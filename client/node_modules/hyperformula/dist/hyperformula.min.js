/*!
 * Copyright (c) HANDSONCODE sp. z o. o.
 * 
 * HYPERFORMULA is a software distributed by HANDSONCODE sp. z o. o., a
 * Polish corporation based in Gdynia, Poland, at Aleja Zwyciestwa 96-98,
 * registered by the District Court in Gdansk under number 538651,
 * EU VAT: PL5862294002, share capital: PLN 62,800.00.
 * 
 * This software is dual-licensed, giving you the option to use it under
 * either a proprietary license or the GNU General Public License version 3
 * (GPLv3). The specific license under which you use the software is
 * determined by the license key you apply. Each licensing option comes with
 * its own terms and conditions as specified below.
 * 
 *   1. PROPRIETARY LICENSE:
 * 
 *     Your use of this software is subject to the terms included in an
 *     applicable proprietary license agreement between you and HANDSONCODE.
 *     The proprietary license can be purchased from HANDSONCODE or an
 *     authorized reseller.
 * 
 *   2. GNU GENERAL PUBLIC LICENSE v3:
 * 
 *     This software is also available under the terms of the GNU General
 *     Public License v3. You are permitted to run, modify, and distribute
 *     this software under the terms of the GPLv3, as published by the Free
 *     Software Foundation. The full text of the GPLv3 can be found at
 *     https://www.gnu.org/licenses/.
 * 
 * UNLESS EXPRESSLY AGREED OTHERWISE, HANDSONCODE PROVIDES THIS SOFTWARE ON
 * AN "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, AND IN NO
 * EVENT AND UNDER NO LEGAL THEORY, SHALL HANDSONCODE BE LIABLE TO YOU FOR
 * DAMAGES, INCLUDING ANY DIRECT, INDIRECT, SPECIAL, INCIDENTAL, OR
 * CONSEQUENTIAL DAMAGES OF ANY CHARACTER ARISING FROM USE OR INABILITY TO
 * USE THIS SOFTWARE.
 * 
 * Version: 3.0.0
 * Release date: 14/01/2025 (built at 14/01/2025 11:44:29)
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("chevrotain"),require("tiny-emitter")):"function"==typeof define&&define.amd?define("HyperFormula",["chevrotain","tiny-emitter"],t):"object"==typeof exports?exports.HyperFormula=t(require("chevrotain"),require("tiny-emitter")):e.HyperFormula=t(e.chevrotain,e.TinyEmitter)}("undefined"!=typeof self?self:this,(function(e,t){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(n,s,function(t){return e[t]}.bind(null,s));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){e.exports=r(1)},function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;var n=r(2);t.ArraySize=n.ArraySize;var s=r(106);t.CellError=s.CellError,t.CellType=s.CellType,t.CellValueDetailedType=s.CellValueDetailedType,t.CellValueType=s.CellValueType,t.ErrorType=s.ErrorType;var o=r(194);t.DetailedCellError=o.DetailedCellError;var a=r(195),i=r(199);t.AlwaysDense=i.AlwaysDense,t.AlwaysSparse=i.AlwaysSparse,t.DenseSparseChooseBasedOnThreshold=i.DenseSparseChooseBasedOnThreshold;var u=r(167);t.ConfigValueTooBigError=u.ConfigValueTooBigError,t.ConfigValueTooSmallError=u.ConfigValueTooSmallError,t.EvaluationSuspendedError=u.EvaluationSuspendedError,t.ExpectedOneOfValuesError=u.ExpectedOneOfValuesError,t.ExpectedValueOfTypeError=u.ExpectedValueOfTypeError,t.FunctionPluginValidationError=u.FunctionPluginValidationError,t.InvalidAddressError=u.InvalidAddressError,t.InvalidArgumentsError=u.InvalidArgumentsError,t.LanguageAlreadyRegisteredError=u.LanguageAlreadyRegisteredError,t.LanguageNotRegisteredError=u.LanguageNotRegisteredError,t.MissingTranslationError=u.MissingTranslationError,t.NamedExpressionDoesNotExistError=u.NamedExpressionDoesNotExistError,t.NamedExpressionNameIsAlreadyTakenError=u.NamedExpressionNameIsAlreadyTakenError,t.NamedExpressionNameIsInvalidError=u.NamedExpressionNameIsInvalidError,t.NoOperationToRedoError=u.NoOperationToRedoError,t.NoOperationToUndoError=u.NoOperationToUndoError,t.NoRelativeAddressesAllowedError=u.NoRelativeAddressesAllowedError,t.NoSheetWithIdError=u.NoSheetWithIdError,t.NoSheetWithNameError=u.NoSheetWithNameError,t.NotAFormulaError=u.NotAFormulaError,t.NothingToPasteError=u.NothingToPasteError,t.ProtectedFunctionTranslationError=u.ProtectedFunctionTranslationError,t.SheetNameAlreadyTakenError=u.SheetNameAlreadyTakenError,t.SheetSizeLimitExceededError=u.SheetSizeLimitExceededError,t.SourceLocationHasArrayError=u.SourceLocationHasArrayError,t.TargetLocationHasArrayError=u.TargetLocationHasArrayError,t.UnableToParseError=u.UnableToParseError;var l=r(222);t.ExportedCellChange=l.ExportedCellChange,t.ExportedNamedExpressionChange=l.ExportedNamedExpressionChange;var c=r(204);t.HyperFormula=c.HyperFormula;var h,d=(h=r(240))&&h.__esModule?h:{default:h},p=r(188);t.FunctionPlugin=p.FunctionPlugin,t.FunctionArgumentType=p.FunctionArgumentType,t.EmptyValue=p.EmptyValue;var m=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=E(t);if(r&&r.has(e))return r.get(e);var n={__proto__:null},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&{}.hasOwnProperty.call(e,o)){var a=s?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(n,o,a):n[o]=e[o]}return n.default=e,r&&r.set(e,n),n}(r(241)),g=r(159);function E(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(E=function(e){return e?r:t})(e)}t.SimpleRangeValue=g.SimpleRangeValue;class T extends c.HyperFormula{}T.HyperFormula=c.HyperFormula,T.ErrorType=s.ErrorType,T.CellError=s.CellError,T.CellType=s.CellType,T.CellValueType=s.CellValueType,T.CellValueDetailedType=s.CellValueDetailedType,T.DetailedCellError=o.DetailedCellError,T.ExportedCellChange=l.ExportedCellChange,T.ExportedNamedExpressionChange=l.ExportedNamedExpressionChange,T.ConfigValueTooBigError=u.ConfigValueTooBigError,T.ConfigValueTooSmallError=u.ConfigValueTooSmallError,T.EvaluationSuspendedError=u.EvaluationSuspendedError,T.ExpectedOneOfValuesError=u.ExpectedOneOfValuesError,T.ExpectedValueOfTypeError=u.ExpectedValueOfTypeError,T.ArraySize=n.ArraySize,T.SimpleRangeValue=g.SimpleRangeValue,T.EmptyValue=p.EmptyValue,T.FunctionPlugin=p.FunctionPlugin,T.FunctionArgumentType=p.FunctionArgumentType,T.FunctionPluginValidationError=u.FunctionPluginValidationError,T.InvalidAddressError=u.InvalidAddressError,T.InvalidArgumentsError=u.InvalidArgumentsError,T.LanguageNotRegisteredError=u.LanguageNotRegisteredError,T.LanguageAlreadyRegisteredError=u.LanguageAlreadyRegisteredError,T.MissingTranslationError=u.MissingTranslationError,T.NamedExpressionDoesNotExistError=u.NamedExpressionDoesNotExistError,T.NamedExpressionNameIsAlreadyTakenError=u.NamedExpressionNameIsAlreadyTakenError,T.NamedExpressionNameIsInvalidError=u.NamedExpressionNameIsInvalidError,T.NoOperationToRedoError=u.NoOperationToRedoError,T.NoOperationToUndoError=u.NoOperationToUndoError,T.NoRelativeAddressesAllowedError=u.NoRelativeAddressesAllowedError,T.NoSheetWithIdError=u.NoSheetWithIdError,T.NoSheetWithNameError=u.NoSheetWithNameError,T.NotAFormulaError=u.NotAFormulaError,T.NothingToPasteError=u.NothingToPasteError,T.ProtectedFunctionTranslationError=u.ProtectedFunctionTranslationError,T.SheetNameAlreadyTakenError=u.SheetNameAlreadyTakenError,T.SheetSizeLimitExceededError=u.SheetSizeLimitExceededError,T.SourceLocationHasArrayError=u.SourceLocationHasArrayError,T.TargetLocationHasArrayError=u.TargetLocationHasArrayError,T.UnableToParseError=u.UnableToParseError;const y=a.Config.defaultConfig.language;c.HyperFormula.registerLanguage(y,d.default),c.HyperFormula.languages[d.default.langCode]=d.default;for(const e of Object.getOwnPropertyNames(m))e.startsWith("_")||c.HyperFormula.registerFunctionPlugin(m[e]);t.default=T},function(e,t,r){"use strict";t.__esModule=!0,t.ArraySizePredictor=t.ArraySize=void 0,r(3),r(73),r(85),r(94);var n=r(105),s=r(187),o=r(188),a=r(137);class i{constructor(e,t,r=!1){this.width=e,this.height=t,this.isRef=r}static error(){return new i(1,1,!0)}static scalar(){return new i(1,1,!1)}isScalar(){return 1===this.width&&1===this.height||this.isRef}}t.ArraySize=i;t.ArraySizePredictor=class{constructor(e,t){this.config=e,this.functionRegistry=t}checkArraySize(e,t){return this.checkArraySizeForAst(e,{formulaAddress:t,arraysFlag:this.config.useArrayArithmetic})}checkArraySizeForAst(e,t){switch(e.type){case a.AstNodeType.FUNCTION_CALL:return this.checkArraySizeForFunction(e,t);case a.AstNodeType.COLUMN_RANGE:case a.AstNodeType.ROW_RANGE:case a.AstNodeType.CELL_RANGE:{const r=n.AbsoluteCellRange.fromAstOrUndef(e,t.formulaAddress);return void 0===r?i.error():new i(r.width(),r.height(),!0)}case a.AstNodeType.ARRAY:{const r=[],n=[];for(const s of e.args){const e=s.map((e=>this.checkArraySizeForAst(e,t))),o=Math.min(...e.map((e=>e.height))),a=e.reduce(((e,t)=>e+t.width),0);r.push(o),n.push(a)}const s=r.reduce(((e,t)=>e+t),0),o=Math.min(...n);return new i(o,s)}case a.AstNodeType.STRING:case a.AstNodeType.NUMBER:return i.scalar();case a.AstNodeType.CELL_REFERENCE:return new i(1,1,!0);case a.AstNodeType.DIV_OP:case a.AstNodeType.CONCATENATE_OP:case a.AstNodeType.EQUALS_OP:case a.AstNodeType.GREATER_THAN_OP:case a.AstNodeType.GREATER_THAN_OR_EQUAL_OP:case a.AstNodeType.LESS_THAN_OP:case a.AstNodeType.LESS_THAN_OR_EQUAL_OP:case a.AstNodeType.MINUS_OP:case a.AstNodeType.NOT_EQUAL_OP:case a.AstNodeType.PLUS_OP:case a.AstNodeType.POWER_OP:case a.AstNodeType.TIMES_OP:{const r=this.checkArraySizeForAst(e.left,t),n=this.checkArraySizeForAst(e.right,t);return!t.arraysFlag&&(r.height>1||r.width>1||n.height>1||n.width>1)?i.error():(s=r,o=n,new i(Math.max(s.width,o.width),Math.max(s.height,o.height)))}case a.AstNodeType.MINUS_UNARY_OP:case a.AstNodeType.PLUS_UNARY_OP:case a.AstNodeType.PERCENT_OP:{const n=this.checkArraySizeForAst(e.value,t);return!t.arraysFlag&&(n.height>1||n.width>1)?i.error():new i((r=n).width,r.height)}case a.AstNodeType.PARENTHESIS:return this.checkArraySizeForAst(e.expression,t);case a.AstNodeType.EMPTY:default:return i.error()}var r,s,o}checkArraySizeForFunction(e,t){const r=this.functionRegistry.getArraySizeFunction(e.procedureName);if(void 0!==r)return r(e,t);const n=this.functionRegistry.getMetadata(e.procedureName);if(void 0===n||n.expandRanges||!t.arraysFlag||n.vectorizationForbidden||void 0===n.parameters)return new i(1,1);const a=e.args.map((e=>{var r;return this.checkArraySizeForAst(e,new s.InterpreterState(t.formulaAddress,t.arraysFlag||null!==(r=null==n?void 0:n.arrayFunction)&&void 0!==r&&r))})),u=[...n.parameters];if(void 0!==n.repeatLastArgs&&u.length<a.length&&(a.length-u.length)%n.repeatLastArgs!=0)return i.error();for(;u.length<a.length;){if(void 0===n.repeatLastArgs)return i.error();u.push(...u.slice(u.length-n.repeatLastArgs))}let l=1,c=1;for(let e=0;e<a.length;e++)u[e].argumentType!==o.FunctionArgumentType.RANGE&&u[e].argumentType!==o.FunctionArgumentType.ANY&&(c=Math.max(c,a[e].height),l=Math.max(l,a[e].width));return new i(l,c)}}},function(e,t,r){"use strict";var n=r(4),s=r(41),o=r(65),a=r(70),i=r(72);n({target:"Array",proto:!0,arity:1,forced:r(9)((function(){return 4294967297!==[].push.call({length:4294967296},1)}))||!function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(e){return e instanceof TypeError}}()},{push:function(e){var t=s(this),r=o(t),n=arguments.length;i(r+n);for(var u=0;u<n;u++)t[r]=arguments[u],r++;return a(t,r),r}})},function(e,t,r){"use strict";var n=r(5),s=r(7).f,o=r(45),a=r(49),i=r(39),u=r(57),l=r(69);e.exports=function(e,t){var r,c,h,d,p,m=e.target,g=e.global,E=e.stat;if(r=g?n:E?n[m]||i(m,{}):n[m]&&n[m].prototype)for(c in t){if(d=t[c],h=e.dontCallGetSet?(p=s(r,c))&&p.value:r[c],!l(g?c:m+(E?".":"#")+c,e.forced)&&void 0!==h){if(typeof d==typeof h)continue;u(d,h)}(e.sham||h&&h.sham)&&o(d,"sham",!0),a(r,c,d,e)}}},function(e,t,r){"use strict";(function(t){var r=function(e){return e&&e.Math===Math&&e};e.exports=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof t&&t)||r("object"==typeof this&&this)||function(){return this}()||Function("return this")()}).call(this,r(6))},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";var n=r(8),s=r(10),o=r(12),a=r(13),i=r(14),u=r(20),l=r(40),c=r(43),h=Object.getOwnPropertyDescriptor;t.f=n?h:function(e,t){if(e=i(e),t=u(t),c)try{return h(e,t)}catch(e){}if(l(e,t))return a(!s(o.f,e,t),e[t])}},function(e,t,r){"use strict";var n=r(9);e.exports=!n((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))},function(e,t,r){"use strict";e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,r){"use strict";var n=r(11),s=Function.prototype.call;e.exports=n?s.bind(s):function(){return s.apply(s,arguments)}},function(e,t,r){"use strict";var n=r(9);e.exports=!n((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}))},function(e,t,r){"use strict";var n={}.propertyIsEnumerable,s=Object.getOwnPropertyDescriptor,o=s&&!n.call({1:2},1);t.f=o?function(e){var t=s(this,e);return!!t&&t.enumerable}:n},function(e,t,r){"use strict";e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,r){"use strict";var n=r(15),s=r(18);e.exports=function(e){return n(s(e))}},function(e,t,r){"use strict";var n=r(16),s=r(9),o=r(17),a=Object,i=n("".split);e.exports=s((function(){return!a("z").propertyIsEnumerable(0)}))?function(e){return"String"===o(e)?i(e,""):a(e)}:a},function(e,t,r){"use strict";var n=r(11),s=Function.prototype,o=s.call,a=n&&s.bind.bind(o,o);e.exports=n?a:function(e){return function(){return o.apply(e,arguments)}}},function(e,t,r){"use strict";var n=r(16),s=n({}.toString),o=n("".slice);e.exports=function(e){return o(s(e),8,-1)}},function(e,t,r){"use strict";var n=r(19),s=TypeError;e.exports=function(e){if(n(e))throw new s("Can't call method on "+e);return e}},function(e,t,r){"use strict";e.exports=function(e){return null==e}},function(e,t,r){"use strict";var n=r(21),s=r(24);e.exports=function(e){var t=n(e,"string");return s(t)?t:t+""}},function(e,t,r){"use strict";var n=r(10),s=r(22),o=r(24),a=r(31),i=r(34),u=r(35),l=TypeError,c=u("toPrimitive");e.exports=function(e,t){if(!s(e)||o(e))return e;var r,u=a(e,c);if(u){if(void 0===t&&(t="default"),r=n(u,e,t),!s(r)||o(r))return r;throw new l("Can't convert object to primitive value")}return void 0===t&&(t="number"),i(e,t)}},function(e,t,r){"use strict";var n=r(23);e.exports=function(e){return"object"==typeof e?null!==e:n(e)}},function(e,t,r){"use strict";var n="object"==typeof document&&document.all;e.exports=void 0===n&&void 0!==n?function(e){return"function"==typeof e||e===n}:function(e){return"function"==typeof e}},function(e,t,r){"use strict";var n=r(25),s=r(23),o=r(26),a=r(27),i=Object;e.exports=a?function(e){return"symbol"==typeof e}:function(e){var t=n("Symbol");return s(t)&&o(t.prototype,i(e))}},function(e,t,r){"use strict";var n=r(5),s=r(23);e.exports=function(e,t){return arguments.length<2?(r=n[e],s(r)?r:void 0):n[e]&&n[e][t];var r}},function(e,t,r){"use strict";var n=r(16);e.exports=n({}.isPrototypeOf)},function(e,t,r){"use strict";var n=r(28);e.exports=n&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(e,t,r){"use strict";var n=r(29),s=r(9),o=r(5).String;e.exports=!!Object.getOwnPropertySymbols&&!s((function(){var e=Symbol("symbol detection");return!o(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&n&&n<41}))},function(e,t,r){"use strict";var n,s,o=r(5),a=r(30),i=o.process,u=o.Deno,l=i&&i.versions||u&&u.version,c=l&&l.v8;c&&(s=(n=c.split("."))[0]>0&&n[0]<4?1:+(n[0]+n[1])),!s&&a&&(!(n=a.match(/Edge\/(\d+)/))||n[1]>=74)&&(n=a.match(/Chrome\/(\d+)/))&&(s=+n[1]),e.exports=s},function(e,t,r){"use strict";var n=r(5).navigator,s=n&&n.userAgent;e.exports=s?String(s):""},function(e,t,r){"use strict";var n=r(32),s=r(19);e.exports=function(e,t){var r=e[t];return s(r)?void 0:n(r)}},function(e,t,r){"use strict";var n=r(23),s=r(33),o=TypeError;e.exports=function(e){if(n(e))return e;throw new o(s(e)+" is not a function")}},function(e,t,r){"use strict";var n=String;e.exports=function(e){try{return n(e)}catch(e){return"Object"}}},function(e,t,r){"use strict";var n=r(10),s=r(23),o=r(22),a=TypeError;e.exports=function(e,t){var r,i;if("string"===t&&s(r=e.toString)&&!o(i=n(r,e)))return i;if(s(r=e.valueOf)&&!o(i=n(r,e)))return i;if("string"!==t&&s(r=e.toString)&&!o(i=n(r,e)))return i;throw new a("Can't convert object to primitive value")}},function(e,t,r){"use strict";var n=r(5),s=r(36),o=r(40),a=r(42),i=r(28),u=r(27),l=n.Symbol,c=s("wks"),h=u?l.for||l:l&&l.withoutSetter||a;e.exports=function(e){return o(c,e)||(c[e]=i&&o(l,e)?l[e]:h("Symbol."+e)),c[e]}},function(e,t,r){"use strict";var n=r(37);e.exports=function(e,t){return n[e]||(n[e]=t||{})}},function(e,t,r){"use strict";var n=r(38),s=r(5),o=r(39),a="__core-js_shared__",i=e.exports=s[a]||o(a,{});(i.versions||(i.versions=[])).push({version:"3.39.0",mode:n?"pure":"global",copyright:"© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.39.0/LICENSE",source:"https://github.com/zloirock/core-js"})},function(e,t,r){"use strict";e.exports=!1},function(e,t,r){"use strict";var n=r(5),s=Object.defineProperty;e.exports=function(e,t){try{s(n,e,{value:t,configurable:!0,writable:!0})}catch(r){n[e]=t}return t}},function(e,t,r){"use strict";var n=r(16),s=r(41),o=n({}.hasOwnProperty);e.exports=Object.hasOwn||function(e,t){return o(s(e),t)}},function(e,t,r){"use strict";var n=r(18),s=Object;e.exports=function(e){return s(n(e))}},function(e,t,r){"use strict";var n=r(16),s=0,o=Math.random(),a=n(1..toString);e.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+a(++s+o,36)}},function(e,t,r){"use strict";var n=r(8),s=r(9),o=r(44);e.exports=!n&&!s((function(){return 7!==Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a}))},function(e,t,r){"use strict";var n=r(5),s=r(22),o=n.document,a=s(o)&&s(o.createElement);e.exports=function(e){return a?o.createElement(e):{}}},function(e,t,r){"use strict";var n=r(8),s=r(46),o=r(13);e.exports=n?function(e,t,r){return s.f(e,t,o(1,r))}:function(e,t,r){return e[t]=r,e}},function(e,t,r){"use strict";var n=r(8),s=r(43),o=r(47),a=r(48),i=r(20),u=TypeError,l=Object.defineProperty,c=Object.getOwnPropertyDescriptor,h="enumerable",d="configurable",p="writable";t.f=n?o?function(e,t,r){if(a(e),t=i(t),a(r),"function"==typeof e&&"prototype"===t&&"value"in r&&p in r&&!r[p]){var n=c(e,t);n&&n[p]&&(e[t]=r.value,r={configurable:d in r?r[d]:n[d],enumerable:h in r?r[h]:n[h],writable:!1})}return l(e,t,r)}:l:function(e,t,r){if(a(e),t=i(t),a(r),s)try{return l(e,t,r)}catch(e){}if("get"in r||"set"in r)throw new u("Accessors not supported");return"value"in r&&(e[t]=r.value),e}},function(e,t,r){"use strict";var n=r(8),s=r(9);e.exports=n&&s((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},function(e,t,r){"use strict";var n=r(22),s=String,o=TypeError;e.exports=function(e){if(n(e))return e;throw new o(s(e)+" is not an object")}},function(e,t,r){"use strict";var n=r(23),s=r(46),o=r(50),a=r(39);e.exports=function(e,t,r,i){i||(i={});var u=i.enumerable,l=void 0!==i.name?i.name:t;if(n(r)&&o(r,l,i),i.global)u?e[t]=r:a(t,r);else{try{i.unsafe?e[t]&&(u=!0):delete e[t]}catch(e){}u?e[t]=r:s.f(e,t,{value:r,enumerable:!1,configurable:!i.nonConfigurable,writable:!i.nonWritable})}return e}},function(e,t,r){"use strict";var n=r(16),s=r(9),o=r(23),a=r(40),i=r(8),u=r(51).CONFIGURABLE,l=r(52),c=r(53),h=c.enforce,d=c.get,p=String,m=Object.defineProperty,g=n("".slice),E=n("".replace),T=n([].join),y=i&&!s((function(){return 8!==m((function(){}),"length",{value:8}).length})),f=String(String).split("String"),A=e.exports=function(e,t,r){"Symbol("===g(p(t),0,7)&&(t="["+E(p(t),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),r&&r.getter&&(t="get "+t),r&&r.setter&&(t="set "+t),(!a(e,"name")||u&&e.name!==t)&&(i?m(e,"name",{value:t,configurable:!0}):e.name=t),y&&r&&a(r,"arity")&&e.length!==r.arity&&m(e,"length",{value:r.arity});try{r&&a(r,"constructor")&&r.constructor?i&&m(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(e){}var n=h(e);return a(n,"source")||(n.source=T(f,"string"==typeof t?t:"")),e};Function.prototype.toString=A((function(){return o(this)&&d(this).source||l(this)}),"toString")},function(e,t,r){"use strict";var n=r(8),s=r(40),o=Function.prototype,a=n&&Object.getOwnPropertyDescriptor,i=s(o,"name"),u=i&&"something"===function(){}.name,l=i&&(!n||n&&a(o,"name").configurable);e.exports={EXISTS:i,PROPER:u,CONFIGURABLE:l}},function(e,t,r){"use strict";var n=r(16),s=r(23),o=r(37),a=n(Function.toString);s(o.inspectSource)||(o.inspectSource=function(e){return a(e)}),e.exports=o.inspectSource},function(e,t,r){"use strict";var n,s,o,a=r(54),i=r(5),u=r(22),l=r(45),c=r(40),h=r(37),d=r(55),p=r(56),m="Object already initialized",g=i.TypeError,E=i.WeakMap;if(a||h.state){var T=h.state||(h.state=new E);T.get=T.get,T.has=T.has,T.set=T.set,n=function(e,t){if(T.has(e))throw new g(m);return t.facade=e,T.set(e,t),t},s=function(e){return T.get(e)||{}},o=function(e){return T.has(e)}}else{var y=d("state");p[y]=!0,n=function(e,t){if(c(e,y))throw new g(m);return t.facade=e,l(e,y,t),t},s=function(e){return c(e,y)?e[y]:{}},o=function(e){return c(e,y)}}e.exports={set:n,get:s,has:o,enforce:function(e){return o(e)?s(e):n(e,{})},getterFor:function(e){return function(t){var r;if(!u(t)||(r=s(t)).type!==e)throw new g("Incompatible receiver, "+e+" required");return r}}}},function(e,t,r){"use strict";var n=r(5),s=r(23),o=n.WeakMap;e.exports=s(o)&&/native code/.test(String(o))},function(e,t,r){"use strict";var n=r(36),s=r(42),o=n("keys");e.exports=function(e){return o[e]||(o[e]=s(e))}},function(e,t,r){"use strict";e.exports={}},function(e,t,r){"use strict";var n=r(40),s=r(58),o=r(7),a=r(46);e.exports=function(e,t,r){for(var i=s(t),u=a.f,l=o.f,c=0;c<i.length;c++){var h=i[c];n(e,h)||r&&n(r,h)||u(e,h,l(t,h))}}},function(e,t,r){"use strict";var n=r(25),s=r(16),o=r(59),a=r(68),i=r(48),u=s([].concat);e.exports=n("Reflect","ownKeys")||function(e){var t=o.f(i(e)),r=a.f;return r?u(t,r(e)):t}},function(e,t,r){"use strict";var n=r(60),s=r(67).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return n(e,s)}},function(e,t,r){"use strict";var n=r(16),s=r(40),o=r(14),a=r(61).indexOf,i=r(56),u=n([].push);e.exports=function(e,t){var r,n=o(e),l=0,c=[];for(r in n)!s(i,r)&&s(n,r)&&u(c,r);for(;t.length>l;)s(n,r=t[l++])&&(~a(c,r)||u(c,r));return c}},function(e,t,r){"use strict";var n=r(14),s=r(62),o=r(65),a=function(e){return function(t,r,a){var i=n(t),u=o(i);if(0===u)return!e&&-1;var l,c=s(a,u);if(e&&r!=r){for(;u>c;)if((l=i[c++])!=l)return!0}else for(;u>c;c++)if((e||c in i)&&i[c]===r)return e||c||0;return!e&&-1}};e.exports={includes:a(!0),indexOf:a(!1)}},function(e,t,r){"use strict";var n=r(63),s=Math.max,o=Math.min;e.exports=function(e,t){var r=n(e);return r<0?s(r+t,0):o(r,t)}},function(e,t,r){"use strict";var n=r(64);e.exports=function(e){var t=+e;return t!=t||0===t?0:n(t)}},function(e,t,r){"use strict";var n=Math.ceil,s=Math.floor;e.exports=Math.trunc||function(e){var t=+e;return(t>0?s:n)(t)}},function(e,t,r){"use strict";var n=r(66);e.exports=function(e){return n(e.length)}},function(e,t,r){"use strict";var n=r(63),s=Math.min;e.exports=function(e){var t=n(e);return t>0?s(t,9007199254740991):0}},function(e,t,r){"use strict";e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(e,t,r){"use strict";t.f=Object.getOwnPropertySymbols},function(e,t,r){"use strict";var n=r(9),s=r(23),o=/#|\.prototype\./,a=function(e,t){var r=u[i(e)];return r===c||r!==l&&(s(t)?n(t):!!t)},i=a.normalize=function(e){return String(e).replace(o,".").toLowerCase()},u=a.data={},l=a.NATIVE="N",c=a.POLYFILL="P";e.exports=a},function(e,t,r){"use strict";var n=r(8),s=r(71),o=TypeError,a=Object.getOwnPropertyDescriptor,i=n&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(e){return e instanceof TypeError}}();e.exports=i?function(e,t){if(s(e)&&!a(e,"length").writable)throw new o("Cannot set read only .length");return e.length=t}:function(e,t){return e.length=t}},function(e,t,r){"use strict";var n=r(17);e.exports=Array.isArray||function(e){return"Array"===n(e)}},function(e,t,r){"use strict";var n=TypeError;e.exports=function(e){if(e>9007199254740991)throw n("Maximum allowed index exceeded");return e}},function(e,t,r){"use strict";r(74)},function(e,t,r){"use strict";var n=r(4),s=r(5),o=r(75),a=r(48),i=r(23),u=r(76),l=r(78),c=r(79),h=r(9),d=r(40),p=r(35),m=r(80).IteratorPrototype,g=r(8),E=r(38),T="constructor",y="Iterator",f=p("toStringTag"),A=TypeError,R=s[y],N=E||!i(R)||R.prototype!==m||!h((function(){R({})})),S=function(){if(o(this,m),u(this)===m)throw new A("Abstract class Iterator not directly constructable")},C=function(e,t){g?l(m,e,{configurable:!0,get:function(){return t},set:function(t){if(a(this),this===m)throw new A("You can't redefine this property");d(this,e)?this[e]=t:c(this,e,t)}}):m[e]=t};d(m,f)||C(f,y),!N&&d(m,T)&&m[T]!==Object||C(T,S),S.prototype=m,n({global:!0,constructor:!0,forced:N},{Iterator:S})},function(e,t,r){"use strict";var n=r(26),s=TypeError;e.exports=function(e,t){if(n(t,e))return e;throw new s("Incorrect invocation")}},function(e,t,r){"use strict";var n=r(40),s=r(23),o=r(41),a=r(55),i=r(77),u=a("IE_PROTO"),l=Object,c=l.prototype;e.exports=i?l.getPrototypeOf:function(e){var t=o(e);if(n(t,u))return t[u];var r=t.constructor;return s(r)&&t instanceof r?r.prototype:t instanceof l?c:null}},function(e,t,r){"use strict";var n=r(9);e.exports=!n((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},function(e,t,r){"use strict";var n=r(50),s=r(46);e.exports=function(e,t,r){return r.get&&n(r.get,t,{getter:!0}),r.set&&n(r.set,t,{setter:!0}),s.f(e,t,r)}},function(e,t,r){"use strict";var n=r(8),s=r(46),o=r(13);e.exports=function(e,t,r){n?s.f(e,t,o(0,r)):e[t]=r}},function(e,t,r){"use strict";var n,s,o,a=r(9),i=r(23),u=r(22),l=r(81),c=r(76),h=r(49),d=r(35),p=r(38),m=d("iterator"),g=!1;[].keys&&("next"in(o=[].keys())?(s=c(c(o)))!==Object.prototype&&(n=s):g=!0),!u(n)||a((function(){var e={};return n[m].call(e)!==e}))?n={}:p&&(n=l(n)),i(n[m])||h(n,m,(function(){return this})),e.exports={IteratorPrototype:n,BUGGY_SAFARI_ITERATORS:g}},function(e,t,r){"use strict";var n,s=r(48),o=r(82),a=r(67),i=r(56),u=r(84),l=r(44),c=r(55),h="prototype",d="script",p=c("IE_PROTO"),m=function(){},g=function(e){return"<"+d+">"+e+"</"+d+">"},E=function(e){e.write(g("")),e.close();var t=e.parentWindow.Object;return e=null,t},T=function(){try{n=new ActiveXObject("htmlfile")}catch(e){}var e,t,r;T="undefined"!=typeof document?document.domain&&n?E(n):(t=l("iframe"),r="java"+d+":",t.style.display="none",u.appendChild(t),t.src=String(r),(e=t.contentWindow.document).open(),e.write(g("document.F=Object")),e.close(),e.F):E(n);for(var s=a.length;s--;)delete T[h][a[s]];return T()};i[p]=!0,e.exports=Object.create||function(e,t){var r;return null!==e?(m[h]=s(e),r=new m,m[h]=null,r[p]=e):r=T(),void 0===t?r:o.f(r,t)}},function(e,t,r){"use strict";var n=r(8),s=r(47),o=r(46),a=r(48),i=r(14),u=r(83);t.f=n&&!s?Object.defineProperties:function(e,t){a(e);for(var r,n=i(t),s=u(t),l=s.length,c=0;l>c;)o.f(e,r=s[c++],n[r]);return e}},function(e,t,r){"use strict";var n=r(60),s=r(67);e.exports=Object.keys||function(e){return n(e,s)}},function(e,t,r){"use strict";var n=r(25);e.exports=n("document","documentElement")},function(e,t,r){"use strict";r(86)},function(e,t,r){"use strict";var n=r(4),s=r(87);n({target:"Iterator",proto:!0,real:!0,forced:r(38)},{map:s})},function(e,t,r){"use strict";var n=r(10),s=r(32),o=r(48),a=r(88),i=r(89),u=r(93),l=i((function(){var e=this.iterator,t=o(n(this.next,e));if(!(this.done=!!t.done))return u(e,this.mapper,[t.value,this.counter++],!0)}));e.exports=function(e){return o(this),s(e),new l(a(this),{mapper:e})}},function(e,t,r){"use strict";e.exports=function(e){return{iterator:e,next:e.next,done:!1}}},function(e,t,r){"use strict";var n=r(10),s=r(81),o=r(45),a=r(90),i=r(35),u=r(53),l=r(31),c=r(80).IteratorPrototype,h=r(91),d=r(92),p=i("toStringTag"),m="IteratorHelper",g="WrapForValidIterator",E=u.set,T=function(e){var t=u.getterFor(e?g:m);return a(s(c),{next:function(){var r=t(this);if(e)return r.nextHandler();try{var n=r.done?void 0:r.nextHandler();return h(n,r.done)}catch(e){throw r.done=!0,e}},return:function(){var r=t(this),s=r.iterator;if(r.done=!0,e){var o=l(s,"return");return o?n(o,s):h(void 0,!0)}if(r.inner)try{d(r.inner.iterator,"normal")}catch(e){return d(s,"throw",e)}return s&&d(s,"normal"),h(void 0,!0)}})},y=T(!0),f=T(!1);o(f,p,"Iterator Helper"),e.exports=function(e,t){var r=function(r,n){n?(n.iterator=r.iterator,n.next=r.next):n=r,n.type=t?g:m,n.nextHandler=e,n.counter=0,n.done=!1,E(this,n)};return r.prototype=t?y:f,r}},function(e,t,r){"use strict";var n=r(49);e.exports=function(e,t,r){for(var s in t)n(e,s,t[s],r);return e}},function(e,t,r){"use strict";e.exports=function(e,t){return{value:e,done:t}}},function(e,t,r){"use strict";var n=r(10),s=r(48),o=r(31);e.exports=function(e,t,r){var a,i;s(e);try{if(!(a=o(e,"return"))){if("throw"===t)throw r;return r}a=n(a,e)}catch(e){i=!0,a=e}if("throw"===t)throw r;if(i)throw a;return s(a),r}},function(e,t,r){"use strict";var n=r(48),s=r(92);e.exports=function(e,t,r,o){try{return o?t(n(r)[0],r[1]):t(r)}catch(t){s(e,"throw",t)}}},function(e,t,r){"use strict";r(95)},function(e,t,r){"use strict";var n=r(4),s=r(96),o=r(32),a=r(48),i=r(88),u=TypeError;n({target:"Iterator",proto:!0,real:!0},{reduce:function(e){a(this),o(e);var t=i(this),r=arguments.length<2,n=r?void 0:arguments[1],l=0;if(s(t,(function(t){r?(r=!1,n=t):n=e(n,t,l),l++}),{IS_RECORD:!0}),r)throw new u("Reduce of empty iterator with no initial value");return n}})},function(e,t,r){"use strict";var n=r(97),s=r(10),o=r(48),a=r(33),i=r(99),u=r(65),l=r(26),c=r(101),h=r(102),d=r(92),p=TypeError,m=function(e,t){this.stopped=e,this.result=t},g=m.prototype;e.exports=function(e,t,r){var E,T,y,f,A,R,N,S=r&&r.that,C=!(!r||!r.AS_ENTRIES),v=!(!r||!r.IS_RECORD),M=!(!r||!r.IS_ITERATOR),w=!(!r||!r.INTERRUPTED),F=n(t,S),O=function(e){return E&&d(E,"normal",e),new m(!0,e)},I=function(e){return C?(o(e),w?F(e[0],e[1],O):F(e[0],e[1])):w?F(e,O):F(e)};if(v)E=e.iterator;else if(M)E=e;else{if(!(T=h(e)))throw new p(a(e)+" is not iterable");if(i(T)){for(y=0,f=u(e);f>y;y++)if((A=I(e[y]))&&l(g,A))return A;return new m(!1)}E=c(e,T)}for(R=v?e.next:E.next;!(N=s(R,E)).done;){try{A=I(N.value)}catch(e){d(E,"throw",e)}if("object"==typeof A&&A&&l(g,A))return A}return new m(!1)}},function(e,t,r){"use strict";var n=r(98),s=r(32),o=r(11),a=n(n.bind);e.exports=function(e,t){return s(e),void 0===t?e:o?a(e,t):function(){return e.apply(t,arguments)}}},function(e,t,r){"use strict";var n=r(17),s=r(16);e.exports=function(e){if("Function"===n(e))return s(e)}},function(e,t,r){"use strict";var n=r(35),s=r(100),o=n("iterator"),a=Array.prototype;e.exports=function(e){return void 0!==e&&(s.Array===e||a[o]===e)}},function(e,t,r){"use strict";e.exports={}},function(e,t,r){"use strict";var n=r(10),s=r(32),o=r(48),a=r(33),i=r(102),u=TypeError;e.exports=function(e,t){var r=arguments.length<2?i(e):t;if(s(r))return o(n(r,e));throw new u(a(e)+" is not iterable")}},function(e,t,r){"use strict";var n=r(103),s=r(31),o=r(19),a=r(100),i=r(35)("iterator");e.exports=function(e){if(!o(e))return s(e,i)||s(e,"@@iterator")||a[n(e)]}},function(e,t,r){"use strict";var n=r(104),s=r(23),o=r(17),a=r(35)("toStringTag"),i=Object,u="Arguments"===o(function(){return arguments}());e.exports=n?o:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=i(e),a))?r:u?o(t):"Object"===(n=o(t))&&s(t.callee)?"Arguments":n}},function(e,t,r){"use strict";var n={};n[r(35)("toStringTag")]="z",e.exports="[object z]"===String(n)},function(e,t,r){"use strict";t.__esModule=!0,t.WRONG_RANGE_SIZE=t.AbsoluteRowRange=t.AbsoluteColumnRange=t.AbsoluteCellRange=void 0,t.isSimpleCellRange=function(e){return!(!e||"object"!=typeof e&&"function"!=typeof e)&&("start"in e&&(0,n.isSimpleCellAddress)(e.start)&&"end"in e&&(0,n.isSimpleCellAddress)(e.end))},t.simpleCellRange=void 0,r(3);var n=r(106),s=r(167),o=r(137),a=r(161);const i=t.WRONG_RANGE_SIZE="AbsoluteCellRange: Wrong range size";t.simpleCellRange=(e,t)=>({start:e,end:t});class u{constructor(e,t){if(e.sheet!==t.sheet)throw new s.SheetsNotEqual(e.sheet,t.sheet);this.start=(0,n.simpleCellAddress)(e.sheet,e.col,e.row),this.end=(0,n.simpleCellAddress)(t.sheet,t.col,t.row)}get sheet(){return this.start.sheet}static fromSimpleCellAddresses(e,t){if(e.sheet!==t.sheet)throw new s.SheetsNotEqual(e.sheet,t.sheet);const r=t.col-e.col,n=t.row-e.row;return Number.isFinite(n)&&Number.isFinite(r)?new u(e,t):Number.isFinite(n)?new c(e.sheet,e.row,t.row):new l(e.sheet,e.col,t.col)}static fromAst(e,t){return e.type===o.AstNodeType.CELL_RANGE?u.fromCellRange(e,t):e.type===o.AstNodeType.COLUMN_RANGE?l.fromColumnRange(e,t):c.fromRowRangeAst(e,t)}static fromAstOrUndef(e,t){try{return u.fromAst(e,t)}catch(e){return}}static fromCellRange(e,t){return new u(e.start.toSimpleCellAddress(t),e.end.toSimpleCellAddress(t))}static spanFrom(e,t,r){const n=u.spanFromOrUndef(e,t,r);if(void 0===n)throw new Error(i);return n}static spanFromOrUndef(e,t,r){if(!Number.isFinite(t)&&Number.isFinite(r)){if(0!==e.col)return;return new c(e.sheet,e.row,e.row+r-1)}if(!Number.isFinite(r)&&Number.isFinite(t)){if(0!==e.row)return;return new l(e.sheet,e.col,e.col+t-1)}if(Number.isFinite(r)&&Number.isFinite(t))return new u(e,(0,n.simpleCellAddress)(e.sheet,e.col+t-1,e.row+r-1))}static fromCoordinates(e,t,r,s,o){return new u((0,n.simpleCellAddress)(e,t,r),(0,n.simpleCellAddress)(e,s,o))}isFinite(){return Number.isFinite(this.size())}doesOverlap(e){return this.start.sheet==e.start.sheet&&(!(this.end.row<e.start.row||this.start.row>e.end.row)&&!(this.end.col<e.start.col||this.start.col>e.end.col))}addressInRange(e){return this.sheet===e.sheet&&(this.start.row<=e.row&&this.end.row>=e.row&&this.start.col<=e.col&&this.end.col>=e.col)}columnInRange(e){return this.sheet===e.sheet&&(this.start.col<=e.col&&this.end.col>=e.col)}rowInRange(e){return this.sheet===e.sheet&&(this.start.row<=e.row&&this.end.row>=e.row)}containsRange(e){return this.addressInRange(e.start)&&this.addressInRange(e.end)}intersectionWith(e){if(this.sheet!==e.start.sheet)return;const t=Math.max(this.start.row,e.start.row),r=Math.min(this.end.row,e.end.row),s=Math.max(this.start.col,e.start.col),o=Math.min(this.end.col,e.end.col);return t>r||s>o?void 0:new u((0,n.simpleCellAddress)(this.sheet,s,t),(0,n.simpleCellAddress)(this.sheet,o,r))}includesRow(e){return this.start.row<e&&this.end.row>=e}includesColumn(e){return this.start.col<e&&this.end.col>=e}shiftByRows(e){this.start.row+=e,this.end.row+=e}expandByRows(e){this.end.row+=e}shiftByColumns(e){this.start.col+=e,this.end.col+=e}shifted(e,t){return u.spanFrom((0,n.simpleCellAddress)(this.sheet,this.start.col+e,this.start.row+t),this.width(),this.height())}expandByColumns(e){this.end.col+=e}moveToSheet(e){this.start.sheet=e,this.end.sheet=e}removeSpan(e){e instanceof a.RowsSpan?this.removeRows(e.start,e.end):this.removeColumns(e.start,e.end)}shouldBeRemoved(){return this.width()<=0||this.height()<=0}rangeWithSameWidth(e,t){return u.spanFrom((0,n.simpleCellAddress)(this.sheet,this.start.col,e),this.width(),t)}rangeWithSameHeight(e,t){return u.spanFrom((0,n.simpleCellAddress)(this.sheet,e,this.start.row),t,this.height())}toString(){return`${this.start.sheet},${this.start.col},${this.start.row},${this.end.col},${this.end.row}`}width(){return this.end.col-this.start.col+1}height(){return this.end.row-this.start.row+1}size(){return this.height()*this.width()}arrayOfAddressesInRange(){const e=[];for(let t=0;t<this.height();++t){e[t]=[];for(let r=0;r<this.width();++r){const s=(0,n.simpleCellAddress)(this.sheet,this.start.col+r,this.start.row+t);e[t].push(s)}}return e}withStart(e){return new u(e,this.end)}sameDimensionsAs(e){return this.width()===e.width()&&this.height()===e.height()}sameAs(e){return(0,n.equalSimpleCellAddress)(this.start,e.start)&&(0,n.equalSimpleCellAddress)(this.end,e.end)}addressesArrayMap(e,t){const r=[];let s=this.start.row;for(;s<=this.effectiveEndRow(e);){let o=this.start.col;const a=[];for(;o<=this.effectiveEndColumn(e);)a.push(t((0,n.simpleCellAddress)(this.start.sheet,o,s))),o++;r.push(a),s++}return r}addresses(e){const t=[];let r=this.start.row;const s=this.effectiveEndRow(e),o=this.effectiveEndColumn(e);for(;r<=s;){let e=this.start.col;for(;e<=o;)t.push((0,n.simpleCellAddress)(this.start.sheet,e,r)),e++;r++}return t}*addressesWithDirection(e,t,r){if(e>0)if(t>0){let e=this.effectiveEndRow(r);for(;e>=this.start.row;){let t=this.effectiveEndColumn(r);for(;t>=this.start.col;)yield(0,n.simpleCellAddress)(this.start.sheet,t,e),t-=1;e-=1}}else{let e=this.start.row;for(;e<=this.effectiveEndRow(r);){let t=this.effectiveEndColumn(r);for(;t>=this.start.col;)yield(0,n.simpleCellAddress)(this.start.sheet,t,e),t-=1;e+=1}}else if(t>0){let e=this.effectiveEndRow(r);for(;e>=this.start.row;){let t=this.start.col;for(;t<=this.effectiveEndColumn(r);)yield(0,n.simpleCellAddress)(this.start.sheet,t,e),t+=1;e-=1}}else{let e=this.start.row;for(;e<=this.effectiveEndRow(r);){let t=this.start.col;for(;t<=this.effectiveEndColumn(r);)yield(0,n.simpleCellAddress)(this.start.sheet,t,e),t+=1;e+=1}}}getAddress(e,t){if(e<0||t<0||t>this.height()-1||e>this.width()-1)throw Error("Index out of bound");return(0,n.simpleCellAddress)(this.start.sheet,this.start.col+e,this.start.row+t)}exceedsSheetSizeLimits(e,t){return this.end.col>=e||this.end.row>=t}effectiveEndColumn(e){return this.end.col}effectiveEndRow(e){return this.end.row}effectiveWidth(e){return this.width()}effectiveHeight(e){return this.height()}removeRows(e,t){if(!(e>this.end.row)){if(t<this.start.row){const r=t-e+1;return this.shiftByRows(-r)}e<=this.start.row&&(this.start.row=e),this.end.row-=Math.min(t,this.end.row)-e+1}}removeColumns(e,t){if(!(e>this.end.col)){if(t<this.start.col){const r=t-e+1;return this.shiftByColumns(-r)}e<=this.start.col&&(this.start.col=e),this.end.col-=Math.min(t,this.end.col)-e+1}}}t.AbsoluteCellRange=u;class l extends u{constructor(e,t,r){super((0,n.simpleCellAddress)(e,t,0),(0,n.simpleCellAddress)(e,r,Number.POSITIVE_INFINITY))}static fromColumnRange(e,t){const r=e.start.toSimpleColumnAddress(t),n=e.end.toSimpleColumnAddress(t);if(r.sheet!==n.sheet)throw new s.SheetsNotEqual(r.sheet,n.sheet);return new l(r.sheet,r.col,n.col)}shouldBeRemoved(){return this.width()<=0}shiftByRows(e){}expandByRows(e){}shifted(e,t){return new l(this.sheet,this.start.col+e,this.end.col+e)}rangeWithSameHeight(e,t){return new l(this.sheet,e,e+t-1)}exceedsSheetSizeLimits(e,t){return this.end.col>=e}effectiveEndRow(e){return this.effectiveHeight(e)-1}effectiveHeight(e){return e.getSheetHeight(this.sheet)}removeRows(e,t){}}t.AbsoluteColumnRange=l;class c extends u{constructor(e,t,r){super((0,n.simpleCellAddress)(e,0,t),(0,n.simpleCellAddress)(e,Number.POSITIVE_INFINITY,r))}static fromRowRangeAst(e,t){const r=e.start.toSimpleRowAddress(t),n=e.end.toSimpleRowAddress(t);if(r.sheet!==n.sheet)throw new s.SheetsNotEqual(r.sheet,n.sheet);return new c(r.sheet,r.row,n.row)}shouldBeRemoved(){return this.height()<=0}shiftByColumns(e){}expandByColumns(e){}shifted(e,t){return new c(this.sheet,this.start.row+t,this.end.row+t)}rangeWithSameWidth(e,t){return new c(this.sheet,e,e+t-1)}exceedsSheetSizeLimits(e,t){return this.end.row>=t}effectiveEndColumn(e){return this.effectiveWidth(e)-1}effectiveWidth(e){return e.getSheetWidth(this.sheet)}removeColumns(e,t){}}t.AbsoluteRowRange=c},function(e,t,r){"use strict";t.__esModule=!0,t.invalidSimpleRowAddress=t.invalidSimpleColumnAddress=t.invalidSimpleCellAddress=t.getCellValueType=t.getCellValueFormat=t.getCellValueDetailedType=t.getCellType=t.equalSimpleCellAddress=t.addressKey=t.absoluteSheetReference=t.ErrorType=t.CellValueTypeOrd=t.CellValueType=t.CellValueNoNumber=t.CellValueJustNumber=t.CellValueDetailedType=t.CellType=t.CellError=void 0,t.isSimpleCellAddress=function(e){var t,r,n;return e&&("object"==typeof e||"function"==typeof e)&&"number"==typeof(null===(t=e)||void 0===t?void 0:t.sheet)&&"number"==typeof(null===(r=e)||void 0===r?void 0:r.col)&&"number"==typeof(null===(n=e)||void 0===n?void 0:n.row)},t.simpleRowAddress=t.simpleColumnAddress=t.simpleCellAddress=t.movedSimpleCellAddress=void 0;var n,s,o=r(107),a=r(151),i=r(160),u=r(159);!function(e){e.DIV_BY_ZERO="DIV_BY_ZERO",e.NAME="NAME",e.VALUE="VALUE",e.NUM="NUM",e.NA="NA",e.CYCLE="CYCLE",e.REF="REF",e.SPILL="SPILL",e.LIC="LIC",e.ERROR="ERROR"}(n||(t.ErrorType=n={})),function(e){e.FORMULA="FORMULA",e.VALUE="VALUE",e.ARRAY="ARRAY",e.EMPTY="EMPTY",e.ARRAYFORMULA="ARRAYFORMULA"}(s||(t.CellType=s={}));var l,c;t.getCellType=(e,t)=>e instanceof o.ArrayVertex?e.isLeftCorner(t)?s.ARRAYFORMULA:s.ARRAY:e instanceof o.FormulaCellVertex||e instanceof o.ParsingErrorVertex?s.FORMULA:e instanceof o.ValueCellVertex?s.VALUE:s.EMPTY,function(e){e.EMPTY="EMPTY",e.NUMBER="NUMBER",e.STRING="STRING",e.BOOLEAN="BOOLEAN",e.ERROR="ERROR"}(l||(t.CellValueNoNumber=l={})),function(e){e.NUMBER="NUMBER"}(c||(t.CellValueJustNumber=c={}));const h=t.CellValueType=Object.assign(Object.assign({},l),c);t.CellValueDetailedType=Object.assign(Object.assign({},l),i.NumberType);t.CellValueTypeOrd=e=>{switch(e){case h.EMPTY:return 0;case h.NUMBER:return 1;case h.STRING:return 2;case h.BOOLEAN:return 3;case h.ERROR:return 4}throw new Error("Cell value not computed")};const d=e=>{if(e===i.EmptyValue)return h.EMPTY;if(e instanceof p||e instanceof u.SimpleRangeValue)return h.ERROR;if("string"==typeof e)return h.STRING;if((0,i.isExtendedNumber)(e))return h.NUMBER;if("boolean"==typeof e)return h.BOOLEAN;throw new Error("Cell value not computed")};t.getCellValueType=d;t.getCellValueDetailedType=e=>(0,i.isExtendedNumber)(e)?(0,i.getTypeOfExtendedNumber)(e):d(e);t.getCellValueFormat=e=>(0,i.isExtendedNumber)(e)?(0,i.getFormatOfExtendedNumber)(e):void 0;class p{constructor(e,t,r){this.type=e,this.message=t,this.root=r}static parsingError(e){return new p(n.ERROR,`${a.ErrorMessage.ParseError}${e?" "+e:""}`)}attachRootVertex(e){return void 0===this.root?new p(this.type,this.message,e):this}}t.CellError=p;t.simpleRowAddress=(e,t)=>({sheet:e,row:t});t.invalidSimpleRowAddress=e=>e.row<0;t.simpleColumnAddress=(e,t)=>({sheet:e,col:t});t.invalidSimpleColumnAddress=e=>e.col<0;const m=(e,t,r)=>({sheet:e,col:t,row:r});t.simpleCellAddress=m;t.invalidSimpleCellAddress=e=>e.col<0||e.row<0;t.movedSimpleCellAddress=(e,t,r,n)=>m(t,e.col+r,e.row+n);t.addressKey=e=>`${e.sheet},${e.row},${e.col}`;t.absoluteSheetReference=(e,t)=>{var r;return null!==(r=e.sheet)&&void 0!==r?r:t.sheet};t.equalSimpleCellAddress=(e,t)=>e.sheet===t.sheet&&e.col===t.col&&e.row===t.row},function(e,t,r){"use strict";t.__esModule=!0,t.ValueCellVertex=t.TopSort=t.SparseStrategy=t.SheetMapping=t.RangeVertex=t.RangeMapping=t.ParsingErrorVertex=t.Graph=t.FormulaCellVertex=t.EmptyCellVertex=t.DependencyGraph=t.DenseStrategy=t.ArrayVertex=t.ArrayMapping=t.AddressMapping=void 0;var n=r(108);t.DependencyGraph=n.DependencyGraph;var s=r(166);t.AddressMapping=s.AddressMapping;var o=r(173);t.Graph=o.Graph;var a=r(174);t.TopSort=a.TopSort;var i=r(176);t.RangeMapping=i.RangeMapping;var u=r(177);t.SheetMapping=u.SheetMapping;var l=r(168);t.ArrayMapping=l.ArrayMapping;var c=r(170);t.FormulaCellVertex=c.FormulaCellVertex,t.ArrayVertex=c.ArrayVertex;var h=r(180);t.EmptyCellVertex=h.EmptyCellVertex;var d=r(181);t.ValueCellVertex=d.ValueCellVertex;var p=r(182);t.ParsingErrorVertex=p.ParsingErrorVertex;var m=r(172);t.RangeVertex=m.RangeVertex;var g=r(185);t.SparseStrategy=g.SparseStrategy;var E=r(186);t.DenseStrategy=E.DenseStrategy},function(e,t,r){"use strict";t.__esModule=!0,t.DependencyGraph=void 0,r(3),r(109),r(120),r(122),r(124),r(126),r(128),r(130),r(73),r(132),r(134),r(85);var n=r(105),s=r(136),o=r(106),a=r(158),i=r(151),u=r(160),l=r(159),c=r(137),h=r(161),d=r(162),p=r(107),m=r(166),g=r(168),E=r(169),T=r(170),y=r(173),f=r(176),A=r(177);class R{constructor(e,t,r,i,u,l,h,d){this.addressMapping=e,this.rangeMapping=t,this.sheetMapping=r,this.arrayMapping=i,this.stats=u,this.lazilyTransformingAstService=l,this.functionRegistry=h,this.namedExpressions=d,this.changes=a.ContentChanges.empty(),this.dependencyQueryAddresses=e=>{if(e instanceof p.RangeVertex)return this.rangeDependencyQuery(e).map((([e,t])=>e));{const t=this.formulaDependencyQuery(e);if(void 0!==t){const[e,r]=t;return r.map((t=>t instanceof c.NamedExpressionDependency?this.namedExpressions.namedExpressionOrPlaceholder(t.name,e.sheet).address:(0,o.isSimpleCellAddress)(t)?t:(0,n.simpleCellRange)(t.start,t.end)))}return[]}},this.dependencyQueryVertices=e=>{if(e instanceof p.RangeVertex)return this.rangeDependencyQuery(e);{const t=this.formulaDependencyQuery(e);if(void 0!==t){const[e,r]=t;return r.map((t=>{if(t instanceof n.AbsoluteCellRange)return[t.start,this.rangeMapping.fetchRange(t.start,t.end)];if(t instanceof c.NamedExpressionDependency){const r=this.namedExpressions.namedExpressionOrPlaceholder(t.name,e.sheet);return[r.address,this.addressMapping.fetchCell(r.address)]}return[t,this.addressMapping.fetchCell(t)]}))}return[]}},this.rangeDependencyQuery=e=>{const t=[],{smallerRangeVertex:r,restRange:s}=this.rangeMapping.findSmallerRange(e.range);let o;void 0!==r&&this.graph.adjacentNodes(r).has(e)?(o=s,t.push([new n.AbsoluteCellRange(r.start,r.end),r])):o=e.range;for(const e of o.addresses(this)){const r=this.addressMapping.getCell(e);void 0!==r&&t.push([e,r])}return t},this.formulaDependencyQuery=e=>{let t,r;if(!(e instanceof T.FormulaVertex))return;r=e.getAddress(this.lazilyTransformingAstService),t=e.getFormula(this.lazilyTransformingAstService);const n=(0,c.collectDependencies)(t,this.functionRegistry);return[r,(0,s.absolutizeDependencies)(n,r)]},this.graph=new y.Graph(this.dependencyQueryVertices)}static buildEmpty(e,t,r,n,s){return new R(new m.AddressMapping(t.chooseAddressMappingPolicy),new f.RangeMapping,new A.SheetMapping(t.translationPackage),new g.ArrayMapping,s,e,r,n)}setFormulaToCell(e,t,r,n,s,o){const a=T.FormulaVertex.fromAst(t,e,n,this.lazilyTransformingAstService.version());return this.exchangeOrAddFormulaVertex(a),this.processCellDependencies(r,a),this.graph.markNodeAsDirty(a),s&&this.markAsVolatile(a),o&&this.markAsDependentOnStructureChange(a),this.correctInfiniteRangesDependency(e),this.getAndClearContentChanges()}setParsingErrorToCell(e,t){const r=this.shrinkPossibleArrayAndGetCell(e);return this.exchangeOrAddGraphNode(r,t),this.addressMapping.setCell(e,t),this.graph.markNodeAsDirty(t),this.correctInfiniteRangesDependency(e),this.getAndClearContentChanges()}setValueToCell(e,t){const r=this.shrinkPossibleArrayAndGetCell(e);if(r instanceof p.ArrayVertex&&this.arrayMapping.removeArray(r.getRange()),r instanceof p.ValueCellVertex){r.getValues().rawValue!==t.rawValue&&(r.setValues(t),this.graph.markNodeAsDirty(r))}else{const n=new p.ValueCellVertex(t.parsedValue,t.rawValue);this.exchangeOrAddGraphNode(r,n),this.addressMapping.setCell(e,n),this.graph.markNodeAsDirty(n)}return this.correctInfiniteRangesDependency(e),this.getAndClearContentChanges()}setCellEmpty(e){const t=this.shrinkPossibleArrayAndGetCell(e);if(void 0===t)return a.ContentChanges.empty();if(this.graph.adjacentNodes(t).size>0){const r=new p.EmptyCellVertex;this.exchangeGraphNode(t,r),0===this.graph.adjacentNodesCount(r)?(this.removeVertex(r),this.addressMapping.removeCell(e)):(this.graph.markNodeAsDirty(r),this.addressMapping.setCell(e,r))}else this.removeVertex(t),this.addressMapping.removeCell(e);return this.getAndClearContentChanges()}clearDirtyVertices(){this.graph.clearDirtyNodes()}verticesToRecompute(){return this.graph.getDirtyAndVolatileNodes()}processCellDependencies(e,t){const r=this.graph.getNodeId(t);e.forEach((e=>{if(e instanceof n.AbsoluteCellRange){const t=e;let n=this.getRange(t.start,t.end);void 0===n&&(n=new p.RangeVertex(t),this.rangeMapping.setRange(n)),this.graph.addNodeAndReturnId(n);const s=this.graph.getNodeId(n);t.isFinite()||this.graph.markNodeAsInfiniteRange(s);const{smallerRangeVertex:o,restRange:a}=this.rangeMapping.findSmallerRange(t);if(void 0!==o){if(this.graph.addEdge(o,s),n.bruteForce){n.bruteForce=!1;for(const e of t.addresses(this))this.graph.removeEdge(this.fetchCell(e),s)}}else n.bruteForce=!0;const i=this.arrayMapping.getArray(a);if(void 0!==i)this.graph.addEdge(i,s);else for(const e of a.addresses(this)){const{vertex:t,id:r}=this.fetchCellOrCreateEmpty(e);this.graph.addEdge(null!=r?r:t,s)}this.graph.addEdge(s,r),t.isFinite()&&this.correctInfiniteRangesDependenciesByRangeVertex(n)}else if(e instanceof c.NamedExpressionDependency){const n=t.getAddress(this.lazilyTransformingAstService).sheet,{vertex:s,id:o}=this.fetchNamedExpressionVertex(e.name,n);this.graph.addEdge(null!=o?o:s,r)}else{const{vertex:t,id:n}=this.fetchCellOrCreateEmpty(e);this.graph.addEdge(null!=n?n:t,r)}}))}fetchNamedExpressionVertex(e,t){const r=this.namedExpressions.namedExpressionOrPlaceholder(e,t);return this.fetchCellOrCreateEmpty(r.address)}exchangeNode(e,t){const r=this.fetchCellOrCreateEmpty(e).vertex,n=this.fetchCellOrCreateEmpty(t).vertex;this.addressMapping.removeCell(e),this.exchangeGraphNode(r,n)}fetchCellOrCreateEmpty(e){const t=this.addressMapping.getCell(e);if(void 0!==t)return{vertex:t,id:void 0};const r=new p.EmptyCellVertex,n=this.graph.addNodeAndReturnId(r);return this.addressMapping.setCell(e,r),{vertex:r,id:n}}removeRows(e){this.stats.measure(d.StatType.ADJUSTING_GRAPH,(()=>{for(const[t,r]of this.addressMapping.entriesFromRowsSpan(e)){for(const e of this.graph.adjacentNodes(r))this.graph.markNodeAsDirty(e);if(r instanceof p.ArrayVertex){if(!r.isLeftCorner(t))continue;this.shrinkArrayToCorner(r),this.arrayMapping.removeArray(r.getRange())}this.removeVertex(r)}})),this.stats.measure(d.StatType.ADJUSTING_ADDRESS_MAPPING,(()=>{this.addressMapping.removeRows(e)}));const t=this.stats.measure(d.StatType.ADJUSTING_RANGES,(()=>{const t=this.truncateRanges(e,(e=>e.row));return this.getArrayVerticesRelatedToRanges(t)}));return this.stats.measure(d.StatType.ADJUSTING_ARRAY_MAPPING,(()=>{this.fixArraysAfterRemovingRows(e.sheet,e.rowStart,e.numberOfRows)})),this.addStructuralNodesToChangeSet(),{affectedArrays:t,contentChanges:this.getAndClearContentChanges()}}removeSheet(e){this.clearSheet(e);for(const[t,r]of this.addressMapping.sheetEntries(e)){for(const e of this.graph.adjacentNodes(r))this.graph.markNodeAsDirty(e);this.removeVertex(r),this.addressMapping.removeCell(t)}this.stats.measure(d.StatType.ADJUSTING_RANGES,(()=>{const t=this.rangeMapping.removeRangesInSheet(e);for(const e of t)this.removeVertex(e);this.stats.measure(d.StatType.ADJUSTING_ADDRESS_MAPPING,(()=>{this.addressMapping.removeSheet(e)}))}))}clearSheet(e){const t=new Set;for(const[r,n]of this.addressMapping.sheetEntries(e))n instanceof p.ArrayVertex?t.add(n):this.setCellEmpty(r);for(const e of t.values())this.setArrayEmpty(e);this.addStructuralNodesToChangeSet()}removeColumns(e){this.stats.measure(d.StatType.ADJUSTING_GRAPH,(()=>{for(const[t,r]of this.addressMapping.entriesFromColumnsSpan(e)){for(const e of this.graph.adjacentNodes(r))this.graph.markNodeAsDirty(e);if(r instanceof p.ArrayVertex){if(!r.isLeftCorner(t))continue;this.shrinkArrayToCorner(r),this.arrayMapping.removeArray(r.getRange())}this.removeVertex(r)}})),this.stats.measure(d.StatType.ADJUSTING_ADDRESS_MAPPING,(()=>{this.addressMapping.removeColumns(e)}));const t=this.stats.measure(d.StatType.ADJUSTING_RANGES,(()=>{const t=this.truncateRanges(e,(e=>e.col));return this.getArrayVerticesRelatedToRanges(t)}));return this.stats.measure(d.StatType.ADJUSTING_ARRAY_MAPPING,(()=>this.fixArraysAfterRemovingColumns(e.sheet,e.columnStart,e.numberOfColumns))),this.addStructuralNodesToChangeSet(),{affectedArrays:t,contentChanges:this.getAndClearContentChanges()}}addRows(e){this.stats.measure(d.StatType.ADJUSTING_ADDRESS_MAPPING,(()=>{this.addressMapping.addRows(e.sheet,e.rowStart,e.numberOfRows)}));const t=this.stats.measure(d.StatType.ADJUSTING_RANGES,(()=>{const t=this.rangeMapping.moveAllRangesInSheetAfterRowByRows(e.sheet,e.rowStart,e.numberOfRows);return this.fixRangesWhenAddingRows(e.sheet,e.rowStart,e.numberOfRows),this.getArrayVerticesRelatedToRanges(t.verticesWithChangedSize)}));this.stats.measure(d.StatType.ADJUSTING_ARRAY_MAPPING,(()=>{this.fixArraysAfterAddingRow(e.sheet,e.rowStart,e.numberOfRows)}));for(const t of this.addressMapping.verticesFromRowsSpan(e))this.graph.markNodeAsDirty(t);return this.addStructuralNodesToChangeSet(),{affectedArrays:t}}addColumns(e){this.stats.measure(d.StatType.ADJUSTING_ADDRESS_MAPPING,(()=>{this.addressMapping.addColumns(e.sheet,e.columnStart,e.numberOfColumns)}));const t=this.stats.measure(d.StatType.ADJUSTING_RANGES,(()=>{const t=this.rangeMapping.moveAllRangesInSheetAfterColumnByColumns(e.sheet,e.columnStart,e.numberOfColumns);return this.fixRangesWhenAddingColumns(e.sheet,e.columnStart,e.numberOfColumns),this.getArrayVerticesRelatedToRanges(t.verticesWithChangedSize)}));this.stats.measure(d.StatType.ADJUSTING_ARRAY_MAPPING,(()=>this.fixArraysAfterAddingColumn(e.sheet,e.columnStart,e.numberOfColumns)));for(const t of this.addressMapping.verticesFromColumnsSpan(e))this.graph.markNodeAsDirty(t);return this.addStructuralNodesToChangeSet(),{affectedArrays:t,contentChanges:this.getAndClearContentChanges()}}isThereSpaceForArray(e){const t=e.getRangeOrUndef();if(void 0===t)return!1;for(const r of t.addresses(this)){const t=this.addressMapping.getCell(r);if(void 0!==t&&!(t instanceof p.EmptyCellVertex)&&t!==e)return!1}return!0}moveCells(e,t,r,n){for(const s of e.addressesWithDirection(t,r,this)){const a=(0,o.simpleCellAddress)(n,s.col+t,s.row+r);let i=this.addressMapping.getCell(s);const u=this.addressMapping.getCell(a);if(this.addressMapping.removeCell(s),void 0!==i){let t;this.graph.markNodeAsDirty(i),this.addressMapping.setCell(a,i);for(const r of this.graph.adjacentNodes(i))r instanceof p.RangeVertex&&!e.containsRange(r.range)&&(t=null!=t?t:this.fetchCellOrCreateEmpty(s).vertex,this.graph.addEdge(t,r),this.graph.removeEdge(i,r));t&&(this.graph.markNodeAsDirty(t),this.addressMapping.setCell(s,t))}if(void 0!==u){void 0===i&&this.addressMapping.removeCell(a);for(const e of this.graph.adjacentNodes(u))i=null!=i?i:this.fetchCellOrCreateEmpty(a).vertex,this.graph.addEdge(i,e),this.graph.markNodeAsDirty(i);this.removeVertex(u)}}for(const t of this.rangeMapping.rangeVerticesContainedInRange(e))for(const r of this.graph.adjacentNodes(t))if(r instanceof p.RangeVertex&&!e.containsRange(r.range)){this.graph.removeEdge(t,r);for(const e of t.range.addresses(this)){const{vertex:t,id:n}=this.fetchCellOrCreateEmpty(e);this.graph.addEdge(null!=n?n:t,r),this.addressMapping.setCell(e,t),this.graph.markNodeAsDirty(t)}}this.rangeMapping.moveRangesInsideSourceRange(e,t,r,n)}setArrayEmpty(e){const t=n.AbsoluteCellRange.spanFrom(e.getAddress(this.lazilyTransformingAstService),e.width,e.height),r=this.graph.adjacentNodes(e);for(const e of t.addresses(this))this.addressMapping.removeCell(e);for(const t of r.values()){const r=(0,E.collectAddressesDependentToRange)(this.functionRegistry,t,e.getRange(),this.lazilyTransformingAstService,this);for(const e of r){const{vertex:r,id:n}=this.fetchCellOrCreateEmpty(e);this.graph.addEdge(null!=n?n:r,t)}r.length>0&&this.graph.markNodeAsDirty(t)}this.removeVertex(e),this.arrayMapping.removeArray(e.getRange())}addVertex(e,t){this.graph.addNodeAndReturnId(t),this.addressMapping.setCell(e,t)}addArrayVertex(e,t){this.graph.addNodeAndReturnId(t),this.setAddressMappingForArrayVertex(t,e)}*arrayFormulaNodes(){for(const e of this.graph.getNodes())e instanceof p.ArrayVertex&&(yield e)}*entriesFromRowsSpan(e){yield*this.addressMapping.entriesFromRowsSpan(e)}*entriesFromColumnsSpan(e){yield*this.addressMapping.entriesFromColumnsSpan(e)}fetchCell(e){return this.addressMapping.fetchCell(e)}getCell(e){return this.addressMapping.getCell(e)}getCellValue(e){return this.addressMapping.getCellValue(e)}getRawValue(e){return this.addressMapping.getRawValue(e)}getScalarValue(e){const t=this.addressMapping.getCellValue(e);return t instanceof l.SimpleRangeValue?new o.CellError(o.ErrorType.VALUE,i.ErrorMessage.ScalarExpected):t}existsEdge(e,t){return this.graph.existsEdge(e,t)}getSheetId(e){return this.sheetMapping.fetch(e)}getSheetHeight(e){return this.addressMapping.getHeight(e)}getSheetWidth(e){return this.addressMapping.getWidth(e)}getArray(e){return this.arrayMapping.getArray(e)}getRange(e,t){return this.rangeMapping.getRange(e,t)}topSortWithScc(){return this.graph.topSortWithScc()}markAsVolatile(e){this.graph.markNodeAsVolatile(e)}markAsDependentOnStructureChange(e){this.graph.markNodeAsChangingWithStructure(e)}forceApplyPostponedTransformations(){for(const e of this.graph.getNodes())e instanceof p.FormulaCellVertex&&e.ensureRecentData(this.lazilyTransformingAstService)}*rawValuesFromRange(e){for(const t of e.addresses(this)){const e=this.getScalarValue(t);e!==u.EmptyValue&&(yield[(0,u.getRawValue)(e),t])}}computeListOfValuesInRange(e){const t=[];for(const r of e.addresses(this)){const e=this.getScalarValue(r);t.push(e)}return t}shrinkArrayToCorner(e){this.cleanAddressMappingUnderArray(e);for(const t of this.adjacentArrayVertices(e)){let r;r=t instanceof T.FormulaVertex?this.formulaDirectDependenciesToArray(t,e):this.rangeDirectDependenciesToArray(t,e);let n=!1;for(const[s,o]of r)e.isLeftCorner(s)&&(n=!0),this.graph.addEdge(o,t),this.graph.markNodeAsDirty(o);n||this.graph.removeEdge(e,t)}this.graph.markNodeAsDirty(e)}isArrayInternalCell(e){const t=this.getCell(e);return t instanceof p.ArrayVertex&&!t.isLeftCorner(e)}getAndClearContentChanges(){const e=this.changes;return this.changes=a.ContentChanges.empty(),e}getAdjacentNodesAddresses(e){const t=this.graph.adjacentNodes(e),r=[];return t.forEach((e=>{const t=e;t instanceof p.RangeVertex?r.push((0,n.simpleCellRange)(t.start,t.end)):r.push(t.getAddress(this.lazilyTransformingAstService))})),r}exchangeGraphNode(e,t){this.graph.addNodeAndReturnId(t);const r=this.graph.adjacentNodes(e);this.removeVertex(e),r.forEach((e=>{this.graph.hasNode(e)&&this.graph.addEdge(t,e)}))}setArray(e,t){this.arrayMapping.setArray(e,t)}correctInfiniteRangesDependency(e){const t=this.graph.getInfiniteRanges().filter((({node:t})=>t.range.addressInRange(e)));if(t.length<=0)return;const{vertex:r,id:n}=this.fetchCellOrCreateEmpty(e),s=null!=n?n:this.graph.getNodeId(r);t.forEach((({id:e})=>{this.graph.addEdge(s,e)}))}exchangeOrAddGraphNode(e,t){e?this.exchangeGraphNode(e,t):this.graph.addNodeAndReturnId(t)}getArrayVerticesRelatedToRanges(e){const t=new Set;return e.forEach((e=>{this.graph.hasNode(e)&&this.graph.adjacentNodes(e).forEach((e=>{e instanceof p.ArrayVertex&&t.add(e)}))})),t}correctInfiniteRangesDependenciesByRangeVertex(e){this.graph.getInfiniteRanges().forEach((({id:t,node:r})=>{const n=e.range.intersectionWith(r.range);void 0!==n&&n.addresses(this).forEach((e=>{const{vertex:r,id:n}=this.fetchCellOrCreateEmpty(e);this.graph.addEdge(null!=n?n:r,t)}))}))}cleanAddressMappingUnderArray(e){const t=e.getRange();for(const r of t.addresses(this)){const t=e.getArrayCellValue(r);this.getCell(r)===e?e.isLeftCorner(r)?this.changes.addChange(new o.CellError(o.ErrorType.REF),r,t):(this.addressMapping.removeCell(r),this.changes.addChange(u.EmptyValue,r,t)):this.changes.addChange(u.EmptyValue,r,t)}}*formulaDirectDependenciesToArray(e,t){var r;const[,s]=null!==(r=this.formulaDependencyQuery(e))&&void 0!==r?r:[];if(void 0!==s)for(const e of s)if(!(e instanceof c.NamedExpressionDependency||e instanceof n.AbsoluteCellRange)&&t.getRange().addressInRange(e)){const t=this.fetchCellOrCreateEmpty(e).vertex;yield[e,t]}}*rangeDirectDependenciesToArray(e,t){const{restRange:r}=this.rangeMapping.findSmallerRange(e.range);for(const e of r.addresses(this))if(t.getRange().addressInRange(e)){const t=this.fetchCellOrCreateEmpty(e).vertex;yield[e,t]}}*adjacentArrayVertices(e){const t=this.graph.adjacentNodes(e);for(const e of t)(e instanceof T.FormulaVertex||e instanceof p.RangeVertex)&&(yield e)}addStructuralNodesToChangeSet(){this.graph.markChangingWithStructureNodesAsDirty()}fixRangesWhenAddingRows(e,t,r){const s=Array.from(this.rangeMapping.rangesInSheet(e));for(const e of s)if(e.range.includesRow(t+r))if(e.bruteForce){const n=e.range.rangeWithSameWidth(t,r);for(const t of n.addresses(this)){const{vertex:r,id:n}=this.fetchCellOrCreateEmpty(t);this.graph.addEdge(null!=n?n:r,e)}}else{let t=e,r=this.rangeMapping.findSmallerRange(t.range);if(void 0!==r.smallerRangeVertex)continue;for(;void 0===r.smallerRangeVertex;){const e=new p.RangeVertex(n.AbsoluteCellRange.spanFrom(t.range.start,t.range.width(),t.range.height()-1));this.rangeMapping.setRange(e),this.graph.addNodeAndReturnId(e);const s=new n.AbsoluteCellRange((0,o.simpleCellAddress)(t.range.start.sheet,t.range.start.col,t.range.end.row),t.range.end);this.addAllFromRange(s,t),this.graph.addEdge(e,t),t=e,r=this.rangeMapping.findSmallerRange(t.range)}this.graph.addEdge(r.smallerRangeVertex,t),this.addAllFromRange(r.restRange,t),this.graph.removeEdge(r.smallerRangeVertex,e)}}addAllFromRange(e,t){for(const r of e.addresses(this)){const{vertex:e,id:n}=this.fetchCellOrCreateEmpty(r);this.graph.addEdge(null!=n?n:e,t)}}fixRangesWhenAddingColumns(e,t,r){for(const s of this.rangeMapping.rangesInSheet(e))if(s.range.includesColumn(t+r)){let a;a=s.bruteForce?s.range.rangeWithSameHeight(t,r):n.AbsoluteCellRange.spanFrom((0,o.simpleCellAddress)(e,t,s.range.end.row),r,1);for(const e of a.addresses(this)){const{vertex:t,id:r}=this.fetchCellOrCreateEmpty(e);this.graph.addEdge(null!=r?r:t,s)}}}exchangeOrAddFormulaVertex(e){const t=e.getAddress(this.lazilyTransformingAstService),r=n.AbsoluteCellRange.spanFrom(t,e.width,e.height),s=this.shrinkPossibleArrayAndGetCell(t);if(e instanceof p.ArrayVertex&&this.setArray(r,e),this.exchangeOrAddGraphNode(s,e),this.addressMapping.setCell(t,e),e instanceof p.ArrayVertex){if(!this.isThereSpaceForArray(e))return;for(const t of r.addresses(this)){if(e.isLeftCorner(t))continue;const r=this.getCell(t);this.exchangeOrAddGraphNode(r,e)}}for(const t of r.addresses(this))this.addressMapping.setCell(t,e)}setAddressMappingForArrayVertex(e,t){if(this.addressMapping.setCell(t,e),!(e instanceof p.ArrayVertex))return;const r=n.AbsoluteCellRange.spanFromOrUndef(t,e.width,e.height);if(void 0!==r&&(this.setArray(r,e),this.isThereSpaceForArray(e)))for(const t of r.addresses(this))this.addressMapping.setCell(t,e)}truncateRanges(e,t){const{verticesToRemove:r,verticesToMerge:n,verticesWithChangedSize:s}=this.rangeMapping.truncateRanges(e,t);for(const[e,t]of n)this.mergeRangeVertices(e,t);for(const e of r)this.removeVertexAndCleanupDependencies(e);return s}fixArraysAfterAddingRow(e,t,r){if(this.arrayMapping.moveArrayVerticesAfterRowByRows(e,t,r),!(t<=0))for(const[,n]of this.arrayMapping.arraysInRows(h.RowsSpan.fromRowStartAndEnd(e,t-1,t-1))){const s=n.getRange();for(let a=s.start.col;a<=s.end.col;++a)for(let i=t;i<=s.end.row;++i){const t=(0,o.simpleCellAddress)(e,a,i),s=(0,o.simpleCellAddress)(e,a,i+r),l=n.getArrayCellValue(t);this.addressMapping.moveCell(s,t),this.changes.addChange(u.EmptyValue,s,l)}}}fixArraysAfterRemovingRows(e,t,r){if(this.arrayMapping.moveArrayVerticesAfterRowByRows(e,t,-r),!(t<=0))for(const[,r]of this.arrayMapping.arraysInRows(h.RowsSpan.fromRowStartAndEnd(e,t-1,t-1)))if(this.isThereSpaceForArray(r))for(const e of r.getRange().addresses(this))this.addressMapping.setCell(e,r);else this.setNoSpaceIfArray(r)}fixArraysAfterAddingColumn(e,t,r){if(this.arrayMapping.moveArrayVerticesAfterColumnByColumns(e,t,r),!(t<=0))for(const[,n]of this.arrayMapping.arraysInCols(h.ColumnsSpan.fromColumnStartAndEnd(e,t-1,t-1))){const s=n.getRange();for(let a=s.start.row;a<=s.end.row;++a)for(let i=t;i<=s.end.col;++i){const t=(0,o.simpleCellAddress)(e,i,a),s=(0,o.simpleCellAddress)(e,i+r,a),l=n.getArrayCellValue(t);this.addressMapping.moveCell(s,t),this.changes.addChange(u.EmptyValue,s,l)}}}fixArraysAfterRemovingColumns(e,t,r){if(this.arrayMapping.moveArrayVerticesAfterColumnByColumns(e,t,-r),!(t<=0))for(const[,r]of this.arrayMapping.arraysInCols(h.ColumnsSpan.fromColumnStartAndEnd(e,t-1,t-1)))if(this.isThereSpaceForArray(r))for(const e of r.getRange().addresses(this))this.addressMapping.setCell(e,r);else this.setNoSpaceIfArray(r)}shrinkPossibleArrayAndGetCell(e){const t=this.getCell(e);return t instanceof p.ArrayVertex?(this.setNoSpaceIfArray(t),this.getCell(e)):t}setNoSpaceIfArray(e){e instanceof p.ArrayVertex&&(this.shrinkArrayToCorner(e),e.setNoSpace())}removeVertex(e){this.removeVertexAndCleanupDependencies(e),e instanceof p.RangeVertex&&this.rangeMapping.removeRange(e)}mergeRangeVertices(e,t){const r=this.graph.adjacentNodes(t);this.removeVertexAndCleanupDependencies(t),this.graph.removeEdgeIfExists(e,t),r.forEach((t=>{this.graph.hasNode(t)&&this.graph.addEdge(e,t)}))}removeVertexAndCleanupDependencies(e){const t=new Set(this.graph.removeNode(e));for(;t.size>0;){const e=t.values().next().value;t.delete(e);const[r,n]=e;this.graph.hasNode(n)&&0===this.graph.adjacentNodesCount(n)&&((n instanceof p.RangeVertex||n instanceof p.EmptyCellVertex)&&this.graph.removeNode(n).forEach((e=>t.add(e))),n instanceof p.RangeVertex?this.rangeMapping.removeRange(n):n instanceof p.EmptyCellVertex&&this.addressMapping.removeCell(r))}}}t.DependencyGraph=R},function(e,t,r){"use strict";var n=r(4),s=r(110);n({target:"Set",proto:!0,real:!0,forced:!r(119)("difference")},{difference:s})},function(e,t,r){"use strict";var n=r(111),s=r(112),o=r(113),a=r(116),i=r(118),u=r(114),l=r(115),c=s.has,h=s.remove;e.exports=function(e){var t=n(this),r=i(e),s=o(t);return a(t)<=r.size?u(t,(function(e){r.includes(e)&&h(s,e)})):l(r.getIterator(),(function(e){c(t,e)&&h(s,e)})),s}},function(e,t,r){"use strict";var n=r(112).has;e.exports=function(e){return n(e),e}},function(e,t,r){"use strict";var n=r(16),s=Set.prototype;e.exports={Set:Set,add:n(s.add),has:n(s.has),remove:n(s.delete),proto:s}},function(e,t,r){"use strict";var n=r(112),s=r(114),o=n.Set,a=n.add;e.exports=function(e){var t=new o;return s(e,(function(e){a(t,e)})),t}},function(e,t,r){"use strict";var n=r(16),s=r(115),o=r(112),a=o.Set,i=o.proto,u=n(i.forEach),l=n(i.keys),c=l(new a).next;e.exports=function(e,t,r){return r?s({iterator:l(e),next:c},t):u(e,t)}},function(e,t,r){"use strict";var n=r(10);e.exports=function(e,t,r){for(var s,o,a=r?e:e.iterator,i=e.next;!(s=n(i,a)).done;)if(void 0!==(o=t(s.value)))return o}},function(e,t,r){"use strict";var n=r(117),s=r(112);e.exports=n(s.proto,"size","get")||function(e){return e.size}},function(e,t,r){"use strict";var n=r(16),s=r(32);e.exports=function(e,t,r){try{return n(s(Object.getOwnPropertyDescriptor(e,t)[r]))}catch(e){}}},function(e,t,r){"use strict";var n=r(32),s=r(48),o=r(10),a=r(63),i=r(88),u="Invalid size",l=RangeError,c=TypeError,h=Math.max,d=function(e,t){this.set=e,this.size=h(t,0),this.has=n(e.has),this.keys=n(e.keys)};d.prototype={getIterator:function(){return i(s(o(this.keys,this.set)))},includes:function(e){return o(this.has,this.set,e)}},e.exports=function(e){s(e);var t=+e.size;if(t!=t)throw new c(u);var r=a(t);if(r<0)throw new l(u);return new d(e,r)}},function(e,t,r){"use strict";var n=r(25),s=function(e){return{size:e,has:function(){return!1},keys:function(){return{next:function(){return{done:!0}}}}}};e.exports=function(e){var t=n("Set");try{(new t)[e](s(0));try{return(new t)[e](s(-1)),!1}catch(e){return!0}}catch(e){return!1}}},function(e,t,r){"use strict";var n=r(4),s=r(9),o=r(121);n({target:"Set",proto:!0,real:!0,forced:!r(119)("intersection")||s((function(){return"3,2"!==String(Array.from(new Set([1,2,3]).intersection(new Set([3,2]))))}))},{intersection:o})},function(e,t,r){"use strict";var n=r(111),s=r(112),o=r(116),a=r(118),i=r(114),u=r(115),l=s.Set,c=s.add,h=s.has;e.exports=function(e){var t=n(this),r=a(e),s=new l;return o(t)>r.size?u(r.getIterator(),(function(e){h(t,e)&&c(s,e)})):i(t,(function(e){r.includes(e)&&c(s,e)})),s}},function(e,t,r){"use strict";var n=r(4),s=r(123);n({target:"Set",proto:!0,real:!0,forced:!r(119)("isDisjointFrom")},{isDisjointFrom:s})},function(e,t,r){"use strict";var n=r(111),s=r(112).has,o=r(116),a=r(118),i=r(114),u=r(115),l=r(92);e.exports=function(e){var t=n(this),r=a(e);if(o(t)<=r.size)return!1!==i(t,(function(e){if(r.includes(e))return!1}),!0);var c=r.getIterator();return!1!==u(c,(function(e){if(s(t,e))return l(c,"normal",!1)}))}},function(e,t,r){"use strict";var n=r(4),s=r(125);n({target:"Set",proto:!0,real:!0,forced:!r(119)("isSubsetOf")},{isSubsetOf:s})},function(e,t,r){"use strict";var n=r(111),s=r(116),o=r(114),a=r(118);e.exports=function(e){var t=n(this),r=a(e);return!(s(t)>r.size)&&!1!==o(t,(function(e){if(!r.includes(e))return!1}),!0)}},function(e,t,r){"use strict";var n=r(4),s=r(127);n({target:"Set",proto:!0,real:!0,forced:!r(119)("isSupersetOf")},{isSupersetOf:s})},function(e,t,r){"use strict";var n=r(111),s=r(112).has,o=r(116),a=r(118),i=r(115),u=r(92);e.exports=function(e){var t=n(this),r=a(e);if(o(t)<r.size)return!1;var l=r.getIterator();return!1!==i(l,(function(e){if(!s(t,e))return u(l,"normal",!1)}))}},function(e,t,r){"use strict";var n=r(4),s=r(129);n({target:"Set",proto:!0,real:!0,forced:!r(119)("symmetricDifference")},{symmetricDifference:s})},function(e,t,r){"use strict";var n=r(111),s=r(112),o=r(113),a=r(118),i=r(115),u=s.add,l=s.has,c=s.remove;e.exports=function(e){var t=n(this),r=a(e).getIterator(),s=o(t);return i(r,(function(e){l(t,e)?c(s,e):u(s,e)})),s}},function(e,t,r){"use strict";var n=r(4),s=r(131);n({target:"Set",proto:!0,real:!0,forced:!r(119)("union")},{union:s})},function(e,t,r){"use strict";var n=r(111),s=r(112).add,o=r(113),a=r(118),i=r(115);e.exports=function(e){var t=n(this),r=a(e).getIterator(),u=o(t);return i(r,(function(e){s(u,e)})),u}},function(e,t,r){"use strict";r(133)},function(e,t,r){"use strict";var n=r(4),s=r(10),o=r(32),a=r(48),i=r(88),u=r(89),l=r(93),c=r(38),h=u((function(){for(var e,t,r=this.iterator,n=this.predicate,o=this.next;;){if(e=a(s(o,r)),this.done=!!e.done)return;if(t=e.value,l(r,n,[t,this.counter++],!0))return t}}));n({target:"Iterator",proto:!0,real:!0,forced:c},{filter:function(e){return a(this),o(e),new h(i(this),{predicate:e})}})},function(e,t,r){"use strict";r(135)},function(e,t,r){"use strict";var n=r(4),s=r(96),o=r(32),a=r(48),i=r(88);n({target:"Iterator",proto:!0,real:!0},{forEach:function(e){a(this),o(e);var t=i(this),r=0;s(t,(function(t){e(t,r++)}),{IS_RECORD:!0})}})},function(e,t,r){"use strict";t.__esModule=!0,t.filterDependenciesOutOfScope=t.absolutizeDependencies=void 0,r(73),r(132),r(85);var n=r(105),s=r(106),o=r(137);t.absolutizeDependencies=(e,t)=>e.map((e=>e.absolutize(t)));t.filterDependenciesOutOfScope=e=>e.filter((e=>e instanceof o.NamedExpressionDependency||(e instanceof n.AbsoluteCellRange?!((0,s.invalidSimpleCellAddress)(e.start)||(0,s.invalidSimpleCellAddress)(e.end)):!(0,s.invalidSimpleCellAddress)(e))))},function(e,t,r){"use strict";t.__esModule=!0,t.simpleCellRangeToString=t.simpleCellRangeFromString=t.simpleCellAddressToString=t.simpleCellAddressFromString=t.collectDependencies=t.cellAddressFromString=t.buildProcedureAst=t.buildParsingErrorAst=t.buildLexerConfig=t.buildCellRangeAst=t.buildCellErrorAst=t.Unparser=t.RowRangeDependency=t.ParsingErrorType=t.ParserWithCaching=t.NamedExpressionDependency=t.FormulaLexer=t.ColumnRangeDependency=t.CellRangeDependency=t.CellAddress=t.AstNodeType=t.AddressDependency=void 0;var n=r(138);t.cellAddressFromString=n.cellAddressFromString,t.simpleCellAddressFromString=n.simpleCellAddressFromString,t.simpleCellAddressToString=n.simpleCellAddressToString,t.simpleCellRangeFromString=n.simpleCellRangeFromString,t.simpleCellRangeToString=n.simpleCellRangeToString;var s=r(139);t.CellAddress=s.CellAddress;var o=r(143);t.ParserWithCaching=o.ParserWithCaching;var a=r(156);t.collectDependencies=a.collectDependencies;var i=r(152);t.buildLexerConfig=i.buildLexerConfig;var u=r(150);t.FormulaLexer=u.FormulaLexer;var l=r(145);t.AstNodeType=l.AstNodeType,t.ParsingErrorType=l.ParsingErrorType,t.buildProcedureAst=l.buildProcedureAst,t.buildCellRangeAst=l.buildCellRangeAst,t.buildParsingErrorAst=l.buildParsingErrorAst,t.buildCellErrorAst=l.buildCellErrorAst;var c=r(155);t.Unparser=c.Unparser;var h=r(157);t.AddressDependency=h.AddressDependency,t.CellRangeDependency=h.CellRangeDependency,t.ColumnRangeDependency=h.ColumnRangeDependency,t.RowRangeDependency=h.RowRangeDependency,t.NamedExpressionDependency=h.NamedExpressionDependency},function(e,t,r){"use strict";t.__esModule=!0,t.columnAddressFromString=t.cellAddressFromString=void 0,t.columnIndexToLabel=E,t.rowAddressFromString=void 0,t.sheetIndexToString=T,t.simpleCellRangeToString=t.simpleCellRangeFromString=t.simpleCellAddressToString=t.simpleCellAddressFromString=void 0,r(73),r(94);var n=r(105),s=r(106),o=r(139),a=r(140),i=r(142),u=r(141);const l=new RegExp(`^(${i.SHEET_NAME_PATTERN})?(\\${i.ABSOLUTE_OPERATOR}?)([A-Za-z]+)(\\${i.ABSOLUTE_OPERATOR}?)([0-9]+)$`),c=new RegExp(`^(${i.SHEET_NAME_PATTERN})?(\\${i.ABSOLUTE_OPERATOR}?)([A-Za-z]+)$`),h=new RegExp(`^(${i.SHEET_NAME_PATTERN})?(\\${i.ABSOLUTE_OPERATOR}?)([0-9]+)$`),d=new RegExp(`^${i.UNQUOTED_SHEET_NAME_PATTERN}$`);t.cellAddressFromString=(e,t,r)=>{const n=l.exec(t),s=g(n[6]);let a=y(n,e);if(void 0===a)return;null===a&&(a=void 0);const u=Number(n[8])-1;return n[5]===i.ABSOLUTE_OPERATOR&&n[7]===i.ABSOLUTE_OPERATOR?o.CellAddress.absolute(s,u,a):n[5]===i.ABSOLUTE_OPERATOR?o.CellAddress.absoluteCol(s,u-r.row,a):n[7]===i.ABSOLUTE_OPERATOR?o.CellAddress.absoluteRow(s-r.col,u,a):o.CellAddress.relative(s-r.col,u-r.row,a)};t.columnAddressFromString=(e,t,r)=>{const n=c.exec(t);let s=y(n,e);if(void 0===s)return;null===s&&(s=void 0);const o=g(n[6]);return n[5]===i.ABSOLUTE_OPERATOR?a.ColumnAddress.absolute(o,s):a.ColumnAddress.relative(o-r.col,s)};t.rowAddressFromString=(e,t,r)=>{const n=h.exec(t);let s=y(n,e);if(void 0===s)return;null===s&&(s=void 0);const o=Number(n[6])-1;return n[5]===i.ABSOLUTE_OPERATOR?u.RowAddress.absolute(o,s):u.RowAddress.relative(o-r.row,s)};const p=(e,t,r)=>{const n=l.exec(t);if(!n)return;const o=g(n[6]);let a=y(n,e);if(void 0===a)return;null===a&&(a=r);const i=Number(n[8])-1;return(0,s.simpleCellAddress)(a,o,i)};t.simpleCellAddressFromString=p;t.simpleCellRangeFromString=(e,t,r)=>{const s=t.split(i.RANGE_OPERATOR);if(2!==s.length)return;const[o,a]=s,u=p(e,o,r);if(void 0===u)return;const l=p(e,a,u.sheet);return void 0!==l&&u.sheet===l.sheet?(0,n.simpleCellRange)(u,l):void 0};const m=(e,t,r)=>{const n=E(t.col),s=T(t.sheet,e);if(void 0!==s)return r!==t.sheet?`${s}!${n}${t.row+1}`:`${n}${t.row+1}`};t.simpleCellAddressToString=m;function g(e){return 1===e.length?e.toUpperCase().charCodeAt(0)-65:e.split("").reduce(((e,t)=>26*e+(t.toUpperCase().charCodeAt(0)-64)),0)-1}function E(e){let t="";for(;e>=0;)t=String.fromCharCode(e%26+97)+t,e=Math.floor(e/26)-1;return t.toUpperCase()}function T(e,t){let r=t(e);if(void 0!==r)return d.test(r)?r:(r=r.replace(/'/g,"''"),`'${r}'`)}function y(e,t){var r;let n=null!==(r=e[3])&&void 0!==r?r:e[2];return n?(n=n.replace(/''/g,"'"),t(n)):null}t.simpleCellRangeToString=(e,t,r)=>{const n=m(e,t.start,r),s=m(e,t.end,t.start.sheet);return void 0===n||void 0===s?void 0:`${n}${i.RANGE_OPERATOR}${s}`}},function(e,t,r){"use strict";t.__esModule=!0,t.CellReferenceType=t.CellAddress=void 0;var n,s=r(106),o=r(138),a=r(140),i=r(141);!function(e){e.CELL_REFERENCE_RELATIVE="CELL_REFERENCE",e.CELL_REFERENCE_ABSOLUTE="CELL_REFERENCE_ABSOLUTE",e.CELL_REFERENCE_ABSOLUTE_COL="CELL_REFERENCE_ABSOLUTE_COL",e.CELL_REFERENCE_ABSOLUTE_ROW="CELL_REFERENCE_ABSOLUTE_ROW"}(n||(t.CellReferenceType=n={}));class u{constructor(e,t,r,n){this.col=e,this.row=t,this.type=r,this.sheet=n}static fromColAndRow(e,t,r){return(e.isColumnAbsolute()&&t.isRowAbsolute()?u.absolute.bind(this):e.isColumnAbsolute()?u.absoluteCol.bind(this):t.isRowAbsolute()?u.absoluteRow.bind(this):u.relative.bind(this))(e.col,t.row,r)}static relative(e,t,r){return new u(e,t,n.CELL_REFERENCE_RELATIVE,r)}static absolute(e,t,r){return new u(e,t,n.CELL_REFERENCE_ABSOLUTE,r)}static absoluteCol(e,t,r){return new u(e,t,n.CELL_REFERENCE_ABSOLUTE_COL,r)}static absoluteRow(e,t,r){return new u(e,t,n.CELL_REFERENCE_ABSOLUTE_ROW,r)}toSimpleCellAddress(e){const t=(0,s.absoluteSheetReference)(this,e);return this.type===n.CELL_REFERENCE_ABSOLUTE?(0,s.simpleCellAddress)(t,this.col,this.row):this.type===n.CELL_REFERENCE_ABSOLUTE_ROW?(0,s.simpleCellAddress)(t,e.col+this.col,this.row):this.type===n.CELL_REFERENCE_ABSOLUTE_COL?(0,s.simpleCellAddress)(t,this.col,e.row+this.row):(0,s.simpleCellAddress)(t,e.col+this.col,e.row+this.row)}toColumnAddress(){const e=this.isColumnRelative()?a.ReferenceType.RELATIVE:a.ReferenceType.ABSOLUTE;return new a.ColumnAddress(e,this.col,this.sheet)}toRowAddress(){const e=this.isRowRelative()?a.ReferenceType.RELATIVE:a.ReferenceType.ABSOLUTE;return new i.RowAddress(e,this.row,this.sheet)}toSimpleColumnAddress(e){const t=(0,s.absoluteSheetReference)(this,e);let r=this.col;return this.isColumnRelative()&&(r+=e.col),(0,s.simpleColumnAddress)(t,r)}toSimpleRowAddress(e){const t=(0,s.absoluteSheetReference)(this,e);let r=this.row;return this.isRowRelative()&&(r+=e.row),(0,s.simpleRowAddress)(t,r)}isRowAbsolute(){return this.type===n.CELL_REFERENCE_ABSOLUTE||this.type===n.CELL_REFERENCE_ABSOLUTE_ROW}isColumnAbsolute(){return this.type===n.CELL_REFERENCE_ABSOLUTE||this.type===n.CELL_REFERENCE_ABSOLUTE_COL}isColumnRelative(){return this.type===n.CELL_REFERENCE_RELATIVE||this.type===n.CELL_REFERENCE_ABSOLUTE_ROW}isRowRelative(){return this.type===n.CELL_REFERENCE_RELATIVE||this.type===n.CELL_REFERENCE_ABSOLUTE_COL}isAbsolute(){return this.type===n.CELL_REFERENCE_ABSOLUTE&&void 0!==this.sheet}shiftedByRows(e){return new u(this.col,this.row+e,this.type,this.sheet)}shiftedByColumns(e){return new u(this.col+e,this.row,this.type,this.sheet)}moved(e,t,r){const n=void 0===this.sheet?void 0:e;return new u(this.col+t,this.row+r,this.type,n)}withSheet(e){return new u(this.col,this.row,this.type,e)}isInvalid(e){return(0,s.invalidSimpleCellAddress)(this.toSimpleCellAddress(e))}shiftRelativeDimensions(e,t){const r=this.isColumnAbsolute()?this.col:this.col+e,n=this.isRowAbsolute()?this.row:this.row+t;return new u(r,n,this.type,this.sheet)}shiftAbsoluteDimensions(e,t){const r=this.isColumnRelative()?this.col:this.col+e,n=this.isRowRelative()?this.row:this.row+t;return new u(r,n,this.type,this.sheet)}hash(e){const t=e&&void 0!==this.sheet?`#${this.sheet}`:"";switch(this.type){case n.CELL_REFERENCE_RELATIVE:return`${t}#${this.row}R${this.col}`;case n.CELL_REFERENCE_ABSOLUTE:return`${t}#${this.row}A${this.col}`;case n.CELL_REFERENCE_ABSOLUTE_COL:return`${t}#${this.row}AC${this.col}`;case n.CELL_REFERENCE_ABSOLUTE_ROW:return`${t}#${this.row}AR${this.col}`}}unparse(e){const t=this.toSimpleCellAddress(e);if((0,s.invalidSimpleCellAddress)(t))return;const r=(0,o.columnIndexToLabel)(t.col),a=this.type===n.CELL_REFERENCE_ABSOLUTE||this.type===n.CELL_REFERENCE_ABSOLUTE_ROW?"$":"";return`${this.type===n.CELL_REFERENCE_ABSOLUTE||this.type===n.CELL_REFERENCE_ABSOLUTE_COL?"$":""}${r}${a}${t.row+1}`}exceedsSheetSizeLimits(e,t){return this.row>=t||this.col>=e}}t.CellAddress=u},function(e,t,r){"use strict";t.__esModule=!0,t.ReferenceType=t.ColumnAddress=void 0;var n,s=r(106),o=r(138);!function(e){e.RELATIVE="RELATIVE",e.ABSOLUTE="ABSOLUTE"}(n||(t.ReferenceType=n={}));class a{constructor(e,t,r){this.type=e,this.col=t,this.sheet=r}static absolute(e,t){return new a(n.ABSOLUTE,e,t)}static relative(e,t){return new a(n.RELATIVE,e,t)}static compareByAbsoluteAddress(e){return(t,r)=>t.toSimpleColumnAddress(e).col-r.toSimpleColumnAddress(e).col}isColumnAbsolute(){return this.type===n.ABSOLUTE}isColumnRelative(){return this.type===n.RELATIVE}isAbsolute(){return this.type===n.ABSOLUTE&&void 0!==this.sheet}moved(e,t,r){const n=void 0===this.sheet?void 0:e;return new a(this.type,this.col+t,n)}shiftedByColumns(e){return new a(this.type,this.col+e,this.sheet)}toSimpleColumnAddress(e){const t=(0,s.absoluteSheetReference)(this,e);let r=this.col;return this.isColumnRelative()&&(r=e.col+this.col),(0,s.simpleColumnAddress)(t,r)}shiftRelativeDimensions(e,t){const r=this.isColumnRelative()?this.col+e:this.col;return new a(this.type,r,this.sheet)}shiftAbsoluteDimensions(e,t){const r=this.isColumnAbsolute()?this.col+e:this.col;return new a(this.type,r,this.sheet)}withSheet(e){return new a(this.type,this.col,e)}isInvalid(e){return this.toSimpleColumnAddress(e).col<0}hash(e){const t=e&&void 0!==this.sheet?`#${this.sheet}`:"";switch(this.type){case n.RELATIVE:return`${t}#COLR${this.col}`;case n.ABSOLUTE:return`${t}#COLA${this.col}`}}unparse(e){const t=this.toSimpleColumnAddress(e);if((0,s.invalidSimpleColumnAddress)(t))return;const r=(0,o.columnIndexToLabel)(t.col);return`${this.type===n.ABSOLUTE?"$":""}${r}`}exceedsSheetSizeLimits(e){return this.col>=e}}t.ColumnAddress=a},function(e,t,r){"use strict";t.__esModule=!0,t.RowAddress=void 0;var n=r(106),s=r(140);class o{constructor(e,t,r){this.type=e,this.row=t,this.sheet=r}static absolute(e,t){return new o(s.ReferenceType.ABSOLUTE,e,t)}static relative(e,t){return new o(s.ReferenceType.RELATIVE,e,t)}static compareByAbsoluteAddress(e){return(t,r)=>t.toSimpleRowAddress(e).row-r.toSimpleRowAddress(e).row}isRowAbsolute(){return this.type===s.ReferenceType.ABSOLUTE}isRowRelative(){return this.type===s.ReferenceType.RELATIVE}isAbsolute(){return this.type===s.ReferenceType.ABSOLUTE&&void 0!==this.sheet}moved(e,t,r){const n=void 0===this.sheet?void 0:e;return new o(this.type,this.row+r,n)}shiftedByRows(e){return new o(this.type,this.row+e,this.sheet)}toSimpleRowAddress(e){const t=(0,n.absoluteSheetReference)(this,e);let r=this.row;return this.isRowRelative()&&(r=e.row+this.row),(0,n.simpleRowAddress)(t,r)}shiftRelativeDimensions(e,t){const r=this.isRowRelative()?this.row+t:this.row;return new o(this.type,r,this.sheet)}shiftAbsoluteDimensions(e,t){const r=this.isRowAbsolute()?this.row+t:this.row;return new o(this.type,r,this.sheet)}withSheet(e){return new o(this.type,this.row,e)}isInvalid(e){return this.toSimpleRowAddress(e).row<0}hash(e){const t=e&&void 0!==this.sheet?`#${this.sheet}`:"";switch(this.type){case s.ReferenceType.RELATIVE:return`${t}#ROWR${this.row}`;case s.ReferenceType.ABSOLUTE:return`${t}#ROWA${this.row}`}}unparse(e){const t=this.toSimpleRowAddress(e);if((0,n.invalidSimpleRowAddress)(t))return;return`${this.type===s.ReferenceType.ABSOLUTE?"$":""}${t.row+1}`}exceedsSheetSizeLimits(e){return this.row>=e}}t.RowAddress=o},function(e,t,r){"use strict";t.__esModule=!0,t.UNQUOTED_SHEET_NAME_PATTERN=t.UNICODE_LETTER_PATTERN=t.SHEET_NAME_PATTERN=t.ROW_REFERENCE_PATTERN=t.RANGE_OPERATOR=t.R1C1_CELL_REFERENCE_PATTERN=t.QUOTED_SHEET_NAME_PATTERN=t.ODFF_WHITESPACE_PATTERN=t.NON_RESERVED_CHARACTER_PATTERN=t.NAMED_EXPRESSION_PATTERN=t.COLUMN_REFERENCE_PATTERN=t.CELL_REFERENCE_WITH_NEXT_CHARACTER_PATTERN=t.CELL_REFERENCE_PATTERN=t.ALL_WHITESPACE_PATTERN=t.ALL_UNICODE_LETTERS_ARRAY=t.ALL_DIGITS_ARRAY=t.ABSOLUTE_OPERATOR=void 0,r(85);t.RANGE_OPERATOR=":";const n=t.ABSOLUTE_OPERATOR="$",s=(t.ALL_WHITESPACE_PATTERN="\\s+",t.ODFF_WHITESPACE_PATTERN="[ \\t\\n\\r]+",t.UNICODE_LETTER_PATTERN="A-Za-zÀ-ʯ"),o=t.NON_RESERVED_CHARACTER_PATTERN=`${s}0-9_.`,a=t.UNQUOTED_SHEET_NAME_PATTERN=`[${s}0-9_]+`,i=t.QUOTED_SHEET_NAME_PATTERN="'(((?!').|'')*)'",u=t.SHEET_NAME_PATTERN=`(${a}|${i})!`,l=t.CELL_REFERENCE_PATTERN=`(${u})?\\${n}?[A-Za-z]+\\${n}?[0-9]+`;t.COLUMN_REFERENCE_PATTERN=`(${u})?\\${n}?[A-Za-z]+`,t.ROW_REFERENCE_PATTERN=`(${u})?\\${n}?[0-9]+`,t.R1C1_CELL_REFERENCE_PATTERN="[rR][0-9]*[cC][0-9]*",t.CELL_REFERENCE_WITH_NEXT_CHARACTER_PATTERN=`(${l})[^${o}]`,t.NAMED_EXPRESSION_PATTERN=`[${s}_][${o}]*`,t.ALL_DIGITS_ARRAY=["0","1","2","3","4","5","6","7","8","9"],t.ALL_UNICODE_LETTERS_ARRAY=[...Array.from(Array(26)).map(((e,t)=>t+"A".charCodeAt(0))),...Array.from(Array(26)).map(((e,t)=>t+"a".charCodeAt(0))),...Array.from(Array(496)).map(((e,t)=>t+192))].map((e=>String.fromCharCode(e)))},function(e,t,r){"use strict";t.__esModule=!0,t.ParserWithCaching=void 0,r(3),r(85);var n=r(144),s=r(106),o=r(137),a=r(138),i=r(145),u=r(146),l=r(147),c=r(150),h=r(152),d=r(155),p=r(140),m=r(141);class g{constructor(e,t,r){this.config=e,this.functionRegistry=t,this.sheetMapping=r,this.statsCacheUsed=0,this.lexerConfig=(0,h.buildLexerConfig)(e),this.lexer=new c.FormulaLexer(this.lexerConfig),this.formulaParser=new c.FormulaParser(this.lexerConfig,this.sheetMapping),this.cache=new l.Cache(this.functionRegistry)}parse(e,t){this.formulaAddress=t;const r=this.tokenizeFormula(e);if(r.errors.length>0){const e=r.errors.map((e=>({type:i.ParsingErrorType.LexingError,message:e.message})));return{ast:(0,o.buildParsingErrorAst)(),errors:e,hasVolatileFunction:!1,hasStructuralChangeFunction:!1,dependencies:[]}}const n=this.computeHashFromTokens(r.tokens,t);let s=this.cache.get(n);if(void 0!==s)++this.statsCacheUsed;else{const e=this.bindWhitespacesToTokens(r.tokens),o=this.formulaParser.parseFromTokens(e,t);if(o.errors.length>0)return Object.assign(Object.assign({},o),{hasVolatileFunction:!1,hasStructuralChangeFunction:!1,dependencies:[]});s=this.cache.set(n,o.ast)}const{ast:a,hasVolatileFunction:u,hasStructuralChangeFunction:l}=s,c=this.convertReversedRangesToRegularRanges(a);return{ast:c,errors:[],hasVolatileFunction:u,hasStructuralChangeFunction:l,dependencies:(0,o.collectDependencies)(c,this.functionRegistry)}}convertReversedRangesToRegularRanges(e){switch(e.type){case o.AstNodeType.EMPTY:case o.AstNodeType.NUMBER:case o.AstNodeType.STRING:case o.AstNodeType.ERROR:case o.AstNodeType.ERROR_WITH_RAW_INPUT:case o.AstNodeType.CELL_REFERENCE:case o.AstNodeType.NAMED_EXPRESSION:return e;case o.AstNodeType.CELL_RANGE:{const{start:t,end:r}=e,n=this.orderCellRangeEnds(t,r);return Object.assign(Object.assign({},e),{start:n.start,end:n.end})}case o.AstNodeType.COLUMN_RANGE:{const{start:t,end:r}=e,n=this.orderColumnRangeEnds(t,r);return Object.assign(Object.assign({},e),{start:n.start,end:n.end})}case o.AstNodeType.ROW_RANGE:{const{start:t,end:r}=e,n=this.orderRowRangeEnds(t,r);return Object.assign(Object.assign({},e),{start:n.start,end:n.end})}case o.AstNodeType.PERCENT_OP:case o.AstNodeType.PLUS_UNARY_OP:case o.AstNodeType.MINUS_UNARY_OP:{const t=this.convertReversedRangesToRegularRanges(e.value);return Object.assign(Object.assign({},e),{value:t})}case o.AstNodeType.CONCATENATE_OP:case o.AstNodeType.EQUALS_OP:case o.AstNodeType.NOT_EQUAL_OP:case o.AstNodeType.LESS_THAN_OP:case o.AstNodeType.GREATER_THAN_OP:case o.AstNodeType.LESS_THAN_OR_EQUAL_OP:case o.AstNodeType.GREATER_THAN_OR_EQUAL_OP:case o.AstNodeType.MINUS_OP:case o.AstNodeType.PLUS_OP:case o.AstNodeType.TIMES_OP:case o.AstNodeType.DIV_OP:case o.AstNodeType.POWER_OP:{const t=this.convertReversedRangesToRegularRanges(e.left),r=this.convertReversedRangesToRegularRanges(e.right);return Object.assign(Object.assign({},e),{left:t,right:r})}case o.AstNodeType.PARENTHESIS:{const t=this.convertReversedRangesToRegularRanges(e.expression);return Object.assign(Object.assign({},e),{expression:t})}case o.AstNodeType.FUNCTION_CALL:{const t=e.args.map((e=>this.convertReversedRangesToRegularRanges(e)));return Object.assign(Object.assign({},e),{args:t})}case o.AstNodeType.ARRAY:{const t=e.args.map((e=>e.map((e=>this.convertReversedRangesToRegularRanges(e)))));return Object.assign(Object.assign({},e),{args:t})}}}orderCellRangeEnds(e,t){const r=[e,t],[n,s]=r.map((e=>e.toColumnAddress())).sort(p.ColumnAddress.compareByAbsoluteAddress(this.formulaAddress)),[a,i]=r.map((e=>e.toRowAddress())).sort(m.RowAddress.compareByAbsoluteAddress(this.formulaAddress)),[u,l]=r.map((e=>e.sheet)).sort(g.compareSheetIds.bind(this));return{start:o.CellAddress.fromColAndRow(n,a,u),end:o.CellAddress.fromColAndRow(s,i,l)}}orderColumnRangeEnds(e,t){const r=[e,t],[n,s]=r.sort(p.ColumnAddress.compareByAbsoluteAddress(this.formulaAddress)),[o,a]=r.map((e=>e.sheet)).sort(g.compareSheetIds.bind(this));return{start:new p.ColumnAddress(n.type,n.col,o),end:new p.ColumnAddress(s.type,s.col,a)}}orderRowRangeEnds(e,t){const r=[e,t],[n,s]=r.sort(m.RowAddress.compareByAbsoluteAddress(this.formulaAddress)),[o,a]=r.map((e=>e.sheet)).sort(g.compareSheetIds.bind(this));return{start:new m.RowAddress(n.type,n.row,o),end:new m.RowAddress(s.type,s.row,a)}}static compareSheetIds(e,t){return(e=null!=e?e:1/0)-(t=null!=t?t:1/0)}fetchCachedResultForAst(e){const t=this.computeHashFromAst(e);return this.fetchCachedResult(t)}fetchCachedResult(e){const t=this.cache.get(e);if(void 0===t)throw new Error("There is no AST with such key in the cache");{const{ast:e,hasVolatileFunction:r,hasStructuralChangeFunction:n,relativeDependencies:s}=t;return{ast:e,errors:[],hasVolatileFunction:r,hasStructuralChangeFunction:n,dependencies:s}}}computeHashFromTokens(e,t){var r;let s="",o=0;for(;o<e.length;){const i=e[o];if((0,n.tokenMatcher)(i,h.CellReference)){const e=(0,a.cellAddressFromString)(this.sheetMapping,i.image,t);s=void 0===e?s.concat(i.image):s.concat(e.hash(!0))}else if((0,n.tokenMatcher)(i,h.ProcedureName)){const e=i.image.toUpperCase().slice(0,-1),t=null!==(r=this.lexerConfig.functionMapping[e])&&void 0!==r?r:e;s=s.concat(t,"(")}else if((0,n.tokenMatcher)(i,h.ColumnRange)){const[e,r]=i.image.split(":"),n=(0,a.columnAddressFromString)(this.sheetMapping,e,t),o=(0,a.columnAddressFromString)(this.sheetMapping,r,t);s=void 0===n||void 0===o?s.concat("!REF"):s.concat(n.hash(!0),":",o.hash(!0))}else if((0,n.tokenMatcher)(i,h.RowRange)){const[e,r]=i.image.split(":"),n=(0,a.rowAddressFromString)(this.sheetMapping,e,t),o=(0,a.rowAddressFromString)(this.sheetMapping,r,t);s=void 0===n||void 0===o?s.concat("!REF"):s.concat(n.hash(!0),":",o.hash(!0))}else s=s.concat(i.image);o++}return s}rememberNewAst(e){const t=this.computeHashFromAst(e);return this.cache.maybeSetAndThenGet(t,e)}computeHashFromAst(e){return"="+this.computeHashOfAstNode(e)}computeHashOfAstNode(e){switch(e.type){case o.AstNodeType.EMPTY:return e.leadingWhitespace||"";case o.AstNodeType.NUMBER:return(0,i.imageWithWhitespace)((0,d.formatNumber)(e.value,this.config.decimalSeparator),e.leadingWhitespace);case o.AstNodeType.STRING:return(0,i.imageWithWhitespace)('"'+e.value+'"',e.leadingWhitespace);case o.AstNodeType.NAMED_EXPRESSION:return(0,i.imageWithWhitespace)(e.expressionName,e.leadingWhitespace);case o.AstNodeType.FUNCTION_CALL:{const t=e.args.map((e=>this.computeHashOfAstNode(e))).join(this.config.functionArgSeparator),r=e.procedureName+"("+t+(0,i.imageWithWhitespace)(")",e.internalWhitespace);return(0,i.imageWithWhitespace)(r,e.leadingWhitespace)}case o.AstNodeType.CELL_REFERENCE:return(0,i.imageWithWhitespace)(e.reference.hash(!0),e.leadingWhitespace);case o.AstNodeType.COLUMN_RANGE:case o.AstNodeType.ROW_RANGE:case o.AstNodeType.CELL_RANGE:{const t=e.start.hash(e.sheetReferenceType!==i.RangeSheetReferenceType.RELATIVE),r=e.end.hash(e.sheetReferenceType===i.RangeSheetReferenceType.BOTH_ABSOLUTE);return(0,i.imageWithWhitespace)(t+":"+r,e.leadingWhitespace)}case o.AstNodeType.MINUS_UNARY_OP:return(0,i.imageWithWhitespace)("-"+this.computeHashOfAstNode(e.value),e.leadingWhitespace);case o.AstNodeType.PLUS_UNARY_OP:return(0,i.imageWithWhitespace)("+"+this.computeHashOfAstNode(e.value),e.leadingWhitespace);case o.AstNodeType.PERCENT_OP:return this.computeHashOfAstNode(e.value)+(0,i.imageWithWhitespace)("%",e.leadingWhitespace);case o.AstNodeType.ERROR:{const t=this.config.translationPackage.getErrorTranslation(e.error?e.error.type:s.ErrorType.ERROR);return(0,i.imageWithWhitespace)(t,e.leadingWhitespace)}case o.AstNodeType.ERROR_WITH_RAW_INPUT:return(0,i.imageWithWhitespace)(e.rawInput,e.leadingWhitespace);case o.AstNodeType.ARRAY:{const t=e.args.map((e=>e.map((e=>this.computeHashOfAstNode(e))).join(","))).join(";");return(0,i.imageWithWhitespace)("{"+t+(0,i.imageWithWhitespace)("}",e.internalWhitespace),e.leadingWhitespace)}case o.AstNodeType.PARENTHESIS:{const t="("+this.computeHashOfAstNode(e.expression)+(0,i.imageWithWhitespace)(")",e.internalWhitespace);return(0,i.imageWithWhitespace)(t,e.leadingWhitespace)}default:return this.computeHashOfAstNode(e.left)+(0,i.imageWithWhitespace)(u.binaryOpTokenMap[e.type],e.leadingWhitespace)+this.computeHashOfAstNode(e.right)}}bindWhitespacesToTokens(e){const t=[],r=e[0];(0,n.tokenMatcher)(r,this.lexerConfig.WhiteSpace)||t.push(r);for(let r=1;r<e.length;++r){const s=e[r];if((0,n.tokenMatcher)(s,this.lexerConfig.WhiteSpace))continue;const o=e[r-1];(0,n.tokenMatcher)(o,this.lexerConfig.WhiteSpace)&&(s.leadingWhitespace=o),t.push(s)}return t}tokenizeFormula(e){return this.lexer.tokenizeFormula(e)}}t.ParserWithCaching=g},function(t,r){t.exports=e},function(e,t,r){"use strict";t.__esModule=!0,t.buildTimesOpAst=t.buildStringAst=t.buildRowRangeAst=t.buildProcedureAst=t.buildPowerOpAst=t.buildPlusUnaryOpAst=t.buildPlusOpAst=t.buildPercentOpAst=t.buildParsingErrorAst=t.buildParenthesisAst=t.buildNumberAst=t.buildNotEqualOpAst=t.buildNamedExpressionAst=t.buildMinusUnaryOpAst=t.buildMinusOpAst=t.buildLessThanOrEqualOpAst=t.buildLessThanOpAst=t.buildGreaterThanOrEqualOpAst=t.buildGreaterThanOpAst=t.buildErrorWithRawInputAst=t.buildEqualsOpAst=t.buildEmptyArgAst=t.buildDivOpAst=t.buildConcatenateOpAst=t.buildColumnRangeAst=t.buildCellReferenceAst=t.buildCellRangeAst=t.buildCellErrorAst=t.buildArrayAst=t.RangeSheetReferenceType=t.ParsingErrorType=t.AstNodeType=void 0,t.imageWithWhitespace=function(e,t){return(null!=t?t:"")+e},t.parsingError=void 0;var n=r(106);var s,o,a;t.parsingError=(e,t)=>({type:e,message:t}),function(e){e.LexingError="LexingError",e.ParserError="ParsingError",e.StaticOffsetError="StaticOffsetError",e.StaticOffsetOutOfRangeError="StaticOffsetOutOfRangeError",e.RangeOffsetNotAllowed="RangeOffsetNotAllowed",e.InvalidRangeSize="InvalidRangeSize"}(s||(t.ParsingErrorType=s={})),function(e){e.EMPTY="EMPTY",e.NUMBER="NUMBER",e.STRING="STRING",e.MINUS_UNARY_OP="MINUS_UNARY_OP",e.PLUS_UNARY_OP="PLUS_UNARY_OP",e.PERCENT_OP="PERCENT_OP",e.CONCATENATE_OP="CONCATENATE_OP",e.EQUALS_OP="EQUALS_OP",e.NOT_EQUAL_OP="NOT_EQUAL_OP",e.GREATER_THAN_OP="GREATER_THAN_OP",e.LESS_THAN_OP="LESS_THAN_OP",e.GREATER_THAN_OR_EQUAL_OP="GREATER_THAN_OR_EQUAL_OP",e.LESS_THAN_OR_EQUAL_OP="LESS_THAN_OR_EQUAL_OP",e.PLUS_OP="PLUS_OP",e.MINUS_OP="MINUS_OP",e.TIMES_OP="TIMES_OP",e.DIV_OP="DIV_OP",e.POWER_OP="POWER_OP",e.FUNCTION_CALL="FUNCTION_CALL",e.NAMED_EXPRESSION="NAMED_EXPRESSION",e.PARENTHESIS="PARENTHESES",e.CELL_REFERENCE="CELL_REFERENCE",e.CELL_RANGE="CELL_RANGE",e.COLUMN_RANGE="COLUMN_RANGE",e.ROW_RANGE="ROW_RANGE",e.ERROR="ERROR",e.ERROR_WITH_RAW_INPUT="ERROR_WITH_RAW_INPUT",e.ARRAY="ARRAY"}(o||(t.AstNodeType=o={})),function(e){e[e.RELATIVE=0]="RELATIVE",e[e.START_ABSOLUTE=1]="START_ABSOLUTE",e[e.BOTH_ABSOLUTE=2]="BOTH_ABSOLUTE"}(a||(t.RangeSheetReferenceType=a={}));t.buildEmptyArgAst=e=>({type:o.EMPTY,leadingWhitespace:null==e?void 0:e.image});t.buildNumberAst=(e,t)=>({type:o.NUMBER,value:e,leadingWhitespace:null==t?void 0:t.image});t.buildStringAst=e=>{var t;return{type:o.STRING,value:e.image.slice(1,-1),leadingWhitespace:null===(t=e.leadingWhitespace)||void 0===t?void 0:t.image}};t.buildCellReferenceAst=(e,t)=>({type:o.CELL_REFERENCE,reference:e,leadingWhitespace:null==t?void 0:t.image});t.buildCellRangeAst=(e,t,r,n)=>(i(e,t,r),{type:o.CELL_RANGE,start:e,end:t,sheetReferenceType:r,leadingWhitespace:n});t.buildColumnRangeAst=(e,t,r,n)=>(i(e,t,r),{type:o.COLUMN_RANGE,start:e,end:t,sheetReferenceType:r,leadingWhitespace:null==n?void 0:n.image});t.buildRowRangeAst=(e,t,r,n)=>(i(e,t,r),{type:o.ROW_RANGE,start:e,end:t,sheetReferenceType:r,leadingWhitespace:null==n?void 0:n.image});t.buildConcatenateOpAst=(e,t,r)=>({type:o.CONCATENATE_OP,left:e,right:t,leadingWhitespace:null==r?void 0:r.image});t.buildEqualsOpAst=(e,t,r)=>({type:o.EQUALS_OP,left:e,right:t,leadingWhitespace:null==r?void 0:r.image});t.buildNotEqualOpAst=(e,t,r)=>({type:o.NOT_EQUAL_OP,left:e,right:t,leadingWhitespace:null==r?void 0:r.image});t.buildGreaterThanOpAst=(e,t,r)=>({type:o.GREATER_THAN_OP,left:e,right:t,leadingWhitespace:null==r?void 0:r.image});t.buildLessThanOpAst=(e,t,r)=>({type:o.LESS_THAN_OP,left:e,right:t,leadingWhitespace:null==r?void 0:r.image});t.buildGreaterThanOrEqualOpAst=(e,t,r)=>({type:o.GREATER_THAN_OR_EQUAL_OP,left:e,right:t,leadingWhitespace:null==r?void 0:r.image});t.buildLessThanOrEqualOpAst=(e,t,r)=>({type:o.LESS_THAN_OR_EQUAL_OP,left:e,right:t,leadingWhitespace:null==r?void 0:r.image});t.buildPlusOpAst=(e,t,r)=>({type:o.PLUS_OP,left:e,right:t,leadingWhitespace:null==r?void 0:r.image});t.buildMinusOpAst=(e,t,r)=>({type:o.MINUS_OP,left:e,right:t,leadingWhitespace:null==r?void 0:r.image});t.buildTimesOpAst=(e,t,r)=>({type:o.TIMES_OP,left:e,right:t,leadingWhitespace:null==r?void 0:r.image});t.buildDivOpAst=(e,t,r)=>({type:o.DIV_OP,left:e,right:t,leadingWhitespace:null==r?void 0:r.image});t.buildPowerOpAst=(e,t,r)=>({type:o.POWER_OP,left:e,right:t,leadingWhitespace:null==r?void 0:r.image});t.buildMinusUnaryOpAst=(e,t)=>({type:o.MINUS_UNARY_OP,value:e,leadingWhitespace:null==t?void 0:t.image});t.buildPlusUnaryOpAst=(e,t)=>({type:o.PLUS_UNARY_OP,value:e,leadingWhitespace:null==t?void 0:t.image});t.buildPercentOpAst=(e,t)=>({type:o.PERCENT_OP,value:e,leadingWhitespace:null==t?void 0:t.image});t.buildProcedureAst=(e,t,r,n,s)=>({type:o.FUNCTION_CALL,procedureName:e,args:t,leadingWhitespace:null==r?void 0:r.image,internalWhitespace:null==n?void 0:n.image,hyperlink:s});t.buildArrayAst=(e,t,r)=>({type:o.ARRAY,args:e,leadingWhitespace:null==t?void 0:t.image,internalWhitespace:null==r?void 0:r.image});t.buildNamedExpressionAst=(e,t)=>({type:o.NAMED_EXPRESSION,expressionName:e,leadingWhitespace:null==t?void 0:t.image});t.buildParenthesisAst=(e,t,r)=>({type:o.PARENTHESIS,expression:e,leadingWhitespace:null==t?void 0:t.image,internalWhitespace:null==r?void 0:r.image});t.buildCellErrorAst=(e,t)=>({type:o.ERROR,error:e,leadingWhitespace:null==t?void 0:t.image});t.buildErrorWithRawInputAst=(e,t,r)=>({type:o.ERROR_WITH_RAW_INPUT,error:t,rawInput:e,leadingWhitespace:null==r?void 0:r.image});function i(e,t,r){if(void 0!==e.sheet&&void 0===t.sheet||void 0===e.sheet&&void 0!==t.sheet)throw new Error("Start address inconsistent with end address");if(void 0===e.sheet&&r!==a.RELATIVE||void 0!==e.sheet&&r===a.RELATIVE)throw new Error("Sheet address inconsistent with sheet reference type")}t.buildParsingErrorAst=()=>({type:o.ERROR,error:n.CellError.parsingError()})},function(e,t,r){"use strict";t.__esModule=!0,t.binaryOpTokenMap=void 0;var n=r(145);t.binaryOpTokenMap={[n.AstNodeType.PLUS_OP]:"+",[n.AstNodeType.MINUS_OP]:"-",[n.AstNodeType.TIMES_OP]:"*",[n.AstNodeType.DIV_OP]:"/",[n.AstNodeType.CONCATENATE_OP]:"&",[n.AstNodeType.POWER_OP]:"^",[n.AstNodeType.EQUALS_OP]:"=",[n.AstNodeType.NOT_EQUAL_OP]:"<>",[n.AstNodeType.GREATER_THAN_OP]:">",[n.AstNodeType.GREATER_THAN_OR_EQUAL_OP]:">=",[n.AstNodeType.LESS_THAN_OP]:"<",[n.AstNodeType.LESS_THAN_OR_EQUAL_OP]:"<="}},function(e,t,r){"use strict";t.__esModule=!0,t.doesContainFunctions=t.Cache=void 0,r(73),r(148);var n=r(137);t.Cache=class{constructor(e){this.functionRegistry=e,this.cache=new Map}set(e,t){const r=((e,t,r,n)=>({ast:e,relativeDependencies:t,hasVolatileFunction:r,hasStructuralChangeFunction:n}))(t,(0,n.collectDependencies)(t,this.functionRegistry),s(t,this.functionRegistry.isFunctionVolatile),s(t,this.functionRegistry.isFunctionDependentOnSheetStructureChange));return this.cache.set(e,r),r}get(e){return this.cache.get(e)}maybeSetAndThenGet(e,t){const r=this.cache.get(e);return void 0!==r?r.ast:(this.set(e,t),t)}};const s=(e,t)=>{switch(e.type){case n.AstNodeType.EMPTY:case n.AstNodeType.NUMBER:case n.AstNodeType.STRING:case n.AstNodeType.ERROR:case n.AstNodeType.ERROR_WITH_RAW_INPUT:case n.AstNodeType.CELL_REFERENCE:case n.AstNodeType.CELL_RANGE:case n.AstNodeType.COLUMN_RANGE:case n.AstNodeType.ROW_RANGE:case n.AstNodeType.NAMED_EXPRESSION:return!1;case n.AstNodeType.PERCENT_OP:case n.AstNodeType.PLUS_UNARY_OP:case n.AstNodeType.MINUS_UNARY_OP:return s(e.value,t);case n.AstNodeType.CONCATENATE_OP:case n.AstNodeType.EQUALS_OP:case n.AstNodeType.NOT_EQUAL_OP:case n.AstNodeType.LESS_THAN_OP:case n.AstNodeType.GREATER_THAN_OP:case n.AstNodeType.LESS_THAN_OR_EQUAL_OP:case n.AstNodeType.GREATER_THAN_OR_EQUAL_OP:case n.AstNodeType.MINUS_OP:case n.AstNodeType.PLUS_OP:case n.AstNodeType.TIMES_OP:case n.AstNodeType.DIV_OP:case n.AstNodeType.POWER_OP:return s(e.left,t)||s(e.right,t);case n.AstNodeType.PARENTHESIS:return s(e.expression,t);case n.AstNodeType.FUNCTION_CALL:return!!t(e.procedureName)||e.args.some((e=>s(e,t)));case n.AstNodeType.ARRAY:return e.args.some((e=>e.some((e=>s(e,t)))))}};t.doesContainFunctions=s},function(e,t,r){"use strict";r(149)},function(e,t,r){"use strict";var n=r(4),s=r(96),o=r(32),a=r(48),i=r(88);n({target:"Iterator",proto:!0,real:!0},{some:function(e){a(this),o(e);var t=i(this),r=0;return s(t,(function(t,n){if(e(t,r++))return n()}),{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},function(e,t,r){"use strict";t.__esModule=!0,t.FormulaParser=t.FormulaLexer=void 0,r(3),r(85);var n=r(144),s=r(106),o=r(151),a=r(138),i=r(145),u=r(139),l=r(152);class c extends n.EmbeddedActionsParser{constructor(e,t){super(e.allTokens,{outputCst:!1,maxLookahead:7}),this.booleanExpressionOrEmpty=this.RULE("booleanExpressionOrEmpty",(()=>this.OR([{ALT:()=>this.SUBRULE(this.booleanExpression)},{ALT:(0,n.EMPTY_ALT)((0,i.buildEmptyArgAst)())}]))),this.procedureExpression=this.RULE("procedureExpression",(()=>{var e;const t=this.CONSUME(l.ProcedureName),r=t.image.toUpperCase().slice(0,-1),n=null!==(e=this.lexerConfig.functionMapping[r])&&void 0!==e?e:r,s=[];let o=this.SUBRULE(this.booleanExpressionOrEmpty);this.MANY((()=>{var e;const t=this.CONSUME(this.lexerConfig.ArgSeparator);o.type===i.AstNodeType.EMPTY&&(o.leadingWhitespace=null===(e=t.leadingWhitespace)||void 0===e?void 0:e.image),s.push(o),o=this.SUBRULE2(this.booleanExpressionOrEmpty)})),s.push(o),1===s.length&&s[0].type===i.AstNodeType.EMPTY&&(s.length=0);const a=this.CONSUME(l.RParen);return(0,i.buildProcedureAst)(n,s,t.leadingWhitespace,a.leadingWhitespace)})),this.namedExpressionExpression=this.RULE("namedExpressionExpression",(()=>{const e=this.CONSUME(l.NamedExpression);return(0,i.buildNamedExpressionAst)(e.image,e.leadingWhitespace)})),this.offsetProcedureExpression=this.RULE("offsetProcedureExpression",(()=>{const e=[];return this.CONSUME(this.lexerConfig.OffsetProcedureName),this.CONSUME(l.LParen),this.MANY_SEP({SEP:this.lexerConfig.ArgSeparator,DEF:()=>{e.push(this.SUBRULE(this.booleanExpression))}}),this.CONSUME(l.RParen),this.handleOffsetHeuristic(e)})),this.columnRangeExpression=this.RULE("columnRangeExpression",(()=>{const e=this.CONSUME(l.ColumnRange),[t,r]=e.image.split(":"),n=this.ACTION((()=>(0,a.columnAddressFromString)(this.sheetMapping,t,this.formulaAddress))),o=this.ACTION((()=>(0,a.columnAddressFromString)(this.sheetMapping,r,this.formulaAddress)));if(void 0===n||void 0===o)return(0,i.buildCellErrorAst)(new s.CellError(s.ErrorType.REF));if(n.exceedsSheetSizeLimits(this.lexerConfig.maxColumns)||o.exceedsSheetSizeLimits(this.lexerConfig.maxColumns))return(0,i.buildErrorWithRawInputAst)(e.image,new s.CellError(s.ErrorType.NAME),e.leadingWhitespace);if(void 0===n.sheet&&void 0!==o.sheet)return this.parsingError(i.ParsingErrorType.ParserError,"Malformed range expression");const{firstEnd:u,secondEnd:h,sheetRefType:d}=c.fixSheetIdsForRangeEnds(n,o);return(0,i.buildColumnRangeAst)(u,h,d,e.leadingWhitespace)})),this.rowRangeExpression=this.RULE("rowRangeExpression",(()=>{const e=this.CONSUME(l.RowRange),[t,r]=e.image.split(":"),n=this.ACTION((()=>(0,a.rowAddressFromString)(this.sheetMapping,t,this.formulaAddress))),o=this.ACTION((()=>(0,a.rowAddressFromString)(this.sheetMapping,r,this.formulaAddress)));if(void 0===n||void 0===o)return(0,i.buildCellErrorAst)(new s.CellError(s.ErrorType.REF));if(n.exceedsSheetSizeLimits(this.lexerConfig.maxRows)||o.exceedsSheetSizeLimits(this.lexerConfig.maxRows))return(0,i.buildErrorWithRawInputAst)(e.image,new s.CellError(s.ErrorType.NAME),e.leadingWhitespace);if(void 0===n.sheet&&void 0!==o.sheet)return this.parsingError(i.ParsingErrorType.ParserError,"Malformed range expression");const{firstEnd:u,secondEnd:h,sheetRefType:d}=c.fixSheetIdsForRangeEnds(n,o);return(0,i.buildRowRangeAst)(u,h,d,e.leadingWhitespace)})),this.cellReference=this.RULE("cellReference",(()=>{const e=this.CONSUME(l.CellReference),t=this.ACTION((()=>(0,a.cellAddressFromString)(this.sheetMapping,e.image,this.formulaAddress)));return void 0===t?(0,i.buildErrorWithRawInputAst)(e.image,new s.CellError(s.ErrorType.REF),e.leadingWhitespace):t.exceedsSheetSizeLimits(this.lexerConfig.maxColumns,this.lexerConfig.maxRows)?(0,i.buildErrorWithRawInputAst)(e.image,new s.CellError(s.ErrorType.NAME),e.leadingWhitespace):(0,i.buildCellReferenceAst)(t,e.leadingWhitespace)})),this.endRangeReference=this.RULE("endRangeReference",(e=>{var t;const r=this.CONSUME(l.CellReference),n=this.ACTION((()=>(0,a.cellAddressFromString)(this.sheetMapping,e.image,this.formulaAddress))),o=this.ACTION((()=>(0,a.cellAddressFromString)(this.sheetMapping,r.image,this.formulaAddress)));return void 0===n||void 0===o?this.ACTION((()=>(0,i.buildErrorWithRawInputAst)(`${e.image}:${r.image}`,new s.CellError(s.ErrorType.REF),e.leadingWhitespace))):n.exceedsSheetSizeLimits(this.lexerConfig.maxColumns,this.lexerConfig.maxRows)||o.exceedsSheetSizeLimits(this.lexerConfig.maxColumns,this.lexerConfig.maxRows)?this.ACTION((()=>(0,i.buildErrorWithRawInputAst)(`${e.image}:${r.image}`,new s.CellError(s.ErrorType.NAME),e.leadingWhitespace))):this.buildCellRange(n,o,null===(t=e.leadingWhitespace)||void 0===t?void 0:t.image)})),this.endOfRangeExpression=this.RULE("endOfRangeExpression",(e=>this.OR([{ALT:()=>this.SUBRULE(this.endRangeReference,{ARGS:[e]})},{ALT:()=>{var t;const r=this.SUBRULE(this.offsetProcedureExpression),n=this.ACTION((()=>(0,a.cellAddressFromString)(this.sheetMapping,e.image,this.formulaAddress)));return void 0===n?(0,i.buildCellErrorAst)(new s.CellError(s.ErrorType.REF)):r.type===i.AstNodeType.CELL_REFERENCE?this.buildCellRange(n,r.reference,null===(t=e.leadingWhitespace)||void 0===t?void 0:t.image):this.parsingError(i.ParsingErrorType.RangeOffsetNotAllowed,"Range offset not allowed here")}}]))),this.cellRangeExpression=this.RULE("cellRangeExpression",(()=>{const e=this.CONSUME(l.CellReference);return this.CONSUME2(l.RangeSeparator),this.SUBRULE(this.endOfRangeExpression,{ARGS:[e]})})),this.endRangeWithOffsetStartReference=this.RULE("endRangeWithOffsetStartReference",(e=>{const t=this.CONSUME(l.CellReference),r=this.ACTION((()=>(0,a.cellAddressFromString)(this.sheetMapping,t.image,this.formulaAddress)));return void 0===r?this.ACTION((()=>(0,i.buildCellErrorAst)(new s.CellError(s.ErrorType.REF)))):this.buildCellRange(e.reference,r,e.leadingWhitespace)})),this.endOfRangeWithOffsetStartExpression=this.RULE("endOfRangeWithOffsetStartExpression",(e=>this.OR([{ALT:()=>this.SUBRULE(this.endRangeWithOffsetStartReference,{ARGS:[e]})},{ALT:()=>{const t=this.SUBRULE(this.offsetProcedureExpression);return t.type===i.AstNodeType.CELL_REFERENCE?this.buildCellRange(e.reference,t.reference,e.leadingWhitespace):this.parsingError(i.ParsingErrorType.RangeOffsetNotAllowed,"Range offset not allowed here")}}]))),this.offsetExpression=this.RULE("offsetExpression",(()=>{const e=this.SUBRULE(this.offsetProcedureExpression);let t;return this.OPTION((()=>{this.CONSUME(l.RangeSeparator),t=e.type===i.AstNodeType.CELL_RANGE?this.parsingError(i.ParsingErrorType.RangeOffsetNotAllowed,"Range offset not allowed here"):this.SUBRULE(this.endOfRangeWithOffsetStartExpression,{ARGS:[e]})})),void 0!==t?t:e})),this.insideArrayExpression=this.RULE("insideArrayExpression",(()=>{const e=[[]];return e[e.length-1].push(this.SUBRULE(this.booleanExpression)),this.MANY((()=>{this.OR([{ALT:()=>{this.CONSUME(this.lexerConfig.ArrayColSeparator),e[e.length-1].push(this.SUBRULE2(this.booleanExpression))}},{ALT:()=>{this.CONSUME(this.lexerConfig.ArrayRowSeparator),e.push([]),e[e.length-1].push(this.SUBRULE3(this.booleanExpression))}}])})),(0,i.buildArrayAst)(e)})),this.parenthesisExpression=this.RULE("parenthesisExpression",(()=>{const e=this.CONSUME(l.LParen),t=this.SUBRULE(this.booleanExpression),r=this.CONSUME(l.RParen);return(0,i.buildParenthesisAst)(t,e.leadingWhitespace,r.leadingWhitespace)})),this.arrayExpression=this.RULE("arrayExpression",(()=>this.OR([{ALT:()=>{const e=this.CONSUME(l.ArrayLParen),t=this.SUBRULE(this.insideArrayExpression),r=this.CONSUME(l.ArrayRParen);return(0,i.buildArrayAst)(t.args,e.leadingWhitespace,r.leadingWhitespace)}},{ALT:()=>this.SUBRULE(this.parenthesisExpression)}]))),this.numericStringToNumber=e=>{const t=e.replace(this.lexerConfig.decimalSeparator,".");return Number(t)},this.positiveAtomicExpression=this.RULE("positiveAtomicExpression",(()=>{var e;return this.OR(null!==(e=this.atomicExpCache)&&void 0!==e?e:this.atomicExpCache=[{ALT:()=>this.SUBRULE(this.arrayExpression)},{ALT:()=>this.SUBRULE(this.cellRangeExpression)},{ALT:()=>this.SUBRULE(this.columnRangeExpression)},{ALT:()=>this.SUBRULE(this.rowRangeExpression)},{ALT:()=>this.SUBRULE(this.offsetExpression)},{ALT:()=>this.SUBRULE(this.cellReference)},{ALT:()=>this.SUBRULE(this.procedureExpression)},{ALT:()=>this.SUBRULE(this.namedExpressionExpression)},{ALT:()=>{const e=this.CONSUME(this.lexerConfig.NumberLiteral);return(0,i.buildNumberAst)(this.numericStringToNumber(e.image),e.leadingWhitespace)}},{ALT:()=>{const e=this.CONSUME(l.StringLiteral);return(0,i.buildStringAst)(e)}},{ALT:()=>{const e=this.CONSUME(l.ErrorLiteral),t=e.image.toUpperCase(),r=this.lexerConfig.errorMapping[t];return r?(0,i.buildCellErrorAst)(new s.CellError(r),e.leadingWhitespace):this.parsingError(i.ParsingErrorType.ParserError,"Unknown error literal")}}])})),this.rightUnaryOpAtomicExpression=this.RULE("rightUnaryOpAtomicExpression",(()=>{const e=this.SUBRULE(this.positiveAtomicExpression),t=this.OPTION((()=>this.CONSUME(l.PercentOp)));return t?(0,i.buildPercentOpAst)(e,t.leadingWhitespace):e})),this.atomicExpression=this.RULE("atomicExpression",(()=>this.OR([{ALT:()=>{const e=this.CONSUME(l.AdditionOp),t=this.SUBRULE(this.atomicExpression);return(0,n.tokenMatcher)(e,l.PlusOp)?(0,i.buildPlusUnaryOpAst)(t,e.leadingWhitespace):(0,n.tokenMatcher)(e,l.MinusOp)?(0,i.buildMinusUnaryOpAst)(t,e.leadingWhitespace):(this.customParsingError=(0,i.parsingError)(i.ParsingErrorType.ParserError,"Mismatched token type"),this.customParsingError)}},{ALT:()=>this.SUBRULE2(this.rightUnaryOpAtomicExpression)}]))),this.powerExpression=this.RULE("powerExpression",(()=>{let e=this.SUBRULE(this.atomicExpression);return this.MANY((()=>{const t=this.CONSUME(l.PowerOp),r=this.SUBRULE2(this.atomicExpression);(0,n.tokenMatcher)(t,l.PowerOp)?e=(0,i.buildPowerOpAst)(e,r,t.leadingWhitespace):this.ACTION((()=>{throw Error("Operator not supported")}))})),e})),this.multiplicationExpression=this.RULE("multiplicationExpression",(()=>{let e=this.SUBRULE(this.powerExpression);return this.MANY((()=>{const t=this.CONSUME(l.MultiplicationOp),r=this.SUBRULE2(this.powerExpression);(0,n.tokenMatcher)(t,l.TimesOp)?e=(0,i.buildTimesOpAst)(e,r,t.leadingWhitespace):(0,n.tokenMatcher)(t,l.DivOp)?e=(0,i.buildDivOpAst)(e,r,t.leadingWhitespace):this.ACTION((()=>{throw Error("Operator not supported")}))})),e})),this.additionExpression=this.RULE("additionExpression",(()=>{let e=this.SUBRULE(this.multiplicationExpression);return this.MANY((()=>{const t=this.CONSUME(l.AdditionOp),r=this.SUBRULE2(this.multiplicationExpression);(0,n.tokenMatcher)(t,l.PlusOp)?e=(0,i.buildPlusOpAst)(e,r,t.leadingWhitespace):(0,n.tokenMatcher)(t,l.MinusOp)?e=(0,i.buildMinusOpAst)(e,r,t.leadingWhitespace):this.ACTION((()=>{throw Error("Operator not supported")}))})),e})),this.concatenateExpression=this.RULE("concatenateExpression",(()=>{let e=this.SUBRULE(this.additionExpression);return this.MANY((()=>{const t=this.CONSUME(l.ConcatenateOp),r=this.SUBRULE2(this.additionExpression);e=(0,i.buildConcatenateOpAst)(e,r,t.leadingWhitespace)})),e})),this.booleanExpression=this.RULE("booleanExpression",(()=>{let e=this.SUBRULE(this.concatenateExpression);return this.MANY((()=>{const t=this.CONSUME(l.BooleanOp),r=this.SUBRULE2(this.concatenateExpression);(0,n.tokenMatcher)(t,l.EqualsOp)?e=(0,i.buildEqualsOpAst)(e,r,t.leadingWhitespace):(0,n.tokenMatcher)(t,l.NotEqualOp)?e=(0,i.buildNotEqualOpAst)(e,r,t.leadingWhitespace):(0,n.tokenMatcher)(t,l.GreaterThanOp)?e=(0,i.buildGreaterThanOpAst)(e,r,t.leadingWhitespace):(0,n.tokenMatcher)(t,l.LessThanOp)?e=(0,i.buildLessThanOpAst)(e,r,t.leadingWhitespace):(0,n.tokenMatcher)(t,l.GreaterThanOrEqualOp)?e=(0,i.buildGreaterThanOrEqualOpAst)(e,r,t.leadingWhitespace):(0,n.tokenMatcher)(t,l.LessThanOrEqualOp)?e=(0,i.buildLessThanOrEqualOpAst)(e,r,t.leadingWhitespace):this.ACTION((()=>{throw Error("Operator not supported")}))})),e})),this.formula=this.RULE("formula",(()=>(this.CONSUME(l.EqualsOp),this.SUBRULE(this.booleanExpression)))),this.lexerConfig=e,this.sheetMapping=t,this.formulaAddress=(0,s.simpleCellAddress)(0,0,0),this.performSelfAnalysis()}parseFromTokens(e,t){this.input=e;let r=this.formulaWithContext(t),n=[];return this.customParsingError&&n.push(this.customParsingError),n=n.concat(this.errors.map((e=>({type:i.ParsingErrorType.ParserError,message:e.message})))),n.length>0&&(r=(0,i.buildParsingErrorAst)()),{ast:r,errors:n}}reset(){super.reset(),this.customParsingError=void 0}formulaWithContext(e){return this.formulaAddress=e,this.formula()}buildCellRange(e,t,r){if(void 0===e.sheet&&void 0!==t.sheet)return this.parsingError(i.ParsingErrorType.ParserError,"Malformed range expression");const{firstEnd:n,secondEnd:s,sheetRefType:o}=c.fixSheetIdsForRangeEnds(e,t);return(0,i.buildCellRangeAst)(n,s,o,r)}static fixSheetIdsForRangeEnds(e,t){const r=c.rangeSheetReferenceType(e.sheet,t.sheet);return{firstEnd:e,secondEnd:void 0!==e.sheet&&void 0===t.sheet?t.withSheet(e.sheet):t,sheetRefType:r}}handleOffsetHeuristic(e){const t=e[0];if(t.type!==i.AstNodeType.CELL_REFERENCE)return this.parsingError(i.ParsingErrorType.StaticOffsetError,"First argument to OFFSET is not a reference");const r=e[1];let n;if(r.type===i.AstNodeType.NUMBER&&Number.isInteger(r.value))n=r.value;else if(r.type===i.AstNodeType.PLUS_UNARY_OP&&r.value.type===i.AstNodeType.NUMBER&&Number.isInteger(r.value.value))n=r.value.value;else{if(r.type!==i.AstNodeType.MINUS_UNARY_OP||r.value.type!==i.AstNodeType.NUMBER||!Number.isInteger(r.value.value))return this.parsingError(i.ParsingErrorType.StaticOffsetError,"Second argument to OFFSET is not a static number");n=-r.value.value}const a=e[2];let l;if(a.type===i.AstNodeType.NUMBER&&Number.isInteger(a.value))l=a.value;else if(a.type===i.AstNodeType.PLUS_UNARY_OP&&a.value.type===i.AstNodeType.NUMBER&&Number.isInteger(a.value.value))l=a.value.value;else{if(a.type!==i.AstNodeType.MINUS_UNARY_OP||a.value.type!==i.AstNodeType.NUMBER||!Number.isInteger(a.value.value))return this.parsingError(i.ParsingErrorType.StaticOffsetError,"Third argument to OFFSET is not a static number");l=-a.value.value}const c=e[3];let h;if(void 0===c)h=1;else{if(c.type!==i.AstNodeType.NUMBER)return this.parsingError(i.ParsingErrorType.StaticOffsetError,"Fourth argument to OFFSET is not a static number");if(h=c.value,h<1)return this.parsingError(i.ParsingErrorType.StaticOffsetError,"Fourth argument to OFFSET is too small number");if(!Number.isInteger(h))return this.parsingError(i.ParsingErrorType.StaticOffsetError,"Fourth argument to OFFSET is not integer")}const d=e[4];let p;if(void 0===d)p=1;else{if(d.type!==i.AstNodeType.NUMBER)return this.parsingError(i.ParsingErrorType.StaticOffsetError,"Fifth argument to OFFSET is not a static number");if(p=d.value,p<1)return this.parsingError(i.ParsingErrorType.StaticOffsetError,"Fifth argument to OFFSET is too small number");if(!Number.isInteger(p))return this.parsingError(i.ParsingErrorType.StaticOffsetError,"Fifth argument to OFFSET is not integer")}const m=new u.CellAddress(t.reference.col+l,t.reference.row+n,t.reference.type);let g=m.col,E=m.row;if(t.reference.type!==u.CellReferenceType.CELL_REFERENCE_RELATIVE&&t.reference.type!==u.CellReferenceType.CELL_REFERENCE_ABSOLUTE_COL||(E+=this.formulaAddress.row),t.reference.type!==u.CellReferenceType.CELL_REFERENCE_RELATIVE&&t.reference.type!==u.CellReferenceType.CELL_REFERENCE_ABSOLUTE_ROW||(g+=this.formulaAddress.col),g<0||E<0)return(0,i.buildCellErrorAst)(new s.CellError(s.ErrorType.REF,o.ErrorMessage.OutOfSheet));if(1===p&&1===h)return(0,i.buildCellReferenceAst)(m);{const e=new u.CellAddress(m.col+p-1,m.row+h-1,m.type);return(0,i.buildCellRangeAst)(m,e,i.RangeSheetReferenceType.RELATIVE)}}parsingError(e,t){return this.customParsingError=(0,i.parsingError)(e,t),(0,i.buildParsingErrorAst)()}static rangeSheetReferenceType(e,t){return void 0===e?i.RangeSheetReferenceType.RELATIVE:void 0===t?i.RangeSheetReferenceType.START_ABSOLUTE:i.RangeSheetReferenceType.BOTH_ABSOLUTE}}t.FormulaParser=c;class h{constructor(e){this.lexerConfig=e,this.lexer=new n.Lexer(e.allTokens,{ensureOptimizations:!0})}tokenizeFormula(e){const t=this.lexer.tokenize(e);let r=t.tokens;return r=this.trimTrailingWhitespaces(r),r=this.skipWhitespacesInsideRanges(r),r=this.skipWhitespacesBeforeArgSeparators(r),t.tokens=r,t}skipWhitespacesInsideRanges(e){return h.filterTokensByNeighbors(e,((e,t,r)=>((0,n.tokenMatcher)(e,l.CellReference)||(0,n.tokenMatcher)(e,l.RangeSeparator))&&(0,n.tokenMatcher)(t,this.lexerConfig.WhiteSpace)&&((0,n.tokenMatcher)(r,l.CellReference)||(0,n.tokenMatcher)(r,l.RangeSeparator))))}skipWhitespacesBeforeArgSeparators(e){return h.filterTokensByNeighbors(e,((e,t,r)=>!(0,n.tokenMatcher)(e,this.lexerConfig.ArgSeparator)&&(0,n.tokenMatcher)(t,this.lexerConfig.WhiteSpace)&&(0,n.tokenMatcher)(r,this.lexerConfig.ArgSeparator)))}static filterTokensByNeighbors(e,t){if(e.length<3)return e;let r=0;const n=[e[r++]];for(;r<e.length-1;)t(e[r-1],e[r],e[r+1])||n.push(e[r]),++r;return n.push(e[r]),n}trimTrailingWhitespaces(e){return e.length>0&&(0,n.tokenMatcher)(e[e.length-1],this.lexerConfig.WhiteSpace)&&e.pop(),e}}t.FormulaLexer=h},function(e,t,r){"use strict";t.__esModule=!0,t.ErrorMessage=void 0;class n{}t.ErrorMessage=n,n.DistinctSigns="Distinct signs.",n.WrongArgNumber="Wrong number of arguments.",n.EmptyArg="Empty function argument.",n.EmptyArray="Empty array not allowed.",n.ArrayDimensions="Array dimensions are not compatible.",n.NoSpaceForArrayResult="No space for array result.",n.ValueSmall="Value too small.",n.ValueLarge="Value too large.",n.BadCriterion="Incorrect criterion.",n.RangeManySheets="Range spans more than one sheet.",n.CellRangeExpected="Cell range expected.",n.WrongDimension="Wrong range dimension.",n.ScalarExpected="Cell range not allowed.",n.NumberCoercion="Value cannot be coerced to number.",n.NumberExpected="Number argument expected.",n.IntegerExpected="Value needs to be an integer.",n.BadMode="Mode not recognized.",n.DateBounds="Date outside of bounds.",n.OutOfSheet="Resulting reference is out of the sheet.",n.WrongType="Wrong type of argument.",n.NaN="NaN or infinite value encountered.",n.EqualLength="Ranges need to be of equal length.",n.Negative="Value cannot be negative.",n.NotBinary="String does not represent a binary number.",n.NotOctal="String does not represent an octal number.",n.NotHex="String does not represent a hexadecimal number.",n.EndStartPeriod="End period needs to be at least start period.",n.CellRefExpected="Cell reference expected.",n.EmptyRange="Empty range not allowed.",n.BadRef="Address is not correct.",n.NumberRange="Number-only range expected.",n.ValueNotFound="Value not found.",n.ValueBaseLarge="Value in base too large.",n.ValueBaseSmall="Value in base too small.",n.ValueBaseLong="Value in base too long.",n.NegativeLength="Length cannot be negative.",n.PatternNotFound="Pattern not found.",n.OneValue="Needs at least one value.",n.TwoValues="Range needs to contain at least two elements.",n.ThreeValues="Range needs to contain at least three elements.",n.IndexBounds="Index out of bounds.",n.IndexLarge="Index too large.",n.Formula="Expected formula.",n.NegativeCount="Count cannot be negative.",n.ParseError="Parsing error.",n.SheetRef="Sheet does not exist.",n.PeriodLong="Period number cannot exceed life length.",n.InvalidDate="Invalid date.",n.BitshiftLong="Result of bitshift is too long.",n.EmptyString="Empty-string argument not allowed.",n.LengthBounds="Length out of bounds.",n.NegativeTime="Time cannot be negative.",n.NoDefault="No default option.",n.NoConditionMet="None of the conditions were met.",n.Selector="Selector cannot exceed the number of arguments.",n.StartEndDate="Start date needs to be earlier than end date.",n.IncorrectDateTime="String does not represent correct DateTime.",n.CharacterCodeBounds="Character code out of bounds.",n.NonZero="Argument cannot be 0.",n.LessThanOne="Argument cannot be less than 1.",n.WeekendString="Incorrect weekend bitmask string.",n.InvalidRoman="Invalid roman numeral.",n.WrongOrder="Wrong order of values.",n.ComplexNumberExpected="Complex number expected.",n.ShouldBeIorJ="Should be 'i' or 'j'.",n.SizeMismatch="Array dimensions mismatched.",n.FunctionName=e=>`Function name ${e} not recognized.`,n.NamedExpressionName=e=>`Named expression ${e} not recognized.`,n.LicenseKey=e=>`License key is ${e}.`},function(e,t,r){"use strict";t.__esModule=!0,t.buildLexerConfig=t.TimesOp=t.StringLiteral=t.RowRange=t.RangeSeparator=t.RParen=t.ProcedureName=t.PowerOp=t.PlusOp=t.PercentOp=t.NotEqualOp=t.NamedExpression=t.MultiplicationOp=t.MinusOp=t.LessThanOrEqualOp=t.LessThanOp=t.LParen=t.GreaterThanOrEqualOp=t.GreaterThanOp=t.ErrorLiteral=t.EqualsOp=t.DivOp=t.ConcatenateOp=t.ColumnRange=t.CellReference=t.BooleanOp=t.ArrayRParen=t.ArrayLParen=t.AdditionOp=void 0;var n=r(144),s=r(142),o=r(153),a=r(154);const i=t.AdditionOp=(0,n.createToken)({name:"AdditionOp",pattern:n.Lexer.NA}),u=t.PlusOp=(0,n.createToken)({name:"PlusOp",pattern:/\+/,categories:i}),l=t.MinusOp=(0,n.createToken)({name:"MinusOp",pattern:/-/,categories:i}),c=t.MultiplicationOp=(0,n.createToken)({name:"MultiplicationOp",pattern:n.Lexer.NA}),h=t.TimesOp=(0,n.createToken)({name:"TimesOp",pattern:/\*/,categories:c}),d=t.DivOp=(0,n.createToken)({name:"DivOp",pattern:/\//,categories:c}),p=t.PowerOp=(0,n.createToken)({name:"PowerOp",pattern:/\^/}),m=t.PercentOp=(0,n.createToken)({name:"PercentOp",pattern:/%/}),g=t.BooleanOp=(0,n.createToken)({name:"BooleanOp",pattern:n.Lexer.NA}),E=t.EqualsOp=(0,n.createToken)({name:"EqualsOp",pattern:/=/,categories:g}),T=t.NotEqualOp=(0,n.createToken)({name:"NotEqualOp",pattern:/<>/,categories:g}),y=t.GreaterThanOp=(0,n.createToken)({name:"GreaterThanOp",pattern:/>/,categories:g}),f=t.LessThanOp=(0,n.createToken)({name:"LessThanOp",pattern:/</,categories:g}),A=t.GreaterThanOrEqualOp=(0,n.createToken)({name:"GreaterThanOrEqualOp",pattern:/>=/,categories:g}),R=t.LessThanOrEqualOp=(0,n.createToken)({name:"LessThanOrEqualOp",pattern:/<=/,categories:g}),N=t.ConcatenateOp=(0,n.createToken)({name:"ConcatenateOp",pattern:/&/}),S=t.LParen=(0,n.createToken)({name:"LParen",pattern:/\(/}),C=t.RParen=(0,n.createToken)({name:"RParen",pattern:/\)/}),v=t.ArrayLParen=(0,n.createToken)({name:"ArrayLParen",pattern:/{/}),M=t.ArrayRParen=(0,n.createToken)({name:"ArrayRParen",pattern:/}/}),w=t.StringLiteral=(0,n.createToken)({name:"StringLiteral",pattern:/"([^"\\]*(\\.[^"\\]*)*)"/}),F=t.ErrorLiteral=(0,n.createToken)({name:"ErrorLiteral",pattern:/#[A-Za-z0-9\/]+[?!]?/}),O=t.RangeSeparator=(0,n.createToken)({name:"RangeSeparator",pattern:new RegExp(s.RANGE_OPERATOR)}),I=t.ColumnRange=(0,n.createToken)({name:"ColumnRange",pattern:new RegExp(`${s.COLUMN_REFERENCE_PATTERN}${s.RANGE_OPERATOR}${s.COLUMN_REFERENCE_PATTERN}`)}),b=t.RowRange=(0,n.createToken)({name:"RowRange",pattern:new RegExp(`${s.ROW_REFERENCE_PATTERN}${s.RANGE_OPERATOR}${s.ROW_REFERENCE_PATTERN}`)}),x=t.ProcedureName=(0,n.createToken)({name:"ProcedureName",pattern:new RegExp(`([${s.UNICODE_LETTER_PATTERN}][${s.NON_RESERVED_CHARACTER_PATTERN}]*)\\(`)}),V=new o.CellReferenceMatcher,U=t.CellReference=(0,n.createToken)({name:"CellReference",pattern:V.match.bind(V),start_chars_hint:V.POSSIBLE_START_CHARACTERS,line_breaks:!1}),_=new a.NamedExpressionMatcher,P=t.NamedExpression=(0,n.createToken)({name:"NamedExpression",pattern:_.match.bind(_),start_chars_hint:_.POSSIBLE_START_CHARACTERS,line_breaks:!1});t.buildLexerConfig=e=>{const t=e.translationPackage.getFunctionTranslation("OFFSET"),r=e.errorMapping,o=e.translationPackage.buildFunctionMapping(),a=new RegExp("standard"===e.ignoreWhiteSpace?s.ODFF_WHITESPACE_PATTERN:s.ALL_WHITESPACE_PATTERN),V=(0,n.createToken)({name:"WhiteSpace",pattern:a}),_=(0,n.createToken)({name:"ArrayRowSep",pattern:e.arrayRowSeparator}),L=(0,n.createToken)({name:"ArrayColSep",pattern:e.arrayColumnSeparator}),D=(0,n.createToken)({name:"NumberLiteral",pattern:new RegExp(`(([${e.decimalSeparator}]\\d+)|(\\d+([${e.decimalSeparator}]\\d*)?))(e[+-]?\\d+)?`)}),B=(0,n.createToken)({name:"OffsetProcedureName",pattern:new RegExp(t,"i")});let G,H;e.functionArgSeparator===e.arrayColumnSeparator?(G=L,H=[]):e.functionArgSeparator===e.arrayRowSeparator?(G=_,H=[]):(G=(0,n.createToken)({name:"ArgSeparator",pattern:e.functionArgSeparator}),H=[G]);return{ArgSeparator:G,NumberLiteral:D,OffsetProcedureName:B,ArrayRowSeparator:_,ArrayColSeparator:L,WhiteSpace:V,allTokens:[V,u,l,h,d,p,E,T,m,A,R,y,f,S,C,v,M,B,x,O,...H,I,b,D,w,F,N,g,i,c,U,P,_,L],errorMapping:r,functionMapping:o,decimalSeparator:e.decimalSeparator,maxColumns:e.maxColumns,maxRows:e.maxRows}}},function(e,t,r){"use strict";t.__esModule=!0,t.CellReferenceMatcher=void 0;var n=r(142);t.CellReferenceMatcher=class{constructor(){this.POSSIBLE_START_CHARACTERS=[...n.ALL_UNICODE_LETTERS_ARRAY,...n.ALL_DIGITS_ARRAY,n.ABSOLUTE_OPERATOR,"'","_"],this.cellReferenceRegexp=new RegExp(n.CELL_REFERENCE_WITH_NEXT_CHARACTER_PATTERN,"y")}match(e,t){this.cellReferenceRegexp.lastIndex=t;const r=this.cellReferenceRegexp.exec(e+"@");return null==r||null==r[1]?null:(r[0]=r[1],r)}}},function(e,t,r){"use strict";t.__esModule=!0,t.NamedExpressionMatcher=void 0;var n=r(142);t.NamedExpressionMatcher=class{constructor(){this.POSSIBLE_START_CHARACTERS=[...n.ALL_UNICODE_LETTERS_ARRAY,"_"],this.namedExpressionRegexp=new RegExp(n.NAMED_EXPRESSION_PATTERN,"y"),this.r1c1CellRefRegexp=new RegExp(`^${n.R1C1_CELL_REFERENCE_PATTERN}$`)}match(e,t){this.namedExpressionRegexp.lastIndex=t;const r=this.namedExpressionRegexp.exec(e);return null==r||null==r[0]||this.r1c1CellRefRegexp.test(r[0])?null:r}}},function(e,t,r){"use strict";t.__esModule=!0,t.Unparser=void 0,t.formatNumber=u,r(85);var n=r(106),s=r(1),o=r(138),a=r(145),i=r(146);function u(e,t){return e.toString().replace(".",t)}t.Unparser=class{constructor(e,t,r,n){this.config=e,this.lexerConfig=t,this.sheetMappingFn=r,this.namedExpressions=n}unparse(e,t){return"="+this.unparseAst(e,t)}unparseAst(e,t){var r,s;switch(e.type){case a.AstNodeType.EMPTY:return(0,a.imageWithWhitespace)("",e.leadingWhitespace);case a.AstNodeType.NUMBER:return(0,a.imageWithWhitespace)(u(e.value,this.config.decimalSeparator),e.leadingWhitespace);case a.AstNodeType.STRING:return(0,a.imageWithWhitespace)('"'+e.value+'"',e.leadingWhitespace);case a.AstNodeType.FUNCTION_CALL:{const r=e.args.map((e=>void 0!==e?this.unparseAst(e,t):"")).join(this.config.functionArgSeparator),n=(this.config.translationPackage.isFunctionTranslated(e.procedureName)?this.config.translationPackage.getFunctionTranslation(e.procedureName):e.procedureName)+"("+r+(0,a.imageWithWhitespace)(")",e.internalWhitespace);return(0,a.imageWithWhitespace)(n,e.leadingWhitespace)}case a.AstNodeType.NAMED_EXPRESSION:{const n=null===(r=this.namedExpressions.nearestNamedExpression(e.expressionName,t.sheet))||void 0===r?void 0:r.displayName;return(0,a.imageWithWhitespace)(n||e.expressionName,e.leadingWhitespace)}case a.AstNodeType.CELL_REFERENCE:{let r;return r=void 0!==e.reference.sheet?this.unparseSheetName(e.reference.sheet)+"!":"",r+=null!==(s=e.reference.unparse(t))&&void 0!==s?s:this.config.translationPackage.getErrorTranslation(n.ErrorType.REF),(0,a.imageWithWhitespace)(r,e.leadingWhitespace)}case a.AstNodeType.COLUMN_RANGE:case a.AstNodeType.ROW_RANGE:case a.AstNodeType.CELL_RANGE:return(0,a.imageWithWhitespace)(this.formatRange(e,t),e.leadingWhitespace);case a.AstNodeType.PLUS_UNARY_OP:{const r=this.unparseAst(e.value,t);return(0,a.imageWithWhitespace)("+",e.leadingWhitespace)+r}case a.AstNodeType.MINUS_UNARY_OP:{const r=this.unparseAst(e.value,t);return(0,a.imageWithWhitespace)("-",e.leadingWhitespace)+r}case a.AstNodeType.PERCENT_OP:return this.unparseAst(e.value,t)+(0,a.imageWithWhitespace)("%",e.leadingWhitespace);case a.AstNodeType.ERROR:{const t=this.config.translationPackage.getErrorTranslation(e.error?e.error.type:n.ErrorType.ERROR);return(0,a.imageWithWhitespace)(t,e.leadingWhitespace)}case a.AstNodeType.ERROR_WITH_RAW_INPUT:return(0,a.imageWithWhitespace)(e.rawInput,e.leadingWhitespace);case a.AstNodeType.PARENTHESIS:{const r="("+this.unparseAst(e.expression,t)+(0,a.imageWithWhitespace)(")",e.internalWhitespace);return(0,a.imageWithWhitespace)(r,e.leadingWhitespace)}case a.AstNodeType.ARRAY:{const r="{"+e.args.map((e=>e.map((e=>this.unparseAst(e,t))).join(this.config.arrayColumnSeparator))).join(this.config.arrayRowSeparator)+(0,a.imageWithWhitespace)("}",e.internalWhitespace);return(0,a.imageWithWhitespace)(r,e.leadingWhitespace)}default:{const r=this.unparseAst(e.left,t),n=this.unparseAst(e.right,t);return r+(0,a.imageWithWhitespace)(i.binaryOpTokenMap[e.type],e.leadingWhitespace)+n}}}unparseSheetName(e){const t=(0,o.sheetIndexToString)(e,this.sheetMappingFn);if(void 0===t)throw new s.NoSheetWithIdError(e);return t}formatRange(e,t){let r="",s="";void 0!==e.start.sheet&&e.sheetReferenceType!==a.RangeSheetReferenceType.RELATIVE&&(r=this.unparseSheetName(e.start.sheet)+"!"),void 0!==e.end.sheet&&e.sheetReferenceType===a.RangeSheetReferenceType.BOTH_ABSOLUTE&&(s=this.unparseSheetName(e.end.sheet)+"!");const o=e.start.unparse(t),i=e.end.unparse(t);return void 0===o||void 0===i?this.config.translationPackage.getErrorTranslation(n.ErrorType.REF):`${r}${o}:${s}${i}`}}},function(e,t,r){"use strict";t.__esModule=!0,t.collectDependencies=void 0,r(3),r(73),r(134);var n=r(137);const s=(e,t,r,o)=>{switch(e.type){case n.AstNodeType.EMPTY:case n.AstNodeType.NUMBER:case n.AstNodeType.STRING:case n.AstNodeType.ERROR:return;case n.AstNodeType.NAMED_EXPRESSION:return void(o&&r.push(new n.NamedExpressionDependency(e.expressionName)));case n.AstNodeType.CELL_REFERENCE:return void(o&&r.push(new n.AddressDependency(e.reference)));case n.AstNodeType.CELL_RANGE:return void(o&&e.start.sheet===e.end.sheet&&r.push(new n.CellRangeDependency(e.start,e.end)));case n.AstNodeType.COLUMN_RANGE:return void(o&&e.start.sheet===e.end.sheet&&r.push(new n.ColumnRangeDependency(e.start,e.end)));case n.AstNodeType.ROW_RANGE:return void(o&&e.start.sheet===e.end.sheet&&r.push(new n.RowRangeDependency(e.start,e.end)));case n.AstNodeType.PERCENT_OP:case n.AstNodeType.PLUS_UNARY_OP:case n.AstNodeType.MINUS_UNARY_OP:return void s(e.value,t,r,!0);case n.AstNodeType.CONCATENATE_OP:case n.AstNodeType.EQUALS_OP:case n.AstNodeType.NOT_EQUAL_OP:case n.AstNodeType.LESS_THAN_OP:case n.AstNodeType.GREATER_THAN_OP:case n.AstNodeType.LESS_THAN_OR_EQUAL_OP:case n.AstNodeType.GREATER_THAN_OR_EQUAL_OP:case n.AstNodeType.MINUS_OP:case n.AstNodeType.PLUS_OP:case n.AstNodeType.TIMES_OP:case n.AstNodeType.DIV_OP:case n.AstNodeType.POWER_OP:return s(e.left,t,r,!0),void s(e.right,t,r,!0);case n.AstNodeType.PARENTHESIS:return void s(e.expression,t,r,o);case n.AstNodeType.FUNCTION_CALL:{const n=!t.doesFunctionNeedArgumentToBeComputed(e.procedureName);return void e.args.forEach((e=>s(e,t,r,n)))}}};t.collectDependencies=(e,t)=>{const r=new Array;return s(e,t,r,!0),r}},function(e,t,r){"use strict";t.__esModule=!0,t.RowRangeDependency=t.NamedExpressionDependency=t.ColumnRangeDependency=t.CellRangeDependency=t.AddressDependency=void 0;var n=r(105);t.AddressDependency=class{constructor(e){this.dependency=e}absolutize(e){return this.dependency.toSimpleCellAddress(e)}};t.CellRangeDependency=class{constructor(e,t){this.start=e,this.end=t}absolutize(e){return new n.AbsoluteCellRange(this.start.toSimpleCellAddress(e),this.end.toSimpleCellAddress(e))}};t.ColumnRangeDependency=class{constructor(e,t){this.start=e,this.end=t}absolutize(e){const t=this.start.toSimpleColumnAddress(e),r=this.end.toSimpleColumnAddress(e);return new n.AbsoluteColumnRange(t.sheet,t.col,r.col)}};t.RowRangeDependency=class{constructor(e,t){this.start=e,this.end=t}absolutize(e){const t=this.start.toSimpleRowAddress(e),r=this.end.toSimpleRowAddress(e);return new n.AbsoluteRowRange(t.sheet,t.row,r.row)}};t.NamedExpressionDependency=class{constructor(e){this.name=e}absolutize(e){return this}}},function(e,t,r){"use strict";t.__esModule=!0,t.ContentChanges=void 0,r(3),r(73),r(134);var n=r(106),s=r(159);class o{constructor(){this.changes=new Map}static empty(){return new o}addAll(e){for(const t of e.changes.values())this.add(t.address,t);return this}addChange(e,t,r){this.addInterpreterValue(e,t,r)}exportChanges(e){let t=[];return this.changes.forEach((r=>{const n=e.exportChange(r);Array.isArray(n)?t=t.concat(n):t.push(n)})),t}getChanges(){return Array.from(this.changes.values())}isEmpty(){return 0===this.changes.size}add(e,t){const r=t.value;if(r instanceof s.SimpleRangeValue)for(const t of r.effectiveAddressesFromData(e))this.changes.delete((0,n.addressKey)(t));this.changes.set((0,n.addressKey)(e),t)}addInterpreterValue(e,t,r){this.add(t,{address:t,value:e,oldValue:r})}}t.ContentChanges=o},function(e,t,r){"use strict";t.__esModule=!0,t.SimpleRangeValue=void 0,r(3);var n=r(2),s=r(106),o=r(151),a=r(160);class i{constructor(e,t,r,s){this._data=e,this.range=t,this.dependencyGraph=r,this._hasOnlyNumbers=s,this.size=void 0===e?new n.ArraySize(t.effectiveWidth(r),t.effectiveHeight(r)):new n.ArraySize(e[0].length,e.length)}get data(){return this.ensureThatComputed(),this._data}static fromRange(e,t,r){return new i(e,t,r,!0)}static onlyNumbers(e){return new i(e,void 0,void 0,!0)}static onlyValues(e){return new i(e,void 0,void 0,void 0)}static onlyRange(e,t){return new i(void 0,e,t,void 0)}static fromScalar(e){return new i([[e]],void 0,void 0,void 0)}isAdHoc(){return void 0===this.range}width(){return this.size.width}height(){return this.size.height}valuesFromTopLeftCorner(){this.ensureThatComputed();const e=[];for(let t=0;t<this._data.length;t++)for(let r=0;r<this._data[0].length;r++)e.push(this._data[t][r]);return e}*effectiveAddressesFromData(e){for(let t=0;t<this.data.length;++t){const r=this.data[t];for(let n=0;n<r.length;++n)yield(0,s.simpleCellAddress)(e.sheet,e.col+n,e.row+t)}}*entriesFromTopLeftCorner(e){this.ensureThatComputed();for(let t=0;t<this.size.height;++t)for(let r=0;r<this.size.width;++r)yield[this._data[t][r],(0,s.simpleCellAddress)(e.sheet,e.col+r,e.row+t)]}*iterateValuesFromTopLeftCorner(){yield*this.valuesFromTopLeftCorner()}numberOfElements(){return this.size.width*this.size.height}hasOnlyNumbers(){if(void 0===this._hasOnlyNumbers){this._hasOnlyNumbers=!0;for(const e of this.data)for(const t of e)if("number"!=typeof t)return this._hasOnlyNumbers=!1,!1}return this._hasOnlyNumbers}rawNumbers(){return this._data}rawData(){var e;return this.ensureThatComputed(),null!==(e=this._data)&&void 0!==e?e:[]}sameDimensionsAs(e){return this.width()===e.width()&&this.height()===e.height()}ensureThatComputed(){void 0===this._data&&(this._hasOnlyNumbers=!0,this._data=this.range.addressesArrayMap(this.dependencyGraph,(e=>{const t=this.dependencyGraph.getCellValue(e);return t instanceof i?(this._hasOnlyNumbers=!1,new s.CellError(s.ErrorType.VALUE,o.ErrorMessage.ScalarExpected)):((0,a.isExtendedNumber)(t)||(this._hasOnlyNumbers=!1),t)})))}}t.SimpleRangeValue=i},function(e,t,r){"use strict";t.__esModule=!0,t.TimeNumber=t.RichNumber=t.PercentNumber=t.NumberType=t.EmptyValue=t.DateTimeNumber=t.DateNumber=t.CurrencyNumber=void 0,t.cloneNumber=function(e,t){if("number"==typeof e)return t;{const r=e.fromNumber(t);return r.format=e.format,r}},t.getFormatOfExtendedNumber=function(e){return e instanceof n?e.format:void 0},t.getRawValue=function(e){return e instanceof n?e.val:e},t.getTypeFormatOfExtendedNumber=function(e){return e instanceof n?{type:e.getDetailedType(),format:e.format}:{type:s.NUMBER_RAW}},t.getTypeOfExtendedNumber=function(e){return e instanceof n?e.getDetailedType():s.NUMBER_RAW},t.isExtendedNumber=function(e){return"number"==typeof e||e instanceof n};t.EmptyValue=Symbol("Empty value");class n{constructor(e,t){this.val=e,this.format=t}fromNumber(e){return new this.constructor(e)}}t.RichNumber=n;t.DateNumber=class extends n{getDetailedType(){return s.NUMBER_DATE}};t.CurrencyNumber=class extends n{getDetailedType(){return s.NUMBER_CURRENCY}};t.TimeNumber=class extends n{getDetailedType(){return s.NUMBER_TIME}};t.DateTimeNumber=class extends n{getDetailedType(){return s.NUMBER_DATETIME}};var s;t.PercentNumber=class extends n{getDetailedType(){return s.NUMBER_PERCENT}},function(e){e.NUMBER_RAW="NUMBER_RAW",e.NUMBER_DATE="NUMBER_DATE",e.NUMBER_TIME="NUMBER_TIME",e.NUMBER_DATETIME="NUMBER_DATETIME",e.NUMBER_CURRENCY="NUMBER_CURRENCY",e.NUMBER_PERCENT="NUMBER_PERCENT"}(s||(t.NumberType=s={}))},function(e,t,r){"use strict";t.__esModule=!0,t.RowsSpan=t.ColumnsSpan=void 0;class n{constructor(e,t,r){if(this.sheet=e,this.rowStart=t,this.rowEnd=r,t<0)throw Error("Starting row cant be less than 0");if(r<t)throw Error("Row span cant end before start")}get numberOfRows(){return this.rowEnd-this.rowStart+1}get start(){return this.rowStart}get end(){return this.rowEnd}static fromNumberOfRows(e,t,r){return new n(e,t,t+r-1)}static fromRowStartAndEnd(e,t,r){return new n(e,t,r)}*rows(){for(let e=this.rowStart;e<=this.rowEnd;++e)yield e}intersect(e){if(this.sheet!==e.sheet)throw Error("Can't intersect spans from different sheets");const t=Math.max(this.rowStart,e.rowStart),r=Math.min(this.rowEnd,e.rowEnd);return t>r?null:new n(this.sheet,t,r)}firstRow(){return new n(this.sheet,this.rowStart,this.rowStart)}}t.RowsSpan=n;class s{constructor(e,t,r){if(this.sheet=e,this.columnStart=t,this.columnEnd=r,t<0)throw Error("Starting column cant be less than 0");if(r<t)throw Error("Column span cant end before start")}get numberOfColumns(){return this.columnEnd-this.columnStart+1}get start(){return this.columnStart}get end(){return this.columnEnd}static fromNumberOfColumns(e,t,r){return new s(e,t,t+r-1)}static fromColumnStartAndEnd(e,t,r){return new s(e,t,r)}*columns(){for(let e=this.columnStart;e<=this.columnEnd;++e)yield e}intersect(e){if(this.sheet!==e.sheet)throw Error("Can't intersect spans from different sheets");const t=Math.max(this.columnStart,e.columnStart),r=Math.min(this.columnEnd,e.columnEnd);return t>r?null:new s(this.sheet,t,r)}firstColumn(){return new s(this.sheet,this.columnStart,this.columnStart)}}t.ColumnsSpan=s},function(e,t,r){"use strict";t.__esModule=!0,t.Statistics=t.StatType=t.EmptyStatistics=void 0;var n=r(163);t.EmptyStatistics=n.EmptyStatistics;var s=r(164);t.Statistics=s.Statistics;var o=r(165);t.StatType=o.StatType},function(e,t,r){"use strict";t.__esModule=!0,t.EmptyStatistics=void 0;var n=r(164);class s extends n.Statistics{incrementCriterionFunctionFullCacheUsed(){}incrementCriterionFunctionPartialCacheUsed(){}start(e){}end(e){}}t.EmptyStatistics=s},function(e,t,r){"use strict";t.__esModule=!0,t.Statistics=void 0;var n=r(165);t.Statistics=class{constructor(){this.stats=new Map([[n.StatType.CRITERION_FUNCTION_FULL_CACHE_USED,0],[n.StatType.CRITERION_FUNCTION_PARTIAL_CACHE_USED,0]]),this.startTimes=new Map}incrementCriterionFunctionFullCacheUsed(){var e;const t=(null!==(e=this.stats.get(n.StatType.CRITERION_FUNCTION_FULL_CACHE_USED))&&void 0!==e?e:0)+1;this.stats.set(n.StatType.CRITERION_FUNCTION_FULL_CACHE_USED,t)}incrementCriterionFunctionPartialCacheUsed(){var e;const t=(null!==(e=this.stats.get(n.StatType.CRITERION_FUNCTION_PARTIAL_CACHE_USED))&&void 0!==e?e:0)+1;this.stats.set(n.StatType.CRITERION_FUNCTION_PARTIAL_CACHE_USED,t)}reset(){this.stats.clear(),this.startTimes.clear(),this.stats.set(n.StatType.CRITERION_FUNCTION_FULL_CACHE_USED,0),this.stats.set(n.StatType.CRITERION_FUNCTION_PARTIAL_CACHE_USED,0)}start(e){if(this.startTimes.get(e))throw Error(`Statistics ${e} already started`);this.startTimes.set(e,Date.now())}end(e){var t;const r=Date.now(),n=this.startTimes.get(e);if(!n)throw Error(`Statistics ${e} not started`);{let s=null!==(t=this.stats.get(e))&&void 0!==t?t:0;s+=r-n,this.stats.set(e,s),this.startTimes.delete(e)}}measure(e,t){this.start(e);const r=t();return this.end(e),r}snapshot(){return new Map(this.stats)}}},function(e,t,r){"use strict";var n;t.__esModule=!0,t.StatType=void 0,function(e){e.BUILD_ENGINE_TOTAL="BUILD_ENGINE_TOTAL",e.PARSER="PARSER",e.GRAPH_BUILD="GRAPH_BUILD",e.COLLECT_DEPENDENCIES="COLLECT_DEPENDENCIES",e.PROCESS_DEPENDENCIES="PROCESS_DEPENDENCIES",e.TOP_SORT="TOP_SORT",e.BUILD_COLUMN_INDEX="BUILD_COLUMN_INDEX",e.EVALUATION="EVALUATION",e.VLOOKUP="VLOOKUP",e.TRANSFORM_ASTS="TRANSFORM_ASTS",e.TRANSFORM_ASTS_POSTPONED="TRANSFORM_ASTS_POSTPONED",e.ADJUSTING_ADDRESS_MAPPING="ADJUSTING_ADDRESS_MAPPING",e.ADJUSTING_ARRAY_MAPPING="ADJUSTING_ARRAY_MAPPING",e.ADJUSTING_RANGES="ADJUSTING_RANGES",e.ADJUSTING_GRAPH="ADJUSTING_GRAPH",e.CRITERION_FUNCTION_FULL_CACHE_USED="CRITERION_FUNCTION_FULL_CACHE_USED",e.CRITERION_FUNCTION_PARTIAL_CACHE_USED="CRITERION_FUNCTION_PARTIAL_CACHE_USED"}(n||(t.StatType=n={}))},function(e,t,r){"use strict";t.__esModule=!0,t.AddressMapping=void 0;var n=r(167),s=r(160),o=r(107);t.AddressMapping=class{constructor(e){this.policy=e,this.mapping=new Map}getCell(e){const t=this.mapping.get(e.sheet);if(void 0===t)throw new n.NoSheetWithIdError(e.sheet);return t.getCell(e)}fetchCell(e){const t=this.mapping.get(e.sheet);if(void 0===t)throw new n.NoSheetWithIdError(e.sheet);const r=t.getCell(e);if(!r)throw Error("Vertex for address missing in AddressMapping");return r}strategyFor(e){const t=this.mapping.get(e);if(void 0===t)throw new n.NoSheetWithIdError(e);return t}addSheet(e,t){if(this.mapping.has(e))throw Error("Sheet already added");this.mapping.set(e,t)}autoAddSheet(e,t){const{height:r,width:n,fill:s}=t,o=this.policy.call(s);this.addSheet(e,new o(n,r))}getCellValue(e){const t=this.getCell(e);return void 0===t?s.EmptyValue:t instanceof o.ArrayVertex?t.getArrayCellValue(e):t.getCellValue()}getRawValue(e){const t=this.getCell(e);return t instanceof o.ValueCellVertex?t.getValues().rawValue:t instanceof o.ArrayVertex?t.getArrayCellRawValue(e):null}setCell(e,t){const r=this.mapping.get(e.sheet);if(!r)throw Error("Sheet not initialized");r.setCell(e,t)}moveCell(e,t){const r=this.mapping.get(e.sheet);if(!r)throw Error("Sheet not initialized.");if(e.sheet!==t.sheet)throw Error("Cannot move cells between sheets.");if(r.has(t))throw new Error("Cannot move cell. Destination already occupied.");const n=r.getCell(e);if(void 0===n)throw new Error("Cannot move cell. No cell with such address.");this.setCell(t,n),this.removeCell(e)}removeCell(e){const t=this.mapping.get(e.sheet);if(!t)throw Error("Sheet not initialized");t.removeCell(e)}has(e){const t=this.mapping.get(e.sheet);return void 0!==t&&t.has(e)}getHeight(e){const t=this.mapping.get(e);if(void 0===t)throw new n.NoSheetWithIdError(e);return t.getHeight()}getWidth(e){const t=this.mapping.get(e);if(!t)throw new n.NoSheetWithIdError(e);return t.getWidth()}addRows(e,t,r){const s=this.mapping.get(e);if(void 0===s)throw new n.NoSheetWithIdError(e);s.addRows(t,r)}removeRows(e){const t=this.mapping.get(e.sheet);if(void 0===t)throw new n.NoSheetWithIdError(e.sheet);t.removeRows(e)}removeSheet(e){this.mapping.delete(e)}addColumns(e,t,r){const s=this.mapping.get(e);if(void 0===s)throw new n.NoSheetWithIdError(e);s.addColumns(t,r)}removeColumns(e){const t=this.mapping.get(e.sheet);if(void 0===t)throw new n.NoSheetWithIdError(e.sheet);t.removeColumns(e)}*verticesFromRowsSpan(e){yield*this.mapping.get(e.sheet).verticesFromRowsSpan(e)}*verticesFromColumnsSpan(e){yield*this.mapping.get(e.sheet).verticesFromColumnsSpan(e)}*entriesFromRowsSpan(e){yield*this.mapping.get(e.sheet).entriesFromRowsSpan(e)}*entriesFromColumnsSpan(e){yield*this.mapping.get(e.sheet).entriesFromColumnsSpan(e)}*entries(){for(const[e,t]of this.mapping.entries())yield*t.getEntries(e)}*sheetEntries(e){const t=this.mapping.get(e);if(void 0===t)throw new n.NoSheetWithIdError(e);yield*t.getEntries(e)}}},function(e,t,r){"use strict";t.__esModule=!0,t.UnableToParseError=t.TargetLocationHasArrayError=t.SourceLocationHasArrayError=t.SheetsNotEqual=t.SheetSizeLimitExceededError=t.SheetNameAlreadyTakenError=t.ProtectedFunctionTranslationError=t.ProtectedFunctionError=t.NothingToPasteError=t.NotAFormulaError=t.NoSheetWithNameError=t.NoSheetWithIdError=t.NoRelativeAddressesAllowedError=t.NoOperationToUndoError=t.NoOperationToRedoError=t.NamedExpressionNameIsInvalidError=t.NamedExpressionNameIsAlreadyTakenError=t.NamedExpressionDoesNotExistError=t.MissingTranslationError=t.LanguageNotRegisteredError=t.LanguageAlreadyRegisteredError=t.InvalidArgumentsError=t.InvalidAddressError=t.FunctionPluginValidationError=t.ExpectedValueOfTypeError=t.ExpectedOneOfValuesError=t.EvaluationSuspendedError=t.ConfigValueTooSmallError=t.ConfigValueTooBigError=t.ConfigValueEmpty=t.AliasAlreadyExisting=void 0;class n extends Error{constructor(e){super(`There's no sheet with id = ${e}`)}}t.NoSheetWithIdError=n;class s extends Error{constructor(e){super(`There's no sheet with name '${e}'`)}}t.NoSheetWithNameError=s;class o extends Error{constructor(e){super(`Sheet with name ${e} already exists`)}}t.SheetNameAlreadyTakenError=o;class a extends Error{constructor(){super("Sheet size limit exceeded")}}t.SheetSizeLimitExceededError=a;class i extends Error{constructor(){super("This is not a formula")}}t.NotAFormulaError=i;class u extends Error{constructor(e){super(`Address (row = ${e.row}, col = ${e.col}) is invalid`)}}t.InvalidAddressError=u;class l extends Error{constructor(e){super(`Invalid arguments, expected ${e}`)}}t.InvalidArgumentsError=l;class c extends Error{constructor(e,t){super(`Sheets ${e} and ${t} are not equal.`)}}t.SheetsNotEqual=c;class h extends Error{constructor(e){super(`Name of Named Expression '${e}' is already present`)}}t.NamedExpressionNameIsAlreadyTakenError=h;class d extends Error{constructor(e){super(`Name of Named Expression '${e}' is invalid`)}}t.NamedExpressionNameIsInvalidError=d;class p extends Error{constructor(e){super(`Named Expression '${e}' does not exist`)}}t.NamedExpressionDoesNotExistError=p;class m extends Error{constructor(){super("There is no operation to undo")}}t.NoOperationToUndoError=m;class g extends Error{constructor(){super("There is no operation to redo")}}t.NoOperationToRedoError=g;class E extends Error{constructor(){super("There is nothing to paste")}}function T(e,t){switch(typeof t){case"function":case"symbol":return t.toString();case"bigint":return"BigInt("+t.toString()+")";default:return t instanceof RegExp?"RegExp("+t.toString()+")":t}}t.NothingToPasteError=E;class y extends Error{constructor(e){super(`Unable to parse value: ${JSON.stringify(e,T,4)}`)}}t.UnableToParseError=y;class f extends Error{constructor(e,t){super(`Expected value of type: ${e} for config parameter: ${t}`)}}t.ExpectedValueOfTypeError=f;class A extends Error{constructor(e){super(`Config parameter ${e} cannot be empty.`)}}t.ConfigValueEmpty=A;class R extends Error{constructor(e,t){super(`Config parameter ${e} should be at least ${t}`)}}t.ConfigValueTooSmallError=R;class N extends Error{constructor(e,t){super(`Config parameter ${e} should be at most ${t}`)}}t.ConfigValueTooBigError=N;class S extends Error{constructor(e,t){super(`Expected one of ${e} for config parameter: ${t}`)}}t.ExpectedOneOfValuesError=S;class C extends Error{constructor(){super("Computations are suspended")}}t.EvaluationSuspendedError=C;class v extends Error{constructor(e){super(`Translation for ${e} is missing in the translation package you're using.`)}}t.MissingTranslationError=v;class M extends Error{constructor(e){super(`Cannot register translation for function with id: ${e}`)}}t.ProtectedFunctionTranslationError=M;class w extends Error{constructor(){super("Language not registered.")}}t.LanguageNotRegisteredError=w;class F extends Error{constructor(){super("Language already registered.")}}t.LanguageAlreadyRegisteredError=F;class O extends Error{static functionNotDeclaredInPlugin(e,t){return new O(`Function with id ${e} not declared in plugin ${t}`)}static functionMethodNotFound(e,t){return new O(`Function method ${e} not found in plugin ${t}`)}}t.FunctionPluginValidationError=O;class I extends Error{static cannotRegisterFunctionWithId(e){return new I(`Cannot register function with id ${e}`)}static cannotUnregisterFunctionWithId(e){return new I(`Cannot unregister function with id ${e}`)}static cannotUnregisterProtectedPlugin(){return new I("Cannot unregister protected plugin")}}t.ProtectedFunctionError=I;class b extends Error{constructor(){super("Cannot perform this operation, source location has an array inside.")}}t.SourceLocationHasArrayError=b;class x extends Error{constructor(){super("Cannot perform this operation, target location has an array inside.")}}t.TargetLocationHasArrayError=x;class V extends Error{constructor(){super("Relative addresses not allowed in named expressions.")}}t.NoRelativeAddressesAllowedError=V;class U extends Error{constructor(e,t){super(`Alias id ${e} in plugin ${t} already defined as a function or alias.`)}}t.AliasAlreadyExisting=U},function(e,t,r){"use strict";t.__esModule=!0,t.ArrayMapping=void 0,r(3),r(73),r(134);var n=r(106);t.ArrayMapping=class{constructor(){this.arrayMapping=new Map}getArray(e){const t=this.getArrayByCorner(e.start);if(null==t?void 0:t.getRange().sameAs(e))return t}getArrayByCorner(e){return this.arrayMapping.get((0,n.addressKey)(e))}setArray(e,t){this.arrayMapping.set((0,n.addressKey)(e.start),t)}removeArray(e){"string"==typeof e?this.arrayMapping.delete(e):this.arrayMapping.delete((0,n.addressKey)(e.start))}count(){return this.arrayMapping.size}*arraysInRows(e){for(const[t,r]of this.arrayMapping.entries())r.spansThroughSheetRows(e.sheet,e.rowStart,e.rowEnd)&&(yield[t,r])}*arraysInCols(e){for(const[t,r]of this.arrayMapping.entries())r.spansThroughSheetColumn(e.sheet,e.columnStart,e.columnEnd)&&(yield[t,r])}isFormulaArrayInRow(e,t){for(const r of this.arrayMapping.values())if(r.spansThroughSheetRows(e,t))return!0;return!1}isFormulaArrayInAllRows(e){let t=!0;for(const r of e.rows())this.isFormulaArrayInRow(e.sheet,r)||(t=!1);return t}isFormulaArrayInColumn(e,t){for(const r of this.arrayMapping.values())if(r.spansThroughSheetColumn(e,t))return!0;return!1}isFormulaArrayInAllColumns(e){let t=!0;for(const r of e.columns())this.isFormulaArrayInColumn(e.sheet,r)||(t=!1);return t}isFormulaArrayInRange(e){for(const t of this.arrayMapping.values())if(t.getRange().doesOverlap(e))return!0;return!1}isFormulaArrayAtAddress(e){for(const t of this.arrayMapping.values())if(t.getRange().addressInRange(e))return!0;return!1}moveArrayVerticesAfterRowByRows(e,t,r){this.updateArrayVerticesInSheet(e,((e,n)=>{const s=n.getRange();return t<=s.start.row?[s.shifted(0,r),n]:void 0}))}moveArrayVerticesAfterColumnByColumns(e,t,r){this.updateArrayVerticesInSheet(e,((e,n)=>{const s=n.getRange();return t<=s.start.col?[s.shifted(r,0),n]:void 0}))}updateArrayVerticesInSheet(e,t){const r=Array();for(const[n,s]of this.arrayMapping.entries()){if(s.sheet!==e)continue;const o=t(n,s);void 0!==o&&(this.removeArray(n),r.push(o))}r.forEach((([e,t])=>{this.setArray(e,t)}))}}},function(e,t,r){"use strict";t.__esModule=!0,t.collectAddressesDependentToRange=void 0,r(73),r(132),r(85);var n=r(137),s=r(170),o=r(172);t.collectAddressesDependentToRange=(e,t,r,a,i)=>{if(t instanceof o.RangeVertex){const e=t.range.intersectionWith(r);return void 0!==e?Array.from(e.addresses(i)):[]}let u,l;return t instanceof s.FormulaVertex?(u=t.getFormula(a),l=t.getAddress(a),(0,n.collectDependencies)(u,e).filter((e=>e instanceof n.AddressDependency)).map((e=>e.dependency.toSimpleCellAddress(l))).filter((e=>r.addressInRange(e)))):[]}},function(e,t,r){"use strict";t.__esModule=!0,t.FormulaVertex=t.FormulaCellVertex=t.ArrayVertex=void 0;var n=r(105),s=r(2),o=r(171),a=r(106),i=r(151),u=r(160),l=r(161);class c{constructor(e,t,r){this.formula=e,this.cellAddress=t,this.version=r}get width(){return 1}get height(){return 1}static fromAst(e,t,r,n){return r.isScalar()?new d(e,t,n):new h(e,t,r,n)}getFormula(e){return this.ensureRecentData(e),this.formula}ensureRecentData(e){if(this.version!=e.version()){const[t,r,n]=e.applyTransformations(this.formula,this.cellAddress,this.version);this.formula=t,this.cellAddress=r,this.version=n}}getAddress(e){return this.ensureRecentData(e),this.cellAddress}}t.FormulaVertex=c;class h extends c{constructor(e,t,r,n=0){super(e,t,n),r.isRef?this.array=new o.ErroredArray(new a.CellError(a.ErrorType.REF,i.ErrorMessage.NoSpaceForArrayResult),s.ArraySize.error()):this.array=new o.NotComputedArray(r)}get width(){return this.array.width()}get height(){return this.array.height()}get sheet(){return this.cellAddress.sheet}get leftCorner(){return this.cellAddress}setCellValue(e){if(e instanceof a.CellError)return this.setErrorValue(e),e;const t=o.ArrayValue.fromInterpreterValue(e);return t.resize(this.array.size),this.array=t,e}getCellValue(){if(this.array instanceof o.NotComputedArray)throw Error("Array not computed yet.");return this.array.simpleRangeValue()}valueOrUndef(){if(!(this.array instanceof o.NotComputedArray))return this.array.simpleRangeValue()}getArrayCellValue(e){const t=e.col-this.cellAddress.col,r=e.row-this.cellAddress.row;try{return this.array.get(t,r)}catch(e){return new a.CellError(a.ErrorType.REF)}}getArrayCellRawValue(e){const t=this.getArrayCellValue(e);return t instanceof a.CellError||t===u.EmptyValue?void 0:(0,u.getRawValue)(t)}setArrayCellValue(e,t){const r=e.col-this.cellAddress.col,n=e.row-this.cellAddress.row;this.array instanceof o.ArrayValue&&this.array.set(r,n,t)}setNoSpace(){return this.array=new o.ErroredArray(new a.CellError(a.ErrorType.SPILL,i.ErrorMessage.NoSpaceForArrayResult),s.ArraySize.error()),this.getCellValue()}getRange(){return n.AbsoluteCellRange.spanFrom(this.cellAddress,this.width,this.height)}getRangeOrUndef(){return n.AbsoluteCellRange.spanFromOrUndef(this.cellAddress,this.width,this.height)}setAddress(e){this.cellAddress=e}setFormula(e){this.formula=e}spansThroughSheetRows(e,t,r=t){return this.cellAddress.sheet===e&&this.cellAddress.row<=r&&t<this.cellAddress.row+this.height}spansThroughSheetColumn(e,t,r=t){return this.cellAddress.sheet===e&&this.cellAddress.col<=r&&t<this.cellAddress.col+this.width}isComputed(){return!(this.array instanceof o.NotComputedArray)}columnsFromArray(){return l.ColumnsSpan.fromNumberOfColumns(this.cellAddress.sheet,this.cellAddress.col,this.width)}rowsFromArray(){return l.RowsSpan.fromNumberOfRows(this.cellAddress.sheet,this.cellAddress.row,this.height)}ensureRecentData(e){}isLeftCorner(e){return(0,a.equalSimpleCellAddress)(this.cellAddress,e)}setErrorValue(e){this.array=new o.ErroredArray(e,this.array.size)}}t.ArrayVertex=h;class d extends c{constructor(e,t,r){super(e,t,r)}valueOrUndef(){return this.cachedCellValue}setCellValue(e){return this.cachedCellValue=e,this.cachedCellValue}getCellValue(){if(void 0!==this.cachedCellValue)return this.cachedCellValue;throw Error("Value of the formula cell is not computed.")}isComputed(){return void 0!==this.cachedCellValue}}t.FormulaCellVertex=d},function(e,t,r){"use strict";t.__esModule=!0,t.NotComputedArray=t.ErroredArray=t.ArrayValue=void 0,r(3);var n=r(2),s=r(160),o=r(159);t.NotComputedArray=class{constructor(e){this.size=e}width(){return this.size.width}height(){return this.size.height}get(e,t){throw Error("Array not computed yet.")}simpleRangeValue(){throw Error("Array not computed yet.")}};class a{constructor(e){if(this.size=new n.ArraySize(e.length>0?e[0].length:0,e.length),this.array=e,this.size.width<=0||this.size.height<=0)throw Error("Incorrect array size")}static fromInterpreterValue(e){return e instanceof o.SimpleRangeValue?new a(e.data):new a([[e]])}simpleRangeValue(){return o.SimpleRangeValue.onlyValues(this.array)}addRows(e,t){this.array.splice(e,0,...this.nullArrays(t,this.width())),this.size.height+=t}addColumns(e,t){for(let r=0;r<this.height();r++)this.array[r].splice(e,0,...new Array(t).fill(s.EmptyValue));this.size.width+=t}removeRows(e,t){if(this.outOfBound(0,e)||this.outOfBound(0,t))throw Error("Array index out of bound");const r=t-e+1;this.array.splice(e,r),this.size.height-=r}removeColumns(e,t){if(this.outOfBound(e,0)||this.outOfBound(t,0))throw Error("Array index out of bound");const r=t-e+1;for(const t of this.array)t.splice(e,r);this.size.width-=r}nullArrays(e,t){const r=[];for(let n=0;n<e;++n)r.push(new Array(t).fill(s.EmptyValue));return r}get(e,t){if(this.outOfBound(e,t))throw Error("Array index out of bound");return this.array[t][e]}set(e,t,r){if(this.outOfBound(e,t))throw Error("Array index out of bound");this.array[t][e]=r}width(){return this.size.width}height(){return this.size.height}raw(){return this.array}resize(e){if(this.height()<e.height&&isFinite(e.height)&&this.addRows(this.height(),e.height-this.height()),this.height()>e.height)throw Error("Resizing to smaller array");if(this.width()<e.width&&isFinite(e.width)&&this.addColumns(this.width(),e.width-this.width()),this.width()>e.width)throw Error("Resizing to smaller array")}outOfBound(e,t){return e<0||t<0||t>this.size.height-1||e>this.size.width-1}}t.ArrayValue=a;t.ErroredArray=class{constructor(e,t){this.error=e,this.size=t}get(e,t){return this.error}width(){return this.size.width}height(){return this.size.height}simpleRangeValue(){return this.error}}},function(e,t,r){"use strict";t.__esModule=!0,t.RangeVertex=void 0,r(109),r(120),r(122),r(124),r(126),r(128),r(130),r(73),r(134);t.RangeVertex=class{constructor(e){this.range=e,this.functionCache=new Map,this.criterionFunctionCache=new Map,this.dependentCacheRanges=new Set,this.bruteForce=!1}get start(){return this.range.start}get end(){return this.range.end}get sheet(){return this.range.start.sheet}getFunctionValue(e){return this.functionCache.get(e)}setFunctionValue(e,t){this.functionCache.set(e,t)}getCriterionFunctionValue(e,t){var r;return null===(r=this.getCriterionFunctionValues(e).get(t))||void 0===r?void 0:r[0]}getCriterionFunctionValues(e){var t;return null!==(t=this.criterionFunctionCache.get(e))&&void 0!==t?t:new Map}setCriterionFunctionValues(e,t){this.criterionFunctionCache.set(e,t)}addDependentCacheRange(e){e!==this&&this.dependentCacheRanges.add(e)}clearCache(){this.functionCache.clear(),this.criterionFunctionCache.clear(),this.dependentCacheRanges.forEach((e=>e.criterionFunctionCache.clear())),this.dependentCacheRanges.clear()}getStart(){return this.start}getEnd(){return this.end}}},function(e,t,r){"use strict";t.__esModule=!0,t.Graph=void 0,r(3),r(109),r(120),r(122),r(124),r(126),r(128),r(130),r(73),r(132),r(134),r(85);var n=r(174),s=r(175);t.Graph=class{constructor(e){this.dependencyQuery=e,this.nodesSparseArray=[],this.edgesSparseArray=[],this.nodesIds=new Map,this.dirtyAndVolatileNodeIds=new s.ProcessableValue({dirty:[],volatile:[]},(e=>this.processDirtyAndVolatileNodeIds(e))),this.infiniteRangeIds=new Set,this.changingWithStructureNodeIds=[],this.nextId=0}getNodes(){return this.nodesSparseArray.filter((e=>void 0!==e))}hasNode(e){return this.nodesIds.has(e)}existsEdge(e,t){const r=this.getNodeId(e),n=this.getNodeId(t);return void 0!==r&&void 0!==n&&this.edgesSparseArray[r].includes(n)}adjacentNodes(e){const t=this.getNodeId(e);if(void 0===t)throw this.missingNodeError(e);return new Set(this.edgesSparseArray[t].filter((e=>void 0!==e)).map((e=>this.nodesSparseArray[e])))}adjacentNodesCount(e){const t=this.getNodeId(e);if(void 0===t)throw this.missingNodeError(e);return this.fixEdgesArrayForNode(t).length}addNodeAndReturnId(e){const t=this.nodesIds.get(e);if(void 0!==t)return t;const r=this.nextId;return this.nextId++,this.nodesSparseArray[r]=e,this.edgesSparseArray[r]=[],this.nodesIds.set(e,r),r}addEdge(e,t){const r=this.getNodeIdIfNotNumber(e),n=this.getNodeIdIfNotNumber(t);if(void 0===r)throw this.missingNodeError(e);if(void 0===n)throw this.missingNodeError(t);this.edgesSparseArray[r].includes(n)||this.edgesSparseArray[r].push(n)}removeNode(e){const t=this.getNodeId(e);if(void 0===t)throw this.missingNodeError(e);this.edgesSparseArray[t].length>0&&(this.edgesSparseArray[t].forEach((e=>this.dirtyAndVolatileNodeIds.rawValue.dirty.push(e))),this.dirtyAndVolatileNodeIds.markAsModified());const r=this.removeDependencies(e);return delete this.nodesSparseArray[t],delete this.edgesSparseArray[t],this.infiniteRangeIds.delete(t),this.nodesIds.delete(e),r}removeEdge(e,t){const r=this.getNodeIdIfNotNumber(e),n=this.getNodeIdIfNotNumber(t);if(void 0===r)throw this.missingNodeError(e);if(void 0===n)throw this.missingNodeError(t);const s=this.edgesSparseArray[r].indexOf(n);if(-1===s)throw new Error("Edge does not exist");delete this.edgesSparseArray[r][s]}removeEdgeIfExists(e,t){const r=this.getNodeId(e),n=this.getNodeId(t);if(void 0===r)return;if(void 0===n)return;const s=this.edgesSparseArray[r].indexOf(n);-1!==s&&delete this.edgesSparseArray[r][s]}topSortWithScc(){return this.getTopSortedWithSccSubgraphFrom(this.getNodes(),(()=>!0),(()=>{}))}getTopSortedWithSccSubgraphFrom(e,t,r){const s=new n.TopSort(this.nodesSparseArray,this.edgesSparseArray),o=e.map((e=>this.getNodeId(e))).filter((e=>void 0!==e));return s.getTopSortedWithSccSubgraphFrom(o,t,r)}markNodeAsVolatile(e){const t=this.getNodeId(e);void 0!==t&&(this.dirtyAndVolatileNodeIds.rawValue.volatile.push(t),this.dirtyAndVolatileNodeIds.markAsModified())}markNodeAsDirty(e){const t=this.getNodeId(e);void 0!==t&&(this.dirtyAndVolatileNodeIds.rawValue.dirty.push(t),this.dirtyAndVolatileNodeIds.markAsModified())}getDirtyAndVolatileNodes(){return this.dirtyAndVolatileNodeIds.getProcessedValue()}clearDirtyNodes(){this.dirtyAndVolatileNodeIds.rawValue.dirty=[],this.dirtyAndVolatileNodeIds.markAsModified()}markNodeAsChangingWithStructure(e){const t=this.getNodeId(e);void 0!==t&&this.changingWithStructureNodeIds.push(t)}markChangingWithStructureNodesAsDirty(){this.changingWithStructureNodeIds.length<=0||(this.dirtyAndVolatileNodeIds.rawValue.dirty=[...this.dirtyAndVolatileNodeIds.rawValue.dirty,...this.changingWithStructureNodeIds],this.dirtyAndVolatileNodeIds.markAsModified())}markNodeAsInfiniteRange(e){const t=this.getNodeIdIfNotNumber(e);void 0!==t&&this.infiniteRangeIds.add(t)}getInfiniteRanges(){return[...this.infiniteRangeIds].map((e=>({node:this.nodesSparseArray[e],id:e})))}getNodeId(e){return this.nodesIds.get(e)}getNodeIdIfNotNumber(e){return"number"==typeof e?e:this.nodesIds.get(e)}fixEdgesArrayForNode(e){const t=this.edgesSparseArray[e];return this.edgesSparseArray[e]=t.filter((e=>void 0!==e&&this.nodesSparseArray[e])),this.edgesSparseArray[e]}removeDependencies(e){const t=this.dependencyQuery(e);return t.forEach((([t,r])=>{this.removeEdgeIfExists(r,e)})),t}processDirtyAndVolatileNodeIds({dirty:e,volatile:t}){return[...new Set([...e,...t])].map((e=>this.nodesSparseArray[e])).filter((e=>void 0!==e))}missingNodeError(e){return new Error(`Unknown node ${e}`)}}},function(e,t,r){"use strict";var n;t.__esModule=!0,t.TopSort=void 0,r(3),r(73),r(132),r(134),function(e){e[e.ON_STACK=0]="ON_STACK",e[e.PROCESSED=1]="PROCESSED",e[e.POPPED=2]="POPPED"}(n||(n={}));t.TopSort=class{constructor(e=[],t=[]){this.nodesSparseArray=e,this.edgesSparseArray=t,this.entranceTime=[],this.low=[],this.parent=[],this.inSCC=[],this.nodeStatus=[],this.order=[],this.sccNonSingletons=[],this.timeCounter=0}getTopSortedWithSccSubgraphFrom(e,t,r){const n=e.reverse();return n.forEach((e=>this.runDFS(e))),this.postprocess(n,r,t)}getAdjacentNodeIds(e){return this.edgesSparseArray[e].filter((e=>void 0!==e&&this.nodesSparseArray[e]))}runDFS(e){if(void 0!==this.nodeStatus[e])return;this.nodeStatus[e]=n.ON_STACK;const t=[e],r=[];for(;t.length>0;){const e=t[t.length-1];switch(this.nodeStatus[e]){case n.ON_STACK:this.handleOnStack(e,r,t);break;case n.PROCESSED:this.handleProcessed(e,r,t);break;case n.POPPED:t.pop()}}}handleOnStack(e,t,r){this.entranceTime[e]=this.timeCounter,this.low[e]=this.timeCounter,this.timeCounter++,t.push(e),this.getAdjacentNodeIds(e).forEach((t=>{void 0===this.entranceTime[t]&&(r.push(t),this.parent[t]=e,this.nodeStatus[t]=n.ON_STACK)})),this.nodeStatus[e]=n.PROCESSED}handleProcessed(e,t,r){let s=this.entranceTime[e];if(this.getAdjacentNodeIds(e).forEach((t=>{this.inSCC[t]||(s=this.parent[t]===e?Math.min(s,this.low[t]):Math.min(s,this.entranceTime[t]))})),this.low[e]=s,s===this.entranceTime[e]){const r=[];do{r.push(t[t.length-1]),t.pop()}while(r[r.length-1]!==e);r.forEach((e=>{this.inSCC[e]=!0})),this.order.push(...r),r.length>1&&r.forEach((e=>{this.sccNonSingletons[e]=!0}))}r.pop(),this.nodeStatus[e]=n.POPPED}postprocess(e,t,r){const n=[];e.forEach((e=>{n[e]=!0}));const s=[],o=[];return this.order.reverse(),this.order.forEach((e=>{const a=this.getAdjacentNodeIds(e);this.sccNonSingletons[e]||a.includes(e)?(o.push(this.nodesSparseArray[e]),t(this.nodesSparseArray[e]),a.forEach((e=>n[e]=!0))):(s.push(this.nodesSparseArray[e]),n[e]&&r(this.nodesSparseArray[e])&&a.forEach((e=>n[e]=!0)))})),{sorted:s,cycled:o}}}},function(e,t,r){"use strict";t.__esModule=!0,t.ProcessableValue=void 0;t.ProcessableValue=class{constructor(e,t){this.rawValue=e,this.processFn=t,this.processedValue=null}getProcessedValue(){return null===this.processedValue&&(this.processedValue=this.processFn(this.rawValue)),this.processedValue}markAsModified(){this.processedValue=null}}},function(e,t,r){"use strict";t.__esModule=!0,t.RangeMapping=void 0,r(3),r(73),r(132),r(134),r(85);var n=r(105),s=r(106);function o(e,t){return`${e.col},${e.row},${t.col},${t.row}`}t.RangeMapping=class{constructor(){this.rangeMapping=new Map}getMappingSize(e){var t,r;return null!==(r=null===(t=this.rangeMapping.get(e))||void 0===t?void 0:t.size)&&void 0!==r?r:0}setRange(e){let t=this.rangeMapping.get(e.getStart().sheet);void 0===t&&(t=new Map,this.rangeMapping.set(e.getStart().sheet,t));const r=o(e.getStart(),e.getEnd());t.set(r,e)}removeRange(e){const t=e.getStart().sheet,r=this.rangeMapping.get(t);if(void 0===r)return;const n=o(e.getStart(),e.getEnd());r.delete(n),0===r.size&&this.rangeMapping.delete(t)}getRange(e,t){const r=this.rangeMapping.get(e.sheet),n=o(e,t);return null==r?void 0:r.get(n)}fetchRange(e,t){const r=this.getRange(e,t);if(!r)throw Error("Range does not exist");return r}truncateRanges(e,t){const r=Array(),n=Array(),s=Array(),i=e.sheet;for(const[o,a]of this.entriesFromSheet(e.sheet)){const u=a.range;e.start<=t(a.range.end)&&(u.removeSpan(e),u.shouldBeRemoved()?(this.removeByKey(i,o),r.push(a)):n.push([o,a]),s.push(a))}const u=[];n.sort(((e,r)=>a(e[1],r[1],t)));for(const[e,t]of n){const r=o((l=t.range).start,l.end);if(r===e)continue;const n=this.getByKey(i,r);this.removeByKey(i,e),void 0!==n&&t!=n?u.push([n,t]):this.setRange(t)}var l;return{verticesToRemove:r,verticesToMerge:u,verticesWithChangedSize:s}}moveAllRangesInSheetAfterRowByRows(e,t,r){return this.updateVerticesFromSheet(e,((e,n)=>t<=n.start.row?(n.range.shiftByRows(r),{changedSize:!1,vertex:n}):t>n.start.row&&t<=n.end.row?(n.range.expandByRows(r),{changedSize:!0,vertex:n}):void 0))}moveAllRangesInSheetAfterColumnByColumns(e,t,r){return this.updateVerticesFromSheet(e,((e,n)=>t<=n.start.col?(n.range.shiftByColumns(r),{changedSize:!1,vertex:n}):t>n.start.col&&t<=n.end.col?(n.range.expandByColumns(r),{changedSize:!0,vertex:n}):void 0))}moveRangesInsideSourceRange(e,t,r,n){this.updateVerticesFromSheet(e.sheet,((s,o)=>e.containsRange(o.range)?(o.range.shiftByColumns(t),o.range.shiftByRows(r),o.range.moveToSheet(n),{changedSize:!1,vertex:o}):void 0))}removeRangesInSheet(e){if(this.rangeMapping.has(e)){const t=this.rangeMapping.get(e).values();return this.rangeMapping.delete(e),t}return[][Symbol.iterator]()}*rangesInSheet(e){const t=this.rangeMapping.get(e);t&&(yield*t.values())}*rangeVerticesContainedInRange(e){for(const t of this.rangesInSheet(e.sheet))e.containsRange(t.range)&&(yield t)}findSmallerRange(e){if(e.height()>1&&Number.isFinite(e.height())){const t=(0,s.simpleCellAddress)(e.end.sheet,e.end.col,e.end.row-1),r=this.getRange(e.start,t);if(void 0!==r){return{smallerRangeVertex:r,restRange:n.AbsoluteCellRange.fromSimpleCellAddresses((0,s.simpleCellAddress)(e.start.sheet,e.start.col,e.end.row),e.end)}}}return{restRange:e}}*entriesFromSheet(e){const t=this.rangeMapping.get(e);t&&(yield*t.entries())}removeByKey(e,t){this.rangeMapping.get(e).delete(t)}getByKey(e,t){var r;return null===(r=this.rangeMapping.get(e))||void 0===r?void 0:r.get(t)}updateVerticesFromSheet(e,t){const r=Array();for(const[n,s]of this.entriesFromSheet(e)){const o=t(n,s);void 0!==o&&(this.removeByKey(e,n),r.push(o))}return r.forEach((e=>{this.setRange(e.vertex)})),{verticesWithChangedSize:r.filter((e=>e.changedSize)).map((e=>e.vertex))}}};const a=(e,t,r)=>{const n=r(e.range.start),s=r(e.range.start);if(n===s){return r(e.range.end)-r(t.range.end)}return n-s}},function(e,t,r){"use strict";t.__esModule=!0,t.SheetMapping=void 0,r(85);var n=r(167),s=r(178);function o(e){return e.toLowerCase()}class a{constructor(e,t){this.id=e,this.displayName=t}get canonicalName(){return o(this.displayName)}}t.SheetMapping=class{constructor(e){this.languages=e,this.mappingFromCanonicalName=new Map,this.mappingFromId=new Map,this.lastSheetId=-1,this.fetch=e=>{const t=this.mappingFromCanonicalName.get(o(e));if(void 0===t)throw new n.NoSheetWithNameError(e);return t.id},this.get=e=>{var t;return null===(t=this.mappingFromCanonicalName.get(o(e)))||void 0===t?void 0:t.id},this.fetchDisplayName=e=>this.fetchSheetById(e).displayName,this.sheetNamePrefix=e.getUITranslation(s.UIElement.NEW_SHEET_PREFIX)}addSheet(e=`${this.sheetNamePrefix}${this.lastSheetId+2}`){const t=o(e);if(this.mappingFromCanonicalName.has(t))throw new n.SheetNameAlreadyTakenError(e);this.lastSheetId++;const r=new a(this.lastSheetId,e);return this.store(r),r.id}removeSheet(e){const t=this.fetchSheetById(e);e==this.lastSheetId&&--this.lastSheetId,this.mappingFromCanonicalName.delete(t.canonicalName),this.mappingFromId.delete(t.id)}getDisplayName(e){var t;return null===(t=this.mappingFromId.get(e))||void 0===t?void 0:t.displayName}*displayNames(){for(const e of this.mappingFromCanonicalName.values())yield e.displayName}numberOfSheets(){return this.mappingFromCanonicalName.size}hasSheetWithId(e){return this.mappingFromId.has(e)}hasSheetWithName(e){return this.mappingFromCanonicalName.has(o(e))}renameSheet(e,t){const r=this.fetchSheetById(e),s=r.displayName;if(s===t)return;const a=this.mappingFromCanonicalName.get(o(t));if(void 0!==a&&a.id!==r.id)throw new n.SheetNameAlreadyTakenError(t);const i=r.canonicalName;return this.mappingFromCanonicalName.delete(i),r.displayName=t,this.store(r),s}sheetNames(){return Array.from(this.mappingFromId.values()).map((e=>e.displayName))}store(e){this.mappingFromId.set(e.id,e),this.mappingFromCanonicalName.set(e.canonicalName,e)}fetchSheetById(e){const t=this.mappingFromId.get(e);if(void 0===t)throw new n.NoSheetWithIdError(e);return t}}},function(e,t,r){"use strict";t.__esModule=!0,t.UIElement=void 0;var n,s=r(179);t.buildTranslationPackage=s.buildTranslationPackage,t.TranslationPackage=s.TranslationPackage,function(e){e.NEW_SHEET_PREFIX="NEW_SHEET_PREFIX"}(n||(t.UIElement=n={}))},function(e,t,r){"use strict";t.__esModule=!0,t.TranslationPackage=void 0,t.buildTranslationPackage=function(e){return new a(Object.assign({},e.functions),Object.assign({},e.errors),Object.assign({},e.ui))},r(3),r(109),r(120),r(122),r(124),r(126),r(128),r(130),r(73),r(94);var n=r(106),s=r(167),o=r(178);class a{constructor(e,t,r){this.functions=e,this.errors=t,this.ui=r,this._protectedTranslations={VERSION:"VERSION"},this.checkUI(),this.checkErrors(),this.checkFunctionTranslations(this.functions),Object.assign(this.functions,this._protectedTranslations)}extendFunctions(e){this.checkFunctionTranslations(e),Object.assign(this.functions,e)}buildFunctionMapping(){return Object.keys(this.functions).reduce(((e,t)=>(e[this.functions[t]]=t,e)),{})}buildErrorMapping(){return Object.keys(this.errors).reduce(((e,t)=>(e[this.errors[t]]=t,e)),{})}isFunctionTranslated(e){return void 0!==this.functions[e]}getFunctionTranslations(e){const t=[];for(const r of e)this.isFunctionTranslated(r)&&t.push(this.functions[r]);return t}getFunctionTranslation(e){const t=this.functions[e];if(void 0===t)throw new s.MissingTranslationError(`functions.${e}`);return t}getMaybeFunctionTranslation(e){return this.functions[e]}getErrorTranslation(e){if(e===n.ErrorType.LIC)return`#${n.ErrorType.LIC}!`;const t=this.errors[e];if(void 0===t)throw new s.MissingTranslationError(`errors.${e}`);return t}getUITranslation(e){const t=this.ui[e];if(void 0===t)throw new s.MissingTranslationError(`ui.${e}`);return t}checkUI(){for(const e of Object.values(o.UIElement))if(!(e in this.ui))throw new s.MissingTranslationError(`ui.${e}`)}checkErrors(){for(const e of Object.values(n.ErrorType))if(!(e in this.errors)&&e!==n.ErrorType.LIC)throw new s.MissingTranslationError(`errors.${e}`)}checkFunctionTranslations(e){const t=new Set(Object.getOwnPropertyNames(e));for(const e of Object.getOwnPropertyNames(this._protectedTranslations))if(t.has(e))throw new s.ProtectedFunctionTranslationError(e)}}t.TranslationPackage=a},function(e,t,r){"use strict";t.__esModule=!0,t.EmptyCellVertex=void 0;var n=r(160);t.EmptyCellVertex=class{constructor(){}getCellValue(){return n.EmptyValue}}},function(e,t,r){"use strict";t.__esModule=!0,t.ValueCellVertex=void 0;t.ValueCellVertex=class{constructor(e,t){this.parsedValue=e,this.rawValue=t}getValues(){return{parsedValue:this.parsedValue,rawValue:this.rawValue}}setValues(e){this.parsedValue=e.parsedValue,this.rawValue=e.rawValue}getCellValue(){return this.parsedValue}}},function(e,t,r){"use strict";t.__esModule=!0,t.ParsingErrorVertex=void 0,r(73),r(183),r(85);var n=r(106);t.ParsingErrorVertex=class{constructor(e,t){this.errors=e,this.rawInput=t}getCellValue(){const e=this.errors.map((e=>e.message)).find((e=>e));return n.CellError.parsingError(e)}getFormula(){return this.rawInput}}},function(e,t,r){"use strict";r(184)},function(e,t,r){"use strict";var n=r(4),s=r(96),o=r(32),a=r(48),i=r(88);n({target:"Iterator",proto:!0,real:!0},{find:function(e){a(this),o(e);var t=i(this),r=0;return s(t,(function(t,n){if(e(t,r++))return n(t)}),{IS_RECORD:!0,INTERRUPTED:!0}).result}})},function(e,t,r){"use strict";t.__esModule=!0,t.SparseStrategy=void 0,r(73),r(134);var n=r(106);t.SparseStrategy=class{constructor(e,t){this.width=e,this.height=t,this.mapping=new Map}getCell(e){var t;return null===(t=this.mapping.get(e.col))||void 0===t?void 0:t.get(e.row)}setCell(e,t){this.width=Math.max(this.width,e.col+1),this.height=Math.max(this.height,e.row+1);let r=this.mapping.get(e.col);r||(r=new Map,this.mapping.set(e.col,r)),r.set(e.row,t)}has(e){var t;return!!(null===(t=this.mapping.get(e.col))||void 0===t?void 0:t.get(e.row))}getHeight(){return this.height}getWidth(){return this.width}removeCell(e){var t;null===(t=this.mapping.get(e.col))||void 0===t||t.delete(e.row)}addRows(e,t){this.mapping.forEach((r=>{const n=new Map;r.forEach(((s,o)=>{o>=e&&(n.set(o+t,s),r.delete(o))})),n.forEach(((e,t)=>{r.set(t,e)}))})),this.height+=t}addColumns(e,t){const r=new Map;this.mapping.forEach(((n,s)=>{s>=e&&(r.set(s+t,n),this.mapping.delete(s))})),r.forEach(((e,t)=>{this.mapping.set(t,e)})),this.width+=t}removeRows(e){this.mapping.forEach((t=>{const r=new Map;t.forEach(((n,s)=>{s>=e.rowStart&&(t.delete(s),s>e.rowEnd&&r.set(s-e.numberOfRows,n))})),r.forEach(((e,r)=>{t.set(r,e)}))}));const t=Math.min(this.height-1,e.rowEnd),r=Math.max(0,t-e.rowStart+1);this.height=Math.max(0,this.height-r)}removeColumns(e){const t=new Map;this.mapping.forEach(((r,n)=>{n>=e.columnStart&&(this.mapping.delete(n),n>e.columnEnd&&t.set(n-e.numberOfColumns,r))})),t.forEach(((e,t)=>{this.mapping.set(t,e)}));const r=Math.min(this.width-1,e.columnEnd),n=Math.max(0,r-e.columnStart+1);this.width=Math.max(0,this.width-n)}*getEntries(e){for(const[t,r]of this.mapping)for(const[s,o]of r)yield[(0,n.simpleCellAddress)(e,t,s),o]}*verticesFromColumn(e){const t=this.mapping.get(e);if(void 0!==t)for(const[e,r]of t)yield r}*verticesFromRow(e){for(const t of this.mapping.values()){const r=t.get(e);void 0!==r&&(yield r)}}*verticesFromColumnsSpan(e){for(const t of e.columns()){const e=this.mapping.get(t);if(void 0!==e)for(const[t,r]of e)yield r}}*verticesFromRowsSpan(e){for(const t of this.mapping.values())for(const r of e.rows()){const e=t.get(r);void 0!==e&&(yield e)}}*entriesFromRowsSpan(e){for(const[t,r]of this.mapping.entries())for(const s of e.rows()){const o=r.get(s);void 0!==o&&(yield[(0,n.simpleCellAddress)(e.sheet,t,s),o])}}*entriesFromColumnsSpan(e){for(const t of e.columns()){const r=this.mapping.get(t);if(void 0!==r)for(const[s,o]of r.entries())yield[(0,n.simpleCellAddress)(e.sheet,t,s),o]}}*vertices(){for(const[e,t]of this.mapping)for(const[e,r]of t)void 0!==r&&(yield r)}}},function(e,t,r){"use strict";t.__esModule=!0,t.DenseStrategy=void 0,r(3);var n=r(106);t.DenseStrategy=class{constructor(e,t){this.width=e,this.height=t,this.mapping=new Array(t);for(let r=0;r<t;r++)this.mapping[r]=new Array(e)}getCell(e){return this.getCellVertex(e.col,e.row)}setCell(e,t){this.width=Math.max(this.width,e.col+1),this.height=Math.max(this.height,e.row+1);this.mapping[e.row]||(this.mapping[e.row]=new Array(this.width)),this.mapping[e.row][e.col]=t}has(e){const t=this.mapping[e.row];return!!t&&!!t[e.col]}getHeight(){return this.height}getWidth(){return this.width}removeCell(e){void 0!==this.mapping[e.row]&&delete this.mapping[e.row][e.col]}addRows(e,t){const r=[];for(let e=0;e<t;e++)r.push(new Array(this.width));this.mapping.splice(e,0,...r),this.height+=t}addColumns(e,t){for(let r=0;r<this.height;r++)void 0!==this.mapping[r]&&this.mapping[r].splice(e,0,...new Array(t));this.width+=t}removeRows(e){this.mapping.splice(e.rowStart,e.numberOfRows);const t=Math.min(this.height-1,e.rowEnd),r=Math.max(0,t-e.rowStart+1);this.height=Math.max(0,this.height-r)}removeColumns(e){for(let t=0;t<this.height;t++)void 0!==this.mapping[t]&&this.mapping[t].splice(e.columnStart,e.numberOfColumns);const t=Math.min(this.width-1,e.columnEnd),r=Math.max(0,t-e.columnStart+1);this.width=Math.max(0,this.width-r)}*getEntries(e){for(let t=0;t<this.height;++t)for(let r=0;r<this.width;++r){const s=this.getCellVertex(r,t);s&&(yield[(0,n.simpleCellAddress)(e,r,t),s])}}*verticesFromColumn(e){for(let t=0;t<this.height;++t){const r=this.getCellVertex(e,t);r&&(yield r)}}*verticesFromRow(e){for(let t=0;t<this.width;++t){const r=this.getCellVertex(t,e);r&&(yield r)}}*verticesFromColumnsSpan(e){for(let t=e.columnStart;t<=e.columnEnd;++t)for(let e=0;e<this.height;++e){const r=this.getCellVertex(t,e);r&&(yield r)}}*verticesFromRowsSpan(e){for(let t=0;t<this.width;++t)for(let r=e.rowStart;r<=e.rowEnd;++r){const e=this.getCellVertex(t,r);e&&(yield e)}}*entriesFromRowsSpan(e){for(let t=0;t<this.width;++t)for(let r=e.rowStart;r<=e.rowEnd;++r){const s=this.getCellVertex(t,r);s&&(yield[(0,n.simpleCellAddress)(e.sheet,t,r),s])}}*entriesFromColumnsSpan(e){for(let t=e.columnStart;t<=e.columnEnd;++t)for(let r=0;r<this.height;++r){const s=this.getCellVertex(t,r);s&&(yield[(0,n.simpleCellAddress)(e.sheet,t,r),s])}}*vertices(){for(let e=0;e<this.height;++e)for(let t=0;t<this.width;++t){const r=this.getCellVertex(t,e);r&&(yield r)}}getCellVertex(e,t){var r;return null===(r=this.mapping[t])||void 0===r?void 0:r[e]}}},function(e,t,r){"use strict";t.__esModule=!0,t.InterpreterState=void 0;t.InterpreterState=class{constructor(e,t,r){this.formulaAddress=e,this.arraysFlag=t,this.formulaVertex=r}}},function(e,t,r){"use strict";t.__esModule=!0;var n=r(189);t.FunctionPlugin=n.FunctionPlugin,t.FunctionArgumentType=n.FunctionArgumentType;var s=r(160);t.EmptyValue=s.EmptyValue},function(e,t,r){"use strict";t.__esModule=!0,t.FunctionPlugin=t.FunctionArgumentType=void 0,r(3),r(73),r(190),r(132),r(85);var n,s=r(105),o=r(106),a=r(151),i=r(137),u=r(192),l=r(160),c=r(159);!function(e){e.STRING="STRING",e.NUMBER="NUMBER",e.BOOLEAN="BOOLEAN",e.SCALAR="SCALAR",e.NOERROR="NOERROR",e.RANGE="RANGE",e.INTEGER="INTEGER",e.COMPLEX="COMPLEX",e.ANY="ANY"}(n||(t.FunctionArgumentType=n={}));t.FunctionPlugin=class{constructor(e){this.coerceScalarToNumberOrError=e=>this.arithmeticHelper.coerceScalarToNumberOrError(e),this.runFunction=(e,t,r,n)=>{const s=this.evaluateArguments(e,t,r),i=s.map((([e,t])=>e)),u=s.map((([e,t])=>t)),l=this.buildMetadataForEachArgumentValue(i.length,r),h=t.arraysFlag&&!r.vectorizationForbidden;if(!this.isNumberOfArgumentValuesValid(l,i.length))return new o.CellError(o.ErrorType.NA,a.ErrorMessage.WrongArgNumber);const[d,p]=h?this.calculateSizeOfVectorizedResultArray(i,l):[1,1];if(1===d&&1===p){const e=this.vectorizeAndBroadcastArgumentsIfNecessary(h,i,l,0,0);return this.calculateSingleCellOfResultArray(t,e,l,u,n,r.returnNumberType)}const m=[...Array(d).keys()].map((e=>[...Array(p).keys()].map((s=>{const o=this.vectorizeAndBroadcastArgumentsIfNecessary(h,i,l,e,s),a=this.calculateSingleCellOfResultArray(t,o,l,u,n,r.returnNumberType);if(a instanceof c.SimpleRangeValue)throw new Error("Function returning array cannot be vectorized.");return a}))));return c.SimpleRangeValue.onlyValues(m)},this.runFunctionWithReferenceArgument=(e,t,r,n,u,l=()=>new o.CellError(o.ErrorType.NA,a.ErrorMessage.CellRefExpected))=>{if(0===e.length)return this.returnNumberWrapper(n(),r.returnNumberType);if(e.length>1)return new o.CellError(o.ErrorType.NA,a.ErrorMessage.WrongArgNumber);let c,h=e[0];for(;h.type===i.AstNodeType.PARENTHESIS;)h=h.expression;if(h.type===i.AstNodeType.CELL_REFERENCE)c=h.reference.toSimpleCellAddress(t.formulaAddress);else if(h.type===i.AstNodeType.CELL_RANGE||h.type===i.AstNodeType.COLUMN_RANGE||h.type===i.AstNodeType.ROW_RANGE)try{c=s.AbsoluteCellRange.fromAst(h,t.formulaAddress).start}catch(e){return new o.CellError(o.ErrorType.REF,a.ErrorMessage.CellRefExpected)}return void 0!==c?this.returnNumberWrapper(u(c),r.returnNumberType):this.runFunction(e,t,r,l)},this.interpreter=e,this.dependencyGraph=e.dependencyGraph,this.columnSearch=e.columnSearch,this.config=e.config,this.serialization=e.serialization,this.arraySizePredictor=e.arraySizePredictor,this.dateTimeHelper=e.dateTimeHelper,this.arithmeticHelper=e.arithmeticHelper}evaluateAst(e,t){return this.interpreter.evaluateAst(e,t)}arraySizeForAst(e,t){return this.arraySizePredictor.checkArraySizeForAst(e,t)}listOfScalarValues(e,t){const r=[];for(const n of e){const e=this.evaluateAst(n,t);if(e instanceof c.SimpleRangeValue)for(const t of e.valuesFromTopLeftCorner())r.push([t,!0]);else r.push([e,!1])}return r}coerceToType(e,t,r){let s;if(e instanceof c.SimpleRangeValue)switch(t.argumentType){case n.RANGE:case n.ANY:s=e;break;default:{const t=(0,u.coerceRangeToScalar)(e,r);if(void 0===t)return;e=t}}if(!(e instanceof c.SimpleRangeValue))switch(t.argumentType){case n.INTEGER:case n.NUMBER:const r=this.coerceScalarToNumberOrError(e);if(!(0,l.isExtendedNumber)(r)){s=r;break}const i=(0,l.getRawValue)(r);if(void 0!==t.maxValue&&i>t.maxValue)return new o.CellError(o.ErrorType.NUM,a.ErrorMessage.ValueLarge);if(void 0!==t.minValue&&i<t.minValue)return new o.CellError(o.ErrorType.NUM,a.ErrorMessage.ValueSmall);if(void 0!==t.lessThan&&i>=t.lessThan)return new o.CellError(o.ErrorType.NUM,a.ErrorMessage.ValueLarge);if(void 0!==t.greaterThan&&i<=t.greaterThan)return new o.CellError(o.ErrorType.NUM,a.ErrorMessage.ValueSmall);if(t.argumentType===n.INTEGER&&!Number.isInteger(i))return new o.CellError(o.ErrorType.NUM,a.ErrorMessage.IntegerExpected);s=r;break;case n.STRING:s=(0,u.coerceScalarToString)(e);break;case n.BOOLEAN:s=(0,u.coerceScalarToBoolean)(e);break;case n.SCALAR:case n.NOERROR:case n.ANY:s=e;break;case n.RANGE:if(e instanceof o.CellError)return e;s=(0,u.coerceToRange)(e);break;case n.COMPLEX:return this.arithmeticHelper.coerceScalarToComplex((0,l.getRawValue)(e))}return t.passSubtype||void 0===s?s:(0,l.getRawValue)(s)}calculateSingleCellOfResultArray(e,t,r,n,s,a){const i=this.coerceArgumentsToRequiredTypes(e,t,r,n);if(i instanceof o.CellError)return i;const u=s(...i);return this.returnNumberWrapper(u,a)}coerceArgumentsToRequiredTypes(e,t,r,s){const i=[];for(let u=0;u<r.length;u++){const l=r[u],c=void 0!==t[u]?t[u]:null==l?void 0:l.defaultValue;if(void 0===c){i.push(void 0);continue}const h=this.coerceToType(c,l,e);if(void 0===h&&!s[u])return new o.CellError(o.ErrorType.VALUE,a.ErrorMessage.WrongType);if(h instanceof o.CellError&&l.argumentType!==n.SCALAR)return h;i.push(h)}return i}vectorizeAndBroadcastArgumentsIfNecessary(e,t,r,n,s){return t.map(((t,o)=>e&&this.isRangePassedAsAScalarArgument(t,r[o])?this.vectorizeAndBroadcastRangeArgument(t,n,s):t))}vectorizeAndBroadcastRangeArgument(e,t,r){var n;const s=1===e.height()?0:t,o=1===e.width()?0:r;return null===(n=e.data[s])||void 0===n?void 0:n[o]}evaluateArguments(e,t,r){return r.expandRanges?this.listOfScalarValues(e,t):e.map((e=>[this.evaluateAst(e,t),!1]))}buildMetadataForEachArgumentValue(e,t){const r=t.parameters?[...t.parameters]:[];if(void 0!==t.repeatLastArgs&&Number.isInteger(t.repeatLastArgs)&&t.repeatLastArgs>0)for(;e>r.length;)r.push(...r.slice(r.length-t.repeatLastArgs));return r}isNumberOfArgumentValuesValid(e,t){if(t>e.length)return!1;if(t<e.length){return e.slice(t).every((e=>(null==e?void 0:e.optionalArg)||void 0!==(null==e?void 0:e.defaultValue)))}return!0}calculateSizeOfVectorizedResultArray(e,t){const r=e.filter(((e,r)=>this.isRangePassedAsAScalarArgument(e,t[r])));return[Math.max(1,...r.map((e=>e.height()))),Math.max(1,...r.map((e=>e.width())))]}isRangePassedAsAScalarArgument(e,t){return null!=e&&null!=t&&(e instanceof c.SimpleRangeValue&&![n.RANGE,n.ANY].includes(t.argumentType))}metadata(e){const t=this.constructor.implementedFunctions[e];if(void 0!==t)return t;throw new Error(`No metadata for function ${e}.`)}returnNumberWrapper(e,t,r){return void 0!==t&&(0,l.isExtendedNumber)(e)?this.arithmeticHelper.ExtendedNumberFactory((0,l.getRawValue)(e),{type:t,format:r}):e}}},function(e,t,r){"use strict";r(191)},function(e,t,r){"use strict";var n=r(4),s=r(96),o=r(32),a=r(48),i=r(88);n({target:"Iterator",proto:!0,real:!0},{every:function(e){a(this),o(e);var t=i(this),r=0;return!s(t,(function(t,n){if(!e(t,r++))return n()}),{IS_RECORD:!0,INTERRUPTED:!0}).stopped}})},function(e,t,r){"use strict";t.__esModule=!0,t.ArithmeticHelper=void 0,t.coerceBooleanToNumber=c,t.coerceComplexToString=function([e,t],r){if(!isFinite(e)||!isFinite(t))return new n.CellError(n.ErrorType.NUM,s.ErrorMessage.NaN);if(r=null!=r?r:u,0===t)return`${e}`;const o=`${-1===t||1===t?"":Math.abs(t)}${r}`;if(0===e)return`${t<0?"-":""}${o}`;return`${e}${t<0?"-":"+"}${o}`},t.coerceEmptyToValue=h,t.coerceRangeToScalar=function(e,t){var r;if(e.isAdHoc())return null===(r=e.data[0])||void 0===r?void 0:r[0];const n=e.range;if(t.formulaAddress.sheet===n.sheet)if(1===n.width()){const r=t.formulaAddress.row-n.start.row;if(r>=0&&r<n.height())return e.data[r][0]}else if(1===n.height()){const r=t.formulaAddress.col-n.start.col;if(r>=0&&r<n.width())return e.data[0][r]}return},t.coerceScalarToBoolean=function(e){if(e instanceof n.CellError||"boolean"==typeof e)return e;if(e===a.EmptyValue)return!1;if((0,a.isExtendedNumber)(e))return 0!==(0,a.getRawValue)(e);{const t=e.toUpperCase();return"TRUE"===t||"FALSE"!==t&&(""!==t&&void 0)}},t.coerceScalarToString=function(e){return e instanceof n.CellError||"string"==typeof e?e:e===a.EmptyValue?"":(0,a.isExtendedNumber)(e)?(0,a.getRawValue)(e).toString():e?"TRUE":"FALSE"},t.coerceToRange=function(e){return e instanceof i.SimpleRangeValue?e:i.SimpleRangeValue.fromScalar(e)},t.coerceToRangeNumbersOrError=function(e){return e instanceof i.SimpleRangeValue&&e.hasOnlyNumbers()||e instanceof n.CellError?e:(0,a.isExtendedNumber)(e)?i.SimpleRangeValue.fromScalar(e):null},t.fixNegativeZero=function(e){return 0===e?0:e},t.forceNormalizeString=function(e){return y(e.toLowerCase(),"nfd").replace(/[\u0300-\u036f]/g,"")},t.isNumberOverflow=function(e){return isNaN(e)||e===1/0||e===-1/0},t.normalizeString=y,t.numberCmp=d,t.zeroIfEmpty=function(e){return e===a.EmptyValue?0:e},r(3);var n=r(106),s=r(151),o=r(193),a=r(160),i=r(159);const u="i",l=/^\s*([+-]?)\s*(([\d\.,]+(e[+-]?\d+)?)\s*([ij]?)|([ij]))\s*(([+-])\s*([+-]?)\s*(([\d\.,]+(e[+-]?\d+)?)\s*([ij]?)|([ij])))?$/;function c(e){return Number(e)}function h(e){return"string"==typeof e?"":(0,a.isExtendedNumber)(e)?0:"boolean"!=typeof e&&a.EmptyValue}function d(e,t){const r=(0,a.getRawValue)(e),n=(0,a.getRawValue)(t);return r>n?1:r<n?-1:0}function p(e){return["*","?"].includes(e)}t.ArithmeticHelper=class{constructor(e,t,r){this.config=e,this.dateTimeHelper=t,this.numberLiteralsHelper=r,this.lt=(e,t)=>this.compare(e,t)<0,this.leq=(e,t)=>this.compare(e,t)<=0,this.gt=(e,t)=>this.compare(e,t)>0,this.geq=(e,t)=>this.compare(e,t)>=0,this.eq=(e,t)=>0===this.compare(e,t),this.neq=(e,t)=>0!==this.compare(e,t),this.pow=(e,t)=>Math.pow((0,a.getRawValue)(e),(0,a.getRawValue)(t)),this.addWithEpsilonRaw=(e,t)=>{const r=e+t;return Math.abs(r)<this.actualEps*Math.abs(e)?0:r},this.addWithEpsilon=(e,t)=>{const r=E(e,t);return this.ExtendedNumberFactory(this.addWithEpsilonRaw((0,a.getRawValue)(e),(0,a.getRawValue)(t)),r)},this.unaryMinus=e=>(0,a.cloneNumber)(e,-(0,a.getRawValue)(e)),this.unaryPlus=e=>e,this.unaryPercent=e=>new a.PercentNumber((0,a.getRawValue)(e)/100),this.concat=(e,t)=>e.concat(t),this.nonstrictadd=(e,t)=>e instanceof n.CellError?e:t instanceof n.CellError?t:"number"==typeof e?"number"==typeof t?this.addWithEpsilonRaw(e,t):e:"number"==typeof t?t:0,this.subtract=(e,t)=>{const r=E(e,t),n=(0,a.getRawValue)(e);let s=n-(0,a.getRawValue)(t);return Math.abs(s)<this.actualEps*Math.abs(n)&&(s=0),this.ExtendedNumberFactory(s,r)},this.divide=(e,t)=>{const r=(0,a.getRawValue)(e),s=(0,a.getRawValue)(t);if(0===s)return new n.CellError(n.ErrorType.DIV_BY_ZERO);{const n=T(e,t);return this.ExtendedNumberFactory(r/s,n)}},this.multiply=(e,t)=>{const r=T(e,t);return this.ExtendedNumberFactory((0,a.getRawValue)(e)*(0,a.getRawValue)(t),r)},this.manyToExactComplex=e=>{const t=[];for(const r of e){if(r instanceof n.CellError)return r;if((0,a.isExtendedNumber)(r)||"string"==typeof r){const e=this.coerceScalarToComplex(r);e instanceof n.CellError||t.push(e)}}return t},this.coerceNumbersExactRanges=e=>this.manyToNumbers(e,this.manyToExactNumbers),this.coerceNumbersCoerceRangesDropNulls=e=>this.manyToNumbers(e,this.manyToCoercedNumbersDropNulls),this.manyToExactNumbers=e=>{const t=[];for(const r of e){if(r instanceof n.CellError)return r;(0,a.isExtendedNumber)(r)&&t.push((0,a.getRawValue)(r))}return t},this.manyToOnlyNumbersDropNulls=e=>{const t=[];for(const r of e){if(r instanceof n.CellError)return r;if((0,a.isExtendedNumber)(r))t.push((0,a.getRawValue)(r));else if(r!==a.EmptyValue)return new n.CellError(n.ErrorType.VALUE,s.ErrorMessage.NumberExpected)}return t},this.manyToCoercedNumbersDropNulls=e=>{const t=[];for(const r of e){if(r instanceof n.CellError)return r;if(r===a.EmptyValue)continue;const e=this.coerceScalarToNumberOrError(r);(0,a.isExtendedNumber)(e)&&t.push((0,a.getRawValue)(e))}return t},this.collator=(0,o.collatorFromConfig)(e),this.actualEps=e.smartRounding?e.precisionEpsilon:0}eqMatcherFunction(e){const t=this.buildRegex(e);return e=>"string"==typeof e&&t.test(this.normalizeString(e))}neqMatcherFunction(e){const t=this.buildRegex(e);return e=>!("string"==typeof e&&t.test(this.normalizeString(e)))}searchString(e,t){var r;const n=this.buildRegex(e,!1).exec(t);return null!==(r=null==n?void 0:n.index)&&void 0!==r?r:-1}requiresRegex(e){if(!this.config.useRegularExpressions&&!this.config.useWildcards)return!this.config.matchWholeCell;for(let t=0;t<e.length;t++){const r=e.charAt(t);if(p(r)||this.config.useRegularExpressions&&g(r))return!0}return!1}floatCmp(e,t){const r=(0,a.getRawValue)(e),n=(0,a.getRawValue)(t),s=1+this.actualEps;return n>=0&&r*s>=n&&r<=n*s||n<=0&&r*s<=n&&r>=n*s?0:r>n?1:-1}coerceScalarToNumberOrError(e){var t;return e instanceof n.CellError?e:null!==(t=this.coerceToMaybeNumber(e))&&void 0!==t?t:new n.CellError(n.ErrorType.VALUE,s.ErrorMessage.NumberCoercion)}coerceToMaybeNumber(e){var t;return null!==(t=this.coerceNonDateScalarToMaybeNumber(e))&&void 0!==t?t:"string"==typeof e?this.dateTimeHelper.dateStringToDateNumber(e):void 0}coerceNonDateScalarToMaybeNumber(e){if(e===a.EmptyValue)return 0;if("string"==typeof e){if(""===e)return 0;const t=this.coerceStringToMaybePercentNumber(e);if(void 0!==t)return t;const r=this.coerceStringToMaybeCurrencyNumber(e);return void 0!==r?r:this.numberLiteralsHelper.numericStringToMaybeNumber(e.trim())}return(0,a.isExtendedNumber)(e)?e:"boolean"==typeof e?Number(e):void 0}coerceStringToMaybePercentNumber(e){const t=e.trim();if(t.endsWith("%")){const e=t.slice(0,t.length-1).trim(),r=this.numberLiteralsHelper.numericStringToMaybeNumber(e);if(void 0!==r)return new a.PercentNumber(r/100)}}coerceStringToMaybeCurrencyNumber(e){const t=this.currencyMatcher(e.trim());if(void 0!==t){const[e,r]=t,n=this.numberLiteralsHelper.numericStringToMaybeNumber(r);if(void 0!==n)return new a.CurrencyNumber(n,e)}}currencyMatcher(e){for(const t of this.config.currencySymbol){if(e.startsWith(t))return[t,e.slice(t.length).trim()];if(e.endsWith(t))return[t,e.slice(0,e.length-t.length).trim()]}}coerceComplexExactRanges(e){const t=[];for(const r of e)if(r instanceof i.SimpleRangeValue)t.push(r);else if(r!==a.EmptyValue){const e=this.coerceScalarToComplex(r);if(e instanceof n.CellError)return e;t.push(e)}const r=[];for(const e of t)if(e instanceof i.SimpleRangeValue){const t=this.manyToExactComplex(e.valuesFromTopLeftCorner());if(t instanceof n.CellError)return t;r.push(...t)}else r.push(e);return r}coerceScalarToComplex(e){return e instanceof n.CellError?e:e===a.EmptyValue?[0,0]:(0,a.isExtendedNumber)(e)?[(0,a.getRawValue)(e),0]:"string"==typeof e?this.coerceStringToComplex(e):new n.CellError(n.ErrorType.NUM,s.ErrorMessage.ComplexNumberExpected)}ExtendedNumberFactory(e,t){const{type:r,format:n}=t;switch(r){case a.NumberType.NUMBER_RAW:return e;case a.NumberType.NUMBER_CURRENCY:return new a.CurrencyNumber(e,null!=n?n:this.config.currencySymbol[0]);case a.NumberType.NUMBER_DATE:return new a.DateNumber(e,n);case a.NumberType.NUMBER_DATETIME:return new a.DateTimeNumber(e,n);case a.NumberType.NUMBER_TIME:return new a.TimeNumber(e,n);case a.NumberType.NUMBER_PERCENT:return new a.PercentNumber(e,n)}}buildRegex(e,t=!0){let r;e=this.normalizeString(e);let n=this.config.useWildcards,s=this.config.useRegularExpressions;if(s)try{RegExp(e)}catch(e){s=!1,n=!1}return r=s?function(e,t){let r="";for(let n=0;n<e.length;n++){const s=e.charAt(n);p(s)||g(s)?r+=s:r+=t?s:s.toLowerCase()}return r}(e,this.config.caseSensitive):n?function(e,t){let r="";for(let n=0;n<e.length;n++){const s=e.charAt(n);if("~"===s){if(n==e.length-1){r+="~";continue}const t=e.charAt(n+1);p(t)||g(t)?(r+="\\"+t,n++):(r+=t,n++)}else p(s)?r+="."+s:g(s)?r+="\\"+s:r+=t?s:s.toLowerCase()}return r}(e,this.config.caseSensitive):function(e,t){let r="";for(let n=0;n<e.length;n++){const s=e.charAt(n);p(s)||g(s)?r+="\\"+s:r+=t?s:s.toLowerCase()}return r}(e,this.config.caseSensitive),this.config.matchWholeCell&&t?RegExp("^("+r+")$"):RegExp(r)}normalizeString(e){return this.config.caseSensitive||(e=e.toLowerCase()),this.config.accentSensitive||(e=y(e,"nfd").replace(/[\u0300-\u036f]/g,"")),e}compare(e,t){if("string"==typeof e||"string"==typeof t){const r="string"==typeof e?this.dateTimeHelper.dateStringToDateNumber(e):e,n="string"==typeof t?this.dateTimeHelper.dateStringToDateNumber(t):t;if((0,a.isExtendedNumber)(r)&&(0,a.isExtendedNumber)(n))return this.floatCmp(r,n)}return e===a.EmptyValue?e=h(t):t===a.EmptyValue&&(t=h(e)),"string"==typeof e&&"string"==typeof t?this.stringCmp(e,t):"boolean"==typeof e&&"boolean"==typeof t?d(c(e),c(t)):(0,a.isExtendedNumber)(e)&&(0,a.isExtendedNumber)(t)?this.floatCmp(e,t):e===a.EmptyValue&&t===a.EmptyValue?0:d((0,n.CellValueTypeOrd)((0,n.getCellValueType)(e)),(0,n.CellValueTypeOrd)((0,n.getCellValueType)(t)))}stringCmp(e,t){return this.collator.compare(e,t)}manyToNumbers(e,t){const r=[];for(const t of e)if(t instanceof i.SimpleRangeValue)r.push(t);else{const e=(0,a.getRawValue)(this.coerceScalarToNumberOrError(t));if(e instanceof n.CellError)return e;r.push(e)}const s=[];for(const e of r)if(e instanceof i.SimpleRangeValue){const r=t(e.valuesFromTopLeftCorner());if(r instanceof n.CellError)return r;s.push(...r)}else s.push(e);return s}coerceStringToComplex(e){const t=l.exec(e);if(null===t)return new n.CellError(n.ErrorType.NUM,s.ErrorMessage.ComplexNumberExpected);let r,o;return r=void 0!==t[6]?"-"===t[1]?[0,-1]:[0,1]:this.parseComplexToken(t[1]+t[3],t[5]),r instanceof n.CellError||void 0===t[8]?r:(o=void 0!==t[14]?"-"===t[9]?[0,-1]:[0,1]:this.parseComplexToken(t[9]+t[11],t[13]),o instanceof n.CellError?o:""!==t[5]||""===t[13]?new n.CellError(n.ErrorType.NUM,s.ErrorMessage.ComplexNumberExpected):"+"===t[8]?[r[0]+o[0],r[1]+o[1]]:[r[0]-o[0],r[1]-o[1]])}parseComplexToken(e,t){const r=(0,a.getRawValue)(this.coerceNonDateScalarToMaybeNumber(e));return void 0===r?new n.CellError(n.ErrorType.NUM,s.ErrorMessage.ComplexNumberExpected):""===t?[r,0]:[0,r]}};const m=["{","}","[","]","(",")","<",">","=",".","+","-",",","\\","$","^","!"];function g(e){return m.includes(e)}function E(e,t){const{type:r,format:n}=(0,a.getTypeFormatOfExtendedNumber)(e),{type:s,format:o}=(0,a.getTypeFormatOfExtendedNumber)(t);if(r===a.NumberType.NUMBER_RAW)return{type:s,format:o};if(s===a.NumberType.NUMBER_RAW)return{type:r,format:n};if(!(r!==a.NumberType.NUMBER_DATETIME&&r!==a.NumberType.NUMBER_DATE||s!==a.NumberType.NUMBER_DATETIME&&s!==a.NumberType.NUMBER_DATE))return{type:a.NumberType.NUMBER_RAW};if(r===a.NumberType.NUMBER_TIME){if(s===a.NumberType.NUMBER_DATE)return{type:a.NumberType.NUMBER_DATETIME,format:`${o} ${n}`};if(s===a.NumberType.NUMBER_DATETIME)return{type:a.NumberType.NUMBER_DATETIME,format:o}}if(s===a.NumberType.NUMBER_TIME){if(r===a.NumberType.NUMBER_DATE)return{type:a.NumberType.NUMBER_DATETIME,format:`${n} ${o}`};if(r===a.NumberType.NUMBER_DATETIME)return{type:a.NumberType.NUMBER_DATETIME,format:n}}return{type:r,format:n}}function T(e,t){let{type:r,format:n}=(0,a.getTypeFormatOfExtendedNumber)(e),{type:s,format:o}=(0,a.getTypeFormatOfExtendedNumber)(t);return r===a.NumberType.NUMBER_PERCENT&&(r=a.NumberType.NUMBER_RAW,n=void 0),s===a.NumberType.NUMBER_PERCENT&&(s=a.NumberType.NUMBER_RAW,o=void 0),r===a.NumberType.NUMBER_RAW?{type:s,format:o}:s===a.NumberType.NUMBER_RAW?{type:r,format:n}:{type:a.NumberType.NUMBER_RAW}}function y(e,t){return e.normalize(t.toUpperCase())}},function(e,t,r){"use strict";t.__esModule=!0,t.collatorFromConfig=function(e){const t=e.caseSensitive?e.accentSensitive?"variant":"case":e.accentSensitive?"accent":"base",r=e.caseFirst,n=e.ignorePunctuation;return new Intl.Collator(e.localeLang,{sensitivity:t,caseFirst:r,ignorePunctuation:n})}},function(e,t,r){"use strict";t.__esModule=!0,t.DetailedCellError=void 0;t.DetailedCellError=class{constructor(e,t,r){var n;this.value=t,this.address=r,this.type=e.type,this.message=null!==(n=e.message)&&void 0!==n?n:""}toString(){return this.value}valueOf(){return this.value}}},function(e,t,r){"use strict";t.__esModule=!0,t.Config=void 0,t.getDefaultConfig=function(){return p({})},r(73),r(134);var n=r(196),s=r(197),o=r(198),a=r(199),i=r(167),u=r(200),l=r(202),c=r(204);const h=new WeakMap;class d{constructor(e={},t=!0){const{accentSensitive:r,caseSensitive:s,caseFirst:a,chooseAddressMappingPolicy:i,context:u,currencySymbol:p,dateFormats:m,decimalSeparator:g,evaluateNullToZero:E,functionArgSeparator:T,functionPlugins:y,ignorePunctuation:f,leapYear1900:A,localeLang:R,language:N,ignoreWhiteSpace:S,licenseKey:C,matchWholeCell:v,arrayColumnSeparator:M,arrayRowSeparator:w,maxRows:F,maxColumns:O,nullYear:I,nullDate:b,parseDateTime:x,precisionEpsilon:V,precisionRounding:U,stringifyDateTime:_,stringifyDuration:P,smartRounding:L,timeFormats:D,thousandSeparator:B,useArrayArithmetic:G,useStats:H,undoLimit:W,useColumnIndex:k,useRegularExpressions:z,useWildcards:Y}=e;t&&d.warnDeprecatedOptions(e),this.useArrayArithmetic=(0,n.configValueFromParam)(G,"boolean","useArrayArithmetic"),this.accentSensitive=(0,n.configValueFromParam)(r,"boolean","accentSensitive"),this.caseSensitive=(0,n.configValueFromParam)(s,"boolean","caseSensitive"),this.caseFirst=(0,n.configValueFromParam)(a,["upper","lower","false"],"caseFirst"),this.ignorePunctuation=(0,n.configValueFromParam)(f,"boolean","ignorePunctuation"),this.chooseAddressMappingPolicy=null!=i?i:d.defaultConfig.chooseAddressMappingPolicy,this.dateFormats=[...(0,n.configValueFromParamCheck)(m,Array.isArray,"array","dateFormats")],this.timeFormats=[...(0,n.configValueFromParamCheck)(D,Array.isArray,"array","timeFormats")],this.functionArgSeparator=(0,n.configValueFromParam)(T,"string","functionArgSeparator"),this.decimalSeparator=(0,n.configValueFromParam)(g,[".",","],"decimalSeparator"),this.language=(0,n.configValueFromParam)(N,"string","language"),this.ignoreWhiteSpace=(0,n.configValueFromParam)(S,["standard","any"],"ignoreWhiteSpace"),this.licenseKey=(0,n.configValueFromParam)(C,"string","licenseKey"),this.thousandSeparator=(0,n.configValueFromParam)(B,["",","," ","."],"thousandSeparator"),this.arrayColumnSeparator=(0,n.configValueFromParam)(M,[",",";"],"arrayColumnSeparator"),this.arrayRowSeparator=(0,n.configValueFromParam)(w,[";","|"],"arrayRowSeparator"),this.localeLang=(0,n.configValueFromParam)(R,"string","localeLang"),this.functionPlugins=[...null!=y?y:d.defaultConfig.functionPlugins],this.smartRounding=(0,n.configValueFromParam)(L,"boolean","smartRounding"),this.evaluateNullToZero=(0,n.configValueFromParam)(E,"boolean","evaluateNullToZero"),this.nullYear=(0,n.configValueFromParam)(I,"number","nullYear"),(0,n.validateNumberToBeAtLeast)(this.nullYear,"nullYear",0),(0,n.validateNumberToBeAtMost)(this.nullYear,"nullYear",100),this.precisionRounding=(0,n.configValueFromParam)(U,"number","precisionRounding"),(0,n.validateNumberToBeAtLeast)(this.precisionRounding,"precisionRounding",0),this.precisionEpsilon=(0,n.configValueFromParam)(V,"number","precisionEpsilon"),(0,n.validateNumberToBeAtLeast)(this.precisionEpsilon,"precisionEpsilon",0),this.useColumnIndex=(0,n.configValueFromParam)(k,"boolean","useColumnIndex"),this.useStats=(0,n.configValueFromParam)(H,"boolean","useStats"),this.parseDateTime=(0,n.configValueFromParam)(x,"function","parseDateTime"),this.stringifyDateTime=(0,n.configValueFromParam)(_,"function","stringifyDateTime"),this.stringifyDuration=(0,n.configValueFromParam)(P,"function","stringifyDuration"),this.translationPackage=c.HyperFormula.getLanguage(this.language),this.errorMapping=this.translationPackage.buildErrorMapping(),this.nullDate=(0,n.configValueFromParamCheck)(b,o.instanceOfSimpleDate,"IDate","nullDate"),this.leapYear1900=(0,n.configValueFromParam)(A,"boolean","leapYear1900"),this.undoLimit=(0,n.configValueFromParam)(W,"number","undoLimit"),this.useRegularExpressions=(0,n.configValueFromParam)(z,"boolean","useRegularExpressions"),this.useWildcards=(0,n.configValueFromParam)(Y,"boolean","useWildcards"),this.matchWholeCell=(0,n.configValueFromParam)(v,"boolean","matchWholeCell"),(0,n.validateNumberToBeAtLeast)(this.undoLimit,"undoLimit",0),this.maxRows=(0,n.configValueFromParam)(F,"number","maxRows"),(0,n.validateNumberToBeAtLeast)(this.maxRows,"maxRows",1),this.maxColumns=(0,n.configValueFromParam)(O,"number","maxColumns"),this.currencySymbol=this.setupCurrencySymbol(p),(0,n.validateNumberToBeAtLeast)(this.maxColumns,"maxColumns",1),this.context=u,h.set(this,{licenseKeyValidityState:(0,l.checkLicenseKeyValidity)(this.licenseKey)}),(0,n.configCheckIfParametersNotInConflict)({value:this.decimalSeparator,name:"decimalSeparator"},{value:this.functionArgSeparator,name:"functionArgSeparator"},{value:this.thousandSeparator,name:"thousandSeparator"}),(0,n.configCheckIfParametersNotInConflict)({value:this.arrayRowSeparator,name:"arrayRowSeparator"},{value:this.arrayColumnSeparator,name:"arrayColumnSeparator"})}setupCurrencySymbol(e){const t=[...(0,n.configValueFromParamCheck)(e,Array.isArray,"array","currencySymbol")];return t.forEach((e=>{if("string"!=typeof e)throw new i.ExpectedValueOfTypeError("string[]","currencySymbol");if(""===e)throw new i.ConfigValueEmpty("currencySymbol")})),t}get licenseKeyValidityState(){return h.get(this).licenseKeyValidityState}getConfig(){return p(this)}mergeConfig(e){const t=Object.assign({},this.getConfig(),e);return d.warnDeprecatedOptions(e),new d(t,!1)}static warnDeprecatedOptions(e){}static warnDeprecatedIfUsed(e,t,r,n){void 0!==e&&(void 0===n?console.warn(`${t} option is deprecated since ${r}`):console.warn(`${t} option is deprecated since ${r}, please use ${n}`))}}function p(e){var t;const r={};for(const n in d.defaultConfig){const s=null!==(t=e[n])&&void 0!==t?t:d.defaultConfig[n];Array.isArray(s)?r[n]=[...s]:r[n]=s}return r}t.Config=d,d.defaultConfig={accentSensitive:!1,currencySymbol:["$"],caseSensitive:!1,caseFirst:"lower",context:void 0,chooseAddressMappingPolicy:new a.AlwaysDense,dateFormats:["DD/MM/YYYY","DD/MM/YY"],decimalSeparator:".",evaluateNullToZero:!1,functionArgSeparator:",",functionPlugins:[],ignorePunctuation:!1,language:"enGB",ignoreWhiteSpace:"standard",licenseKey:"",leapYear1900:!1,localeLang:"en",matchWholeCell:!0,arrayColumnSeparator:",",arrayRowSeparator:";",maxRows:4e4,maxColumns:18278,nullYear:30,nullDate:{year:1899,month:12,day:30},parseDateTime:s.defaultParseToDateTime,precisionEpsilon:1e-13,precisionRounding:10,smartRounding:!0,stringifyDateTime:u.defaultStringifyDateTime,stringifyDuration:u.defaultStringifyDuration,timeFormats:["hh:mm","hh:mm:ss.sss"],thousandSeparator:"",undoLimit:20,useRegularExpressions:!1,useWildcards:!0,useColumnIndex:!1,useStats:!1,useArrayArithmetic:!1}},function(e,t,r){"use strict";t.__esModule=!0,t.configCheckIfParametersNotInConflict=function(...e){const t=new Map;e.forEach((e=>{const r=t.get(e.value)||[];r.push(e.name),t.set(e.value,r)}));const r=[];for(const e of t.values())e.length>1&&r.push(e);if(r.length>0){r.forEach((e=>e.sort()));const e=r.map((e=>`[${e}]`)).join("; ");throw new Error(`Config initialization failed. Parameters in conflict: ${e}`)}},t.configValueFromParam=function(e,t,r){if(void 0===e)return n.Config.defaultConfig[r];if("string"==typeof t){if(typeof e===t)return e;throw new s.ExpectedValueOfTypeError(t,r)}if(t.includes(e))return e;throw new s.ExpectedOneOfValuesError(t.map((e=>`'${e}'`)).join(" "),r)},t.configValueFromParamCheck=function(e,t,r,o){if(t(e))return e;if(void 0===e)return n.Config.defaultConfig[o];throw new s.ExpectedValueOfTypeError(r,o)},t.validateArgToType=function(e,t,r){if(typeof e!==t)throw new s.ExpectedValueOfTypeError(t,r)},t.validateNumberToBeAtLeast=function(e,t,r){if(e<r)throw new s.ConfigValueTooSmallError(t,r)},t.validateNumberToBeAtMost=function(e,t,r){if(e>r)throw new s.ConfigValueTooBigError(t,r)},r(3),r(73),r(134),r(85);var n=r(195),s=r(167)},function(e,t,r){"use strict";t.__esModule=!0,t.TIME_FORMAT_SECONDS_ITEM_REGEXP=void 0,t.defaultParseToDateTime=function(e,t,r){if(void 0===t&&void 0===r)return;let n=e.replace(o," ").trim().toLowerCase();if(!function(e){return s.test(e)}(n))return;let u=n.substring(n.length-2);"am"===u||"pm"===u?n=n.substring(0,n.length-2).trim():(u=n.substring(n.length-1),"a"===u||"p"===u?n=n.substring(0,n.length-1).trim():u=void 0);const l=n.split(a);l.length>=2&&l[l.length-2].includes(i)&&(l[l.length-2]=l[l.length-2]+"."+l[l.length-1],l.pop());const c=l[l.length-1].split(i);void 0!==u&&c.push(u);if(1===l.length)return h(c,r);if(1===c.length)return d(l,t);const p=d(l.slice(0,l.length-1),t),m=h(c,r);return void 0===p||void 0===m?void 0:Object.assign(Object.assign({},p),m)},r(3);const n=t.TIME_FORMAT_SECONDS_ITEM_REGEXP=new RegExp("^ss(\\.(s+|0+))?$"),s=new RegExp("^[0-9/.\\-: ]+[ap]?m?$"),o=new RegExp("\\s+"),a=new RegExp("[ /.-]"),i=":",u=1e3,l=p((function(e){const t=e.toLowerCase().trim(),r=(t.endsWith("am/pm")?t.substring(0,t.length-5):t.endsWith("a/p")?t.substring(0,e.length-3):t).trim().split(i);return{itemsCount:r.length,hourItem:r.indexOf("hh"),minuteItem:r.indexOf("mm"),secondItem:r.findIndex((e=>n.test(e)))}})),c=p((function(e){const t=e.toLowerCase().trim().split(a);return{itemsCount:t.length,dayItem:t.indexOf("dd"),monthItem:t.indexOf("mm"),shortYearItem:t.indexOf("yy"),longYearItem:t.indexOf("yyyy")}}));function h(e,t){var r,n,s;if(void 0===t)return;const{itemsCount:o,hourItem:a,minuteItem:i,secondItem:c}=l(t);let h;if("am"===e[e.length-1]||"a"===e[e.length-1]?(h=!1,e.pop()):"pm"!==e[e.length-1]&&"p"!==e[e.length-1]||(h=!0,e.pop()),e.length!==o)return;const d=Number(null!==(r=e[c])&&void 0!==r?r:"0");if(!Number.isFinite(d))return;const p=Math.round(d*u)/u,m=Number(null!==(n=e[i])&&void 0!==n?n:"0");if(!Number.isFinite(m)||!Number.isInteger(m))return;const g=Number(null!==(s=e[a])&&void 0!==s?s:"0");if(!Number.isFinite(g)||!Number.isInteger(g))return;if(void 0!==h&&(g<0||g>12))return;return{hours:void 0!==h?g%12+(h?12:0):g,minutes:m,seconds:p}}function d(e,t){var r;if(void 0===t)return;const{itemsCount:n,dayItem:s,monthItem:o,shortYearItem:a,longYearItem:i}=c(t);if(e.length!==n)return;const u=Number(e[s]);if(!Number.isFinite(u)||!Number.isInteger(u))return;const l=Number(e[o]);if(!Number.isFinite(l)||!Number.isInteger(l))return;if(e[i]&&e[a])return;const h=Number(null!==(r=e[i])&&void 0!==r?r:e[a]);return Number.isFinite(h)&&Number.isInteger(h)&&!(e[i]&&(h<1e3||h>9999)||e[a]&&(h<0||h>99))?{year:h,month:l,day:u}:void 0}function p(e){const t={};return r=>{const n=t[r];if(void 0!==n)return n;const s=e(r);return t[r]=s,s}}},function(e,t,r){"use strict";t.__esModule=!0,t.DateTimeHelper=void 0,t.instanceOfSimpleDate=l,t.instanceOfSimpleTime=c,t.maxDate=void 0,t.numberToSimpleTime=d,t.offsetMonth=function(e,t){const r=12*e.year+e.month-1+t;return{year:Math.floor(r/12),month:r%12+1,day:e.day}},t.roundToNearestSecond=function(e){return Math.round(3600*e*24)/86400},t.timeToNumber=p,t.toBasisEU=function(e){return{year:e.year,month:e.month,day:Math.min(30,e.day)}},t.truncateDayInMonth=function(e){return{year:e.year,month:e.month,day:Math.min(e.day,s[e.month-1])}};var n=r(160);const s=[31,28,31,30,31,30,31,31,30,31,30,31],o=[0,31,59,90,120,151,181,212,243,273,304,334],a=60,i=60,u=24;function l(e){return!(!e||"object"!=typeof e&&"function"!=typeof e)&&("year"in e&&"number"==typeof e.year&&"month"in e&&"number"==typeof e.month&&"day"in e&&"number"==typeof e.day)}function c(e){return!(!e||"object"!=typeof e&&"function"!=typeof e)&&("hours"in e&&"number"==typeof e.hours&&"minutes"in e&&"number"==typeof e.minutes&&"seconds"in e&&"number"==typeof e.seconds)}const h=t.maxDate={year:9999,month:12,day:31};function d(e){const t=e*u*i*a,r=function(e,t=1){return Math.round(e*t)/t}(t%a,1e5)%a,n=(t-r)/a,s=Math.round(n%i)%i,o=(n-s)/i;return{hours:Math.round(o),minutes:s,seconds:r}}function p(e){return((e.seconds/60+e.minutes)/60+e.hours)/24}t.DateTimeHelper=class{constructor(e){this.config=e,this.minDateAbsoluteValue=this.dateToNumberFromZero(e.nullDate),this.maxDateValue=this.dateToNumber(h),this.leapYear1900=e.leapYear1900,!this.leapYear1900&&0<=this.dateToNumber({year:1900,month:2,day:28})?this.epochYearZero=this.numberToSimpleDate(2).year:this.epochYearZero=this.numberToSimpleDate(1).year,this.parseDateTime=e.parseDateTime}getWithinBounds(e){return e<=this.maxDateValue&&e>=0?e:void 0}dateStringToDateNumber(e){const{dateTime:t,dateFormat:r="",timeFormat:s=""}=this.parseDateTimeFromConfigFormats(e);if(void 0!==t)return c(t)?l(t)?new n.DateTimeNumber(p(t)+this.dateToNumber(t),r+" "+s):new n.TimeNumber(p(t),s):l(t)?new n.DateNumber(this.dateToNumber(t),r):0}parseDateTimeFromConfigFormats(e){return this.parseDateTimeFromFormats(e,this.config.dateFormats,this.config.timeFormats)}getNullYear(){return this.config.nullYear}getEpochYearZero(){return this.epochYearZero}isValidDate(e){return!(isNaN(e.year)||isNaN(e.month)||isNaN(e.day))&&(e.day===Math.round(e.day)&&e.month===Math.round(e.month)&&e.year===Math.round(e.year)&&(!(e.year<1582)&&(!(e.month<1||e.month>12)&&(!(e.day<1)&&(this.isLeapYear(e.year)&&2===e.month?e.day<=29:e.day<=s[e.month-1])))))}dateToNumber(e){return this.dateToNumberFromZero(e)-this.minDateAbsoluteValue}relativeNumberToAbsoluteNumber(e){return e+this.minDateAbsoluteValue-(this.leapYear1900?1:0)}numberToSimpleDate(e){const t=Math.floor(e)+this.minDateAbsoluteValue;let r=Math.floor(t/365.2425);this.dateToNumberFromZero({year:r+1,month:1,day:1})<=t?r++:this.dateToNumberFromZero({year:r-1,month:1,day:1})>t&&r--;const n=t-this.dateToNumberFromZero({year:r,month:1,day:1}),s=function(e){let t=0;o[t+6]<=e&&(t+=6);o[t+3]<=e&&(t+=3);o[t+2]<=e?t+=2:o[t+1]<=e&&(t+=1);return t}(n-(this.isLeapYear(r)&&n>=59?1:0));return{year:r,month:s+1,day:n-o[s]-(this.isLeapYear(r)&&s>1?1:0)+1}}numberToSimpleDateTime(e){const t=d(e%1),r=Math.floor(t.hours/u);t.hours=t.hours%u;const n=this.numberToSimpleDate(Math.floor(e)+r);return Object.assign(Object.assign({},n),t)}leapYearsCount(e){return Math.floor(e/4)-Math.floor(e/100)+Math.floor(e/400)+(this.config.leapYear1900&&e>=1900?1:0)}daysInMonth(e,t){return this.isLeapYear(e)&&2===t?29:s[t-1]}endOfMonth(e){return{year:e.year,month:e.month,day:this.daysInMonth(e.year,e.month)}}toBasisUS(e,t){return 31===e.day&&(e.day=30),30===e.day&&31===t.day&&(t.day=30),2===e.month&&e.day===this.daysInMonth(e.year,e.month)&&(e.day=30,2===t.month&&t.day===this.daysInMonth(t.year,t.month)&&(t.day=30)),[e,t]}yearLengthForBasis(e,t){return e.year!==t.year?e.year+1!==t.year||e.month<t.month||e.month===t.month&&e.day<t.day?(this.leapYearsCount(t.year)-this.leapYearsCount(e.year-1))/(t.year-e.year+1)+365:this.countLeapDays(t)!==this.countLeapDays({year:e.year,month:e.month,day:e.day-1})?366:365:this.isLeapYear(e.year)?366:365}parseSingleFormat(e,t,r){const n=this.parseDateTime(e,t,r);if(!l(n)||(n.year>=0&&n.year<100&&(n.year<this.getNullYear()?n.year+=2e3:n.year+=1900),this.isValidDate(n)))return n}parseDateTimeFromFormats(e,t,r){const n=0===t.length?[void 0]:t,s=0===r.length?[void 0]:r;for(const t of n)for(const r of s){const n=this.parseSingleFormat(e,t,r);if(void 0!==n)return{dateTime:n,timeFormat:r,dateFormat:t}}return{}}countLeapDays(e){return e.month>2||2===e.month&&e.day>=29?this.leapYearsCount(e.year):this.leapYearsCount(e.year-1)}dateToNumberFromZero(e){return 365*e.year+o[e.month-1]+e.day-1+(e.month<=2?this.leapYearsCount(e.year-1):this.leapYearsCount(e.year))}isLeapYear(e){return!(e%4)&&(!!(e%100)||(!(e%400)||1900===e&&this.config.leapYear1900))}}},function(e,t,r){"use strict";t.__esModule=!0,t.DenseSparseChooseBasedOnThreshold=t.AlwaysSparse=t.AlwaysDense=void 0;var n=r(186),s=r(185);t.DenseSparseChooseBasedOnThreshold=class{constructor(e){this.threshold=e}call(e){return e>this.threshold?n.DenseStrategy:s.SparseStrategy}};t.AlwaysSparse=class{call(){return s.SparseStrategy}};t.AlwaysDense=class{call(){return n.DenseStrategy}}},function(e,t,r){"use strict";t.__esModule=!0,t.defaultStringifyDateTime=function(e,t){const r=(0,o.parseForDateTimeFormat)(t);if(void 0===r)return;const s=r.tokens;let i="",u=!1;const l=s.some((e=>e.type===o.TokenType.FORMAT&&("a/p"===e.value||"A/P"===e.value||"am/pm"===e.value||"AM/PM"===e.value)));for(let t=0;t<s.length;t++){const r=s[t];if(r.type!==o.TokenType.FREE_TEXT)switch(r.value.toLowerCase()){case"h":case"hh":u=!0,i+=a(l?(e.hours+11)%12+1:e.hours,r.value.length);break;case"d":case"dd":i+=a(e.day,r.value.length);break;case"s":case"ss":i+=a(Math.floor(e.seconds),r.value.length);break;case"m":case"mm":t+1<s.length&&s[t+1].value.startsWith(":")&&(u=!0),i+=a(u?e.minutes:e.month,r.value.length),u=!0;break;case"yy":i+=a(e.year%100,r.value.length);break;case"yyyy":i+=e.year;break;case"am/pm":case"a/p":{const[t,n]=r.value.split("/");i+=e.hours<12?t:n;break}default:if(n.TIME_FORMAT_SECONDS_ITEM_REGEXP.test(r.value)){const t=r.value.length-3;i+=`${e.seconds<10?"0":""}${Math.floor(e.seconds*Math.pow(10,t))/Math.pow(10,t)}`;continue}return}else i+=r.value}return i},t.defaultStringifyDuration=function(e,t){const r=(0,o.parseForDateTimeFormat)(t);if(void 0===r)return;const s=r.tokens;let i="";for(const t of s)if(t.type!==o.TokenType.FREE_TEXT)switch(t.value.toLowerCase()){case"h":case"hh":i+=a(e.hours,t.value.length),e.hours=0;break;case"[hh]":i+=a(e.hours,t.value.length-2),e.hours=0;break;case"m":case"mm":i+=a(e.minutes,t.value.length),e.minutes=0;break;case"[mm]":i+=a(e.minutes+60*e.hours,t.value.length-2),e.minutes=0,e.hours=0;break;case"s":case"ss":i+=a(Math.floor(e.seconds),t.value.length);break;default:if(n.TIME_FORMAT_SECONDS_ITEM_REGEXP.test(t.value)){const r=Math.max(t.value.length-3,0);i+=`${e.seconds<10?"0":""}${Math.floor(e.seconds*Math.pow(10,r))/Math.pow(10,r)}`;continue}return}else i+=t.value;return i},t.format=function(e,t,r,n){const l=r.stringifyDateTime(n.numberToSimpleDateTime(e),t);if(void 0!==l)return l;const c=r.stringifyDuration((0,s.numberToSimpleTime)(e),t);if(void 0!==c)return c;const h=(0,o.parseForNumberFormat)(t);if(void 0!==h)return function(e,t){let r="";for(let n=0;n<e.length;++n){const s=e[n];if(s.type===o.TokenType.FREE_TEXT){r+=s.value;continue}const l=s.value.split("."),c=l[0],h=l[1]||"",d=l[1]?".":"",p=Number(t.toFixed(h.length)).toString().split(".");let m=p[0]||"",g=p[1]||"";if(c.length>m.length){m=a(m,u(c.substr(0,c.length-m.length),"0")+m.length)}g=i(g,u(h.substr(g.length,h.length-g.length),"0")+g.length),r+=m+d+g}return r}(h.tokens,e);return t},t.padLeft=a,t.padRight=i,r(73),r(148);var n=r(197),s=r(198),o=r(201);function a(e,t){let r=`${e}`;for(;r.length<t;)r="0"+r;return r}function i(e,t){let r=`${e}`;for(;r.length<t;)r+="0";return r}function u(e,t){return e.split(t).length-1}},function(e,t,r){"use strict";t.__esModule=!0,t.TokenType=t.FormatExpressionType=void 0,t.formatToken=i,t.isEscapeToken=h,t.parse=function(e){var t,r;return null!==(r=null!==(t=l(e))&&void 0!==t?t:c(e))&&void 0!==r?r:{type:a.STRING,tokens:[{type:o.FREE_TEXT,value:e}]}},t.parseForDateTimeFormat=l,t.parseForNumberFormat=c,r(3),r(73),r(190);const n=/(\\.|dd|DD|d|D|mm|MM|m|M|YYYY|YY|yyyy|yy|HH|hh|H|h|ss(\.(0+|s+))?|s|AM\/PM|am\/pm|A\/P|a\/p|\[mm]|\[MM]|\[hh]|\[HH])/g,s=/(\\.|[#0]+(\.[#0]*)?)/g;var o,a;function i(e,t){return{type:e,value:t}}function u(e,t){const r=[];let n=0;for(let s=0;s<e.length;++s){const a=e[s];if(a.index!==n){const e=t.substr(n,a.index-n);r.push(i(o.FREE_TEXT,e))}a[0].startsWith("\\")?r.push(i(o.FREE_TEXT,a[0])):r.push(i(o.FORMAT,a[0])),n=a.index+a[0].length}const s=e[e.length-1];if(s.index+s[0].length<t.length){const e=t.substr(s.index+s[0].length,t.length);r.push(i(o.FREE_TEXT,e))}return r}function l(e){const t=function(e){n.lastIndex=0;const t=[];let r;do{r=n.exec(e),null!==r&&t.push(r)}while(r);return t}(e);return t.every((e=>h(e)))?void 0:{type:a.DATE,tokens:u(t,e)}}function c(e){const t=function(e){s.lastIndex=0;const t=s.exec(e);return null!==t?[t]:[]}(e);return t.every((e=>h(e)))?void 0:{type:a.NUMBER,tokens:u(t,e)}}function h(e){return e[0].startsWith("\\")}!function(e){e.FORMAT="FORMAT",e.FREE_TEXT="FREE_TEXT"}(o||(t.TokenType=o={})),function(e){e.DATE="DATE",e.NUMBER="NUMBER",e.STRING="STRING"}(a||(t.FormatExpressionType=a={}))},function(e,t,r){"use strict";t.__esModule=!0,t.checkLicenseKeyValidity=function(e){const t={template:"missing",vars:{}};if("gpl-v3"===e||"internal-use-in-handsontable"===e)t.template="valid";else if("string"==typeof e&&(0,n.checkKeySchema)(e)){const[r,s,o]="14/01/2025".split("/"),a=Math.floor(new Date(`${s}/${r}/${o}`).getTime()/864e5),i=(0,n.extractTime)(e);t.vars.keyValidityDate=function(e){const t=["January","February","March","April","May","June","July","August","September","October","November","December"][e.getMonth()],r=e.getDate(),n=e.getFullYear();return`${t} ${r}, ${n}`}(new Date(864e5*(i+1))),t.template=a>i?"expired":"valid"}else""!==e&&(t.template="invalid");o||"valid"===t.template||(console.warn(s[t.template](t.vars)),o=!0);return t.template};var n=r(203);const s={invalid:()=>"The license key for HyperFormula is invalid.",expired:({keyValidityDate:e})=>`The license key for HyperFormula expired on ${e}, and is not valid for the installed version.`,missing:()=>"The license key for HyperFormula is missing."};let o=!1},function(e,t,r){"use strict";t.__esModule=!0,t.checkKeySchema=function(e){if((e=(e+"").replace(/\-/g,""))[n]!==u("Z"))return!1;let t=0;return[[0,u("G")+1],[u("H"),u("H")-1],[u("G")+u("H"),u("G")]].reduce(((r,[n,a],u)=>(r|=(o(`${o(s(i(e,t+n-(0===u?0:2),a+(u?2:0)))+(s(i(e,t+n+a,2))+[]).padStart(2,"0"))}`)%97||2)>>1,t+=2,r)),u("A"))===[]+1>>1},t.extractTime=function(e){return 25===a(e)[n]?s(i(a(e),s("12"),u("F")))/(s(i(a(e),u("C"),u("Y")>>4))||1+(![][n]<<3)):0},r(73),r(94);const n="length",s=e=>parseInt(e,16),o=e=>parseInt(e,10),a=e=>(e+"").replace(/\-/g,""),i=(e,t,r)=>e.substr(t,r),u=e=>e.codePointAt(0)-65},function(e,t,r){"use strict";t.__esModule=!0,t.HyperFormula=void 0,r(109),r(120),r(122),r(124),r(126),r(128),r(130),r(73),r(190),r(132),r(85);var n=r(105),s=r(196),o=r(205),a=r(106),i=r(206),u=r(195),l=r(198),c=r(237),h=r(238),d=r(167),p=r(178),m=r(224),g=r(210),E=r(137);class T{constructor(e,t,r,n,s,o,a,i,u,l,c,d,p,m){this._config=e,this._stats=t,this._dependencyGraph=r,this._columnSearch=n,this._parser=s,this._unparser=o,this._cellContentParser=a,this._evaluator=i,this._lazilyTransformingAstService=u,this._crudOperations=l,this._exporter=c,this._namedExpressions=d,this._serialization=p,this._functionRegistry=m,this._emitter=new h.Emitter,this._evaluationSuspended=!1}static get defaultConfig(){return(0,u.getDefaultConfig)()}get graph(){return this.dependencyGraph.graph}get rangeMapping(){return this.dependencyGraph.rangeMapping}get arrayMapping(){return this.dependencyGraph.arrayMapping}get sheetMapping(){return this.dependencyGraph.sheetMapping}get addressMapping(){return this.dependencyGraph.addressMapping}get dependencyGraph(){return this._dependencyGraph}get evaluator(){return this._evaluator}get columnSearch(){return this._columnSearch}get lazilyTransformingAstService(){return this._lazilyTransformingAstService}get licenseKeyValidityState(){return this._config.licenseKeyValidityState}static buildFromArray(e,t={},r=[]){return this.buildFromEngineState(o.BuildEngineFactory.buildFromSheet(e,t,r))}static buildFromSheets(e,t={},r=[]){return this.buildFromEngineState(o.BuildEngineFactory.buildFromSheets(e,t,r))}static buildEmpty(e={},t=[]){return this.buildFromEngineState(o.BuildEngineFactory.buildEmpty(e,t))}static getLanguage(e){(0,s.validateArgToType)(e,"string","languageCode");const t=this.registeredLanguages.get(e);if(void 0===t)throw new d.LanguageNotRegisteredError;return t}static registerLanguage(e,t){if((0,s.validateArgToType)(e,"string","languageCode"),this.registeredLanguages.has(e))throw new d.LanguageAlreadyRegisteredError;this.registeredLanguages.set(e,(0,p.buildTranslationPackage)(t))}static unregisterLanguage(e){if((0,s.validateArgToType)(e,"string","languageCode"),!this.registeredLanguages.has(e))throw new d.LanguageNotRegisteredError;this.registeredLanguages.delete(e)}static getRegisteredLanguagesCodes(){return Array.from(this.registeredLanguages.keys())}static registerFunctionPlugin(e,t){m.FunctionRegistry.registerFunctionPlugin(e,t)}static unregisterFunctionPlugin(e){m.FunctionRegistry.unregisterFunctionPlugin(e)}static registerFunction(e,t,r){(0,s.validateArgToType)(e,"string","functionId"),m.FunctionRegistry.registerFunction(e,t,r)}static unregisterFunction(e){(0,s.validateArgToType)(e,"string","functionId"),m.FunctionRegistry.unregisterFunction(e)}static unregisterAllFunctions(){m.FunctionRegistry.unregisterAll()}static getRegisteredFunctionNames(e){(0,s.validateArgToType)(e,"string","code");const t=m.FunctionRegistry.getRegisteredFunctionIds();return this.getLanguage(e).getFunctionTranslations(t)}static getFunctionPlugin(e){return(0,s.validateArgToType)(e,"string","functionId"),m.FunctionRegistry.getFunctionPlugin(e)}static getAllFunctionPlugins(){return m.FunctionRegistry.getPlugins()}static buildFromEngineState(e){return new T(e.config,e.stats,e.dependencyGraph,e.columnSearch,e.parser,e.unparser,e.cellContentParser,e.evaluator,e.lazilyTransformingAstService,e.crudOperations,e.exporter,e.namedExpressions,e.serialization,e.functionRegistry)}getCellValue(e){if(!(0,a.isSimpleCellAddress)(e))throw new d.ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");return this.ensureEvaluationIsNotSuspended(),this._serialization.getCellValue(e)}getCellFormula(e){if(!(0,a.isSimpleCellAddress)(e))throw new d.ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");return this._serialization.getCellFormula(e)}getCellHyperlink(e){if(!(0,a.isSimpleCellAddress)(e))throw new d.ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");return this.ensureEvaluationIsNotSuspended(),this._serialization.getCellHyperlink(e)}getCellSerialized(e){if(!(0,a.isSimpleCellAddress)(e))throw new d.ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");return this.ensureEvaluationIsNotSuspended(),this._serialization.getCellSerialized(e)}getSheetValues(e){return(0,s.validateArgToType)(e,"number","sheetId"),this.ensureEvaluationIsNotSuspended(),this._serialization.getSheetValues(e)}getSheetFormulas(e){return(0,s.validateArgToType)(e,"number","sheetId"),this._serialization.getSheetFormulas(e)}getSheetSerialized(e){return(0,s.validateArgToType)(e,"number","sheetId"),this.ensureEvaluationIsNotSuspended(),this._serialization.getSheetSerialized(e)}getAllSheetsDimensions(){return this._serialization.genericAllSheetsGetter((e=>this.getSheetDimensions(e)))}getSheetDimensions(e){return(0,s.validateArgToType)(e,"number","sheetId"),{width:this.dependencyGraph.getSheetWidth(e),height:this.dependencyGraph.getSheetHeight(e)}}getAllSheetsValues(){return this.ensureEvaluationIsNotSuspended(),this._serialization.getAllSheetsValues()}getAllSheetsFormulas(){return this._serialization.getAllSheetsFormulas()}getAllSheetsSerialized(){return this.ensureEvaluationIsNotSuspended(),this._serialization.getAllSheetsSerialized()}updateConfig(e){Object.entries(e).every((([e,t])=>this._config[e]===t))||this.rebuildWithConfig(e)}getConfig(){return this._config.getConfig()}rebuildAndRecalculate(){this.rebuildWithConfig({})}getStats(){return this._stats.snapshot()}undo(){return this._crudOperations.undo(),this.recomputeIfDependencyGraphNeedsIt()}redo(){return this._crudOperations.redo(),this.recomputeIfDependencyGraphNeedsIt()}isThereSomethingToUndo(){return this._crudOperations.isThereSomethingToUndo()}isThereSomethingToRedo(){return this._crudOperations.isThereSomethingToRedo()}isItPossibleToSetCellContents(e){let t;if((0,a.isSimpleCellAddress)(e))t=new n.AbsoluteCellRange(e,e);else{if(!(0,n.isSimpleCellRange)(e))throw new d.ExpectedValueOfTypeError("SimpleCellAddress | SimpleCellRange","address");t=new n.AbsoluteCellRange(e.start,e.end)}try{this._crudOperations.ensureRangeInSizeLimits(t);for(const e of t.addresses(this._dependencyGraph))this._crudOperations.ensureItIsPossibleToChangeContent(e)}catch(e){return!1}return!0}setCellContents(e,t){return this._crudOperations.setCellContents(e,t),this.recomputeIfDependencyGraphNeedsIt()}swapRowIndexes(e,t){return(0,s.validateArgToType)(e,"number","sheetId"),this._crudOperations.setRowOrder(e,t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToSwapRowIndexes(e,t){(0,s.validateArgToType)(e,"number","sheetId");try{return this._crudOperations.validateSwapRowIndexes(e,t),this._crudOperations.testRowOrderForArrays(e,t),!0}catch(e){return!1}}setRowOrder(e,t){(0,s.validateArgToType)(e,"number","sheetId");const r=this._crudOperations.mappingFromOrder(e,t,"row");return this.swapRowIndexes(e,r)}isItPossibleToSetRowOrder(e,t){(0,s.validateArgToType)(e,"number","sheetId");try{const r=this._crudOperations.mappingFromOrder(e,t,"row");return this._crudOperations.validateSwapRowIndexes(e,r),this._crudOperations.testRowOrderForArrays(e,r),!0}catch(e){return!1}}swapColumnIndexes(e,t){return(0,s.validateArgToType)(e,"number","sheetId"),this._crudOperations.setColumnOrder(e,t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToSwapColumnIndexes(e,t){(0,s.validateArgToType)(e,"number","sheetId");try{return this._crudOperations.validateSwapColumnIndexes(e,t),this._crudOperations.testColumnOrderForArrays(e,t),!0}catch(e){return!1}}setColumnOrder(e,t){(0,s.validateArgToType)(e,"number","sheetId");const r=this._crudOperations.mappingFromOrder(e,t,"column");return this.swapColumnIndexes(e,r)}isItPossibleToSetColumnOrder(e,t){(0,s.validateArgToType)(e,"number","sheetId");try{const r=this._crudOperations.mappingFromOrder(e,t,"column");return this._crudOperations.validateSwapColumnIndexes(e,r),this._crudOperations.testColumnOrderForArrays(e,r),!0}catch(e){return!1}}isItPossibleToAddRows(e,...t){(0,s.validateArgToType)(e,"number","sheetId");const r=(0,g.normalizeAddedIndexes)(t);try{return this._crudOperations.ensureItIsPossibleToAddRows(e,...r),!0}catch(e){return!1}}addRows(e,...t){return(0,s.validateArgToType)(e,"number","sheetId"),this._crudOperations.addRows(e,...t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToRemoveRows(e,...t){(0,s.validateArgToType)(e,"number","sheetId");const r=(0,g.normalizeRemovedIndexes)(t);try{return this._crudOperations.ensureItIsPossibleToRemoveRows(e,...r),!0}catch(e){return!1}}removeRows(e,...t){return(0,s.validateArgToType)(e,"number","sheetId"),this._crudOperations.removeRows(e,...t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToAddColumns(e,...t){(0,s.validateArgToType)(e,"number","sheetId");const r=(0,g.normalizeAddedIndexes)(t);try{return this._crudOperations.ensureItIsPossibleToAddColumns(e,...r),!0}catch(e){return!1}}addColumns(e,...t){return(0,s.validateArgToType)(e,"number","sheetId"),this._crudOperations.addColumns(e,...t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToRemoveColumns(e,...t){(0,s.validateArgToType)(e,"number","sheetId");const r=(0,g.normalizeRemovedIndexes)(t);try{return this._crudOperations.ensureItIsPossibleToRemoveColumns(e,...r),!0}catch(e){return!1}}removeColumns(e,...t){return(0,s.validateArgToType)(e,"number","sheetId"),this._crudOperations.removeColumns(e,...t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToMoveCells(e,t){if(!(0,a.isSimpleCellAddress)(t))throw new d.ExpectedValueOfTypeError("SimpleCellAddress","destinationLeftCorner");if(!(0,n.isSimpleCellRange)(e))throw new d.ExpectedValueOfTypeError("SimpleCellRange","source");try{const r=new n.AbsoluteCellRange(e.start,e.end);return this._crudOperations.operations.ensureItIsPossibleToMoveCells(r.start,r.width(),r.height(),t),!0}catch(e){return!1}}moveCells(e,t){if(!(0,a.isSimpleCellAddress)(t))throw new d.ExpectedValueOfTypeError("SimpleCellAddress","destinationLeftCorner");if(!(0,n.isSimpleCellRange)(e))throw new d.ExpectedValueOfTypeError("SimpleCellRange","source");const r=new n.AbsoluteCellRange(e.start,e.end);return this._crudOperations.moveCells(r.start,r.width(),r.height(),t),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToMoveRows(e,t,r,n){(0,s.validateArgToType)(e,"number","sheetId"),(0,s.validateArgToType)(t,"number","startRow"),(0,s.validateArgToType)(r,"number","numberOfRows"),(0,s.validateArgToType)(n,"number","targetRow");try{return this._crudOperations.ensureItIsPossibleToMoveRows(e,t,r,n),!0}catch(e){return!1}}moveRows(e,t,r,n){return(0,s.validateArgToType)(e,"number","sheetId"),(0,s.validateArgToType)(t,"number","startRow"),(0,s.validateArgToType)(r,"number","numberOfRows"),(0,s.validateArgToType)(n,"number","targetRow"),this._crudOperations.moveRows(e,t,r,n),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToMoveColumns(e,t,r,n){(0,s.validateArgToType)(e,"number","sheetId"),(0,s.validateArgToType)(t,"number","startColumn"),(0,s.validateArgToType)(r,"number","numberOfColumns"),(0,s.validateArgToType)(n,"number","targetColumn");try{return this._crudOperations.ensureItIsPossibleToMoveColumns(e,t,r,n),!0}catch(e){return!1}}moveColumns(e,t,r,n){return(0,s.validateArgToType)(e,"number","sheetId"),(0,s.validateArgToType)(t,"number","startColumn"),(0,s.validateArgToType)(r,"number","numberOfColumns"),(0,s.validateArgToType)(n,"number","targetColumn"),this._crudOperations.moveColumns(e,t,r,n),this.recomputeIfDependencyGraphNeedsIt()}copy(e){if(!(0,n.isSimpleCellRange)(e))throw new d.ExpectedValueOfTypeError("SimpleCellRange","source");const t=new n.AbsoluteCellRange(e.start,e.end);return this._crudOperations.copy(t.start,t.width(),t.height()),this.getRangeValues(e)}cut(e){if(!(0,n.isSimpleCellRange)(e))throw new d.ExpectedValueOfTypeError("SimpleCellRange","source");const t=new n.AbsoluteCellRange(e.start,e.end);return this._crudOperations.cut(t.start,t.width(),t.height()),this.getRangeValues(e)}paste(e){if(!(0,a.isSimpleCellAddress)(e))throw new d.ExpectedValueOfTypeError("SimpleCellAddress","targetLeftCorner");return this.ensureEvaluationIsNotSuspended(),this._crudOperations.paste(e),this.recomputeIfDependencyGraphNeedsIt()}isClipboardEmpty(){return this._crudOperations.isClipboardEmpty()}clearClipboard(){this._crudOperations.clearClipboard()}clearRedoStack(){this._crudOperations.undoRedo.clearRedoStack()}clearUndoStack(){this._crudOperations.undoRedo.clearUndoStack()}getRangeValues(e){if(!(0,n.isSimpleCellRange)(e))throw new d.ExpectedValueOfTypeError("SimpleCellRange","source");return new n.AbsoluteCellRange(e.start,e.end).arrayOfAddressesInRange().map((e=>e.map((e=>this.getCellValue(e)))))}getRangeFormulas(e){if(!(0,n.isSimpleCellRange)(e))throw new d.ExpectedValueOfTypeError("SimpleCellRange","source");return new n.AbsoluteCellRange(e.start,e.end).arrayOfAddressesInRange().map((e=>e.map((e=>this.getCellFormula(e)))))}getRangeSerialized(e){if(!(0,n.isSimpleCellRange)(e))throw new d.ExpectedValueOfTypeError("SimpleCellRange","source");return new n.AbsoluteCellRange(e.start,e.end).arrayOfAddressesInRange().map((e=>e.map((e=>this.getCellSerialized(e)))))}getFillRangeData(e,t,r=!1){if(!(0,n.isSimpleCellRange)(e))throw new d.ExpectedValueOfTypeError("SimpleCellRange","source");if(!(0,n.isSimpleCellRange)(t))throw new d.ExpectedValueOfTypeError("SimpleCellRange","target");const s=new n.AbsoluteCellRange(e.start,e.end),o=new n.AbsoluteCellRange(t.start,t.end);return this.ensureEvaluationIsNotSuspended(),o.arrayOfAddressesInRange().map((n=>n.map((n=>{const o=((n.row-(r?t:e).start.row)%s.height()+s.height())%s.height()+e.start.row,a=((n.col-(r?t:e).start.col)%s.width()+s.width())%s.width()+e.start.col;return this._serialization.getCellSerialized({row:o,col:a,sheet:s.sheet},n)}))))}isItPossibleToAddSheet(e){(0,s.validateArgToType)(e,"string","sheetName");try{return this._crudOperations.ensureItIsPossibleToAddSheet(e),!0}catch(e){return!1}}addSheet(e){void 0!==e&&(0,s.validateArgToType)(e,"string","sheetName");const t=this._crudOperations.addSheet(e);return this._emitter.emit(h.Events.SheetAdded,t),t}isItPossibleToRemoveSheet(e){(0,s.validateArgToType)(e,"number","sheetId");try{return this._crudOperations.ensureScopeIdIsValid(e),!0}catch(e){return!1}}removeSheet(e){(0,s.validateArgToType)(e,"number","sheetId");const t=this.sheetMapping.getDisplayName(e);this._crudOperations.removeSheet(e);const r=this.recomputeIfDependencyGraphNeedsIt();return this._emitter.emit(h.Events.SheetRemoved,t,r),r}isItPossibleToClearSheet(e){(0,s.validateArgToType)(e,"number","sheetId");try{return this._crudOperations.ensureScopeIdIsValid(e),!0}catch(e){return!1}}clearSheet(e){return(0,s.validateArgToType)(e,"number","sheetId"),this._crudOperations.clearSheet(e),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToReplaceSheetContent(e,t){(0,s.validateArgToType)(e,"number","sheetId");try{return this._crudOperations.ensureScopeIdIsValid(e),this._crudOperations.ensureItIsPossibleToChangeSheetContents(e,t),!0}catch(e){return!1}}setSheetContent(e,t){return(0,s.validateArgToType)(e,"number","sheetId"),this._crudOperations.setSheetContent(e,t),this.recomputeIfDependencyGraphNeedsIt()}simpleCellAddressFromString(e,t){return(0,s.validateArgToType)(e,"string","cellAddress"),(0,s.validateArgToType)(t,"number","sheetId"),(0,E.simpleCellAddressFromString)(this.sheetMapping.get,e,t)}simpleCellRangeFromString(e,t){return(0,s.validateArgToType)(e,"string","cellRange"),(0,s.validateArgToType)(t,"number","sheetId"),(0,E.simpleCellRangeFromString)(this.sheetMapping.get,e,t)}simpleCellAddressToString(e,t={}){if(!(0,a.isSimpleCellAddress)(e))throw new d.ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");const r="number"==typeof t?t:t.includeSheetName?e.sheet+1:e.sheet;return(0,E.simpleCellAddressToString)(this.sheetMapping.fetchDisplayName,e,r)}simpleCellRangeToString(e,t={}){if(!(0,n.isSimpleCellRange)(e))throw new d.ExpectedValueOfTypeError("SimpleCellRange","cellRange");const r="number"==typeof t?t:t.includeSheetName?e.start.sheet+e.end.sheet+1:e.start.sheet;return(0,E.simpleCellRangeToString)(this.sheetMapping.fetchDisplayName,e,r)}getCellDependents(e){let t;if((0,a.isSimpleCellAddress)(e))t=this._dependencyGraph.addressMapping.getCell(e);else{if(!(0,n.isSimpleCellRange)(e))throw new d.ExpectedValueOfTypeError("SimpleCellAddress | SimpleCellRange",e);t=this._dependencyGraph.rangeMapping.getRange(e.start,e.end)}return void 0===t?[]:this._dependencyGraph.getAdjacentNodesAddresses(t)}getCellPrecedents(e){let t;if((0,a.isSimpleCellAddress)(e))t=this._dependencyGraph.addressMapping.getCell(e);else{if(!(0,n.isSimpleCellRange)(e))throw new d.ExpectedValueOfTypeError("SimpleCellAddress | SimpleCellRange",e);t=this._dependencyGraph.rangeMapping.getRange(e.start,e.end)}return void 0===t?[]:this._dependencyGraph.dependencyQueryAddresses(t)}getSheetName(e){return(0,s.validateArgToType)(e,"number","sheetId"),this.sheetMapping.getDisplayName(e)}getSheetNames(){return this.sheetMapping.sheetNames()}getSheetId(e){return(0,s.validateArgToType)(e,"string","sheetName"),this.sheetMapping.get(e)}doesSheetExist(e){return(0,s.validateArgToType)(e,"string","sheetName"),this.sheetMapping.hasSheetWithName(e)}getCellType(e){if(!(0,a.isSimpleCellAddress)(e))throw new d.ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");const t=this.dependencyGraph.getCell(e);return(0,a.getCellType)(t,e)}doesCellHaveSimpleValue(e){if(!(0,a.isSimpleCellAddress)(e))throw new d.ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");return this.getCellType(e)===a.CellType.VALUE}doesCellHaveFormula(e){if(!(0,a.isSimpleCellAddress)(e))throw new d.ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");const t=this.getCellType(e);return t===a.CellType.FORMULA||t===a.CellType.ARRAYFORMULA}isCellEmpty(e){if(!(0,a.isSimpleCellAddress)(e))throw new d.ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");return this.getCellType(e)===a.CellType.EMPTY}isCellPartOfArray(e){if(!(0,a.isSimpleCellAddress)(e))throw new d.ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");const t=this.getCellType(e);return t===a.CellType.ARRAY||t===a.CellType.ARRAYFORMULA}getCellValueType(e){if(!(0,a.isSimpleCellAddress)(e))throw new d.ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");this.ensureEvaluationIsNotSuspended();const t=this.dependencyGraph.getCellValue(e);return(0,a.getCellValueType)(t)}getCellValueDetailedType(e){if(!(0,a.isSimpleCellAddress)(e))throw new d.ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");this.ensureEvaluationIsNotSuspended();const t=this.dependencyGraph.getCellValue(e);return(0,a.getCellValueDetailedType)(t)}getCellValueFormat(e){if(!(0,a.isSimpleCellAddress)(e))throw new d.ExpectedValueOfTypeError("SimpleCellAddress","cellAddress");this.ensureEvaluationIsNotSuspended();const t=this.dependencyGraph.getCellValue(e);return(0,a.getCellValueFormat)(t)}countSheets(){return this.sheetMapping.numberOfSheets()}isItPossibleToRenameSheet(e,t){(0,s.validateArgToType)(e,"number","sheetId"),(0,s.validateArgToType)(t,"string","newName");try{return this._crudOperations.ensureItIsPossibleToRenameSheet(e,t),!0}catch(e){return!1}}renameSheet(e,t){(0,s.validateArgToType)(e,"number","sheetId"),(0,s.validateArgToType)(t,"string","newName");const r=this._crudOperations.renameSheet(e,t);void 0!==r&&this._emitter.emit(h.Events.SheetRenamed,r,t)}batch(e){this.suspendEvaluation(),this._crudOperations.beginUndoRedoBatchMode();try{e()}catch(e){throw this._crudOperations.commitUndoRedoBatchMode(),this.resumeEvaluation(),e}return this._crudOperations.commitUndoRedoBatchMode(),this.resumeEvaluation()}suspendEvaluation(){this._evaluationSuspended=!0,this._emitter.emit(h.Events.EvaluationSuspended)}resumeEvaluation(){this._evaluationSuspended=!1;const e=this.recomputeIfDependencyGraphNeedsIt();return this._emitter.emit(h.Events.EvaluationResumed,e),e}isEvaluationSuspended(){return this._evaluationSuspended}isItPossibleToAddNamedExpression(e,t,r){(0,s.validateArgToType)(e,"string","expressionName"),void 0!==r&&(0,s.validateArgToType)(r,"number","scope");try{return this._crudOperations.ensureItIsPossibleToAddNamedExpression(e,t,r),!0}catch(e){return!1}}addNamedExpression(e,t,r,n){(0,s.validateArgToType)(e,"string","expressionName"),void 0!==r&&(0,s.validateArgToType)(r,"number","scope"),this._crudOperations.addNamedExpression(e,t,r,n);const o=this.recomputeIfDependencyGraphNeedsIt();return this._emitter.emit(h.Events.NamedExpressionAdded,e,o),o}getNamedExpressionValue(e,t){(0,s.validateArgToType)(e,"string","expressionName"),void 0!==t&&(0,s.validateArgToType)(t,"number","scope"),this.ensureEvaluationIsNotSuspended(),this._crudOperations.ensureScopeIdIsValid(t);const r=this._namedExpressions.namedExpressionForScope(e,t);return r?this._serialization.getCellValue(r.address):void 0}getNamedExpressionFormula(e,t){(0,s.validateArgToType)(e,"string","expressionName"),void 0!==t&&(0,s.validateArgToType)(t,"number","scope"),this._crudOperations.ensureScopeIdIsValid(t);const r=this._namedExpressions.namedExpressionForScope(e,t);return void 0===r?void 0:this._serialization.getCellFormula(r.address)}getNamedExpression(e,t){(0,s.validateArgToType)(e,"string","expressionName"),void 0!==t&&(0,s.validateArgToType)(t,"number","scope");const r=this._namedExpressions.namedExpressionForScope(e,t);if(void 0===r)return;return{name:e,scope:t,expression:this._serialization.getCellFormula(r.address),options:r.options}}isItPossibleToChangeNamedExpression(e,t,r){(0,s.validateArgToType)(e,"string","expressionName"),void 0!==r&&(0,s.validateArgToType)(r,"number","scope");try{return this._crudOperations.ensureItIsPossibleToChangeNamedExpression(e,t,r),!0}catch(e){return!1}}changeNamedExpression(e,t,r,n){return(0,s.validateArgToType)(e,"string","expressionName"),void 0!==r&&(0,s.validateArgToType)(r,"number","scope"),this._crudOperations.changeNamedExpressionExpression(e,r,t,n),this.recomputeIfDependencyGraphNeedsIt()}isItPossibleToRemoveNamedExpression(e,t){(0,s.validateArgToType)(e,"string","expressionName"),void 0!==t&&(0,s.validateArgToType)(t,"number","scope");try{return this._crudOperations.isItPossibleToRemoveNamedExpression(e,t),!0}catch(e){return!1}}removeNamedExpression(e,t){(0,s.validateArgToType)(e,"string","expressionName"),void 0!==t&&(0,s.validateArgToType)(t,"number","scope");const r=this._crudOperations.removeNamedExpression(e,t);if(r){const e=this.recomputeIfDependencyGraphNeedsIt();return this._emitter.emit(h.Events.NamedExpressionRemoved,r.displayName,e),e}return[]}listNamedExpressions(e){return void 0!==e&&(0,s.validateArgToType)(e,"number","scope"),this._crudOperations.ensureScopeIdIsValid(e),this._namedExpressions.getAllNamedExpressionsNamesInScope(e)}getAllNamedExpressionsSerialized(){return this._serialization.getAllNamedExpressionsSerialized()}normalizeFormula(e){(0,s.validateArgToType)(e,"string","formulaString");const{ast:t,address:r}=this.extractTemporaryFormula(e);if(void 0===t)throw new d.NotAFormulaError;return this._unparser.unparse(t,r)}calculateFormula(e,t){(0,s.validateArgToType)(e,"string","formulaString"),(0,s.validateArgToType)(t,"number","sheetId"),this._crudOperations.ensureScopeIdIsValid(t);const{ast:r,address:n,dependencies:o}=this.extractTemporaryFormula(e,t);if(void 0===r)throw new d.NotAFormulaError;const a=this.evaluator.runAndForget(r,n,o);return this._exporter.exportScalarOrRange(a)}getNamedExpressionsFromFormula(e){(0,s.validateArgToType)(e,"string","formulaString");const{ast:t,dependencies:r}=this.extractTemporaryFormula(e);if(void 0===t)throw new d.NotAFormulaError;const n=r.filter((e=>e instanceof E.NamedExpressionDependency)).map((e=>e.name));return[...new Set(n)]}validateFormula(e){(0,s.validateArgToType)(e,"string","formulaString");const{ast:t}=this.extractTemporaryFormula(e);return void 0!==t}getRegisteredFunctionNames(){return T.getLanguage(this._config.language).getFunctionTranslations(this._functionRegistry.getRegisteredFunctionIds())}getFunctionPlugin(e){return(0,s.validateArgToType)(e,"string","functionId"),this._functionRegistry.getFunctionPlugin(e)}getAllFunctionPlugins(){return this._functionRegistry.getPlugins()}numberToDateTime(e){return(0,s.validateArgToType)(e,"number","val"),this._evaluator.interpreter.dateTimeHelper.numberToSimpleDateTime(e)}numberToDate(e){return(0,s.validateArgToType)(e,"number","val"),this._evaluator.interpreter.dateTimeHelper.numberToSimpleDate(e)}numberToTime(e){return(0,s.validateArgToType)(e,"number","val"),(0,l.numberToSimpleTime)(e)}on(e,t){this._emitter.on(e,t)}once(e,t){this._emitter.once(e,t)}off(e,t){this._emitter.off(e,t)}destroy(){(0,c.objectDestroy)(this)}ensureEvaluationIsNotSuspended(){if(this._evaluationSuspended)throw new d.EvaluationSuspendedError}extractTemporaryFormula(e,t=1){const r=this._cellContentParser.parse(e),n={sheet:t,col:0,row:0};if(!(r instanceof i.CellContent.Formula))return{address:n,dependencies:[]};const{ast:s,errors:o,dependencies:a}=this._parser.parse(r.formula,n);return o.length>0?{address:n,dependencies:[]}:{ast:s,address:n,dependencies:a}}rebuildWithConfig(e){const t=this._config.mergeConfig(e),r=this._config.mergeConfig({language:e.language}),n=this._serialization.withNewConfig(r,this._namedExpressions).getAllSheetsSerialized(),s=this._serialization.getAllNamedExpressionsSerialized(),a=o.BuildEngineFactory.rebuildWithConfig(t,n,s,this._stats);this._config=a.config,this._stats=a.stats,this._dependencyGraph=a.dependencyGraph,this._columnSearch=a.columnSearch,this._parser=a.parser,this._unparser=a.unparser,this._cellContentParser=a.cellContentParser,this._evaluator=a.evaluator,this._lazilyTransformingAstService=a.lazilyTransformingAstService,this._crudOperations=a.crudOperations,this._exporter=a.exporter,this._namedExpressions=a.namedExpressions,this._serialization=a.serialization,this._functionRegistry=a.functionRegistry}recomputeIfDependencyGraphNeedsIt(){if(this._evaluationSuspended)return[];{const e=this._crudOperations.getAndClearContentChanges(),t=this.dependencyGraph.verticesToRecompute();this.dependencyGraph.clearDirtyVertices(),t.length>0&&e.addAll(this.evaluator.partialRun(t));const r=e.exportChanges(this._exporter);return e.isEmpty()||this._emitter.emit(h.Events.ValuesUpdated,r),r}}}t.HyperFormula=T,T.version="3.0.0",T.buildDate="14/01/2025 11:44:29",T.releaseDate="14/01/2025",T.languages={},T.registeredLanguages=new Map},function(e,t,r){"use strict";t.__esModule=!0,t.BuildEngineFactory=void 0,r(73),r(134);var n=r(2),s=r(206),o=r(207),a=r(195),i=r(208),u=r(198),l=r(107),c=r(167),h=r(221),d=r(222),p=r(223),m=r(178),g=r(192),E=r(224),T=r(226),y=r(228),f=r(230),A=r(209),R=r(235),N=r(210),S=r(137),C=r(236),v=r(219),M=r(162),w=r(220);t.BuildEngineFactory=class{static buildFromSheets(e,t={},r=[]){const n=new a.Config(t);return this.buildEngine(n,e,r)}static buildFromSheet(e,t={},r=[]){const n=new a.Config(t),s=n.translationPackage.getUITranslation(m.UIElement.NEW_SHEET_PREFIX)+"1";return this.buildEngine(n,{[s]:e},r)}static buildEmpty(e={},t=[]){return this.buildEngine(new a.Config(e),{},t)}static rebuildWithConfig(e,t,r,n){return this.buildEngine(e,t,r,n)}static buildEngine(e,t={},r=[],a=(e.useStats?new M.Statistics:new M.EmptyStatistics)){a.start(M.StatType.BUILD_ENGINE_TOTAL);const m=new A.NamedExpressions,F=new E.FunctionRegistry(e),O=new y.LazilyTransformingAstService(a),I=l.DependencyGraph.buildEmpty(O,e,F,m,a),b=(0,f.buildColumnSearchStrategy)(I,e,a),x=I.sheetMapping,V=I.addressMapping;for(const r in t)if(Object.prototype.hasOwnProperty.call(t,r)){const n=t[r];(0,v.validateAsSheet)(n);const s=(0,v.findBoundaries)(n);if(s.height>e.maxRows||s.width>e.maxColumns)throw new c.SheetSizeLimitExceededError;const o=x.addSheet(r);V.autoAddSheet(o,s)}const U=new S.ParserWithCaching(e,F,x.get);O.parser=U;const _=new S.Unparser(e,(0,S.buildLexerConfig)(e),x.fetchDisplayName,m),P=new u.DateTimeHelper(e),L=new R.NumberLiteralHelper(e),D=new g.ArithmeticHelper(e,P,L),B=new s.CellContentParser(e,P,L),G=new n.ArraySizePredictor(e,F),H=new N.Operations(e,I,b,B,U,a,O,m,G),W=new w.UndoRedo(e,H);O.undoRedo=W;const k=new o.ClipboardOperations(e,I,H),z=new i.CrudOperations(e,H,W,k,I,b,U,B,O,m);r.forEach((e=>{z.ensureItIsPossibleToAddNamedExpression(e.name,e.expression,e.scope),z.operations.addNamedExpression(e.name,e.expression,e.scope,e.options)}));const Y=new d.Exporter(e,m,x.fetchDisplayName,O),$=new C.Serialization(I,_,Y),X=new T.Interpreter(e,I,b,a,D,F,m,$,G,P);a.measure(M.StatType.GRAPH_BUILD,(()=>{new p.GraphBuilder(I,b,U,B,a,G).buildGraph(t,a)}));const j=new h.Evaluator(e,a,X,O,I,b);return j.run(),a.end(M.StatType.BUILD_ENGINE_TOTAL),{config:e,stats:a,dependencyGraph:I,columnSearch:b,parser:U,unparser:_,cellContentParser:B,evaluator:j,lazilyTransformingAstService:O,crudOperations:z,exporter:Y,namedExpressions:m,serialization:$,functionRegistry:F}}}},function(e,t,r){"use strict";t.__esModule=!0,t.CellContentParser=t.CellContent=void 0,t.isBoolean=h,t.isError=d,t.isFormula=c;var n,s=r(106),o=r(198),a=r(151),i=r(167),u=r(192),l=r(160);function c(e){return e.startsWith("=")}function h(e){const t=e.toLowerCase();return"true"===t||"false"===t}function d(e,t){const r=e.toUpperCase();return/#[A-Za-z0-9\/]+[?!]?/.test(r)&&Object.prototype.hasOwnProperty.call(t,r)}!function(e){e.Number=class{constructor(e){this.value=e,this.value=(0,l.cloneNumber)(this.value,(0,u.fixNegativeZero)((0,l.getRawValue)(this.value)))}};e.String=class{constructor(e){this.value=e}};e.Boolean=class{constructor(e){this.value=e}};class t{static getSingletonInstance(){return t.instance||(t.instance=new t),t.instance}}e.Empty=t;e.Formula=class{constructor(e){this.formula=e}};e.Error=class{constructor(e,t){this.value=new s.CellError(e,t)}}}(n||(t.CellContent=n={}));t.CellContentParser=class{constructor(e,t,r){this.config=e,this.dateHelper=t,this.numberLiteralsHelper=r}parse(e){if(null==e)return n.Empty.getSingletonInstance();if("number"==typeof e)return(0,u.isNumberOverflow)(e)?new n.Error(s.ErrorType.NUM,a.ErrorMessage.ValueLarge):new n.Number(e);if("boolean"==typeof e)return new n.Boolean(e);if(e instanceof Date){const t=this.dateHelper.dateToNumber({day:e.getDate(),month:e.getMonth()+1,year:e.getFullYear()})+(0,o.timeToNumber)({hours:e.getHours(),minutes:e.getMinutes(),seconds:e.getSeconds()+e.getMilliseconds()/1e3});return t<0?new n.Error(s.ErrorType.NUM,a.ErrorMessage.DateBounds):t%1==0?new n.Number(new l.DateNumber(t,"Date()")):t<1?new n.Number(new l.TimeNumber(t,"Date()")):new n.Number(new l.DateTimeNumber(t,"Date()"))}if("string"==typeof e){if(h(e))return new n.Boolean("true"===e.toLowerCase());if(c(e))return new n.Formula(e);if(d(e,this.config.errorMapping))return new n.Error(this.config.errorMapping[e.toUpperCase()]);{let t,r=e.trim(),s=0;if(r.endsWith("%"))s=1,r=r.slice(0,r.length-1);else{const e=this.currencyMatcher(r);void 0!==e&&(s=2,[t,r]=e)}const o=this.numberLiteralsHelper.numericStringToMaybeNumber(r);if(void 0!==o){let e;return e=1===s?new l.PercentNumber(o/100):2===s?new l.CurrencyNumber(o,t):o,new n.Number(e)}const a=this.dateHelper.dateStringToDateNumber(r);return void 0!==a?new n.Number(a):new n.String(e.startsWith("'")?e.slice(1):e)}}throw new i.UnableToParseError(e)}currencyMatcher(e){for(const t of this.config.currencySymbol){if(e.startsWith(t))return[t,e.slice(t.length)];if(e.endsWith(t))return[t,e.slice(0,e.length-t.length)]}}}},function(e,t,r){"use strict";t.__esModule=!0,t.ClipboardOperations=t.ClipboardCellType=void 0,r(3);var n,s,o=r(105),a=r(106),i=r(167);!function(e){e[e.COPY=0]="COPY",e[e.CUT=1]="CUT"}(n||(n={})),function(e){e[e.VALUE=0]="VALUE",e[e.EMPTY=1]="EMPTY",e[e.FORMULA=2]="FORMULA",e[e.PARSING_ERROR=3]="PARSING_ERROR"}(s||(t.ClipboardCellType=s={}));class u{constructor(e,t,r,n,s){this.sourceLeftCorner=e,this.width=t,this.height=r,this.type=n,this.content=s}*getContent(e){if(void 0!==this.content)for(let t=0;t<this.height;++t)for(let r=0;r<this.width;++r)yield[(0,a.simpleCellAddress)(e.sheet,e.col+r,e.row+t),this.content[t][r]]}}t.ClipboardOperations=class{constructor(e,t,r){this.dependencyGraph=t,this.operations=r,this.maxRows=e.maxRows,this.maxColumns=e.maxColumns}cut(e,t,r){this.clipboard=new u(e,t,r,n.CUT)}copy(e,t,r){const s=[];for(let n=0;n<r;++n){s[n]=[];for(let r=0;r<t;++r){const t=this.operations.getClipboardCell((0,a.simpleCellAddress)(e.sheet,e.col+r,e.row+n));s[n].push(t)}}this.clipboard=new u(e,t,r,n.COPY,s)}abortCut(){this.clipboard&&this.clipboard.type===n.CUT&&this.clear()}clear(){this.clipboard=void 0}ensureItIsPossibleToCopyPaste(e){if(void 0===this.clipboard)return;if((0,a.invalidSimpleCellAddress)(e)||!this.dependencyGraph.sheetMapping.hasSheetWithId(e.sheet))throw new i.InvalidArgumentsError("a valid target address.");const t=o.AbsoluteCellRange.spanFrom(e,this.clipboard.width,this.clipboard.height);if(t.exceedsSheetSizeLimits(this.maxColumns,this.maxRows))throw new i.SheetSizeLimitExceededError;if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(t))throw new Error("It is not possible to paste onto an array")}isCutClipboard(){return void 0!==this.clipboard&&this.clipboard.type===n.CUT}isCopyClipboard(){return void 0!==this.clipboard&&this.clipboard.type===n.COPY}}},function(e,t,r){"use strict";t.__esModule=!0,t.CrudOperations=void 0,r(3),r(73),r(85),r(94);var n=r(105),s=r(106),o=r(206),a=r(167),i=r(209),u=r(210),l=r(219),c=r(161),h=r(220);function d(e){return Number.isInteger(e)&&e>0}function p(e){return Number.isInteger(e)&&e>=0}t.CrudOperations=class{constructor(e,t,r,n,s,o,a,i,u,l){this.operations=t,this.undoRedo=r,this.clipboardOperations=n,this.dependencyGraph=s,this.columnSearch=o,this.parser=a,this.cellContentParser=i,this.lazilyTransformingAstService=u,this.namedExpressions=l,this.maxRows=e.maxRows,this.maxColumns=e.maxColumns}get sheetMapping(){return this.dependencyGraph.sheetMapping}addRows(e,...t){const r=new u.AddRowsCommand(e,t);this.ensureItIsPossibleToAddRows(e,...t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.operations.addRows(r),this.undoRedo.saveOperation(new h.AddRowsUndoEntry(r))}removeRows(e,...t){const r=new u.RemoveRowsCommand(e,t);this.ensureItIsPossibleToRemoveRows(e,...t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const n=this.operations.removeRows(r);this.undoRedo.saveOperation(new h.RemoveRowsUndoEntry(r,n))}addColumns(e,...t){const r=new u.AddColumnsCommand(e,t);this.ensureItIsPossibleToAddColumns(e,...t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.operations.addColumns(r),this.undoRedo.saveOperation(new h.AddColumnsUndoEntry(r))}removeColumns(e,...t){const r=new u.RemoveColumnsCommand(e,t);this.ensureItIsPossibleToRemoveColumns(e,...t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const n=this.operations.removeColumns(r);this.undoRedo.saveOperation(new h.RemoveColumnsUndoEntry(r,n))}moveCells(e,t,r,n){this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const{version:s,overwrittenCellsData:o,addedGlobalNamedExpressions:a}=this.operations.moveCells(e,t,r,n);this.undoRedo.saveOperation(new h.MoveCellsUndoEntry(e,t,r,n,o,a,s))}moveRows(e,t,r,n){this.ensureItIsPossibleToMoveRows(e,t,r,n),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const s=this.operations.moveRows(e,t,r,n);this.undoRedo.saveOperation(new h.MoveRowsUndoEntry(e,t,r,n,s))}moveColumns(e,t,r,n){this.ensureItIsPossibleToMoveColumns(e,t,r,n),this.undoRedo.clearRedoStack();const s=this.operations.moveColumns(e,t,r,n);this.undoRedo.saveOperation(new h.MoveColumnsUndoEntry(e,t,r,n,s))}cut(e,t,r){this.clipboardOperations.cut(e,t,r)}ensureItIsPossibleToCopy(e,t,r){if(!d(t))throw new a.InvalidArgumentsError("width to be positive integer.");if(!d(r))throw new a.InvalidArgumentsError("height to be positive integer.")}copy(e,t,r){this.ensureItIsPossibleToCopy(e,t,r),this.clipboardOperations.copy(e,t,r)}paste(e){const t=this.clipboardOperations.clipboard;if(void 0===t)throw new a.NothingToPasteError;if(this.clipboardOperations.isCutClipboard())this.moveCells(t.sourceLeftCorner,t.width,t.height,e);else if(this.clipboardOperations.isCopyClipboard()){this.clipboardOperations.ensureItIsPossibleToCopyPaste(e);const r=n.AbsoluteCellRange.spanFrom(e,t.width,t.height),s=this.operations.getRangeClipboardCells(r);this.undoRedo.clearRedoStack();const o=this.operations.restoreClipboardCells(t.sourceLeftCorner.sheet,t.getContent(e));this.undoRedo.saveOperation(new h.PasteUndoEntry(e,s,t.content,o))}}beginUndoRedoBatchMode(){this.undoRedo.beginBatchMode()}commitUndoRedoBatchMode(){this.undoRedo.commitBatchMode()}isClipboardEmpty(){return void 0===this.clipboardOperations.clipboard}clearClipboard(){this.clipboardOperations.clear()}addSheet(e){void 0!==e&&this.ensureItIsPossibleToAddSheet(e),this.undoRedo.clearRedoStack();const t=this.operations.addSheet(e);return this.undoRedo.saveOperation(new h.AddSheetUndoEntry(t)),t}removeSheet(e){this.ensureScopeIdIsValid(e),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const t=this.sheetMapping.fetchDisplayName(e),r=this.operations.getSheetClipboardCells(e),{version:n,scopedNamedExpressions:s}=this.operations.removeSheet(e);this.undoRedo.saveOperation(new h.RemoveSheetUndoEntry(t,e,r,s,n))}renameSheet(e,t){this.ensureItIsPossibleToRenameSheet(e,t);const r=this.operations.renameSheet(e,t);return void 0!==r&&(this.undoRedo.clearRedoStack(),this.undoRedo.saveOperation(new h.RenameSheetUndoEntry(e,r,t))),r}clearSheet(e){this.ensureScopeIdIsValid(e),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const t=this.operations.getSheetClipboardCells(e);this.operations.clearSheet(e),this.undoRedo.saveOperation(new h.ClearSheetUndoEntry(e,t))}setCellContents(e,t){if(t instanceof Array){for(let e=0;e<t.length;e++)if(!(t[e]instanceof Array))throw new a.InvalidArgumentsError("an array of arrays or a raw cell value.")}else t=[[t]];this.ensureItIsPossibleToChangeCellContents(e,t),this.undoRedo.clearRedoStack();const r=[];for(let n=0;n<t.length;n++)for(let s=0;s<t[n].length;s++){const o={sheet:e.sheet,row:e.row+n,col:e.col+s},a=t[n][s];this.clipboardOperations.abortCut();const i=this.operations.setCellContent(o,a);r.push({address:o,newContent:a,oldContent:i})}this.undoRedo.saveOperation(new h.SetCellContentsUndoEntry(r))}setSheetContent(e,t){this.ensureScopeIdIsValid(e),this.ensureItIsPossibleToChangeSheetContents(e,t),(0,l.validateAsSheet)(t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const r=this.operations.getSheetClipboardCells(e);this.operations.setSheetContent(e,t),this.undoRedo.saveOperation(new h.SetSheetContentUndoEntry(e,r,t))}setRowOrder(e,t){this.validateSwapRowIndexes(e,t),this.testRowOrderForArrays(e,t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const r=this.operations.setRowOrder(e,t);this.undoRedo.saveOperation(new h.SetRowOrderUndoEntry(e,t,r))}validateSwapRowIndexes(e,t){if(!this.sheetMapping.hasSheetWithId(e))throw new a.NoSheetWithIdError(e);this.validateRowOrColumnMapping(e,t,"row")}testColumnOrderForArrays(e,t){for(const[r,s]of t)if(r!==s){const t=n.AbsoluteCellRange.spanFrom({sheet:e,col:r,row:0},1,1/0);if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(t))throw new a.SourceLocationHasArrayError}}setColumnOrder(e,t){this.validateSwapColumnIndexes(e,t),this.testColumnOrderForArrays(e,t),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut();const r=this.operations.setColumnOrder(e,t);this.undoRedo.saveOperation(new h.SetColumnOrderUndoEntry(e,t,r))}validateSwapColumnIndexes(e,t){if(!this.sheetMapping.hasSheetWithId(e))throw new a.NoSheetWithIdError(e);this.validateRowOrColumnMapping(e,t,"column")}testRowOrderForArrays(e,t){for(const[r,s]of t)if(r!==s){const t=n.AbsoluteCellRange.spanFrom({sheet:e,col:0,row:r},1/0,1);if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(t))throw new a.SourceLocationHasArrayError}}mappingFromOrder(e,t,r){if(!this.sheetMapping.hasSheetWithId(e))throw new a.NoSheetWithIdError(e);const n="row"===r?this.dependencyGraph.getSheetHeight(e):this.dependencyGraph.getSheetWidth(e);if(t.length!==n)throw new a.InvalidArgumentsError(`number of ${r}s provided to be sheet ${"row"===r?"height":"width"}.`);const s=[];for(let e=0;e<n;e++)t[e]!==e&&s.push([e,t[e]]);return s}undo(){if(this.undoRedo.isUndoStackEmpty())throw new a.NoOperationToUndoError;this.clipboardOperations.abortCut(),this.undoRedo.undo()}redo(){if(this.undoRedo.isRedoStackEmpty())throw new a.NoOperationToRedoError;this.clipboardOperations.abortCut(),this.undoRedo.redo()}addNamedExpression(e,t,r,n){this.ensureItIsPossibleToAddNamedExpression(e,t,r),this.operations.addNamedExpression(e,t,r,n),this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.undoRedo.saveOperation(new h.AddNamedExpressionUndoEntry(e,t,r,n))}changeNamedExpressionExpression(e,t,r,n){this.ensureItIsPossibleToChangeNamedExpression(e,r,t);const[s,o]=this.operations.changeNamedExpressionExpression(e,r,t,n);this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.undoRedo.saveOperation(new h.ChangeNamedExpressionUndoEntry(s,r,o,t,n))}removeNamedExpression(e,t){this.ensureScopeIdIsValid(t);const[r,n]=this.operations.removeNamedExpression(e,t);return this.undoRedo.clearRedoStack(),this.clipboardOperations.abortCut(),this.undoRedo.saveOperation(new h.RemoveNamedExpressionUndoEntry(r,n,t)),r}ensureItIsPossibleToAddNamedExpression(e,t,r){this.ensureScopeIdIsValid(r),this.ensureNamedExpressionNameIsValid(e,r),this.ensureNamedExpressionIsValid(t)}ensureItIsPossibleToChangeNamedExpression(e,t,r){if(this.ensureScopeIdIsValid(r),void 0===this.namedExpressions.namedExpressionForScope(e,r))throw new a.NamedExpressionDoesNotExistError(e);this.ensureNamedExpressionIsValid(t)}isItPossibleToRemoveNamedExpression(e,t){if(this.ensureScopeIdIsValid(t),void 0===this.namedExpressions.namedExpressionForScope(e,t))throw new a.NamedExpressionDoesNotExistError(e)}ensureItIsPossibleToAddRows(e,...t){if(!this.sheetMapping.hasSheetWithId(e))throw new a.NoSheetWithIdError(e);if(this.dependencyGraph.getSheetHeight(e)+t.map((e=>e[1])).reduce(((e,t)=>e+t),0)>this.maxRows)throw new a.SheetSizeLimitExceededError;for(const[e,r]of t)if(!p(e)||!d(r))throw new a.InvalidArgumentsError("row number to be nonnegative and number of rows to add to be positive.")}ensureItIsPossibleToRemoveRows(e,...t){for(const[r,n]of t){const t=r+n-1;if(!p(r)||!p(t))throw new a.InvalidArgumentsError("starting and ending row to be nonnegative.");if(t<r)throw new a.InvalidArgumentsError("starting row to be smaller than the ending row.");if(!this.sheetMapping.hasSheetWithId(e))throw new a.NoSheetWithIdError(e)}}ensureItIsPossibleToAddColumns(e,...t){if(!this.sheetMapping.hasSheetWithId(e))throw new a.NoSheetWithIdError(e);if(this.dependencyGraph.getSheetWidth(e)+t.map((e=>e[1])).reduce(((e,t)=>e+t),0)>this.maxColumns)throw new a.SheetSizeLimitExceededError;for(const[e,r]of t)if(!p(e)||!d(r))throw new a.InvalidArgumentsError("column number to be nonnegative and number of columns to add to be positive.")}ensureItIsPossibleToRemoveColumns(e,...t){for(const[r,n]of t){const t=r+n-1;if(!p(r)||!p(t))throw new a.InvalidArgumentsError("starting and ending column to be nonnegative.");if(t<r)throw new a.InvalidArgumentsError("starting column to be smaller than the ending column.");if(!this.sheetMapping.hasSheetWithId(e))throw new a.NoSheetWithIdError(e)}}ensureItIsPossibleToMoveRows(e,t,r,o){this.ensureItIsPossibleToAddRows(e,[o,r]);const i=(0,s.simpleCellAddress)(e,0,t),u=(0,s.simpleCellAddress)(e,0,o);if(!this.sheetMapping.hasSheetWithId(e)||(0,s.invalidSimpleCellAddress)(i)||(0,s.invalidSimpleCellAddress)(u)||!d(r)||o<=t+r&&o>=t)throw new a.InvalidArgumentsError("a valid range of rows to move.");const l=this.dependencyGraph.getSheetWidth(e),h=n.AbsoluteCellRange.spanFrom(i,l,r);if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(h))throw new a.SourceLocationHasArrayError;if(o>0&&this.dependencyGraph.arrayMapping.isFormulaArrayInAllRows(c.RowsSpan.fromNumberOfRows(e,o-1,2)))throw new a.TargetLocationHasArrayError}ensureItIsPossibleToMoveColumns(e,t,r,o){this.ensureItIsPossibleToAddColumns(e,[o,r]);const i=(0,s.simpleCellAddress)(e,t,0),u=(0,s.simpleCellAddress)(e,o,0);if(!this.sheetMapping.hasSheetWithId(e)||(0,s.invalidSimpleCellAddress)(i)||(0,s.invalidSimpleCellAddress)(u)||!d(r)||o<=t+r&&o>=t)throw new a.InvalidArgumentsError("a valid range of columns to move.");const l=this.dependencyGraph.getSheetHeight(e),h=n.AbsoluteCellRange.spanFrom(i,r,l);if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(h))throw new a.SourceLocationHasArrayError;if(o>0&&this.dependencyGraph.arrayMapping.isFormulaArrayInAllColumns(c.ColumnsSpan.fromNumberOfColumns(e,o-1,2)))throw new a.TargetLocationHasArrayError}ensureItIsPossibleToAddSheet(e){if(this.sheetMapping.hasSheetWithName(e))throw new a.SheetNameAlreadyTakenError(e)}ensureItIsPossibleToRenameSheet(e,t){if(!this.sheetMapping.hasSheetWithId(e))throw new a.NoSheetWithIdError(e);const r=this.sheetMapping.get(t);if(void 0!==r&&r!==e)throw new a.SheetNameAlreadyTakenError(t)}ensureItIsPossibleToChangeContent(e){if((0,s.invalidSimpleCellAddress)(e))throw new a.InvalidAddressError(e);if(!this.sheetMapping.hasSheetWithId(e.sheet))throw new a.NoSheetWithIdError(e.sheet)}ensureItIsPossibleToChangeCellContents(e,t){const r=(0,l.findBoundaries)(t),s=n.AbsoluteCellRange.spanFrom(e,r.width,r.height);this.ensureRangeInSizeLimits(s);for(const e of s.addresses(this.dependencyGraph))this.ensureItIsPossibleToChangeContent(e)}ensureItIsPossibleToChangeSheetContents(e,t){const r=(0,l.findBoundaries)(t),o=n.AbsoluteCellRange.spanFrom((0,s.simpleCellAddress)(e,0,0),r.width,r.height);this.ensureRangeInSizeLimits(o)}ensureRangeInSizeLimits(e){if(e.exceedsSheetSizeLimits(this.maxColumns,this.maxRows))throw new a.SheetSizeLimitExceededError}isThereSomethingToUndo(){return!this.undoRedo.isUndoStackEmpty()}isThereSomethingToRedo(){return!this.undoRedo.isRedoStackEmpty()}getAndClearContentChanges(){return this.operations.getAndClearContentChanges()}ensureScopeIdIsValid(e){if(void 0!==e&&!this.sheetMapping.hasSheetWithId(e))throw new a.NoSheetWithIdError(e)}validateRowOrColumnMapping(e,t,r){const n="row"===r?this.dependencyGraph.getSheetHeight(e):this.dependencyGraph.getSheetWidth(e),s=t.map((([e,t])=>e)).sort(((e,t)=>e-t)),o=t.map((([e,t])=>t)).sort(((e,t)=>e-t));for(let e=0;e<s.length;e++){if(!p(s[e])||s[e]>=n)throw new a.InvalidArgumentsError(`${r} numbers to be nonnegative integers and less than sheet ${"row"===r?"height":"width"}.`);if(s[e]===s[e+1])throw new a.InvalidArgumentsError(`source ${r} numbers to be unique.`);if(s[e]!==o[e])throw new a.InvalidArgumentsError(`target ${r} numbers to be permutation of source ${r} numbers.`)}}ensureNamedExpressionNameIsValid(e,t){if(!this.namedExpressions.isNameValid(e))throw new a.NamedExpressionNameIsInvalidError(e);if(!this.namedExpressions.isNameAvailable(e,t))throw new a.NamedExpressionNameIsAlreadyTakenError(e)}ensureNamedExpressionIsValid(e){const t=this.cellContentParser.parse(e);if(t instanceof o.CellContent.Formula){const e=this.parser.parse(t.formula,(0,s.simpleCellAddress)(-1,0,0));if((0,i.doesContainRelativeReferences)(e.ast))throw new a.NoRelativeAddressesAllowedError}}}},function(e,t,r){"use strict";t.__esModule=!0,t.doesContainRelativeReferences=t.NamedExpressions=t.InternalNamedExpression=void 0,r(3),r(73),r(132),r(134),r(85),r(148);var n=r(106),s=r(137),o=r(142);class a{constructor(e,t,r,n){this.displayName=e,this.address=t,this.added=r,this.options=n}normalizeExpressionName(){return this.displayName.toLowerCase()}copy(){return new a(this.displayName,this.address,this.added,this.options)}}t.InternalNamedExpression=a;class i{constructor(){this.mapping=new Map}has(e){return this.mapping.has(this.normalizeExpressionName(e))}isNameAvailable(e){const t=this.normalizeExpressionName(e),r=this.mapping.get(t);return!(r&&r.added)}add(e){this.mapping.set(e.normalizeExpressionName(),e)}get(e){return this.mapping.get(this.normalizeExpressionName(e))}getExisting(e){const t=this.mapping.get(this.normalizeExpressionName(e));return t&&t.added?t:void 0}remove(e){const t=this.normalizeExpressionName(e),r=this.mapping.get(t);r&&(r.added=!1)}getAllNamedExpressions(){return Array.from(this.mapping.values()).filter((e=>e.added))}normalizeExpressionName(e){return e.toLowerCase()}}class u{constructor(){this.mapping=new Map}add(e){this.mapping.set(this.normalizeExpressionName(e.displayName),e)}get(e){return this.mapping.get(this.normalizeExpressionName(e))}has(e){return this.mapping.has(this.normalizeExpressionName(e))}getAllNamedExpressions(){return Array.from(this.mapping.values()).filter((e=>e.added))}isNameAvailable(e){const t=this.normalizeExpressionName(e);return!this.mapping.has(t)}remove(e){const t=this.normalizeExpressionName(e);this.mapping.get(t)&&this.mapping.delete(t)}normalizeExpressionName(e){return e.toLowerCase()}}class l{constructor(){this.nextNamedExpressionRow=0,this.workbookStore=new i,this.worksheetStores=new Map,this.addressCache=new Map}isNameAvailable(e,t){var r,n;return void 0===t?this.workbookStore.isNameAvailable(e):null===(n=null===(r=this.worksheetStore(t))||void 0===r?void 0:r.isNameAvailable(e))||void 0===n||n}namedExpressionInAddress(e){const t=this.addressCache.get(e);return t&&t.added?t:void 0}namedExpressionForScope(e,t){var r;return void 0===t?this.workbookStore.getExisting(e):null===(r=this.worksheetStore(t))||void 0===r?void 0:r.get(e)}nearestNamedExpression(e,t){var r,n;return null!==(n=null===(r=this.worksheetStore(t))||void 0===r?void 0:r.get(e))&&void 0!==n?n:this.workbookStore.getExisting(e)}isExpressionInScope(e,t){var r,n;return null!==(n=null===(r=this.worksheetStore(t))||void 0===r?void 0:r.has(e))&&void 0!==n&&n}isNameValid(e){const t=new RegExp(`^${o.CELL_REFERENCE_PATTERN}$`),r=new RegExp(`^${o.R1C1_CELL_REFERENCE_PATTERN}$`),n=new RegExp(`^${o.NAMED_EXPRESSION_PATTERN}$`);return!t.test(e)&&!r.test(e)&&n.test(e)}addNamedExpression(e,t,r){const n=void 0===t?this.workbookStore:this.worksheetStoreOrCreate(t);let s=n.get(e);return void 0!==s?(s.added=!0,s.displayName=e,s.options=r):(s=new a(e,this.nextAddress(),!0,r),n.add(s)),this.addressCache.set(s.address.row,s),s}restoreNamedExpression(e,t){const r=void 0===t?this.workbookStore:this.worksheetStoreOrCreate(t);return e.added=!0,r.add(e),this.addressCache.set(e.address.row,e),e}namedExpressionOrPlaceholder(e,t){var r;return null!==(r=this.worksheetStoreOrCreate(t).get(e))&&void 0!==r?r:this.workbookNamedExpressionOrPlaceholder(e)}workbookNamedExpressionOrPlaceholder(e){let t=this.workbookStore.get(e);return void 0===t&&(t=new a(e,this.nextAddress(),!1),this.workbookStore.add(t)),t}remove(e,t){let r;r=void 0===t?this.workbookStore:this.worksheetStore(t);const n=null==r?void 0:r.get(e);if(void 0===r||void 0===n||!n.added)throw Error("Named expression does not exist");r.remove(e),r instanceof u&&0===r.mapping.size&&this.worksheetStores.delete(t),this.addressCache.delete(n.address.row)}getAllNamedExpressionsNamesInScope(e){return this.getAllNamedExpressions().filter((({scope:t})=>t===e)).map((e=>e.expression.displayName))}getAllNamedExpressionsNames(){return this.getAllNamedExpressions().map((e=>e.expression.displayName))}getAllNamedExpressions(){const e=[];return this.workbookStore.getAllNamedExpressions().forEach((t=>{e.push({expression:t,scope:void 0})})),this.worksheetStores.forEach(((t,r)=>{t.getAllNamedExpressions().forEach((t=>{e.push({expression:t,scope:r})}))})),e}getAllNamedExpressionsForScope(e){var t,r;return void 0===e?this.workbookStore.getAllNamedExpressions():null!==(r=null===(t=this.worksheetStores.get(e))||void 0===t?void 0:t.getAllNamedExpressions())&&void 0!==r?r:[]}worksheetStoreOrCreate(e){let t=this.worksheetStores.get(e);return t||(t=new u,this.worksheetStores.set(e,t)),t}worksheetStore(e){return this.worksheetStores.get(e)}nextAddress(){return(0,n.simpleCellAddress)(l.SHEET_FOR_WORKBOOK_EXPRESSIONS,0,this.nextNamedExpressionRow++)}}t.NamedExpressions=l,l.SHEET_FOR_WORKBOOK_EXPRESSIONS=-1;const c=e=>{switch(e.type){case s.AstNodeType.EMPTY:case s.AstNodeType.NUMBER:case s.AstNodeType.STRING:case s.AstNodeType.ERROR:case s.AstNodeType.ERROR_WITH_RAW_INPUT:return!1;case s.AstNodeType.CELL_REFERENCE:return!e.reference.isAbsolute();case s.AstNodeType.CELL_RANGE:case s.AstNodeType.COLUMN_RANGE:case s.AstNodeType.ROW_RANGE:return!e.start.isAbsolute();case s.AstNodeType.NAMED_EXPRESSION:return!1;case s.AstNodeType.PERCENT_OP:case s.AstNodeType.PLUS_UNARY_OP:case s.AstNodeType.MINUS_UNARY_OP:return c(e.value);case s.AstNodeType.CONCATENATE_OP:case s.AstNodeType.EQUALS_OP:case s.AstNodeType.NOT_EQUAL_OP:case s.AstNodeType.LESS_THAN_OP:case s.AstNodeType.GREATER_THAN_OP:case s.AstNodeType.LESS_THAN_OR_EQUAL_OP:case s.AstNodeType.GREATER_THAN_OR_EQUAL_OP:case s.AstNodeType.MINUS_OP:case s.AstNodeType.PLUS_OP:case s.AstNodeType.TIMES_OP:case s.AstNodeType.DIV_OP:case s.AstNodeType.POWER_OP:return c(e.left)||c(e.right);case s.AstNodeType.PARENTHESIS:return c(e.expression);case s.AstNodeType.FUNCTION_CALL:return e.args.some((e=>c(e)));case s.AstNodeType.ARRAY:return e.args.some((e=>e.some((e=>c(e)))))}};t.doesContainRelativeReferences=c},function(e,t,r){"use strict";t.__esModule=!0,t.RemoveRowsCommand=t.RemoveColumnsCommand=t.Operations=t.AddRowsCommand=t.AddColumnsCommand=void 0,t.normalizeAddedIndexes=w,t.normalizeRemovedIndexes=M,r(3),r(73),r(132),r(85),r(94);var n=r(105),s=r(136),o=r(2),a=r(106),i=r(206),u=r(207),l=r(158),c=r(107),h=r(170),d=r(211),p=r(213),m=r(214),g=r(215),E=r(216),T=r(217),y=r(218),f=r(167),A=r(160),R=r(209),N=r(137),S=r(219),C=r(161),v=r(162);t.RemoveRowsCommand=class{constructor(e,t){this.sheet=e,this.indexes=t}normalizedIndexes(){return M(this.indexes)}rowsSpans(){return this.normalizedIndexes().map((e=>C.RowsSpan.fromNumberOfRows(this.sheet,e[0],e[1])))}};t.AddRowsCommand=class{constructor(e,t){this.sheet=e,this.indexes=t}normalizedIndexes(){return w(this.indexes)}rowsSpans(){return this.normalizedIndexes().map((e=>C.RowsSpan.fromNumberOfRows(this.sheet,e[0],e[1])))}};t.AddColumnsCommand=class{constructor(e,t){this.sheet=e,this.indexes=t}normalizedIndexes(){return w(this.indexes)}columnsSpans(){return this.normalizedIndexes().map((e=>C.ColumnsSpan.fromNumberOfColumns(this.sheet,e[0],e[1])))}};t.RemoveColumnsCommand=class{constructor(e,t){this.sheet=e,this.indexes=t}normalizedIndexes(){return M(this.indexes)}columnsSpans(){return this.normalizedIndexes().map((e=>C.ColumnsSpan.fromNumberOfColumns(this.sheet,e[0],e[1])))}};function M(e){if(e.length<=1)return e;const t=[...e].sort((([e],[t])=>e-t)),r=t.reduce(((e,[t,r])=>{const n=e[e.length-1],s=n[0]+n[1];return t<=s?n[1]+=Math.max(0,r-(s-t)):e.push([t,r]),e}),[t[0]]);let n=0;for(let e=0;e<r.length;++e)r[e][0]-=n,n+=r[e][1];return r}function w(e){if(e.length<=1)return e;const t=[...e].sort((([e],[t])=>e-t)),r=t.reduce(((e,[t,r])=>{const n=e[e.length-1];return t===n[0]?n[1]=Math.max(n[1],r):e.push([t,r]),e}),[t[0]]);let n=0;for(let e=0;e<r.length;++e)r[e][0]+=n,n+=r[e][1];return r}function F(e){return Number.isInteger(e)&&e>0}t.Operations=class{constructor(e,t,r,n,s,o,a,i,u){this.dependencyGraph=t,this.columnSearch=r,this.cellContentParser=n,this.parser=s,this.stats=o,this.lazilyTransformingAstService=a,this.namedExpressions=i,this.arraySizePredictor=u,this.changes=l.ContentChanges.empty(),this.allocateNamedExpressionAddressSpace(),this.maxColumns=e.maxColumns,this.maxRows=e.maxRows}get sheetMapping(){return this.dependencyGraph.sheetMapping}get addressMapping(){return this.dependencyGraph.addressMapping}removeRows(e){const t=[];for(const r of e.rowsSpans()){const e=this.doRemoveRows(r);e&&t.push(e)}return t}addRows(e){for(const t of e.rowsSpans())this.doAddRows(t)}addColumns(e){for(const t of e.columnsSpans())this.doAddColumns(t)}removeColumns(e){const t=[];for(const r of e.columnsSpans()){const e=this.doRemoveColumns(r);e&&t.push(e)}return t}removeSheet(e){this.dependencyGraph.removeSheet(e);let t=0;this.stats.measure(v.StatType.TRANSFORM_ASTS,(()=>{const r=new y.RemoveSheetTransformer(e);r.performEagerTransformations(this.dependencyGraph,this.parser),t=this.lazilyTransformingAstService.addTransformation(r)})),this.sheetMapping.removeSheet(e),this.columnSearch.removeSheet(e);const r=this.namedExpressions.getAllNamedExpressionsForScope(e).map((t=>this.removeNamedExpression(t.normalizeExpressionName(),e)));return{version:t,scopedNamedExpressions:r}}removeSheetByName(e){const t=this.sheetMapping.fetch(e);return this.removeSheet(t)}clearSheet(e){this.dependencyGraph.clearSheet(e),this.columnSearch.removeSheet(e)}addSheet(e){const t=this.sheetMapping.addSheet(e);return this.dependencyGraph.addressMapping.autoAddSheet(t,(0,S.findBoundaries)([])),this.sheetMapping.fetchDisplayName(t)}renameSheet(e,t){return this.sheetMapping.renameSheet(e,t)}moveRows(e,t,r,n){const s=C.RowsSpan.fromNumberOfRows(e,n,r);this.lazilyTransformingAstService.beginCombinedMode(e),this.doAddRows(s),n<t&&(t+=r);const o=(0,a.simpleCellAddress)(e,0,t),i=(0,a.simpleCellAddress)(e,0,n);this.moveCells(o,Number.POSITIVE_INFINITY,r,i);const u=C.RowsSpan.fromNumberOfRows(e,t,r);return this.doRemoveRows(u),this.lazilyTransformingAstService.commitCombinedMode()}moveColumns(e,t,r,n){const s=C.ColumnsSpan.fromNumberOfColumns(e,n,r);this.lazilyTransformingAstService.beginCombinedMode(e),this.doAddColumns(s),n<t&&(t+=r);const o=(0,a.simpleCellAddress)(e,t,0),i=(0,a.simpleCellAddress)(e,n,0);this.moveCells(o,r,Number.POSITIVE_INFINITY,i);const u=C.ColumnsSpan.fromNumberOfColumns(e,t,r);return this.doRemoveColumns(u),this.lazilyTransformingAstService.commitCombinedMode()}moveCells(e,t,r,s){this.ensureItIsPossibleToMoveCells(e,t,r,s);const o=n.AbsoluteCellRange.spanFrom(e,t,r),a=n.AbsoluteCellRange.spanFrom(s,t,r),i=s.col-e.col,u=s.row-e.row,l=s.sheet,c=this.getRangeClipboardCells(a),h=this.dependencyGraph.rawValuesFromRange(a);this.columnSearch.removeValues(h);const d=this.dependencyGraph.rawValuesFromRange(o);this.columnSearch.moveValues(d,i,u,l);let p=0;this.stats.measure(v.StatType.TRANSFORM_ASTS,(()=>{const e=new g.MoveCellsTransformer(o,i,u,l);e.performEagerTransformations(this.dependencyGraph,this.parser),p=this.lazilyTransformingAstService.addTransformation(e)})),this.dependencyGraph.moveCells(o,i,u,l);const m=this.updateNamedExpressionsForMovedCells(e,t,r,s);return{version:p,overwrittenCellsData:c,addedGlobalNamedExpressions:m}}setRowOrder(e,t){const r=[];let s=[];for(const[o,a]of t)if(o!==a){const t=n.AbsoluteCellRange.spanFrom({sheet:e,col:0,row:o},1/0,1),i=this.getRangeClipboardCells(t);s=s.concat(i),r.push(i.map((([{sheet:e,col:t},r])=>[{sheet:e,col:t,row:a},r])))}return r.forEach((t=>this.restoreClipboardCells(e,t.values()))),s}setColumnOrder(e,t){const r=[];let s=[];for(const[o,a]of t)if(o!==a){const t=n.AbsoluteCellRange.spanFrom({sheet:e,col:o,row:0},1,1/0),i=this.getRangeClipboardCells(t);s=s.concat(i),r.push(i.map((([{sheet:e,col:t,row:r},n])=>[{sheet:e,col:a,row:r},n])))}return r.forEach((t=>this.restoreClipboardCells(e,t.values()))),s}addNamedExpression(e,t,r,n){const s=this.namedExpressions.addNamedExpression(e,r,n);this.storeNamedExpressionInCell(s.address,t),this.adjustNamedExpressionEdges(s,e,r)}restoreNamedExpression(e,t,r){const n=e.displayName;this.restoreCell(e.address,t);const s=this.namedExpressions.restoreNamedExpression(e,r);this.adjustNamedExpressionEdges(s,n,r)}changeNamedExpressionExpression(e,t,r,n){const s=this.namedExpressions.namedExpressionForScope(e,r);if(!s)throw new f.NamedExpressionDoesNotExistError(e);const o=s.copy();s.options=n;const a=this.getClipboardCell(s.address);return this.storeNamedExpressionInCell(s.address,t),[o,a]}removeNamedExpression(e,t){const r=this.namedExpressions.namedExpressionForScope(e,t);if(!r)throw new f.NamedExpressionDoesNotExistError(e);this.namedExpressions.remove(r.displayName,t);const n=this.getClipboardCell(r.address);if(void 0!==t){const t=this.namedExpressions.workbookNamedExpressionOrPlaceholder(e);this.dependencyGraph.exchangeNode(r.address,t.address)}else this.dependencyGraph.setCellEmpty(r.address);return[r,n]}ensureItIsPossibleToMoveCells(e,t,r,s){if((0,a.invalidSimpleCellAddress)(e)||!(F(t)&&F(r)||function(e,t,r){return 0===e.row&&F(t)&&r===Number.POSITIVE_INFINITY||0===e.col&&F(r)&&t===Number.POSITIVE_INFINITY}(e,t,r))||(0,a.invalidSimpleCellAddress)(s)||!this.sheetMapping.hasSheetWithId(e.sheet)||!this.sheetMapping.hasSheetWithId(s.sheet))throw new f.InvalidArgumentsError("a valid range of cells to move.");const o=n.AbsoluteCellRange.spanFrom(e,t,r),i=n.AbsoluteCellRange.spanFrom(s,t,r);if(i.exceedsSheetSizeLimits(this.maxColumns,this.maxRows))throw new f.SheetSizeLimitExceededError;if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(o))throw new f.SourceLocationHasArrayError;if(this.dependencyGraph.arrayMapping.isFormulaArrayInRange(i))throw new f.TargetLocationHasArrayError}restoreClipboardCells(e,t){const r=[];for(const[n,s]of t)if(this.restoreCell(n,s),s.type===u.ClipboardCellType.FORMULA){const{dependencies:t}=this.parser.fetchCachedResult(s.hash);r.push(...this.updateNamedExpressionsForTargetAddress(e,n,t))}return r}restoreCell(e,t){switch(t.type){case u.ClipboardCellType.VALUE:this.setValueToCell(t,e);break;case u.ClipboardCellType.FORMULA:this.setFormulaToCellFromCache(t.hash,e);break;case u.ClipboardCellType.EMPTY:this.setCellEmpty(e);break;case u.ClipboardCellType.PARSING_ERROR:this.setParsingErrorToCell(t.rawInput,t.errors,e)}}getOldContent(e){const t=this.dependencyGraph.getCell(e);if(void 0===t||t instanceof c.EmptyCellVertex)return[e,{type:u.ClipboardCellType.EMPTY}];if(t instanceof c.ValueCellVertex)return[e,Object.assign({type:u.ClipboardCellType.VALUE},t.getValues())];if(t instanceof h.FormulaVertex)return[t.getAddress(this.lazilyTransformingAstService),{type:u.ClipboardCellType.FORMULA,hash:this.parser.computeHashFromAst(t.getFormula(this.lazilyTransformingAstService))}];if(t instanceof c.ParsingErrorVertex)return[e,{type:u.ClipboardCellType.PARSING_ERROR,rawInput:t.rawInput,errors:t.errors}];throw Error("Trying to copy unsupported type")}getClipboardCell(e){const t=this.dependencyGraph.getCell(e);if(void 0===t||t instanceof c.EmptyCellVertex)return{type:u.ClipboardCellType.EMPTY};if(t instanceof c.ValueCellVertex)return Object.assign({type:u.ClipboardCellType.VALUE},t.getValues());if(t instanceof c.ArrayVertex){const r=t.getArrayCellValue(e);return r===A.EmptyValue?{type:u.ClipboardCellType.EMPTY}:{type:u.ClipboardCellType.VALUE,parsedValue:r,rawValue:t.getArrayCellRawValue(e)}}if(t instanceof c.FormulaCellVertex)return{type:u.ClipboardCellType.FORMULA,hash:this.parser.computeHashFromAst(t.getFormula(this.lazilyTransformingAstService))};if(t instanceof c.ParsingErrorVertex)return{type:u.ClipboardCellType.PARSING_ERROR,rawInput:t.rawInput,errors:t.errors};throw Error("Trying to copy unsupported type")}getSheetClipboardCells(e){const t=this.dependencyGraph.getSheetHeight(e),r=this.dependencyGraph.getSheetWidth(e),n=new Array(t);for(let s=0;s<t;s++){n[s]=new Array(r);for(let t=0;t<r;t++){const r=(0,a.simpleCellAddress)(e,t,s);n[s][t]=this.getClipboardCell(r)}}return n}getRangeClipboardCells(e){const t=[];for(const r of e.addresses(this.dependencyGraph))t.push([r,this.getClipboardCell(r)]);return t}setCellContent(e,t){const r=this.cellContentParser.parse(t),n=this.getOldContent(e);if(r instanceof i.CellContent.Formula){const t=this.parser.parse(r.formula,e),{ast:n,errors:s}=t;if(s.length>0)this.setParsingErrorToCell(r.formula,s,e);else try{const r=this.arraySizePredictor.checkArraySize(n,e);if(r.width<=0||r.height<=0)throw Error("Incorrect array size");this.setFormulaToCell(e,r,t)}catch(t){if(!t.message)throw t;const n={type:N.ParsingErrorType.InvalidRangeSize,message:"Invalid range size."};this.setParsingErrorToCell(r.formula,[n],e)}}else r instanceof i.CellContent.Empty?this.setCellEmpty(e):this.setValueToCell({parsedValue:r.value,rawValue:t},e);return n}setSheetContent(e,t){this.clearSheet(e);for(let r=0;r<t.length;r++)for(let n=0;n<t[r].length;n++){const s=(0,a.simpleCellAddress)(e,n,r);this.setCellContent(s,t[r][n])}}setParsingErrorToCell(e,t,r){const n=this.dependencyGraph.getCellValue(r),s=new c.ParsingErrorVertex(t,e),o=this.dependencyGraph.setParsingErrorToCell(r,s);this.columnSearch.remove((0,A.getRawValue)(n),r),this.columnSearch.applyChanges(o.getChanges()),this.changes.addAll(o),this.changes.addChange(s.getCellValue(),r)}setFormulaToCell(e,t,{ast:r,hasVolatileFunction:n,hasStructuralChangeFunction:o,dependencies:a}){const i=this.dependencyGraph.getCellValue(e),u=this.dependencyGraph.setFormulaToCell(e,r,(0,s.absolutizeDependencies)(a,e),t,n,o);this.columnSearch.remove((0,A.getRawValue)(i),e),this.columnSearch.applyChanges(u.getChanges()),this.changes.addAll(u)}setValueToCell(e,t){const r=this.dependencyGraph.getCellValue(t),n=this.dependencyGraph.setValueToCell(t,e);this.columnSearch.change((0,A.getRawValue)(r),(0,A.getRawValue)(e.parsedValue),t),this.columnSearch.applyChanges(n.getChanges().filter((e=>!(0,a.equalSimpleCellAddress)(e.address,t)))),this.changes.addAll(n),this.changes.addChange(e.parsedValue,t)}setCellEmpty(e){if(this.dependencyGraph.isArrayInternalCell(e))return;const t=this.dependencyGraph.getCellValue(e),r=this.dependencyGraph.setCellEmpty(e);this.columnSearch.remove((0,A.getRawValue)(t),e),this.columnSearch.applyChanges(r.getChanges()),this.changes.addAll(r),this.changes.addChange(A.EmptyValue,e)}setFormulaToCellFromCache(e,t){const{ast:r,hasVolatileFunction:n,hasStructuralChangeFunction:o,dependencies:a}=this.parser.fetchCachedResult(e),i=(0,s.absolutizeDependencies)(a,t),[u]=new m.CleanOutOfScopeDependenciesTransformer(t.sheet).transformSingleAst(r,t);this.parser.rememberNewAst(u);const l=(0,s.filterDependenciesOutOfScope)(i),c=this.arraySizePredictor.checkArraySize(r,t);this.dependencyGraph.setFormulaToCell(t,u,l,c,n,o)}rowEffectivelyNotInSheet(e,t){return e>=this.dependencyGraph.addressMapping.getHeight(t)}getAndClearContentChanges(){const e=this.changes;return this.changes=l.ContentChanges.empty(),e}forceApplyPostponedTransformations(){this.dependencyGraph.forceApplyPostponedTransformations()}doRemoveRows(e){if(this.rowEffectivelyNotInSheet(e.rowStart,e.sheet))return;const t=[];for(const[r]of this.dependencyGraph.entriesFromRowsSpan(e))t.push({address:r,cellType:this.getClipboardCell(r)});const{affectedArrays:r,contentChanges:n}=this.dependencyGraph.removeRows(e);this.columnSearch.applyChanges(n.getChanges());let s=0;return this.stats.measure(v.StatType.TRANSFORM_ASTS,(()=>{const t=new T.RemoveRowsTransformer(e);t.performEagerTransformations(this.dependencyGraph,this.parser),s=this.lazilyTransformingAstService.addTransformation(t)})),this.rewriteAffectedArrays(r),{version:s,removedCells:t,rowFrom:e.rowStart,rowCount:e.numberOfRows}}doRemoveColumns(e){if(this.columnEffectivelyNotInSheet(e.columnStart,e.sheet))return;const t=[];for(const[r]of this.dependencyGraph.entriesFromColumnsSpan(e))t.push({address:r,cellType:this.getClipboardCell(r)});const{affectedArrays:r,contentChanges:n}=this.dependencyGraph.removeColumns(e);this.columnSearch.applyChanges(n.getChanges()),this.columnSearch.removeColumns(e);let s=0;return this.stats.measure(v.StatType.TRANSFORM_ASTS,(()=>{const t=new E.RemoveColumnsTransformer(e);t.performEagerTransformations(this.dependencyGraph,this.parser),s=this.lazilyTransformingAstService.addTransformation(t)})),this.rewriteAffectedArrays(r),{version:s,removedCells:t,columnFrom:e.columnStart,columnCount:e.numberOfColumns}}doAddRows(e){if(this.rowEffectivelyNotInSheet(e.rowStart,e.sheet))return;const{affectedArrays:t}=this.dependencyGraph.addRows(e);this.stats.measure(v.StatType.TRANSFORM_ASTS,(()=>{const t=new p.AddRowsTransformer(e);t.performEagerTransformations(this.dependencyGraph,this.parser),this.lazilyTransformingAstService.addTransformation(t)})),this.rewriteAffectedArrays(t)}rewriteAffectedArrays(e){for(const t of e.values()){if(t.array.size.isRef)continue;const e=t.getFormula(this.lazilyTransformingAstService),r=t.getAddress(this.lazilyTransformingAstService),n=this.parser.computeHashFromAst(e);this.setFormulaToCellFromCache(n,r)}}doAddColumns(e){if(this.columnEffectivelyNotInSheet(e.columnStart,e.sheet))return;const{affectedArrays:t,contentChanges:r}=this.dependencyGraph.addColumns(e);this.columnSearch.addColumns(e),this.columnSearch.applyChanges(r.getChanges()),this.stats.measure(v.StatType.TRANSFORM_ASTS,(()=>{const t=new d.AddColumnsTransformer(e);t.performEagerTransformations(this.dependencyGraph,this.parser),this.lazilyTransformingAstService.addTransformation(t)})),this.rewriteAffectedArrays(t)}columnEffectivelyNotInSheet(e,t){return e>=this.dependencyGraph.addressMapping.getWidth(t)}adjustNamedExpressionEdges(e,t,r){if(void 0===r)return;const{vertex:n,id:o}=this.dependencyGraph.fetchCellOrCreateEmpty(e.address),a=null!=o?o:this.dependencyGraph.graph.getNodeId(n),i=this.namedExpressions.workbookNamedExpressionOrPlaceholder(t),{vertex:u,id:l}=this.dependencyGraph.fetchCellOrCreateEmpty(i.address),h=null!=l?l:this.dependencyGraph.graph.getNodeId(u);for(const t of this.dependencyGraph.graph.adjacentNodes(u))if(t instanceof c.FormulaCellVertex&&t.getAddress(this.lazilyTransformingAstService).sheet===r){const r=t.getFormula(this.lazilyTransformingAstService),n=t.getAddress(this.lazilyTransformingAstService),{dependencies:o}=this.parser.fetchCachedResultForAst(r);for(const r of(0,s.absolutizeDependencies)(o,n))r instanceof N.NamedExpressionDependency&&r.name.toLowerCase()===e.displayName.toLowerCase()&&(this.dependencyGraph.graph.removeEdge(h,t),this.dependencyGraph.graph.addEdge(a,t))}}storeNamedExpressionInCell(e,t){const r=this.cellContentParser.parse(t);if(r instanceof i.CellContent.Formula){const t=this.parser.parse(r.formula,(0,a.simpleCellAddress)(-1,0,0));if((0,R.doesContainRelativeReferences)(t.ast))throw new f.NoRelativeAddressesAllowedError;const{ast:n,hasVolatileFunction:i,hasStructuralChangeFunction:u,dependencies:l}=t;this.dependencyGraph.setFormulaToCell(e,n,(0,s.absolutizeDependencies)(l,e),o.ArraySize.scalar(),i,u)}else r instanceof i.CellContent.Empty?this.setCellEmpty(e):this.setValueToCell({parsedValue:r.value,rawValue:t},e)}updateNamedExpressionsForMovedCells(e,t,r,s){if(e.sheet===s.sheet)return[];const o=[],a=n.AbsoluteCellRange.spanFrom(s,t,r);for(const t of a.addresses(this.dependencyGraph)){const r=this.addressMapping.fetchCell(t);if(r instanceof c.FormulaCellVertex&&t.sheet!==e.sheet){const n=r.getFormula(this.lazilyTransformingAstService),{dependencies:s}=this.parser.fetchCachedResultForAst(n);o.push(...this.updateNamedExpressionsForTargetAddress(e.sheet,t,s))}}return o}updateNamedExpressionsForTargetAddress(e,t,r){if(e===t.sheet)return[];const n=[],o=this.addressMapping.fetchCell(t);for(const a of(0,s.absolutizeDependencies)(r,t)){if(!(a instanceof N.NamedExpressionDependency))continue;const r=a.name,s=this.dependencyGraph.fetchNamedExpressionVertex(r,e).vertex,i=this.namedExpressions.isExpressionInScope(r,t.sheet)?this.dependencyGraph.fetchNamedExpressionVertex(r,t.sheet).vertex:this.copyOrFetchGlobalNamedExpressionVertex(r,s,n);i!==s&&(this.dependencyGraph.graph.removeEdgeIfExists(s,o),this.dependencyGraph.graph.addEdge(i,o))}return n}allocateNamedExpressionAddressSpace(){this.dependencyGraph.addressMapping.addSheet(R.NamedExpressions.SHEET_FOR_WORKBOOK_EXPRESSIONS,new c.SparseStrategy(0,0))}copyOrFetchGlobalNamedExpressionVertex(e,t,r){let n=this.namedExpressions.namedExpressionForScope(e);if(void 0===n)if(n=this.namedExpressions.addNamedExpression(e),r.push(n.normalizeExpressionName()),t instanceof c.FormulaCellVertex){const e=this.parser.fetchCachedResultForAst(t.getFormula(this.lazilyTransformingAstService)),{ast:r,hasVolatileFunction:a,hasStructuralChangeFunction:i,dependencies:u}=e;this.dependencyGraph.setFormulaToCell(n.address,r,(0,s.absolutizeDependencies)(u,n.address),o.ArraySize.scalar(),a,i)}else t instanceof c.EmptyCellVertex?this.setCellEmpty(n.address):t instanceof c.ValueCellVertex&&this.setValueToCell(t.getValues(),n.address);return this.dependencyGraph.fetchCellOrCreateEmpty(n.address).vertex}}},function(e,t,r){"use strict";t.__esModule=!0,t.AddColumnsTransformer=void 0;var n=r(106),s=r(212);class o extends s.Transformer{constructor(e){super(),this.columnsSpan=e}get sheet(){return this.columnsSpan.sheet}isIrreversible(){return!1}transformRowRangeAst(e,t){return e}transformCellRange(e,t,r){return this.transformRange(e,t,r)}transformRowRange(e,t,r){throw Error("Not implemented")}transformColumnRange(e,t,r){return this.transformRange(e,t,r)}transformCellAddress(e,t){const r=(0,n.absoluteSheetReference)(e,t);if(r!==this.columnsSpan.sheet&&t.sheet!==this.columnsSpan.sheet)return!1;const s=e.toSimpleColumnAddress(t);if(r===this.columnsSpan.sheet&&t.sheet!==this.columnsSpan.sheet)return this.columnsSpan.columnStart<=s.col&&e.shiftedByColumns(this.columnsSpan.numberOfColumns);if(t.sheet===this.columnsSpan.sheet&&r!==this.columnsSpan.sheet)return!e.isColumnAbsolute()&&(!(t.col<this.columnsSpan.columnStart)&&e.shiftedByColumns(-this.columnsSpan.numberOfColumns));if(e.isColumnAbsolute())return!(e.col<this.columnsSpan.columnStart)&&e.shiftedByColumns(this.columnsSpan.numberOfColumns);return e.toSimpleColumnAddress(t).col<this.columnsSpan.columnStart?!(t.col<this.columnsSpan.columnStart)&&e.shiftedByColumns(-this.columnsSpan.numberOfColumns):t.col<this.columnsSpan.columnStart&&e.shiftedByColumns(this.columnsSpan.numberOfColumns)}fixNodeAddress(e){return this.columnsSpan.sheet===e.sheet&&this.columnsSpan.columnStart<=e.col?Object.assign(Object.assign({},e),{col:e.col+this.columnsSpan.numberOfColumns}):e}transformRange(e,t,r){const s=this.transformCellAddress(e,r),o=this.transformCellAddress(t,r);return s===n.ErrorType.REF||o===n.ErrorType.REF?n.ErrorType.REF:!(!s&&!o)&&[s||e,o||t]}}t.AddColumnsTransformer=o},function(e,t,r){"use strict";t.__esModule=!0,t.Transformer=void 0,r(85);var n=r(106),s=r(137);t.Transformer=class{performEagerTransformations(e,t){for(const r of e.arrayFormulaNodes()){const[n,s]=this.transformSingleAst(r.getFormula(e.lazilyTransformingAstService),r.getAddress(e.lazilyTransformingAstService)),o=t.rememberNewAst(n);r.setFormula(o),r.setAddress(s)}}transformSingleAst(e,t){return[this.transformAst(e,t),this.fixNodeAddress(t)]}transformAst(e,t){switch(e.type){case s.AstNodeType.CELL_REFERENCE:return this.transformCellReferenceAst(e,t);case s.AstNodeType.CELL_RANGE:return this.transformCellRangeAst(e,t);case s.AstNodeType.COLUMN_RANGE:return this.transformColumnRangeAst(e,t);case s.AstNodeType.ROW_RANGE:return this.transformRowRangeAst(e,t);case s.AstNodeType.EMPTY:case s.AstNodeType.ERROR:case s.AstNodeType.NUMBER:case s.AstNodeType.NAMED_EXPRESSION:case s.AstNodeType.ERROR_WITH_RAW_INPUT:case s.AstNodeType.STRING:return e;case s.AstNodeType.PERCENT_OP:case s.AstNodeType.MINUS_UNARY_OP:case s.AstNodeType.PLUS_UNARY_OP:return Object.assign(Object.assign({},e),{value:this.transformAst(e.value,t)});case s.AstNodeType.FUNCTION_CALL:return Object.assign(Object.assign({},e),{procedureName:e.procedureName,args:e.args.map((e=>this.transformAst(e,t)))});case s.AstNodeType.PARENTHESIS:return Object.assign(Object.assign({},e),{expression:this.transformAst(e.expression,t)});case s.AstNodeType.ARRAY:return Object.assign(Object.assign({},e),{args:e.args.map((e=>e.map((e=>this.transformAst(e,t)))))});default:return Object.assign(Object.assign({},e),{left:this.transformAst(e.left,t),right:this.transformAst(e.right,t)})}}transformCellReferenceAst(e,t){const r=this.transformCellAddress(e.reference,t);return r instanceof s.CellAddress?Object.assign(Object.assign({},e),{reference:r}):r===n.ErrorType.REF?(0,s.buildCellErrorAst)(new n.CellError(n.ErrorType.REF)):e}transformCellRangeAst(e,t){const r=this.transformCellRange(e.start,e.end,t);return Array.isArray(r)?Object.assign(Object.assign({},e),{start:r[0],end:r[1]}):r===n.ErrorType.REF?(0,s.buildCellErrorAst)(new n.CellError(n.ErrorType.REF)):e}transformColumnRangeAst(e,t){const r=this.transformColumnRange(e.start,e.end,t);return Array.isArray(r)?Object.assign(Object.assign({},e),{start:r[0],end:r[1]}):r===n.ErrorType.REF?(0,s.buildCellErrorAst)(new n.CellError(n.ErrorType.REF)):e}transformRowRangeAst(e,t){const r=this.transformRowRange(e.start,e.end,t);return Array.isArray(r)?Object.assign(Object.assign({},e),{start:r[0],end:r[1]}):r===n.ErrorType.REF?(0,s.buildCellErrorAst)(new n.CellError(n.ErrorType.REF)):e}}},function(e,t,r){"use strict";t.__esModule=!0,t.AddRowsTransformer=void 0;var n=r(106),s=r(212);class o extends s.Transformer{constructor(e){super(),this.rowsSpan=e}get sheet(){return this.rowsSpan.sheet}isIrreversible(){return!1}transformColumnRangeAst(e,t){return e}transformCellRange(e,t,r){return this.transformRange(e,t,r)}transformRowRange(e,t,r){return this.transformRange(e,t,r)}transformColumnRange(e,t,r){throw Error("Not implemented")}transformCellAddress(e,t){const r=(0,n.absoluteSheetReference)(e,t);if(r!==this.rowsSpan.sheet&&t.sheet!==this.rowsSpan.sheet)return!1;const s=e.toSimpleRowAddress(t);return r===this.rowsSpan.sheet&&t.sheet!==this.rowsSpan.sheet?this.rowsSpan.rowStart<=s.row&&e.shiftedByRows(this.rowsSpan.numberOfRows):t.sheet===this.rowsSpan.sheet&&r!==this.rowsSpan.sheet?!e.isRowAbsolute()&&(!(t.row<this.rowsSpan.rowStart)&&e.shiftedByRows(-this.rowsSpan.numberOfRows)):e.isRowAbsolute()?!(e.row<this.rowsSpan.rowStart)&&e.shiftedByRows(this.rowsSpan.numberOfRows):s.row<this.rowsSpan.rowStart?!(t.row<this.rowsSpan.rowStart)&&e.shiftedByRows(-this.rowsSpan.numberOfRows):t.row<this.rowsSpan.rowStart&&e.shiftedByRows(this.rowsSpan.numberOfRows)}fixNodeAddress(e){return this.rowsSpan.sheet===e.sheet&&this.rowsSpan.rowStart<=e.row?Object.assign(Object.assign({},e),{row:e.row+this.rowsSpan.numberOfRows}):e}transformRange(e,t,r){const s=this.transformCellAddress(e,r),o=this.transformCellAddress(t,r);return s===n.ErrorType.REF||o===n.ErrorType.REF?n.ErrorType.REF:!(!s&&!o)&&[s||e,o||t]}}t.AddRowsTransformer=o},function(e,t,r){"use strict";t.__esModule=!0,t.CleanOutOfScopeDependenciesTransformer=void 0;var n=r(106),s=r(212);class o extends s.Transformer{constructor(e){super(),this.sheet=e}isIrreversible(){return!0}fixNodeAddress(e){return e}transformCellAddress(e,t){return!!e.isInvalid(t)&&n.ErrorType.REF}transformCellRange(e,t,r){return!(!e.isInvalid(r)&&!t.isInvalid(r))&&n.ErrorType.REF}transformColumnRange(e,t,r){return!(!e.isInvalid(r)&&!t.isInvalid(r))&&n.ErrorType.REF}transformRowRange(e,t,r){return!(!e.isInvalid(r)&&!t.isInvalid(r))&&n.ErrorType.REF}}t.CleanOutOfScopeDependenciesTransformer=o},function(e,t,r){"use strict";t.__esModule=!0,t.MoveCellsTransformer=t.DependentFormulaTransformer=void 0;var n=r(106),s=r(137),o=r(141),a=r(212);class i extends a.Transformer{constructor(e,t,r,n){super(),this.sourceRange=e,this.toRight=t,this.toBottom=r,this.toSheet=n,this.dependentFormulaTransformer=new u(e,t,r,n)}get sheet(){return this.sourceRange.sheet}isIrreversible(){return!0}transformSingleAst(e,t){if(this.sourceRange.addressInRange(t)){return[this.transformAst(e,t),this.fixNodeAddress(t)]}return this.dependentFormulaTransformer.transformSingleAst(e,t)}fixNodeAddress(e){return(0,n.simpleCellAddress)(this.toSheet,e.col+this.toRight,e.row+this.toBottom)}transformCellAddress(e,t){return this.transformAddress(e,t)}transformCellRange(e,t,r){return this.transformRange(e,t,r)}transformColumnRange(e,t,r){return this.transformRange(e,t,r)}transformRowRange(e,t,r){return this.transformRange(e,t,r)}transformAddress(e,t){const r=this.sourceRange;if(e instanceof s.CellAddress){const n=e.toSimpleCellAddress(t);if(r.addressInRange(n))return e.shiftAbsoluteDimensions(this.toRight,this.toBottom)}return e.shiftRelativeDimensions(-this.toRight,-this.toBottom)}transformRange(e,t,r){const n=this.sourceRange;if(e instanceof s.CellAddress&&t instanceof s.CellAddress){const s=e.toSimpleCellAddress(r),o=t.toSimpleCellAddress(r);if(n.addressInRange(s)&&n.addressInRange(o))return[e.shiftAbsoluteDimensions(this.toRight,this.toBottom),t.shiftAbsoluteDimensions(this.toRight,this.toBottom)]}return[e.shiftRelativeDimensions(-this.toRight,-this.toBottom),t.shiftRelativeDimensions(-this.toRight,-this.toBottom)]}}t.MoveCellsTransformer=i;class u extends a.Transformer{constructor(e,t,r,n){super(),this.sourceRange=e,this.toRight=t,this.toBottom=r,this.toSheet=n}get sheet(){return this.sourceRange.sheet}isIrreversible(){return!0}fixNodeAddress(e){return e}transformCellAddress(e,t){return!!this.shouldMove(e,t)&&e.moved(this.toSheet,this.toRight,this.toBottom)}transformCellRange(e,t,r){return this.transformRange(e,t,r)}transformColumnRange(e,t,r){return this.transformRange(e,t,r)}transformRowRange(e,t,r){return this.transformRange(e,t,r)}shouldMove(e,t){return e instanceof s.CellAddress?this.sourceRange.addressInRange(e.toSimpleCellAddress(t)):e instanceof o.RowAddress?this.sourceRange.rowInRange(e.toSimpleRowAddress(t))&&!this.sourceRange.isFinite():this.sourceRange.columnInRange(e.toSimpleColumnAddress(t))&&!this.sourceRange.isFinite()}transformRange(e,t,r){const n=this.transformCellAddress(e,r),s=this.transformCellAddress(t,r);return!(!n||!s)&&[n,s]}}t.DependentFormulaTransformer=u},function(e,t,r){"use strict";t.__esModule=!0,t.RemoveColumnsTransformer=void 0;var n=r(106),s=r(212);class o extends s.Transformer{constructor(e){super(),this.columnsSpan=e}get sheet(){return this.columnsSpan.sheet}isIrreversible(){return!0}transformRowRangeAst(e,t){return e}transformCellRange(e,t,r){return this.transformRange(e,t,r)}transformRowRange(e,t,r){throw Error("Not implemented")}transformColumnRange(e,t,r){return this.transformRange(e,t,r)}transformCellAddress(e,t){const r=(0,n.absoluteSheetReference)(e,t);if(this.columnsSpan.sheet!==t.sheet&&this.columnsSpan.sheet!==r)return!1;if(this.columnsSpan.sheet!==t.sheet&&this.columnsSpan.sheet===r){const r=e.toSimpleColumnAddress(t);if(r.col<this.columnsSpan.columnStart)return!1;if(r.col>this.columnsSpan.columnEnd)return e.shiftedByColumns(-this.columnsSpan.numberOfColumns)}if(this.columnsSpan.sheet===t.sheet&&this.columnsSpan.sheet!==r){if(e.isColumnAbsolute())return!1;if(t.col<this.columnsSpan.columnStart)return!1;if(t.col>this.columnsSpan.columnEnd)return e.shiftedByColumns(this.columnsSpan.numberOfColumns)}if(this.columnsSpan.sheet===t.sheet&&this.columnsSpan.sheet===r)if(e.isColumnAbsolute()){if(e.col<this.columnsSpan.columnStart)return!1;if(e.col>this.columnsSpan.columnEnd)return e.shiftedByColumns(-this.columnsSpan.numberOfColumns)}else{const r=e.toSimpleColumnAddress(t);if(r.col<this.columnsSpan.columnStart){if(t.col<this.columnsSpan.columnStart)return!1;if(t.col>this.columnsSpan.columnEnd)return e.shiftedByColumns(this.columnsSpan.numberOfColumns)}else if(r.col>this.columnsSpan.columnEnd){if(t.col<this.columnsSpan.columnStart)return e.shiftedByColumns(-this.columnsSpan.numberOfColumns);if(t.col>this.columnsSpan.columnEnd)return!1}}return n.ErrorType.REF}fixNodeAddress(e){return this.columnsSpan.sheet===e.sheet&&this.columnsSpan.columnStart<=e.col?Object.assign(Object.assign({},e),{col:e.col-this.columnsSpan.numberOfColumns}):e}transformRange(e,t,r){const s=(0,n.absoluteSheetReference)(e,r);let o=e,a=t;if(this.columnsSpan.sheet===s){const s=e.toSimpleColumnAddress(r),i=t.toSimpleColumnAddress(r);if(this.columnsSpan.columnStart<=s.col&&this.columnsSpan.columnEnd>=i.col)return n.ErrorType.REF;s.col>=this.columnsSpan.columnStart&&s.col<=this.columnsSpan.columnEnd&&(o=e.shiftedByColumns(this.columnsSpan.columnEnd-s.col+1)),i.col>=this.columnsSpan.columnStart&&i.col<=this.columnsSpan.columnEnd&&(a=t.shiftedByColumns(-(i.col-this.columnsSpan.columnStart+1)))}const i=this.transformCellAddress(o,r),u=this.transformCellAddress(a,r);if(!1===i&&!1===u)return[o,a];if(i===n.ErrorType.REF||u===n.ErrorType.REF)throw Error("Cannot happen");return[i||o,u||a]}}t.RemoveColumnsTransformer=o},function(e,t,r){"use strict";t.__esModule=!0,t.RemoveRowsTransformer=void 0;var n=r(106),s=r(212);class o extends s.Transformer{constructor(e){super(),this.rowsSpan=e}get sheet(){return this.rowsSpan.sheet}isIrreversible(){return!0}transformColumnRangeAst(e,t){return e}transformCellAddress(e,t){const r=(0,n.absoluteSheetReference)(e,t);if(this.rowsSpan.sheet!==t.sheet&&this.rowsSpan.sheet!==r)return!1;if(this.rowsSpan.sheet!==t.sheet&&this.rowsSpan.sheet===r){const r=e.toSimpleRowAddress(t);if(r.row<this.rowsSpan.rowStart)return!1;if(r.row>this.rowsSpan.rowEnd)return e.shiftedByRows(-this.rowsSpan.numberOfRows)}if(this.rowsSpan.sheet===t.sheet&&this.rowsSpan.sheet!==r){if(e.isRowAbsolute())return!1;if(t.row<this.rowsSpan.rowStart)return!1;if(t.row>this.rowsSpan.rowEnd)return e.shiftedByRows(this.rowsSpan.numberOfRows)}if(this.rowsSpan.sheet===t.sheet&&this.rowsSpan.sheet===r)if(e.isRowAbsolute()){if(e.row<this.rowsSpan.rowStart)return!1;if(e.row>this.rowsSpan.rowEnd)return e.shiftedByRows(-this.rowsSpan.numberOfRows)}else{const r=e.toSimpleRowAddress(t);if(r.row<this.rowsSpan.rowStart){if(t.row<this.rowsSpan.rowStart)return!1;if(t.row>this.rowsSpan.rowEnd)return e.shiftedByRows(this.rowsSpan.numberOfRows)}else if(r.row>this.rowsSpan.rowEnd){if(t.row<this.rowsSpan.rowStart)return e.shiftedByRows(-this.rowsSpan.numberOfRows);if(t.row>this.rowsSpan.rowEnd)return!1}}return n.ErrorType.REF}transformCellRange(e,t,r){return this.transformRange(e,t,r)}transformRowRange(e,t,r){return this.transformRange(e,t,r)}transformColumnRange(e,t,r){throw Error("Not implemented")}fixNodeAddress(e){return this.rowsSpan.sheet===e.sheet&&this.rowsSpan.rowStart<=e.row?Object.assign(Object.assign({},e),{row:e.row-this.rowsSpan.numberOfRows}):e}transformRange(e,t,r){const s=(0,n.absoluteSheetReference)(e,r);let o=e,a=t;if(this.rowsSpan.sheet===s){const s=e.toSimpleRowAddress(r),i=t.toSimpleRowAddress(r);if(this.rowsSpan.rowStart<=s.row&&this.rowsSpan.rowEnd>=i.row)return n.ErrorType.REF;s.row>=this.rowsSpan.rowStart&&s.row<=this.rowsSpan.rowEnd&&(o=e.shiftedByRows(this.rowsSpan.rowEnd-s.row+1)),i.row>=this.rowsSpan.rowStart&&i.row<=this.rowsSpan.rowEnd&&(a=t.shiftedByRows(-(i.row-this.rowsSpan.rowStart+1)))}const i=this.transformCellAddress(o,r),u=this.transformCellAddress(a,r);return!1===i&&!1===u?[o,a]:i===n.ErrorType.REF||u===n.ErrorType.REF?n.ErrorType.REF:[i||o,u||a]}}t.RemoveRowsTransformer=o},function(e,t,r){"use strict";t.__esModule=!0,t.RemoveSheetTransformer=void 0;var n=r(106),s=r(212);class o extends s.Transformer{constructor(e){super(),this.sheet=e}isIrreversible(){return!0}performEagerTransformations(e,t){for(const t of e.arrayFormulaNodes()){const[r]=this.transformSingleAst(t.getFormula(e.lazilyTransformingAstService),t.getAddress(e.lazilyTransformingAstService));t.setFormula(r)}}fixNodeAddress(e){return e}transformCellAddress(e,t){return this.transformAddress(e)}transformCellRange(e,t,r){return this.transformAddress(e)}transformColumnRange(e,t,r){return this.transformAddress(e)}transformRowRange(e,t,r){return this.transformAddress(e)}transformAddress(e){return e.sheet===this.sheet&&n.ErrorType.REF}}t.RemoveSheetTransformer=o},function(e,t,r){"use strict";t.__esModule=!0,t.findBoundaries=function(e){let t=0,r=0,n=0;for(let s=0;s<e.length;s++){let o=0;for(let t=0;t<e[s].length;t++){const r=e[s][t];null!=r&&(o=t+1,++n)}t=Math.max(t,o),o>0&&(r=s+1)}const s=t*r;return{height:r,width:t,fill:0===s?0:n/s}},t.validateAsSheet=function(e){if(!Array.isArray(e))throw new n.InvalidArgumentsError("an array of arrays.");for(let t=0;t<e.length;t++)if(!Array.isArray(e[t]))throw new n.InvalidArgumentsError("an array of arrays.")};var n=r(167)},function(e,t,r){"use strict";t.__esModule=!0,t.UndoRedo=t.SetSheetContentUndoEntry=t.SetRowOrderUndoEntry=t.SetColumnOrderUndoEntry=t.SetCellContentsUndoEntry=t.RenameSheetUndoEntry=t.RemoveSheetUndoEntry=t.RemoveRowsUndoEntry=t.RemoveNamedExpressionUndoEntry=t.RemoveColumnsUndoEntry=t.PasteUndoEntry=t.MoveRowsUndoEntry=t.MoveColumnsUndoEntry=t.MoveCellsUndoEntry=t.ClearSheetUndoEntry=t.ChangeNamedExpressionUndoEntry=t.BatchUndoEntry=t.BaseUndoEntry=t.AddSheetUndoEntry=t.AddRowsUndoEntry=t.AddNamedExpressionUndoEntry=t.AddColumnsUndoEntry=void 0,r(3);var n=r(106),s=r(210);class o{}t.BaseUndoEntry=o;t.RemoveRowsUndoEntry=class extends o{constructor(e,t){super(),this.command=e,this.rowsRemovals=t}doUndo(e){e.undoRemoveRows(this)}doRedo(e){e.redoRemoveRows(this)}};t.MoveCellsUndoEntry=class extends o{constructor(e,t,r,n,s,o,a){super(),this.sourceLeftCorner=e,this.width=t,this.height=r,this.destinationLeftCorner=n,this.overwrittenCellsData=s,this.addedGlobalNamedExpressions=o,this.version=a}doUndo(e){e.undoMoveCells(this)}doRedo(e){e.redoMoveCells(this)}};t.AddRowsUndoEntry=class extends o{constructor(e){super(),this.command=e}doUndo(e){e.undoAddRows(this)}doRedo(e){e.redoAddRows(this)}};t.SetRowOrderUndoEntry=class extends o{constructor(e,t,r){super(),this.sheetId=e,this.rowMapping=t,this.oldContent=r}doUndo(e){e.undoSetRowOrder(this)}doRedo(e){e.redoSetRowOrder(this)}};t.SetColumnOrderUndoEntry=class extends o{constructor(e,t,r){super(),this.sheetId=e,this.columnMapping=t,this.oldContent=r}doUndo(e){e.undoSetColumnOrder(this)}doRedo(e){e.redoSetColumnOrder(this)}};t.SetSheetContentUndoEntry=class extends o{constructor(e,t,r){super(),this.sheetId=e,this.oldSheetContent=t,this.newSheetContent=r}doUndo(e){e.undoSetSheetContent(this)}doRedo(e){e.redoSetSheetContent(this)}};t.MoveRowsUndoEntry=class extends o{constructor(e,t,r,n,s){super(),this.sheet=e,this.startRow=t,this.numberOfRows=r,this.targetRow=n,this.version=s,this.undoStart=this.startRow<this.targetRow?this.targetRow-this.numberOfRows:this.targetRow,this.undoEnd=this.startRow>this.targetRow?this.startRow+this.numberOfRows:this.startRow}doUndo(e){e.undoMoveRows(this)}doRedo(e){e.redoMoveRows(this)}};t.MoveColumnsUndoEntry=class extends o{constructor(e,t,r,n,s){super(),this.sheet=e,this.startColumn=t,this.numberOfColumns=r,this.targetColumn=n,this.version=s,this.undoStart=this.startColumn<this.targetColumn?this.targetColumn-this.numberOfColumns:this.targetColumn,this.undoEnd=this.startColumn>this.targetColumn?this.startColumn+this.numberOfColumns:this.startColumn}doUndo(e){e.undoMoveColumns(this)}doRedo(e){e.redoMoveColumns(this)}};t.AddColumnsUndoEntry=class extends o{constructor(e){super(),this.command=e}doUndo(e){e.undoAddColumns(this)}doRedo(e){e.redoAddColumns(this)}};t.RemoveColumnsUndoEntry=class extends o{constructor(e,t){super(),this.command=e,this.columnsRemovals=t}doUndo(e){e.undoRemoveColumns(this)}doRedo(e){e.redoRemoveColumns(this)}};t.AddSheetUndoEntry=class extends o{constructor(e){super(),this.sheetName=e}doUndo(e){e.undoAddSheet(this)}doRedo(e){e.redoAddSheet(this)}};t.RemoveSheetUndoEntry=class extends o{constructor(e,t,r,n,s){super(),this.sheetName=e,this.sheetId=t,this.oldSheetContent=r,this.scopedNamedExpressions=n,this.version=s}doUndo(e){e.undoRemoveSheet(this)}doRedo(e){e.redoRemoveSheet(this)}};t.RenameSheetUndoEntry=class extends o{constructor(e,t,r){super(),this.sheetId=e,this.oldName=t,this.newName=r}doUndo(e){e.undoRenameSheet(this)}doRedo(e){e.redoRenameSheet(this)}};t.ClearSheetUndoEntry=class extends o{constructor(e,t){super(),this.sheetId=e,this.oldSheetContent=t}doUndo(e){e.undoClearSheet(this)}doRedo(e){e.redoClearSheet(this)}};t.SetCellContentsUndoEntry=class extends o{constructor(e){super(),this.cellContents=e}doUndo(e){e.undoSetCellContents(this)}doRedo(e){e.redoSetCellContents(this)}};t.PasteUndoEntry=class extends o{constructor(e,t,r,n){super(),this.targetLeftCorner=e,this.oldContent=t,this.newContent=r,this.addedGlobalNamedExpressions=n}doUndo(e){e.undoPaste(this)}doRedo(e){e.redoPaste(this)}};t.AddNamedExpressionUndoEntry=class extends o{constructor(e,t,r,n){super(),this.name=e,this.newContent=t,this.scope=r,this.options=n}doUndo(e){e.undoAddNamedExpression(this)}doRedo(e){e.redoAddNamedExpression(this)}};t.RemoveNamedExpressionUndoEntry=class extends o{constructor(e,t,r){super(),this.namedExpression=e,this.content=t,this.scope=r}doUndo(e){e.undoRemoveNamedExpression(this)}doRedo(e){e.redoRemoveNamedExpression(this)}};t.ChangeNamedExpressionUndoEntry=class extends o{constructor(e,t,r,n,s){super(),this.namedExpression=e,this.newContent=t,this.oldContent=r,this.scope=n,this.options=s}doUndo(e){e.undoChangeNamedExpression(this)}doRedo(e){e.redoChangeNamedExpression(this)}};class a extends o{constructor(){super(...arguments),this.operations=[]}add(e){this.operations.push(e)}*reversedOperations(){for(let e=this.operations.length-1;e>=0;e--)yield this.operations[e]}doUndo(e){e.undoBatch(this)}doRedo(e){e.redoBatch(this)}}t.BatchUndoEntry=a;t.UndoRedo=class{constructor(e,t){this.operations=t,this.oldData=new Map,this.undoStack=[],this.redoStack=[],this.undoLimit=e.undoLimit}saveOperation(e){void 0!==this.batchUndoEntry?this.batchUndoEntry.add(e):this.addUndoEntry(e)}beginBatchMode(){this.batchUndoEntry=new a}commitBatchMode(){if(void 0===this.batchUndoEntry)throw Error("Batch mode wasn't started");this.addUndoEntry(this.batchUndoEntry),this.batchUndoEntry=void 0}storeDataForVersion(e,t,r){this.oldData.has(e)||this.oldData.set(e,[]);this.oldData.get(e).push([t,r])}clearRedoStack(){this.redoStack=[]}clearUndoStack(){this.undoStack=[]}isUndoStackEmpty(){return 0===this.undoStack.length}isRedoStackEmpty(){return 0===this.redoStack.length}undo(){const e=this.undoStack.pop();if(!e)throw Error("Attempted to undo without operation on stack");this.undoEntry(e),this.redoStack.push(e)}undoBatch(e){for(const t of e.reversedOperations())this.undoEntry(t)}undoRemoveRows(e){this.operations.forceApplyPostponedTransformations();const{command:{sheet:t},rowsRemovals:r}=e;for(let e=r.length-1;e>=0;--e){const n=r[e];this.operations.addRows(new s.AddRowsCommand(t,[[n.rowFrom,n.rowCount]]));for(const{address:e,cellType:t}of n.removedCells)this.operations.restoreCell(e,t);this.restoreOldDataFromVersion(n.version-1)}}undoRemoveColumns(e){this.operations.forceApplyPostponedTransformations();const{command:{sheet:t},columnsRemovals:r}=e;for(let e=r.length-1;e>=0;--e){const n=r[e];this.operations.addColumns(new s.AddColumnsCommand(t,[[n.columnFrom,n.columnCount]]));for(const{address:e,cellType:t}of n.removedCells)this.operations.restoreCell(e,t);this.restoreOldDataFromVersion(n.version-1)}}undoAddRows(e){const t=e.command.rowsSpans();for(let r=t.length-1;r>=0;--r){const n=t[r];this.operations.removeRows(new s.RemoveRowsCommand(e.command.sheet,[[n.rowStart,n.numberOfRows]]))}}undoAddColumns(e){const t=e.command.columnsSpans();for(let r=t.length-1;r>=0;--r){const n=t[r];this.operations.removeColumns(new s.RemoveColumnsCommand(e.command.sheet,[[n.columnStart,n.numberOfColumns]]))}}undoSetCellContents(e){for(const t of e.cellContents){const e=t.address,[r,s]=t.oldContent;(0,n.equalSimpleCellAddress)(e,r)||this.operations.setCellEmpty(e),this.operations.restoreCell(r,s)}}undoPaste(e){this.restoreOperationOldContent(e.oldContent);for(const t of e.addedGlobalNamedExpressions)this.operations.removeNamedExpression(t)}undoMoveRows(e){const{sheet:t}=e;this.operations.moveRows(t,e.undoStart,e.numberOfRows,e.undoEnd),this.restoreOldDataFromVersion(e.version-1)}undoMoveColumns(e){const{sheet:t}=e;this.operations.moveColumns(t,e.undoStart,e.numberOfColumns,e.undoEnd),this.restoreOldDataFromVersion(e.version-1)}undoMoveCells(e){this.operations.forceApplyPostponedTransformations(),this.operations.moveCells(e.destinationLeftCorner,e.width,e.height,e.sourceLeftCorner),this.restoreOperationOldContent(e.overwrittenCellsData),this.restoreOldDataFromVersion(e.version-1);for(const t of e.addedGlobalNamedExpressions)this.operations.removeNamedExpression(t)}undoAddSheet(e){const{sheetName:t}=e;this.operations.removeSheetByName(t)}undoRemoveSheet(e){this.operations.forceApplyPostponedTransformations();const{oldSheetContent:t,sheetId:r}=e;this.operations.addSheet(e.sheetName);for(let e=0;e<t.length;e++){const s=t[e];for(let t=0;t<s.length;t++){const o=s[t],a=(0,n.simpleCellAddress)(r,t,e);this.operations.restoreCell(a,o)}}for(const[t,n]of e.scopedNamedExpressions)this.operations.restoreNamedExpression(t,n,r);this.restoreOldDataFromVersion(e.version-1)}undoRenameSheet(e){this.operations.renameSheet(e.sheetId,e.oldName)}undoClearSheet(e){const{oldSheetContent:t,sheetId:r}=e;for(let e=0;e<t.length;e++){const s=t[e];for(let t=0;t<s.length;t++){const o=s[t],a=(0,n.simpleCellAddress)(r,t,e);this.operations.restoreCell(a,o)}}}undoSetSheetContent(e){const{oldSheetContent:t,sheetId:r}=e;this.operations.clearSheet(r);for(let e=0;e<t.length;e++){const s=t[e];for(let t=0;t<s.length;t++){const o=s[t],a=(0,n.simpleCellAddress)(r,t,e);this.operations.restoreCell(a,o)}}}undoAddNamedExpression(e){this.operations.removeNamedExpression(e.name,e.scope)}undoRemoveNamedExpression(e){this.operations.restoreNamedExpression(e.namedExpression,e.content,e.scope)}undoChangeNamedExpression(e){this.operations.restoreNamedExpression(e.namedExpression,e.oldContent,e.scope)}undoSetRowOrder(e){this.restoreOperationOldContent(e.oldContent)}undoSetColumnOrder(e){this.restoreOperationOldContent(e.oldContent)}redo(){const e=this.redoStack.pop();if(!e)throw Error("Attempted to redo without operation on stack");this.redoEntry(e),this.undoStack.push(e)}redoBatch(e){for(const t of e.operations)this.redoEntry(t)}redoRemoveRows(e){this.operations.removeRows(e.command)}redoMoveCells(e){this.operations.moveCells(e.sourceLeftCorner,e.width,e.height,e.destinationLeftCorner)}redoRemoveColumns(e){this.operations.removeColumns(e.command)}redoPaste(e){const{targetLeftCorner:t,newContent:r}=e,s=r.length,o=r[0].length;for(let e=0;e<s;++e)for(let s=0;s<o;++s){const o=(0,n.simpleCellAddress)(t.sheet,t.col+s,t.row+e);this.operations.restoreCell(o,r[e][s])}}redoSetCellContents(e){for(const t of e.cellContents)this.operations.setCellContent(t.address,t.newContent)}redoAddRows(e){this.operations.addRows(e.command)}redoAddColumns(e){this.operations.addColumns(e.command)}redoRemoveSheet(e){this.operations.removeSheetByName(e.sheetName)}redoAddSheet(e){this.operations.addSheet(e.sheetName)}redoRenameSheet(e){this.operations.renameSheet(e.sheetId,e.newName)}redoMoveRows(e){this.operations.moveRows(e.sheet,e.startRow,e.numberOfRows,e.targetRow)}redoMoveColumns(e){this.operations.moveColumns(e.sheet,e.startColumn,e.numberOfColumns,e.targetColumn)}redoClearSheet(e){this.operations.clearSheet(e.sheetId)}redoSetSheetContent(e){const{sheetId:t,newSheetContent:r}=e;this.operations.setSheetContent(t,r)}redoAddNamedExpression(e){this.operations.addNamedExpression(e.name,e.newContent,e.scope,e.options)}redoRemoveNamedExpression(e){this.operations.removeNamedExpression(e.namedExpression.displayName,e.scope)}redoChangeNamedExpression(e){this.operations.changeNamedExpressionExpression(e.namedExpression.displayName,e.newContent,e.scope,e.options)}redoSetRowOrder(e){this.operations.setRowOrder(e.sheetId,e.rowMapping)}redoSetColumnOrder(e){this.operations.setColumnOrder(e.sheetId,e.columnMapping)}addUndoEntry(e){this.undoStack.push(e),this.undoStack.splice(0,Math.max(0,this.undoStack.length-this.undoLimit))}undoEntry(e){e.doUndo(this)}restoreOperationOldContent(e){for(const[t,r]of e)this.operations.restoreCell(t,r)}redoEntry(e){e.doRedo(this)}restoreOldDataFromVersion(e){const t=this.oldData.get(e)||[];for(const e of t){const[t,r]=e;this.operations.setFormulaToCellFromCache(r,t)}}}},function(e,t,r){"use strict";t.__esModule=!0,t.Evaluator=void 0,r(3),r(73),r(134);var n=r(105),s=r(136),o=r(106),a=r(158),i=r(107),u=r(170),l=r(187),c=r(160),h=r(159),d=r(162);t.Evaluator=class{constructor(e,t,r,n,s,o){this.config=e,this.stats=t,this.interpreter=r,this.lazilyTransformingAstService=n,this.dependencyGraph=s,this.columnSearch=o}run(){this.stats.start(d.StatType.TOP_SORT);const{sorted:e,cycled:t}=this.dependencyGraph.topSortWithScc();this.stats.end(d.StatType.TOP_SORT),this.stats.measure(d.StatType.EVALUATION,(()=>{this.recomputeFormulas(t,e)}))}partialRun(e){const t=a.ContentChanges.empty();return this.stats.measure(d.StatType.EVALUATION,(()=>{this.dependencyGraph.graph.getTopSortedWithSccSubgraphFrom(e,(e=>{if(e instanceof u.FormulaVertex){const r=e.isComputed()?e.getCellValue():void 0,n=this.recomputeFormulaVertexValue(e);if(n!==r){const s=e.getAddress(this.lazilyTransformingAstService);return t.addChange(n,s),this.columnSearch.change((0,c.getRawValue)(r),(0,c.getRawValue)(n),s),!0}return!1}return!(e instanceof i.RangeVertex)||(e.clearCache(),!0)}),(e=>{if(e instanceof i.RangeVertex)e.clearCache();else if(e instanceof u.FormulaVertex){const r=e.getAddress(this.lazilyTransformingAstService);this.columnSearch.remove((0,c.getRawValue)(e.valueOrUndef()),r);const n=new o.CellError(o.ErrorType.CYCLE,void 0,e);e.setCellValue(n),t.addChange(n,r)}}))})),t}runAndForget(e,t,r){const o=[];for(const e of(0,s.absolutizeDependencies)(r,t))if(e instanceof n.AbsoluteCellRange){const t=e;if(void 0===this.dependencyGraph.getRange(t.start,t.end)){const e=new i.RangeVertex(t);this.dependencyGraph.rangeMapping.setRange(e),o.push(e)}}const a=this.evaluateAstToCellValue(e,new l.InterpreterState(t,this.config.useArrayArithmetic));return o.forEach((e=>{this.dependencyGraph.rangeMapping.removeRange(e)})),a}recomputeFormulas(e,t){e.forEach((e=>{e instanceof u.FormulaVertex&&e.setCellValue(new o.CellError(o.ErrorType.CYCLE,void 0,e))})),t.forEach((e=>{if(e instanceof u.FormulaVertex){const t=this.recomputeFormulaVertexValue(e),r=e.getAddress(this.lazilyTransformingAstService);this.columnSearch.add((0,c.getRawValue)(t),r)}else e instanceof i.RangeVertex&&e.clearCache()}))}recomputeFormulaVertexValue(e){const t=e.getAddress(this.lazilyTransformingAstService);if(e instanceof i.ArrayVertex&&(e.array.size.isRef||!this.dependencyGraph.isThereSpaceForArray(e)))return e.setNoSpace();{const r=e.getFormula(this.lazilyTransformingAstService),n=this.evaluateAstToCellValue(r,new l.InterpreterState(t,this.config.useArrayArithmetic,e));return e.setCellValue(n)}}evaluateAstToCellValue(e,t){const r=this.interpreter.evaluateAst(e,t);return r instanceof h.SimpleRangeValue?r:r===c.EmptyValue&&this.config.evaluateNullToZero?0:r}}},function(e,t,r){"use strict";t.__esModule=!0,t.Exporter=t.ExportedNamedExpressionChange=t.ExportedCellChange=void 0,r(3),r(85);var n=r(106),s=r(194),o=r(151),a=r(160),i=r(159),u=r(209),l=r(138);class c{constructor(e,t){this.address=e,this.newValue=t}get col(){return this.address.col}get row(){return this.address.row}get sheet(){return this.address.sheet}get value(){return this.newValue}}t.ExportedCellChange=c;class h{constructor(e,t){this.name=e,this.newValue=t}}t.ExportedNamedExpressionChange=h;t.Exporter=class{constructor(e,t,r,n){this.config=e,this.namedExpressions=t,this.sheetIndexMapping=r,this.lazilyTransformingService=n}exportChange(e){const t=e.value,r=e.address;if(r.sheet===u.NamedExpressions.SHEET_FOR_WORKBOOK_EXPRESSIONS){const e=this.namedExpressions.namedExpressionInAddress(r.row);if(!e)throw new Error("Missing named expression");return new h(e.displayName,this.exportScalarOrRange(t))}if(t instanceof i.SimpleRangeValue){const e=[];for(const[n,s]of t.entriesFromTopLeftCorner(r))e.push(new c(s,this.exportValue(n)));return e}return new c(r,this.exportValue(t))}exportValue(e){return e instanceof i.SimpleRangeValue?this.detailedError(new n.CellError(n.ErrorType.VALUE,o.ErrorMessage.ScalarExpected)):this.config.smartRounding&&(0,a.isExtendedNumber)(e)?this.cellValueRounding((0,a.getRawValue)(e)):e instanceof n.CellError?this.detailedError(e):e===a.EmptyValue?null:(0,a.getRawValue)(e)}exportScalarOrRange(e){return e instanceof i.SimpleRangeValue?e.rawData().map((e=>e.map((e=>this.exportValue(e))))):this.exportValue(e)}detailedError(e){var t,r;let n;const o=null===(t=e.root)||void 0===t?void 0:t.getAddress(this.lazilyTransformingService);return void 0!==o&&(n=o.sheet===u.NamedExpressions.SHEET_FOR_WORKBOOK_EXPRESSIONS?null===(r=this.namedExpressions.namedExpressionInAddress(o.row))||void 0===r?void 0:r.displayName:(0,l.simpleCellAddressToString)(this.sheetIndexMapping,o,-1)),new s.DetailedCellError(e,this.config.translationPackage.getErrorTranslation(e.type),n)}cellValueRounding(e){if(0===e)return e;const t=Math.floor(Math.log10(Math.abs(e))),r=Math.pow(10,this.config.precisionRounding-t);return e<0?-Math.round(-e*r)/r:Math.round(e*r)/r}}},function(e,t,r){"use strict";t.__esModule=!0,t.SimpleStrategy=t.GraphBuilder=void 0,r(73),r(134);var n=r(136),s=r(2),o=r(106),a=r(206),i=r(107),u=r(160),l=r(162);t.GraphBuilder=class{constructor(e,t,r,n,s,o){this.dependencyGraph=e,this.columnSearch=t,this.parser=r,this.cellContentParser=n,this.stats=s,this.arraySizePredictor=o,this.buildStrategy=new c(e,t,r,s,n,o)}buildGraph(e,t){const r=t.measure(l.StatType.COLLECT_DEPENDENCIES,(()=>this.buildStrategy.run(e)));this.dependencyGraph.getAndClearContentChanges(),t.measure(l.StatType.PROCESS_DEPENDENCIES,(()=>this.processDependencies(r)))}processDependencies(e){e.forEach(((e,t)=>{this.dependencyGraph.processCellDependencies(e,t)}))}};class c{constructor(e,t,r,n,s,o){this.dependencyGraph=e,this.columnIndex=t,this.parser=r,this.stats=n,this.cellContentParser=s,this.arraySizePredictor=o}run(e){const t=new Map;for(const r in e){const c=this.dependencyGraph.getSheetId(r),h=e[r];for(let e=0;e<h.length;++e){const r=h[e];for(let h=0;h<r.length;++h){const d=r[h],p=(0,o.simpleCellAddress)(c,h,e),m=this.cellContentParser.parse(d);if(m instanceof a.CellContent.Formula){const e=this.stats.measure(l.StatType.PARSER,(()=>this.parser.parse(m.formula,p)));if(e.errors.length>0){this.shrinkArrayIfNeeded(p);const t=new i.ParsingErrorVertex(e.errors,m.formula);this.dependencyGraph.addVertex(p,t)}else{this.shrinkArrayIfNeeded(p);const r=this.arraySizePredictor.checkArraySize(e.ast,p);if(r.isScalar()){const r=new i.FormulaCellVertex(e.ast,p,0);t.set(r,(0,n.absolutizeDependencies)(e.dependencies,p)),this.dependencyGraph.addVertex(p,r),e.hasVolatileFunction&&this.dependencyGraph.markAsVolatile(r),e.hasStructuralChangeFunction&&this.dependencyGraph.markAsDependentOnStructureChange(r)}else{const o=new i.ArrayVertex(e.ast,p,new s.ArraySize(r.width,r.height));t.set(o,(0,n.absolutizeDependencies)(e.dependencies,p)),this.dependencyGraph.addArrayVertex(p,o)}}}else if(m instanceof a.CellContent.Empty);else{this.shrinkArrayIfNeeded(p);const e=new i.ValueCellVertex(m.value,d);this.columnIndex.add((0,u.getRawValue)(m.value),p),this.dependencyGraph.addVertex(p,e)}}}}return t}shrinkArrayIfNeeded(e){const t=this.dependencyGraph.getCell(e);t instanceof i.ArrayVertex&&this.dependencyGraph.shrinkArrayToCorner(t)}}t.SimpleStrategy=c},function(e,t,r){"use strict";t.__esModule=!0,t.FunctionRegistry=void 0,r(3),r(109),r(120),r(122),r(124),r(126),r(128),r(130),r(73),r(134);var n=r(167),s=r(204),o=r(225);function a(e,t){var r;let s=t.implementedFunctions[e];const o=null===(r=t.aliases)||void 0===r?void 0:r[e];if(void 0!==o){if(void 0!==s)throw new n.AliasAlreadyExisting(e,t.name);s=t.implementedFunctions[o]}if(void 0===s)throw n.FunctionPluginValidationError.functionNotDeclaredInPlugin(e,t.name);return s}class i{constructor(e){if(this.config=e,this.functions=new Map,this.arraySizeFunctions=new Map,this.volatileFunctions=new Set,this.arrayFunctions=new Set,this.structuralChangeFunctions=new Set,this.functionsWhichDoesNotNeedArgumentsToBeComputed=new Set,this.functionsMetadata=new Map,this.doesFunctionNeedArgumentToBeComputed=e=>this.functionsWhichDoesNotNeedArgumentsToBeComputed.has(e),this.isFunctionVolatile=e=>this.volatileFunctions.has(e),this.isArrayFunction=e=>this.arrayFunctions.has(e),this.isFunctionDependentOnSheetStructureChange=e=>this.structuralChangeFunctions.has(e),e.functionPlugins.length>0){this.instancePlugins=new Map;for(const t of e.functionPlugins)i.loadPluginFunctions(t,this.instancePlugins)}else this.instancePlugins=new Map(i.plugins);for(const[e,t]of i.protectedFunctions())i.loadFunctionUnprotected(t,e,this.instancePlugins);for(const[e,t]of this.instancePlugins.entries())this.categorizeFunction(e,a(e,t))}static registerFunctionPlugin(e,t){this.loadPluginFunctions(e,this.plugins),void 0!==t&&this.loadTranslations(t)}static registerFunction(e,t,r){this.loadPluginFunction(t,e,this.plugins),void 0!==r&&this.loadTranslations(r)}static unregisterFunction(e){if(this.functionIsProtected(e))throw n.ProtectedFunctionError.cannotUnregisterFunctionWithId(e);this.plugins.delete(e)}static unregisterFunctionPlugin(e){for(const t of this.protectedPlugins())if(t===e)throw n.ProtectedFunctionError.cannotUnregisterProtectedPlugin();for(const[t,r]of this.plugins.entries())r===e&&this.plugins.delete(t)}static unregisterAll(){this.plugins.clear()}static getRegisteredFunctionIds(){return[...Array.from(this.plugins.keys()),...Array.from(this._protectedPlugins.keys())]}static getPlugins(){return Array.from(new Set(this.plugins.values()).values())}static getFunctionPlugin(e){return this.functionIsProtected(e)?void 0:this.plugins.get(e)}static functionIsProtected(e){return this._protectedPlugins.has(e)}static loadTranslations(e){const t=new Set(s.HyperFormula.getRegisteredLanguagesCodes());Object.keys(e).forEach((r=>{t.has(r)&&s.HyperFormula.getLanguage(r).extendFunctions(e[r])}))}static loadPluginFunctions(e,t){Object.keys(e.implementedFunctions).forEach((r=>{this.loadPluginFunction(e,r,t)})),void 0!==e.aliases&&Object.keys(e.aliases).forEach((r=>{this.loadPluginFunction(e,r,t)}))}static loadPluginFunction(e,t,r){if(this.functionIsProtected(t))throw n.ProtectedFunctionError.cannotRegisterFunctionWithId(t);this.loadFunctionUnprotected(e,t,r)}static loadFunctionUnprotected(e,t,r){const s=a(t,e).method;if(!Object.prototype.hasOwnProperty.call(e.prototype,s))throw n.FunctionPluginValidationError.functionMethodNotFound(s,e.name);r.set(t,e)}static*protectedFunctions(){for(const[e,t]of this._protectedPlugins)void 0!==t&&(yield[e,t])}static*protectedPlugins(){for(const[,e]of this._protectedPlugins)void 0!==e&&(yield e)}initializePlugins(e){const t=[];for(const[r,n]of this.instancePlugins.entries()){let s=t.find((e=>e instanceof n));void 0===s&&(s=new n(e),t.push(s));const o=a(r,n),i=o.method;this.functions.set(r,[i,s]);const u=o.arraySizeMethod;void 0!==u&&this.arraySizeFunctions.set(r,[u,s])}}getFunctionPlugin(e){if(!i.functionIsProtected(e))return this.instancePlugins.get(e)}getFunction(e){const t=this.functions.get(e);if(void 0!==t&&this.config.translationPackage.isFunctionTranslated(e)){const[e,r]=t;return(t,n)=>r[e](t,n)}}getArraySizeFunction(e){const t=this.arraySizeFunctions.get(e);if(void 0!==t&&this.config.translationPackage.isFunctionTranslated(e)){const[e,r]=t;return(t,n)=>r[e](t,n)}}getMetadata(e){return this.functionsMetadata.get(e)}getPlugins(){const e=new Set;for(const[t,r]of this.instancePlugins)i.functionIsProtected(t)||e.add(r);return Array.from(e)}getRegisteredFunctionIds(){return Array.from(this.functions.keys())}categorizeFunction(e,t){t.isVolatile&&this.volatileFunctions.add(e),t.arrayFunction&&this.arrayFunctions.add(e),t.doesNotNeedArgumentsToBeComputed&&this.functionsWhichDoesNotNeedArgumentsToBeComputed.add(e),t.isDependentOnSheetStructureChange&&this.structuralChangeFunctions.add(e),this.functionsMetadata.set(e,t)}}t.FunctionRegistry=i,i.plugins=new Map,i._protectedPlugins=new Map([["VERSION",o.VersionPlugin],["OFFSET",void 0]])},function(e,t,r){"use strict";t.__esModule=!0,t.VersionPlugin=void 0;var n=r(204),s=r(189);const o=new Map([["gpl-v3",1],["missing",2],["invalid",3],["expired",4]]);class a extends s.FunctionPlugin{version(e,t){return this.runFunction(e.args,t,this.metadata("VERSION"),(()=>{const{licenseKeyValidityState:e,licenseKey:t}=this.config;let r;return o.has(t)?r=o.get(t):o.has(e)?r=o.get(e):"valid"===e&&(r=t.slice(-5)),`HyperFormula v${n.HyperFormula.version}, ${r}`}))}}t.VersionPlugin=a,a.implementedFunctions={VERSION:{method:"version",parameters:[]}}},function(e,t,r){"use strict";t.__esModule=!0,t.Interpreter=void 0,r(3),r(85);var n=r(105),s=r(171),o=r(106),a=r(151),i=r(145),u=r(192),l=r(227),c=r(224),h=r(187),d=r(160),p=r(159);function m(e,t){return t instanceof o.CellError?t:e(t)}function g(e,t,r){return t instanceof o.CellError?t:r instanceof o.CellError?r:e(t,r)}t.Interpreter=class{constructor(e,t,r,n,s,o,a,i,c,h){this.config=e,this.dependencyGraph=t,this.columnSearch=r,this.stats=n,this.arithmeticHelper=s,this.functionRegistry=o,this.namedExpressions=a,this.serialization=i,this.arraySizePredictor=c,this.dateTimeHelper=h,this.equalOp=(e,t)=>g(this.arithmeticHelper.eq,e,t),this.notEqualOp=(e,t)=>g(this.arithmeticHelper.neq,e,t),this.greaterThanOp=(e,t)=>g(this.arithmeticHelper.gt,e,t),this.lessThanOp=(e,t)=>g(this.arithmeticHelper.lt,e,t),this.greaterThanOrEqualOp=(e,t)=>g(this.arithmeticHelper.geq,e,t),this.lessThanOrEqualOp=(e,t)=>g(this.arithmeticHelper.leq,e,t),this.concatOp=(e,t)=>g(this.arithmeticHelper.concat,(0,u.coerceScalarToString)(e),(0,u.coerceScalarToString)(t)),this.plusOp=(e,t)=>g(this.arithmeticHelper.addWithEpsilon,this.arithmeticHelper.coerceScalarToNumberOrError(e),this.arithmeticHelper.coerceScalarToNumberOrError(t)),this.minusOp=(e,t)=>g(this.arithmeticHelper.subtract,this.arithmeticHelper.coerceScalarToNumberOrError(e),this.arithmeticHelper.coerceScalarToNumberOrError(t)),this.timesOp=(e,t)=>g(this.arithmeticHelper.multiply,this.arithmeticHelper.coerceScalarToNumberOrError(e),this.arithmeticHelper.coerceScalarToNumberOrError(t)),this.powerOp=(e,t)=>g(this.arithmeticHelper.pow,this.arithmeticHelper.coerceScalarToNumberOrError(e),this.arithmeticHelper.coerceScalarToNumberOrError(t)),this.divOp=(e,t)=>g(this.arithmeticHelper.divide,this.arithmeticHelper.coerceScalarToNumberOrError(e),this.arithmeticHelper.coerceScalarToNumberOrError(t)),this.unaryMinusOp=e=>m(this.arithmeticHelper.unaryMinus,this.arithmeticHelper.coerceScalarToNumberOrError(e)),this.percentOp=e=>m(this.arithmeticHelper.unaryPercent,this.arithmeticHelper.coerceScalarToNumberOrError(e)),this.unaryPlusOp=e=>this.arithmeticHelper.unaryPlus(e),this.functionRegistry.initializePlugins(this),this.criterionBuilder=new l.CriterionBuilder(e)}evaluateAst(e,t){let r=this.evaluateAstWithoutPostprocessing(e,t);if((0,d.isExtendedNumber)(r)){if((0,u.isNumberOverflow)((0,d.getRawValue)(r)))return new o.CellError(o.ErrorType.NUM,a.ErrorMessage.NaN);r=(0,d.cloneNumber)(r,(0,u.fixNegativeZero)((0,d.getRawValue)(r)))}return r instanceof p.SimpleRangeValue&&1===r.height()&&1===r.width()&&([[r]]=r.data),function(e,t){if(e instanceof o.CellError&&void 0!==t)return e.attachRootVertex(t);return e}(r,t.formulaVertex)}evaluateAstWithoutPostprocessing(e,t){switch(e.type){case i.AstNodeType.EMPTY:return d.EmptyValue;case i.AstNodeType.CELL_REFERENCE:{const r=e.reference.toSimpleCellAddress(t.formulaAddress);return(0,o.invalidSimpleCellAddress)(r)?new o.CellError(o.ErrorType.REF,a.ErrorMessage.BadRef):this.dependencyGraph.getCellValue(r)}case i.AstNodeType.NUMBER:case i.AstNodeType.STRING:return e.value;case i.AstNodeType.CONCATENATE_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.concatOp,r,n,t)}case i.AstNodeType.EQUALS_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.equalOp,r,n,t)}case i.AstNodeType.NOT_EQUAL_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.notEqualOp,r,n,t)}case i.AstNodeType.GREATER_THAN_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.greaterThanOp,r,n,t)}case i.AstNodeType.LESS_THAN_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.lessThanOp,r,n,t)}case i.AstNodeType.GREATER_THAN_OR_EQUAL_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.greaterThanOrEqualOp,r,n,t)}case i.AstNodeType.LESS_THAN_OR_EQUAL_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.lessThanOrEqualOp,r,n,t)}case i.AstNodeType.PLUS_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.plusOp,r,n,t)}case i.AstNodeType.MINUS_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.minusOp,r,n,t)}case i.AstNodeType.TIMES_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.timesOp,r,n,t)}case i.AstNodeType.POWER_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.powerOp,r,n,t)}case i.AstNodeType.DIV_OP:{const r=this.evaluateAst(e.left,t),n=this.evaluateAst(e.right,t);return this.binaryRangeWrapper(this.divOp,r,n,t)}case i.AstNodeType.PLUS_UNARY_OP:{const r=this.evaluateAst(e.value,t);return this.unaryRangeWrapper(this.unaryPlusOp,r,t)}case i.AstNodeType.MINUS_UNARY_OP:{const r=this.evaluateAst(e.value,t);return this.unaryRangeWrapper(this.unaryMinusOp,r,t)}case i.AstNodeType.PERCENT_OP:{const r=this.evaluateAst(e.value,t);return this.unaryRangeWrapper(this.percentOp,r,t)}case i.AstNodeType.FUNCTION_CALL:{if("valid"!==this.config.licenseKeyValidityState&&!c.FunctionRegistry.functionIsProtected(e.procedureName))return new o.CellError(o.ErrorType.LIC,a.ErrorMessage.LicenseKey(this.config.licenseKeyValidityState));const r=this.functionRegistry.getFunction(e.procedureName);return void 0!==r?r(e,new h.InterpreterState(t.formulaAddress,t.arraysFlag||this.functionRegistry.isArrayFunction(e.procedureName),t.formulaVertex)):new o.CellError(o.ErrorType.NAME,a.ErrorMessage.FunctionName(e.procedureName))}case i.AstNodeType.NAMED_EXPRESSION:{const r=this.namedExpressions.nearestNamedExpression(e.expressionName,t.formulaAddress.sheet);return r?this.dependencyGraph.getCellValue(r.address):new o.CellError(o.ErrorType.NAME,a.ErrorMessage.NamedExpressionName(e.expressionName))}case i.AstNodeType.CELL_RANGE:{if(!this.rangeSpansOneSheet(e))return new o.CellError(o.ErrorType.REF,a.ErrorMessage.RangeManySheets);const r=n.AbsoluteCellRange.fromCellRange(e,t.formulaAddress),i=this.dependencyGraph.getArray(r);if(i){const e=i.array;if(e instanceof s.NotComputedArray)throw new Error("Array should be already computed");if(e instanceof o.CellError)return e;if(e instanceof s.ArrayValue)return p.SimpleRangeValue.fromRange(e.raw(),r,this.dependencyGraph);throw new Error("Unknown array")}return p.SimpleRangeValue.onlyRange(r,this.dependencyGraph)}case i.AstNodeType.COLUMN_RANGE:{if(!this.rangeSpansOneSheet(e))return new o.CellError(o.ErrorType.REF,a.ErrorMessage.RangeManySheets);const r=n.AbsoluteColumnRange.fromColumnRange(e,t.formulaAddress);return p.SimpleRangeValue.onlyRange(r,this.dependencyGraph)}case i.AstNodeType.ROW_RANGE:{if(!this.rangeSpansOneSheet(e))return new o.CellError(o.ErrorType.REF,a.ErrorMessage.RangeManySheets);const r=n.AbsoluteRowRange.fromRowRangeAst(e,t.formulaAddress);return p.SimpleRangeValue.onlyRange(r,this.dependencyGraph)}case i.AstNodeType.PARENTHESIS:return this.evaluateAst(e.expression,t);case i.AstNodeType.ARRAY:{let r;const n=[];for(const s of e.args){let e;const i=[];for(const r of s){const n=(0,u.coerceToRange)(this.evaluateAst(r,t)),s=n.height();if(void 0===e)e=s,i.push(...n.data);else{if(e!==s)return new o.CellError(o.ErrorType.REF,a.ErrorMessage.SizeMismatch);for(let e=0;e<s;e++)i[e].push(...n.data[e])}}const l=i[0].length;if(void 0===r)r=l,n.push(...i);else{if(r!==l)return new o.CellError(o.ErrorType.REF,a.ErrorMessage.SizeMismatch);n.push(...i)}}return p.SimpleRangeValue.onlyValues(n)}case i.AstNodeType.ERROR_WITH_RAW_INPUT:case i.AstNodeType.ERROR:return e.error}}rangeSpansOneSheet(e){return e.start.sheet===e.end.sheet}unaryRangeWrapper(e,t,r){var n;if(t instanceof p.SimpleRangeValue&&!r.arraysFlag&&(t=null!==(n=(0,u.coerceRangeToScalar)(t,r))&&void 0!==n?n:new o.CellError(o.ErrorType.VALUE,a.ErrorMessage.ScalarExpected)),t instanceof o.CellError)return t;if(t instanceof p.SimpleRangeValue){const r=t.data.map((t=>t.map(e)));return p.SimpleRangeValue.onlyValues(r)}return e(t)}binaryRangeWrapper(e,t,r,n){var s,i;if(t instanceof p.SimpleRangeValue&&!n.arraysFlag&&(t=null!==(s=(0,u.coerceRangeToScalar)(t,n))&&void 0!==s?s:new o.CellError(o.ErrorType.VALUE,a.ErrorMessage.ScalarExpected)),t instanceof o.CellError)return t;if(r instanceof p.SimpleRangeValue&&!n.arraysFlag&&(r=null!==(i=(0,u.coerceRangeToScalar)(r,n))&&void 0!==i?i:new o.CellError(o.ErrorType.VALUE,a.ErrorMessage.ScalarExpected)),r instanceof o.CellError)return r;if(t instanceof p.SimpleRangeValue||r instanceof p.SimpleRangeValue){if(!(t instanceof p.SimpleRangeValue)){if(r.isAdHoc()){const n=r.data;for(let r=0;r<n.length;r++)for(let s=0;s<n[0].length;s++)n[r][s]=e(t,n[r][s]);return p.SimpleRangeValue.onlyValues(n)}t=p.SimpleRangeValue.fromScalar(t)}if(!(r instanceof p.SimpleRangeValue)){if(t.isAdHoc()){const n=t.data;for(let t=0;t<n.length;t++)for(let s=0;s<n[0].length;s++)n[t][s]=e(n[t][s],r);return p.SimpleRangeValue.onlyValues(n)}r=p.SimpleRangeValue.fromScalar(r)}if(t.width()===r.width()&&t.height()===r.height()){if(t.isAdHoc()){const n=t.data,s=r.data;for(let t=0;t<n.length;t++)for(let r=0;r<n[0].length;r++)n[t][r]=e(n[t][r],s[t][r]);return p.SimpleRangeValue.onlyValues(n)}if(r.isAdHoc()){const n=t.data,s=r.data;for(let t=0;t<n.length;t++)for(let r=0;r<n[0].length;r++)s[t][r]=e(n[t][r],s[t][r]);return p.SimpleRangeValue.onlyValues(s)}}const n=Math.max(t.width(),r.width()),s=Math.max(t.height(),r.height()),a=Array(s);for(let e=0;e<s;e++)a[e]=Array(n);for(let i=0;i<s;i++){const s=1!==t.height()?i:0,u=1!==r.height()?i:0;for(let l=0;l<n;l++){const n=1!==t.width()?l:0,c=1!==r.width()?l:0;s<t.height()&&u<r.height()&&n<t.width()&&c<r.width()?a[i][l]=e(t.data[s][n],r.data[u][c]):a[i][l]=new o.CellError(o.ErrorType.NA)}}return p.SimpleRangeValue.onlyValues(a)}return e(t,r)}}},function(e,t,r){"use strict";t.__esModule=!0,t.buildCriterionLambda=t.buildCriterion=t.CriterionType=t.CriterionBuilder=void 0;var n,s=r(160);!function(e){e.GREATER_THAN="GREATER_THAN",e.GREATER_THAN_OR_EQUAL="GREATER_THAN_OR_EQUAL",e.LESS_THAN="LESS_THAN",e.LESS_THAN_OR_EQUAL="LESS_THAN_OR_EQUAL",e.NOT_EQUAL="NOT_EQUAL",e.EQUAL="EQUAL"}(n||(t.CriterionType=n={}));const o=(e,t)=>({operator:e,value:t});t.buildCriterion=o;t.CriterionBuilder=class{constructor(e){var t,r,n,s;this.trueString=null!==(r=null===(t=e.translationPackage.getMaybeFunctionTranslation("TRUE"))||void 0===t?void 0:t.toLowerCase())&&void 0!==r?r:"true",this.falseString=null!==(s=null===(n=e.translationPackage.getMaybeFunctionTranslation("FALSE"))||void 0===n?void 0:n.toLowerCase())&&void 0!==s?s:"false"}fromCellValue(e,t){if("string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e)return;const r=this.parseCriterion(e,t);return void 0!==r?{raw:e,lambda:i(r,t)}:void 0}parseCriterion(e,t){if("number"==typeof e||"boolean"==typeof e)return o(n.EQUAL,e);if("string"==typeof e){const r=a.exec(e);let i,u;r?(u=function(e){switch(e){case">":return n.GREATER_THAN;case">=":return n.GREATER_THAN_OR_EQUAL;case"<":return n.LESS_THAN;case"<=":return n.LESS_THAN_OR_EQUAL;case"<>":return n.NOT_EQUAL;case"=":return n.EQUAL;default:return}}(r[1]),i=r[2]):(u=n.EQUAL,i=e);const l=t.coerceToMaybeNumber(i),c=i.toLowerCase()===this.trueString||i.toLowerCase()!==this.falseString&&void 0;if(void 0===u)return;if(""===i)return o(u,null);if(void 0!==l)return o(u,(0,s.getRawValue)(l));if(u===n.EQUAL||u===n.NOT_EQUAL)return o(u,null!=c?c:i)}}};const a=/([<>=]+)(.*)/;const i=(e,t)=>{switch(e.operator){case n.GREATER_THAN:return"number"==typeof e.value?r=>"number"==typeof r&&t.floatCmp(r,e.value)>0:e=>!1;case n.GREATER_THAN_OR_EQUAL:return"number"==typeof e.value?r=>"number"==typeof r&&t.floatCmp(r,e.value)>=0:e=>!1;case n.LESS_THAN:return"number"==typeof e.value?r=>"number"==typeof r&&t.floatCmp(r,e.value)<0:e=>!1;case n.LESS_THAN_OR_EQUAL:return"number"==typeof e.value?r=>"number"==typeof r&&t.floatCmp(r,e.value)<=0:e=>!1;case n.EQUAL:return"number"==typeof e.value?r=>{if("number"==typeof r)return 0===t.floatCmp(r,e.value);if("string"==typeof r){if(""===r)return!1;const n=t.coerceToMaybeNumber(r);return void 0!==n&&0===t.floatCmp(n,e.value)}return!1}:"string"==typeof e.value?t.eqMatcherFunction(e.value):"boolean"==typeof e.value?t=>"boolean"==typeof t&&t===e.value:e=>e===s.EmptyValue;case n.NOT_EQUAL:return"number"==typeof e.value?r=>{if("number"==typeof r)return 0!==t.floatCmp(r,e.value);if("string"==typeof r){if(""===r)return!0;const n=t.coerceToMaybeNumber(r);return void 0===n||0!==t.floatCmp(n,e.value)}return!0}:"string"==typeof e.value?t.neqMatcherFunction(e.value):"boolean"==typeof e.value?t=>"boolean"!=typeof t||t!==e.value:e=>e!==s.EmptyValue}};t.buildCriterionLambda=i},function(e,t,r){"use strict";t.__esModule=!0,t.LazilyTransformingAstService=void 0,r(3);var n=r(229),s=r(162);t.LazilyTransformingAstService=class{constructor(e){this.stats=e,this.transformations=[]}version(){return this.transformations.length}addTransformation(e){return void 0!==this.combinedTransformer?this.combinedTransformer.add(e):this.transformations.push(e),this.version()}beginCombinedMode(e){this.combinedTransformer=new n.CombinedTransformer(e)}commitCombinedMode(){if(void 0===this.combinedTransformer)throw Error("Combined mode wasn't started");return this.transformations.push(this.combinedTransformer),this.combinedTransformer=void 0,this.version()}applyTransformations(e,t,r){this.stats.start(s.StatType.TRANSFORM_ASTS_POSTPONED);for(let n=r;n<this.transformations.length;n++){const r=this.transformations[n];r.isIrreversible()&&(this.undoRedo.storeDataForVersion(n,t,this.parser.computeHashFromAst(e)),this.parser.rememberNewAst(e));const[s,o]=r.transformSingleAst(e,t);e=s,t=o}const n=this.parser.rememberNewAst(e);return this.stats.end(s.StatType.TRANSFORM_ASTS_POSTPONED),[n,t,this.transformations.length]}*getTransformationsFrom(e,t){for(let r=e;r<this.transformations.length;r++){const e=this.transformations[r];t&&!t(e)||(yield e)}}}},function(e,t,r){"use strict";t.__esModule=!0,t.CombinedTransformer=void 0,r(3),r(73),r(134);t.CombinedTransformer=class{constructor(e){this.sheet=e,this.transformations=[]}add(e){this.transformations.push(e)}performEagerTransformations(e,t){this.transformations.forEach((r=>r.performEagerTransformations(e,t)))}transformSingleAst(e,t){let[r,n]=[e,t];return this.transformations.forEach((e=>{[r,n]=e.transformSingleAst(r,n)})),[r,n]}isIrreversible(){return!0}}},function(e,t,r){"use strict";t.__esModule=!0,t.buildColumnSearchStrategy=function(e,t,r){return t.useColumnIndex?new s.ColumnIndex(e,t,r):new n.ColumnBinarySearch(e)};var n=r(231),s=r(234)},function(e,t,r){"use strict";t.__esModule=!0,t.ColumnBinarySearch=void 0;var n=r(232);class s extends n.AdvancedFind{constructor(e){super(e),this.dependencyGraph=e}add(e,t){}remove(e,t){}change(e,t,r){}applyChanges(e){}addColumns(e){}removeColumns(e){}removeSheet(e){}moveValues(e,t,r,n){}removeValues(e){}find(e,t,r){return this.basicFind(e,t,"row",r)}}t.ColumnBinarySearch=s},function(e,t,r){"use strict";t.__esModule=!0,t.AdvancedFind=void 0,r(85);var n=r(160),s=r(192),o=r(233);t.AdvancedFind=class{constructor(e){this.dependencyGraph=e}advancedFind(e,t,{returnOccurrence:r}={returnOccurrence:"first"}){const s=t.range,o=void 0===s?t.valuesFromTopLeftCorner():this.dependencyGraph.computeListOfValuesInRange(s),a="first"===r?e=>e<o.length:e=>e>=0,i="first"===r?e=>e+1:e=>e-1;for(let t="first"===r?0:o.length-1;a(t);t=i(t))if(e((0,n.getRawValue)(o[t])))return t;return-1}basicFind(e,t,r,{ordering:n,ifNoMatch:a,returnOccurrence:i}){const u="string"==typeof e?(0,s.forceNormalizeString)(e):e,l=t.range;return void 0===l?this.findNormalizedValue(u,t.valuesFromTopLeftCorner(),a,i):"none"===n?this.findNormalizedValue(u,this.dependencyGraph.computeListOfValuesInRange(l),a,i):(0,o.findLastOccurrenceInOrderedRange)(u,l,{searchCoordinate:r,orderingDirection:n,ifNoMatch:a},this.dependencyGraph)}findNormalizedValue(e,t,r="returnNotFound",a="first"){const i=t.map(n.getRawValue).map((e=>"string"==typeof e?(0,s.forceNormalizeString)(e):e));if("returnNotFound"===r)return"first"===a?i.indexOf(e):i.lastIndexOf(e);const u="returnLowerBound"===r?(e,t)=>(0,o.compare)(e,t):(e,t)=>-(0,o.compare)(e,t);let l="returnLowerBound"===r?-1/0:1/0,c=-1;const h="first"===a?e=>e<i.length:e=>e>=0,d="first"===a?e=>e+1:e=>e-1;for(let t="first"===a?0:i.length-1;h(t);t=d(t)){const r=i[t];if(r===e)return t;u(r,e)>0||u(l,r)<0&&(l=r,c=t)}return c}}},function(e,t,r){"use strict";t.__esModule=!0,t.compare=i,t.findLastMatchingIndex=a,t.findLastOccurrenceInOrderedArray=function(e,t,r="asc"){return a("asc"===r?r=>i(e,t[r])>=0:r=>-i(e,t[r])>=0,0,t.length-1)},t.findLastOccurrenceInOrderedRange=function(e,t,{searchCoordinate:r,orderingDirection:u,ifNoMatch:l},c){const h=t.start[r],d="col"===r?t.effectiveEndColumn(c):t.effectiveEndRow(c),p="col"===r?e=>(0,s.getRawValue)(c.getCellValue((0,n.simpleCellAddress)(t.sheet,e,t.start.row))):e=>(0,s.getRawValue)(c.getCellValue((0,n.simpleCellAddress)(t.sheet,t.start.col,e))),m="asc"===u?(e,t)=>i(e,t):(e,t)=>-i(e,t),g=a((t=>m(e,p(t))>=0),h,d),E=p(g);if(E===e)return g-h;if("returnLowerBound"===l){if(g===o)return"asc"===u?o:0;if(typeof E!=typeof e)return o;if("asc"===u)return g-h;const t=g+1;return t<=d?t-h:o}if("returnUpperBound"===l){if(g===o)return"asc"===u?0:o;if(typeof E!=typeof e)return o;if("desc"===u)return g-h;const t=g+1;return t<=d?t-h:o}return o};var n=r(106),s=r(160);const o=-1;function a(e,t,r){let n=t,s=r;for(;n<s;){const t=Math.ceil((n+s)/2);e(t)?n=t:s=t-1}return n===s&&e(n)?n:o}function i(e,t){return typeof e==typeof t?e===s.EmptyValue?0:e<t?-1:e>t?1:0:e===s.EmptyValue?-1:t===s.EmptyValue?1:t instanceof n.CellError||"number"==typeof e&&"string"==typeof t||"number"==typeof e&&"boolean"==typeof t?-1:"string"==typeof e&&"number"==typeof t?1:"string"==typeof e&&"boolean"==typeof t?-1:1}},function(e,t,r){"use strict";t.__esModule=!0,t.ColumnIndex=void 0,t.findInOrderedArray=d,r(73),r(183);var n=r(106),s=r(213),o=r(217),a=r(192),i=r(160),u=r(159),l=r(162),c=r(231);class h{constructor(e,t,r){this.dependencyGraph=e,this.config=t,this.stats=r,this.index=new Map,this.transformingService=this.dependencyGraph.lazilyTransformingAstService,this.binarySearchStrategy=new c.ColumnBinarySearch(e)}add(e,t){if(!(e===i.EmptyValue||e instanceof n.CellError))if(e instanceof u.SimpleRangeValue)for(const[r,n]of e.entriesFromTopLeftCorner(t))this.addSingleCellValue((0,i.getRawValue)(r),n);else this.addSingleCellValue(e,t)}remove(e,t){if(void 0!==e)if(e instanceof u.SimpleRangeValue)for(const[r,n]of e.entriesFromTopLeftCorner(t))this.removeSingleValue((0,i.getRawValue)(r),n);else this.removeSingleValue(e,t)}change(e,t,r){e!==t&&(this.remove(e,r),this.add(t,r))}applyChanges(e){for(const t of e)void 0!==t.oldValue&&this.change((0,i.getRawValue)(t.oldValue),(0,i.getRawValue)(t.value),t.address)}moveValues(e,t,r,s){for(const[o,a]of e){const e=(0,n.movedSimpleCellAddress)(a,s,t,r);this.remove(o,a),this.add(o,e)}}removeValues(e){for(const[t,r]of e)this.remove(t,r)}find(e,t,{ordering:r,ifNoMatch:n,returnOccurrence:s}){null==s&&(s="none"===r?"first":"last");const o=this.findUsingColumnIndex(e,t,s);return void 0!==o?o:this.binarySearchStrategy.find(e,t,{ordering:r,ifNoMatch:n,returnOccurrence:s})}findUsingColumnIndex(e,t,r){const n=t.range;if(void 0===n)return;this.ensureRecentData(n.sheet,n.start.col,e);const s=this.getColumnMap(n.sheet,n.start.col);if(!s)return-1;const o="string"==typeof e?(0,a.forceNormalizeString)(e):e,i=s.get(o);if(!i||!i.index||0===i.index.length)return;const u=h.findRowBelongingToRange(i,n,r);return void 0!==u?u-n.start.row:void 0}static findRowBelongingToRange(e,t,r){const n=t.start.row,s=t.end.row,o="first"===r?d(n,e.index,"upperBound"):d(s,e.index,"lowerBound");if(-1===o)return;const a=e.index[o];return a>=n&&a<=s?a:void 0}advancedFind(e,t,r={returnOccurrence:"first"}){return this.binarySearchStrategy.advancedFind(e,t,r)}addColumns(e){const t=this.index.get(e.sheet);t&&t.splice(e.columnStart,0,...Array(e.numberOfColumns))}removeColumns(e){const t=this.index.get(e.sheet);t&&t.splice(e.columnStart,e.numberOfColumns)}removeSheet(e){this.index.delete(e)}getColumnMap(e,t){this.index.has(e)||this.index.set(e,[]);const r=this.index.get(e);let n=r[t];return n||(n=new Map,r[t]=n),n}getValueIndex(e,t,r){const n=this.getColumnMap(e,t);let s=this.getColumnMap(e,t).get(r);return s||(s={version:this.transformingService.version(),index:[]},n.set(r,s)),s}ensureRecentData(e,t,r){const n=this.getValueIndex(e,t,r),a=this.transformingService.version();if(n.version===a)return;const i=this.transformingService.getTransformationsFrom(n.version,(t=>t.sheet===e&&(t instanceof s.AddRowsTransformer||t instanceof o.RemoveRowsTransformer)));for(const e of i)e instanceof s.AddRowsTransformer?this.addRows(t,e.rowsSpan,r):e instanceof o.RemoveRowsTransformer&&this.removeRows(t,e.rowsSpan,r);n.version=a}addSingleCellValue(e,t){this.stats.measure(l.StatType.BUILD_COLUMN_INDEX,(()=>{this.ensureRecentData(t.sheet,t.col,e),"string"==typeof e&&(e=(0,a.forceNormalizeString)(e));const r=this.getValueIndex(t.sheet,t.col,e);h.addValue(r,t.row)}))}removeSingleValue(e,t){this.stats.measure(l.StatType.BUILD_COLUMN_INDEX,(()=>{this.ensureRecentData(t.sheet,t.col,e);const r=this.getColumnMap(t.sheet,t.col);"string"==typeof e&&(e=(0,a.forceNormalizeString)(e));const n=r.get(e);if(!n)return;const s=d(t.row,n.index);s>-1&&n.index.splice(s,1),0===n.index.length&&r.delete(e),0===r.size&&delete this.index.get(t.sheet)[t.col]}))}addRows(e,t,r){const n=this.getValueIndex(t.sheet,e,r);h.shiftRows(n,t.rowStart,t.numberOfRows)}removeRows(e,t,r){const n=this.getValueIndex(t.sheet,e,r);h.removeRowsFromValues(n,t),h.shiftRows(n,t.rowEnd+1,-t.numberOfRows)}static addValue(e,t){const r=d(t,e.index,"lowerBound");e.index[r]===t||e.index.splice(r+1,0,t)}static removeRowsFromValues(e,t){const r=d(t.rowStart,e.index,"upperBound"),n=d(t.rowEnd,e.index,"lowerBound");r>-1&&n>-1&&r<=n&&e.index[r]<=t.rowEnd&&e.index.splice(r,n-r+1)}static shiftRows(e,t,r){const n=d(t,e.index,"upperBound");if(-1!==n)for(let t=n;t<e.index.length;++t)e.index[t]+=r}}function d(e,t,r="upperBound"){let n=0,s=t.length-1;for(;n<=s;){const r=Math.floor((n+s)/2);if(e>t[r])n=r+1;else{if(!(e<t[r]))return r;s=r-1}}const o="lowerBound"===r?s:n;return o>=0&&o<=t.length?o:-1}t.ColumnIndex=h},function(e,t,r){"use strict";t.__esModule=!0,t.NumberLiteralHelper=void 0;t.NumberLiteralHelper=class{constructor(e){this.config=e;const t="."===this.config.thousandSeparator?`\\${this.config.thousandSeparator}`:this.config.thousandSeparator,r="."===this.config.decimalSeparator?`\\${this.config.decimalSeparator}`:this.config.decimalSeparator;this.numberPattern=new RegExp(`^([+-]?((${r}\\d+)|(\\d+(${t}\\d{3,})*(${r}\\d*)?)))(e[+-]?\\d+)?$`),this.allThousandSeparatorsRegex=new RegExp(`${t}`,"g")}numericStringToMaybeNumber(e){if(this.numberPattern.test(e)){const t=this.numericStringToNumber(e);if(isNaN(t))return;return t}}numericStringToNumber(e){const t=e.replace(this.allThousandSeparatorsRegex,"").replace(this.config.decimalSeparator,".");return Number(t)}}},function(e,t,r){"use strict";t.__esModule=!0,t.Serialization=void 0,r(85);var n=r(106),s=r(107),o=r(137);class a{constructor(e,t,r){this.dependencyGraph=e,this.unparser=t,this.exporter=r}getCellHyperlink(e){const t=this.dependencyGraph.getCell(e);if(t instanceof s.FormulaCellVertex){const e=t.getFormula(this.dependencyGraph.lazilyTransformingAstService);if("HYPERLINK"===e.procedureName)return e.hyperlink}}getCellFormula(e,t){const r=this.dependencyGraph.getCell(e);if(r instanceof s.FormulaCellVertex){const n=r.getFormula(this.dependencyGraph.lazilyTransformingAstService);return t=null!=t?t:e,this.unparser.unparse(n,t)}if(r instanceof s.ArrayVertex){const n=r.getAddress(this.dependencyGraph.lazilyTransformingAstService);if(n.row!==e.row||n.col!==e.col||n.sheet!==e.sheet)return;t=null!=t?t:e;const s=r.getFormula(this.dependencyGraph.lazilyTransformingAstService);if(void 0!==s)return this.unparser.unparse(s,t)}else if(r instanceof s.ParsingErrorVertex)return r.getFormula()}getCellSerialized(e,t){var r;return null!==(r=this.getCellFormula(e,t))&&void 0!==r?r:this.getRawValue(e)}getCellValue(e){return this.exporter.exportValue(this.dependencyGraph.getScalarValue(e))}getRawValue(e){return this.dependencyGraph.getRawValue(e)}getSheetValues(e){return this.genericSheetGetter(e,(e=>this.getCellValue(e)))}getSheetFormulas(e){return this.genericSheetGetter(e,(e=>this.getCellFormula(e)))}genericSheetGetter(e,t){const r=this.dependencyGraph.getSheetHeight(e),s=this.dependencyGraph.getSheetWidth(e),o=new Array(r);for(let a=0;a<r;a++){o[a]=new Array(s);for(let r=0;r<s;r++){const s=(0,n.simpleCellAddress)(e,r,a);o[a][r]=t(s)}for(let e=s-1;e>=0&&(null===o[a][e]||void 0===o[a][e]);e--)o[a].pop()}for(let e=r-1;e>=0&&0===o[e].length;e--)o.pop();return o}genericAllSheetsGetter(e){const t={};for(const r of this.dependencyGraph.sheetMapping.displayNames()){const n=this.dependencyGraph.sheetMapping.fetch(r);t[r]=e(n)}return t}getSheetSerialized(e){return this.genericSheetGetter(e,(e=>this.getCellSerialized(e)))}getAllSheetsValues(){return this.genericAllSheetsGetter((e=>this.getSheetValues(e)))}getAllSheetsFormulas(){return this.genericAllSheetsGetter((e=>this.getSheetFormulas(e)))}getAllSheetsSerialized(){return this.genericAllSheetsGetter((e=>this.getSheetSerialized(e)))}getAllNamedExpressionsSerialized(){const e=[];let t=0;for(const r of this.dependencyGraph.sheetMapping.displayNames()){const n=this.dependencyGraph.sheetMapping.fetch(r);e[n]=t,t++}return this.dependencyGraph.namedExpressions.getAllNamedExpressions().map((t=>({name:t.expression.displayName,expression:this.getCellSerialized(t.expression.address),scope:void 0!==t.scope?e[t.scope]:void 0,options:t.expression.options})))}withNewConfig(e,t){const r=new o.Unparser(e,(0,o.buildLexerConfig)(e),this.dependencyGraph.sheetMapping.fetchDisplayName,t);return new a(this.dependencyGraph,r,this.exporter)}}t.Serialization=a},function(e,t,r){"use strict";function n(e){return()=>{throw new Error(`The "${e}" method cannot be called because this HyperFormula instance has been destroyed`)}}t.__esModule=!0,t.objectDestroy=function(e){for(const[t,r]of Object.entries(e))r instanceof Function?e[t]=n(r):delete e[t]}},function(e,t,r){"use strict";t.__esModule=!0,t.Events=t.Emitter=void 0;var n,s=r(239);!function(e){e.SheetAdded="sheetAdded",e.SheetRemoved="sheetRemoved",e.SheetRenamed="sheetRenamed",e.NamedExpressionAdded="namedExpressionAdded",e.NamedExpressionRemoved="namedExpressionRemoved",e.ValuesUpdated="valuesUpdated",e.EvaluationSuspended="evaluationSuspended",e.EvaluationResumed="evaluationResumed"}(n||(t.Events=n={}));class o extends s.TinyEmitter{emit(e,...t){return super.emit(e,...t),this}}t.Emitter=o},function(e,r){e.exports=t},function(e,t,r){"use strict";t.__esModule=!0,t.default=void 0;t.default={errors:{CYCLE:"#CYCLE!",DIV_BY_ZERO:"#DIV/0!",ERROR:"#ERROR!",NA:"#N/A",NAME:"#NAME?",NUM:"#NUM!",REF:"#REF!",SPILL:"#SPILL!",VALUE:"#VALUE!"},functions:{FILTER:"FILTER",ADDRESS:"ADDRESS",ARRAY_CONSTRAIN:"ARRAY_CONSTRAIN",ARRAYFORMULA:"ARRAYFORMULA",ABS:"ABS",ACOS:"ACOS",ACOSH:"ACOSH",ACOT:"ACOT",ACOTH:"ACOTH",AND:"AND",ARABIC:"ARABIC",ASIN:"ASIN",ASINH:"ASINH",ATAN2:"ATAN2",ATAN:"ATAN",ATANH:"ATANH",AVERAGE:"AVERAGE",AVERAGEA:"AVERAGEA",AVERAGEIF:"AVERAGEIF",BASE:"BASE",BIN2DEC:"BIN2DEC",BIN2HEX:"BIN2HEX",BIN2OCT:"BIN2OCT",BITAND:"BITAND",BITLSHIFT:"BITLSHIFT",BITOR:"BITOR",BITRSHIFT:"BITRSHIFT",BITXOR:"BITXOR",CEILING:"CEILING",CHAR:"CHAR",CHOOSE:"CHOOSE",CLEAN:"CLEAN",CODE:"CODE",COLUMN:"COLUMN",COLUMNS:"COLUMNS",CONCATENATE:"CONCATENATE",CORREL:"CORREL",COS:"COS",COSH:"COSH",COT:"COT",COTH:"COTH",COUNT:"COUNT",COUNTA:"COUNTA",COUNTBLANK:"COUNTBLANK",COUNTIF:"COUNTIF",COUNTIFS:"COUNTIFS",COUNTUNIQUE:"COUNTUNIQUE",CSC:"CSC",CSCH:"CSCH",CUMIPMT:"CUMIPMT",CUMPRINC:"CUMPRINC",DATE:"DATE",DATEDIF:"DATEDIF",DATEVALUE:"DATEVALUE",DAY:"DAY",DAYS360:"DAYS360",DAYS:"DAYS",DB:"DB",DDB:"DDB",DEC2BIN:"DEC2BIN",DEC2HEX:"DEC2HEX",DEC2OCT:"DEC2OCT",DECIMAL:"DECIMAL",DEGREES:"DEGREES",DELTA:"DELTA",DOLLARDE:"DOLLARDE",DOLLARFR:"DOLLARFR",EDATE:"EDATE",EFFECT:"EFFECT",EOMONTH:"EOMONTH",ERF:"ERF",ERFC:"ERFC",EVEN:"EVEN",EXACT:"EXACT",EXP:"EXP",FALSE:"FALSE",FIND:"FIND",FORMULATEXT:"FORMULATEXT",FV:"FV",FVSCHEDULE:"FVSCHEDULE",HEX2BIN:"HEX2BIN",HEX2DEC:"HEX2DEC",HEX2OCT:"HEX2OCT",HLOOKUP:"HLOOKUP",HOUR:"HOUR",HYPERLINK:"HYPERLINK",IF:"IF",IFERROR:"IFERROR",IFNA:"IFNA",IFS:"IFS",INDEX:"INDEX",INT:"INT",INTERVAL:"INTERVAL",IPMT:"IPMT",ISBINARY:"ISBINARY",ISBLANK:"ISBLANK",ISERR:"ISERR",ISERROR:"ISERROR",ISEVEN:"ISEVEN",ISFORMULA:"ISFORMULA",ISLOGICAL:"ISLOGICAL",ISNA:"ISNA",ISNONTEXT:"ISNONTEXT",ISNUMBER:"ISNUMBER",ISODD:"ISODD",ISOWEEKNUM:"ISOWEEKNUM",ISPMT:"ISPMT",ISREF:"ISREF",ISTEXT:"ISTEXT",LEFT:"LEFT",LEN:"LEN",LN:"LN",LOG10:"LOG10",LOG:"LOG",LOWER:"LOWER",MATCH:"MATCH",MAX:"MAX",MAXA:"MAXA",MAXIFS:"MAXIFS",MAXPOOL:"MAXPOOL",MEDIAN:"MEDIAN",MEDIANPOOL:"MEDIANPOOL",MID:"MID",MIN:"MIN",MINA:"MINA",MINIFS:"MINIFS",MINUTE:"MINUTE",MIRR:"MIRR",MMULT:"MMULT",MOD:"MOD",MONTH:"MONTH",NA:"NA",NETWORKDAYS:"NETWORKDAYS","NETWORKDAYS.INTL":"NETWORKDAYS.INTL",NOMINAL:"NOMINAL",NOT:"NOT",NOW:"NOW",NPER:"NPER",NPV:"NPV",OCT2BIN:"OCT2BIN",OCT2DEC:"OCT2DEC",OCT2HEX:"OCT2HEX",ODD:"ODD",OFFSET:"OFFSET",OR:"OR",PI:"PI",PMT:"PMT",PDURATION:"PDURATION",PRODUCT:"PRODUCT",POWER:"POWER",PPMT:"PPMT",PROPER:"PROPER",PV:"PV",RADIANS:"RADIANS",RAND:"RAND",RATE:"RATE",REPLACE:"REPLACE",REPT:"REPT",RIGHT:"RIGHT",ROMAN:"ROMAN",ROUND:"ROUND",ROUNDDOWN:"ROUNDDOWN",ROUNDUP:"ROUNDUP",ROW:"ROW",ROWS:"ROWS",RRI:"RRI",SEARCH:"SEARCH",SEC:"SEC",SECH:"SECH",SECOND:"SECOND",SHEET:"SHEET",SHEETS:"SHEETS",SIN:"SIN",SINH:"SINH",SLN:"SLN",SPLIT:"SPLIT",SQRT:"SQRT",STDEVA:"STDEVA","STDEV.P":"STDEV.P",STDEVPA:"STDEVPA","STDEV.S":"STDEV.S",SUBSTITUTE:"SUBSTITUTE",SUBTOTAL:"SUBTOTAL",SUM:"SUM",SUMIF:"SUMIF",SUMIFS:"SUMIFS",SUMPRODUCT:"SUMPRODUCT",SUMSQ:"SUMSQ",SWITCH:"SWITCH",SYD:"SYD",T:"T",TAN:"TAN",TANH:"TANH",TBILLEQ:"TBILLEQ",TBILLPRICE:"TBILLPRICE",TBILLYIELD:"TBILLYIELD",TEXT:"TEXT",TIME:"TIME",TIMEVALUE:"TIMEVALUE",TODAY:"TODAY",TRANSPOSE:"TRANSPOSE",TRIM:"TRIM",TRUE:"TRUE",TRUNC:"TRUNC",UNICHAR:"UNICHAR",UNICODE:"UNICODE",UPPER:"UPPER",VARA:"VARA","VAR.P":"VAR.P",VARPA:"VARPA","VAR.S":"VAR.S",VLOOKUP:"VLOOKUP",WEEKDAY:"WEEKDAY",WEEKNUM:"WEEKNUM",WORKDAY:"WORKDAY","WORKDAY.INTL":"WORKDAY.INTL",XNPV:"XNPV",XOR:"XOR",XLOOKUP:"XLOOKUP",YEAR:"YEAR",YEARFRAC:"YEARFRAC","HF.ADD":"HF.ADD","HF.CONCAT":"HF.CONCAT","HF.DIVIDE":"HF.DIVIDE","HF.EQ":"HF.EQ","HF.GT":"HF.GT","HF.GTE":"HF.GTE","HF.LT":"HF.LT","HF.LTE":"HF.LTE","HF.MINUS":"HF.MINUS","HF.MULTIPLY":"HF.MULTIPLY","HF.NE":"HF.NE","HF.POW":"HF.POW","HF.UMINUS":"HF.UMINUS","HF.UNARY_PERCENT":"HF.UNARY_PERCENT","HF.UPLUS":"HF.UPLUS",VARP:"VARP",VAR:"VAR",STDEVP:"STDEVP",STDEV:"STDEV","EXPON.DIST":"EXPON.DIST",FISHER:"FISHER",FISHERINV:"FISHERINV",GAMMA:"GAMMA","GAMMA.DIST":"GAMMA.DIST",GAMMALN:"GAMMALN","GAMMALN.PRECISE":"GAMMALN.PRECISE","GAMMA.INV":"GAMMA.INV",GAUSS:"GAUSS",FACT:"FACT",FACTDOUBLE:"FACTDOUBLE",COMBIN:"COMBIN",COMBINA:"COMBINA",GCD:"GCD",LCM:"LCM",MROUND:"MROUND",MULTINOMIAL:"MULTINOMIAL",QUOTIENT:"QUOTIENT",RANDBETWEEN:"RANDBETWEEN",SERIESSUM:"SERIESSUM",SIGN:"SIGN",SQRTPI:"SQRTPI",SUMX2MY2:"SUMX2MY2",SUMX2PY2:"SUMX2PY2",SUMXMY2:"SUMXMY2",EXPONDIST:"EXPONDIST",GAMMADIST:"GAMMADIST",GAMMAINV:"GAMMAINV","BETA.DIST":"BETA.DIST",BETADIST:"BETADIST","BETA.INV":"BETA.INV",BETAINV:"BETAINV","BINOM.DIST":"BINOM.DIST",BINOMDIST:"BINOMDIST","BINOM.INV":"BINOM.INV",BESSELI:"BESSELI",BESSELJ:"BESSELJ",BESSELK:"BESSELK",BESSELY:"BESSELY","CHISQ.DIST":"CHISQ.DIST","CHISQ.DIST.RT":"CHISQ.DIST.RT","CHISQ.INV":"CHISQ.INV","CHISQ.INV.RT":"CHISQ.INV.RT",CHIDIST:"CHIDIST",CHIINV:"CHIINV","F.DIST":"F.DIST","F.DIST.RT":"F.DIST.RT","F.INV":"F.INV","F.INV.RT":"F.INV.RT",FDIST:"FDIST",FINV:"FINV",WEIBULL:"WEIBULL","WEIBULL.DIST":"WEIBULL.DIST",POISSON:"POISSON","POISSON.DIST":"POISSON.DIST","HYPGEOM.DIST":"HYPGEOM.DIST",HYPGEOMDIST:"HYPGEOMDIST","T.DIST":"T.DIST","T.DIST.2T":"T.DIST.2T","T.DIST.RT":"T.DIST.RT","T.INV":"T.INV","T.INV.2T":"T.INV.2T",TDIST:"TDIST",TINV:"TINV",LOGINV:"LOGINV","LOGNORM.DIST":"LOGNORM.DIST","LOGNORM.INV":"LOGNORM.INV",LOGNORMDIST:"LOGNORMDIST","NORM.DIST":"NORM.DIST","NORM.INV":"NORM.INV","NORM.S.DIST":"NORM.S.DIST","NORM.S.INV":"NORM.S.INV",NORMDIST:"NORMDIST",NORMINV:"NORMINV",NORMSDIST:"NORMSDIST",NORMSINV:"NORMSINV",PHI:"PHI","NEGBINOM.DIST":"NEGBINOM.DIST",NEGBINOMDIST:"NEGBINOMDIST",COMPLEX:"COMPLEX",IMABS:"IMABS",IMAGINARY:"IMAGINARY",IMARGUMENT:"IMARGUMENT",IMCONJUGATE:"IMCONJUGATE",IMCOS:"IMCOS",IMCOSH:"IMCOSH",IMCOT:"IMCOT",IMCSC:"IMCSC",IMCSCH:"IMCSCH",IMDIV:"IMDIV",IMEXP:"IMEXP",IMLN:"IMLN",IMLOG10:"IMLOG10",IMLOG2:"IMLOG2",IMPOWER:"IMPOWER",IMPRODUCT:"IMPRODUCT",IMREAL:"IMREAL",IMSEC:"IMSEC",IMSECH:"IMSECH",IMSIN:"IMSIN",IMSINH:"IMSINH",IMSQRT:"IMSQRT",IMSUB:"IMSUB",IMSUM:"IMSUM",IMTAN:"IMTAN",LARGE:"LARGE",SMALL:"SMALL",AVEDEV:"AVEDEV",CONFIDENCE:"CONFIDENCE","CONFIDENCE.NORM":"CONFIDENCE.NORM","CONFIDENCE.T":"CONFIDENCE.T",DEVSQ:"DEVSQ",GEOMEAN:"GEOMEAN",HARMEAN:"HARMEAN",CRITBINOM:"CRITBINOM","COVARIANCE.P":"COVARIANCE.P","COVARIANCE.S":"COVARIANCE.S",COVAR:"COVAR",PEARSON:"PEARSON",RSQ:"RSQ",STANDARDIZE:"STANDARDIZE","Z.TEST":"Z.TEST",ZTEST:"ZTEST","F.TEST":"F.TEST",FTEST:"FTEST",STEYX:"STEYX",SLOPE:"SLOPE","CHISQ.TEST":"CHISQ.TEST",CHITEST:"CHITEST","T.TEST":"T.TEST",TTEST:"TTEST",SKEW:"SKEW","SKEW.P":"SKEW.P",WEIBULLDIST:"WEIBULLDIST",VARS:"VARS",TINV2T:"TINV2T",TDISTRT:"TDISTRT",TDIST2T:"TDIST2T",STDEVS:"STDEVS",FINVRT:"FINVRT",FDISTRT:"FDISTRT",CHIDISTRT:"CHIDISTRT",CHIINVRT:"CHIINVRT",COVARIANCEP:"COVARIANCEP",COVARIANCES:"COVARIANCES",LOGNORMINV:"LOGNORMINV",POISSONDIST:"POISSONDIST",SKEWP:"SKEWP","CEILING.MATH":"CEILING.MATH",FLOOR:"FLOOR","FLOOR.MATH":"FLOOR.MATH","CEILING.PRECISE":"CEILING.PRECISE","FLOOR.PRECISE":"FLOOR.PRECISE","ISO.CEILING":"ISO.CEILING"},langCode:"enGB",ui:{NEW_SHEET_PREFIX:"Sheet"}}},function(e,t,r){"use strict";t.__esModule=!0,t.TrigonometryPlugin=t.TextPlugin=t.SumprodPlugin=t.StatisticalPlugin=t.StatisticalAggregationPlugin=t.SqrtPlugin=t.SimpleArithmerticPlugin=t.RoundingPlugin=t.RomanPlugin=t.RandomPlugin=t.RadixConversionPlugin=t.RadiansPlugin=t.PowerPlugin=t.NumericAggregationPlugin=t.ModuloPlugin=t.MedianPlugin=t.MatrixPlugin=t.MathPlugin=t.MathConstantsPlugin=t.LookupPlugin=t.LogarithmPlugin=t.IsOddPlugin=t.IsEvenPlugin=t.InformationPlugin=t.HyperlinkPlugin=t.FormulaTextPlugin=t.FinancialPlugin=t.ExpPlugin=t.DeltaPlugin=t.DegreesPlugin=t.DateTimePlugin=t.CountUniquePlugin=t.CountBlankPlugin=t.ConditionalAggregationPlugin=t.ComplexPlugin=t.CodePlugin=t.CharPlugin=t.BooleanPlugin=t.BitwiseLogicOperationsPlugin=t.BitShiftPlugin=t.ArrayPlugin=t.AddressPlugin=t.AbsPlugin=void 0;var n=r(242);t.AddressPlugin=n.AddressPlugin;var s=r(243);t.ArrayPlugin=s.ArrayPlugin;var o=r(244);t.AbsPlugin=o.AbsPlugin;var a=r(245);t.BitShiftPlugin=a.BitShiftPlugin;var i=r(246);t.BitwiseLogicOperationsPlugin=i.BitwiseLogicOperationsPlugin;var u=r(247);t.BooleanPlugin=u.BooleanPlugin;var l=r(248);t.CharPlugin=l.CharPlugin;var c=r(249);t.CodePlugin=c.CodePlugin;var h=r(250);t.CountBlankPlugin=h.CountBlankPlugin;var d=r(251);t.CountUniquePlugin=d.CountUniquePlugin;var p=r(252);t.DateTimePlugin=p.DateTimePlugin;var m=r(253);t.DegreesPlugin=m.DegreesPlugin;var g=r(254);t.DeltaPlugin=g.DeltaPlugin;var E=r(255);t.ExpPlugin=E.ExpPlugin;var T=r(256);t.FinancialPlugin=T.FinancialPlugin;var y=r(257);t.FormulaTextPlugin=y.FormulaTextPlugin;var f=r(258);t.HyperlinkPlugin=f.HyperlinkPlugin;var A=r(259);t.InformationPlugin=A.InformationPlugin;var R=r(260);t.IsEvenPlugin=R.IsEvenPlugin;var N=r(261);t.IsOddPlugin=N.IsOddPlugin;var S=r(262);t.LogarithmPlugin=S.LogarithmPlugin;var C=r(263);t.MathConstantsPlugin=C.MathConstantsPlugin;var v=r(264);t.MatrixPlugin=v.MatrixPlugin;var M=r(265);t.MedianPlugin=M.MedianPlugin;var w=r(266);t.ModuloPlugin=w.ModuloPlugin;var F=r(267);t.NumericAggregationPlugin=F.NumericAggregationPlugin;var O=r(268);t.PowerPlugin=O.PowerPlugin;var I=r(269);t.RadiansPlugin=I.RadiansPlugin;var b=r(270);t.RadixConversionPlugin=b.RadixConversionPlugin;var x=r(271);t.RandomPlugin=x.RandomPlugin;var V=r(272);t.RoundingPlugin=V.RoundingPlugin;var U=r(273);t.SqrtPlugin=U.SqrtPlugin;var _=r(274);t.ConditionalAggregationPlugin=_.ConditionalAggregationPlugin;var P=r(277);t.SumprodPlugin=P.SumprodPlugin;var L=r(278);t.TextPlugin=L.TextPlugin;var D=r(279);t.TrigonometryPlugin=D.TrigonometryPlugin;var B=r(280);t.LookupPlugin=B.LookupPlugin;var G=r(282);t.RomanPlugin=G.RomanPlugin;var H=r(283);t.SimpleArithmerticPlugin=H.SimpleArithmerticPlugin;var W=r(284);t.StatisticalPlugin=W.StatisticalPlugin;var k=r(287);t.MathPlugin=k.MathPlugin;var z=r(288);t.ComplexPlugin=z.ComplexPlugin;var Y=r(289);t.StatisticalAggregationPlugin=Y.StatisticalAggregationPlugin},function(e,t,r){"use strict";t.__esModule=!0,t.AddressPlugin=void 0;var n,s=r(138),o=r(189),a=r(106),i=r(151);!function(e){e[e.FullyAbsolute=1]="FullyAbsolute",e[e.RowAbsoluteColRelative=2]="RowAbsoluteColRelative",e[e.RowRelativeColAbsolute=3]="RowRelativeColAbsolute",e[e.FullyRelative=4]="FullyRelative"}(n||(n={}));class u extends o.FunctionPlugin{verifyAddressArguments(e,t,r,s){if(s){if(e<1||t<1)return new a.CellError(a.ErrorType.VALUE,i.ErrorMessage.LessThanOne)}else if(n.FullyAbsolute==r){if(e<1||t<1)return new a.CellError(a.ErrorType.VALUE,i.ErrorMessage.LessThanOne)}else if(n.RowAbsoluteColRelative==r){if(e<1)return new a.CellError(a.ErrorType.VALUE,i.ErrorMessage.LessThanOne)}else if(n.RowRelativeColAbsolute==r&&t<1)return new a.CellError(a.ErrorType.VALUE,i.ErrorMessage.LessThanOne)}address(e,t){return this.runFunction(e.args,t,this.metadata("ADDRESS"),((e,t,r,o,a)=>{const i=this.verifyAddressArguments(e,t,r,o);if(void 0!==i)return i;const u=(0,s.columnIndexToLabel)(t-1);let l="";null!=a&&(l=`${a}!`);const c=0==t?"C":`C[${t}]`,h=0==e?"R":`R[${e}]`;return n.FullyRelative==r?o?`${l}${u}${e}`:`${l}${h}${c}`:n.RowRelativeColAbsolute==r?o?`${l}$${u}${e}`:`${l}${h}C${t}`:n.RowAbsoluteColRelative==r?o?`${l}${u}$${e}`:`${l}R${e}${c}`:o?`${l}$${u}$${e}`:`${l}R${e}C${t}`}))}}t.AddressPlugin=u,u.implementedFunctions={ADDRESS:{method:"address",parameters:[{argumentType:o.FunctionArgumentType.NUMBER},{argumentType:o.FunctionArgumentType.NUMBER},{argumentType:o.FunctionArgumentType.NUMBER,optionalArg:!0,defaultValue:1,minValue:1,maxValue:4},{argumentType:o.FunctionArgumentType.BOOLEAN,optionalArg:!0,defaultValue:!0},{argumentType:o.FunctionArgumentType.STRING,optionalArg:!0}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.ArrayPlugin=void 0,r(3),r(85);var n=r(2),s=r(106),o=r(151),a=r(137),i=r(192),u=r(187),l=r(159),c=r(189);class h extends c.FunctionPlugin{arrayformula(e,t){return this.runFunction(e.args,t,this.metadata("ARRAYFORMULA"),(e=>e))}arrayformulaArraySize(e,t){if(1!==e.args.length)return n.ArraySize.error();const r=this.metadata("ARRAYFORMULA");return e.args.map((e=>{var n;return this.arraySizeForAst(e,new u.InterpreterState(t.formulaAddress,t.arraysFlag||null!==(n=null==r?void 0:r.arrayFunction)&&void 0!==n&&n))}))[0]}arrayconstrain(e,t){return this.runFunction(e.args,t,this.metadata("ARRAY_CONSTRAIN"),((e,t,r)=>{t=Math.min(t,e.height()),r=Math.min(r,e.width());const n=e.data,s=[];for(let e=0;e<t;e++)s.push(n[e].slice(0,r));return l.SimpleRangeValue.onlyValues(s)}))}arrayconstrainArraySize(e,t){if(3!==e.args.length)return n.ArraySize.error();const r=this.metadata("ARRAY_CONSTRAIN"),s=e.args.map((e=>{var n;return this.arraySizeForAst(e,new u.InterpreterState(t.formulaAddress,t.arraysFlag||null!==(n=null==r?void 0:r.arrayFunction)&&void 0!==n&&n))}));let{height:o,width:i}=s[0];return e.args[1].type===a.AstNodeType.NUMBER&&(o=Math.min(o,e.args[1].value)),e.args[2].type===a.AstNodeType.NUMBER&&(i=Math.min(i,e.args[2].value)),o<1||i<1||!Number.isInteger(o)||!Number.isInteger(i)?n.ArraySize.error():new n.ArraySize(i,o)}filter(e,t){return this.runFunction(e.args,t,this.metadata("FILTER"),((e,...t)=>{for(const r of t)if(e.width()!==r.width()||e.height()!==r.height())return new s.CellError(s.ErrorType.NA,o.ErrorMessage.EqualLength);if(e.width()>1&&e.height()>1)return new s.CellError(s.ErrorType.NA,o.ErrorMessage.WrongDimension);const r=e.data,n=[];for(let s=0;s<e.height();s++){const o=[];for(let n=0;n<e.width();n++){let e=!0;for(const r of t){if(!0!==(0,i.coerceScalarToBoolean)(r.data[s][n])){e=!1;break}}e&&o.push(r[s][n])}o.length>0&&n.push(o)}return n.length>0?l.SimpleRangeValue.onlyValues(n):new s.CellError(s.ErrorType.NA,o.ErrorMessage.EmptyRange)}))}filterArraySize(e,t){if(e.args.length<=1)return n.ArraySize.error();const r=this.metadata("FILTER"),s=e.args.map((e=>{var n;return this.arraySizeForAst(e,new u.InterpreterState(t.formulaAddress,t.arraysFlag||null!==(n=null==r?void 0:r.arrayFunction)&&void 0!==n&&n))})),o=Math.max(...s.map((e=>e.width))),a=Math.max(...s.map((e=>e.height)));return new n.ArraySize(o,a)}}t.ArrayPlugin=h,h.implementedFunctions={ARRAYFORMULA:{method:"arrayformula",arraySizeMethod:"arrayformulaArraySize",arrayFunction:!0,parameters:[{argumentType:c.FunctionArgumentType.ANY}]},ARRAY_CONSTRAIN:{method:"arrayconstrain",arraySizeMethod:"arrayconstrainArraySize",parameters:[{argumentType:c.FunctionArgumentType.RANGE},{argumentType:c.FunctionArgumentType.INTEGER,minValue:1},{argumentType:c.FunctionArgumentType.INTEGER,minValue:1}],vectorizationForbidden:!0},FILTER:{method:"filter",arraySizeMethod:"filterArraySize",arrayFunction:!0,parameters:[{argumentType:c.FunctionArgumentType.RANGE},{argumentType:c.FunctionArgumentType.RANGE}],repeatLastArgs:1}}},function(e,t,r){"use strict";t.__esModule=!0,t.AbsPlugin=void 0;var n=r(189);class s extends n.FunctionPlugin{abs(e,t){return this.runFunction(e.args,t,this.metadata("ABS"),Math.abs)}}t.AbsPlugin=s,s.implementedFunctions={ABS:{method:"abs",parameters:[{argumentType:n.FunctionArgumentType.NUMBER}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.BitShiftPlugin=void 0;var n=r(106),s=r(151),o=r(189);class a extends o.FunctionPlugin{bitlshift(e,t){return this.runFunction(e.args,t,this.metadata("BITLSHIFT"),i)}bitrshift(e,t){return this.runFunction(e.args,t,this.metadata("BITRSHIFT"),u)}}function i(e,t){return t<0?u(e,-t):l(e*Math.pow(2,t))}function u(e,t){return t<0?i(e,-t):l(Math.floor(e/Math.pow(2,t)))}function l(e){return e>0xffffffffffff?new n.CellError(n.ErrorType.NUM,s.ErrorMessage.BitshiftLong):e}t.BitShiftPlugin=a,a.implementedFunctions={BITLSHIFT:{method:"bitlshift",parameters:[{argumentType:o.FunctionArgumentType.INTEGER,minValue:0},{argumentType:o.FunctionArgumentType.INTEGER,minValue:-53,maxValue:53}]},BITRSHIFT:{method:"bitrshift",parameters:[{argumentType:o.FunctionArgumentType.INTEGER,minValue:0},{argumentType:o.FunctionArgumentType.INTEGER,minValue:-53,maxValue:53}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.BitwiseLogicOperationsPlugin=void 0;var n=r(189);class s extends n.FunctionPlugin{bitand(e,t){return this.runFunction(e.args,t,this.metadata("BITAND"),((e,t)=>e&t))}bitor(e,t){return this.runFunction(e.args,t,this.metadata("BITOR"),((e,t)=>e|t))}bitxor(e,t){return this.runFunction(e.args,t,this.metadata("BITXOR"),((e,t)=>e^t))}}t.BitwiseLogicOperationsPlugin=s,s.implementedFunctions={BITAND:{method:"bitand",parameters:[{argumentType:n.FunctionArgumentType.INTEGER,minValue:0},{argumentType:n.FunctionArgumentType.INTEGER,minValue:0}]},BITOR:{method:"bitor",parameters:[{argumentType:n.FunctionArgumentType.INTEGER,minValue:0},{argumentType:n.FunctionArgumentType.INTEGER,minValue:0}]},BITXOR:{method:"bitxor",parameters:[{argumentType:n.FunctionArgumentType.INTEGER,minValue:0},{argumentType:n.FunctionArgumentType.INTEGER,minValue:0}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.BooleanPlugin=void 0,r(73),r(190),r(132),r(134),r(148);var n=r(106),s=r(151),o=r(189);class a extends o.FunctionPlugin{literalTrue(e,t){return this.runFunction(e.args,t,this.metadata("TRUE"),(()=>!0))}literalFalse(e,t){return this.runFunction(e.args,t,this.metadata("FALSE"),(()=>!1))}conditionalIf(e,t){return this.runFunction(e.args,t,this.metadata("IF"),((e,t,r)=>e?t:r))}ifs(e,t){return this.runFunction(e.args,t,this.metadata("IFS"),((...e)=>{for(let t=0;t<e.length;t+=2)if(e[t])return e[t+1];return new n.CellError(n.ErrorType.NA,s.ErrorMessage.NoConditionMet)}))}and(e,t){return this.runFunction(e.args,t,this.metadata("AND"),((...e)=>e.filter((e=>void 0!==e)).every((e=>!!e))))}or(e,t){return this.runFunction(e.args,t,this.metadata("OR"),((...e)=>e.filter((e=>void 0!==e)).some((e=>e))))}not(e,t){return this.runFunction(e.args,t,this.metadata("NOT"),(e=>!e))}xor(e,t){return this.runFunction(e.args,t,this.metadata("XOR"),((...e)=>{let t=0;return e.filter((e=>void 0!==e)).forEach((e=>{e&&t++})),t%2==1}))}switch(e,t){return this.runFunction(e.args,t,this.metadata("SWITCH"),((e,...t)=>{const r=t.length;let o=0;for(;o+1<r;o+=2)if(!(t[o]instanceof n.CellError)&&this.arithmeticHelper.eq(e,t[o]))return t[o+1];return o<r?t[o]:new n.CellError(n.ErrorType.NA,s.ErrorMessage.NoDefault)}))}iferror(e,t){return this.runFunction(e.args,t,this.metadata("IFERROR"),((e,t)=>e instanceof n.CellError?t:e))}ifna(e,t){return this.runFunction(e.args,t,this.metadata("IFNA"),((e,t)=>e instanceof n.CellError&&e.type===n.ErrorType.NA?t:e))}choose(e,t){return this.runFunction(e.args,t,this.metadata("CHOOSE"),((e,...t)=>e>t.length?new n.CellError(n.ErrorType.NUM,s.ErrorMessage.Selector):t[e-1]))}}t.BooleanPlugin=a,a.implementedFunctions={TRUE:{method:"literalTrue",parameters:[]},FALSE:{method:"literalFalse",parameters:[]},IF:{method:"conditionalIf",parameters:[{argumentType:o.FunctionArgumentType.BOOLEAN},{argumentType:o.FunctionArgumentType.SCALAR,passSubtype:!0},{argumentType:o.FunctionArgumentType.SCALAR,defaultValue:!1,passSubtype:!0}]},IFS:{method:"ifs",parameters:[{argumentType:o.FunctionArgumentType.BOOLEAN},{argumentType:o.FunctionArgumentType.SCALAR,passSubtype:!0}],repeatLastArgs:2},AND:{method:"and",parameters:[{argumentType:o.FunctionArgumentType.BOOLEAN}],repeatLastArgs:1,expandRanges:!0},OR:{method:"or",parameters:[{argumentType:o.FunctionArgumentType.BOOLEAN}],repeatLastArgs:1,expandRanges:!0},XOR:{method:"xor",parameters:[{argumentType:o.FunctionArgumentType.BOOLEAN}],repeatLastArgs:1,expandRanges:!0},NOT:{method:"not",parameters:[{argumentType:o.FunctionArgumentType.BOOLEAN}]},SWITCH:{method:"switch",parameters:[{argumentType:o.FunctionArgumentType.NOERROR},{argumentType:o.FunctionArgumentType.SCALAR,passSubtype:!0},{argumentType:o.FunctionArgumentType.SCALAR,passSubtype:!0}],repeatLastArgs:1},IFERROR:{method:"iferror",parameters:[{argumentType:o.FunctionArgumentType.SCALAR,passSubtype:!0},{argumentType:o.FunctionArgumentType.SCALAR,passSubtype:!0}]},IFNA:{method:"ifna",parameters:[{argumentType:o.FunctionArgumentType.SCALAR,passSubtype:!0},{argumentType:o.FunctionArgumentType.SCALAR,passSubtype:!0}]},CHOOSE:{method:"choose",parameters:[{argumentType:o.FunctionArgumentType.INTEGER,minValue:1},{argumentType:o.FunctionArgumentType.SCALAR,passSubtype:!0}],repeatLastArgs:1}}},function(e,t,r){"use strict";t.__esModule=!0,t.CharPlugin=void 0;var n=r(106),s=r(151),o=r(189);class a extends o.FunctionPlugin{char(e,t){return this.runFunction(e.args,t,this.metadata("CHAR"),(e=>e<1||e>=256?new n.CellError(n.ErrorType.VALUE,s.ErrorMessage.CharacterCodeBounds):String.fromCharCode(Math.trunc(e))))}unichar(e,t){return this.runFunction(e.args,t,this.metadata("CHAR"),(e=>e<1||e>=1114112?new n.CellError(n.ErrorType.VALUE,s.ErrorMessage.CharacterCodeBounds):String.fromCodePoint(Math.trunc(e))))}}t.CharPlugin=a,a.implementedFunctions={CHAR:{method:"char",parameters:[{argumentType:o.FunctionArgumentType.NUMBER}]},UNICHAR:{method:"unichar",parameters:[{argumentType:o.FunctionArgumentType.NUMBER}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.CodePlugin=void 0;var n=r(106),s=r(151),o=r(189);class a extends o.FunctionPlugin{code(e,t){return this.runFunction(e.args,t,this.metadata("CODE"),(e=>0===e.length?new n.CellError(n.ErrorType.VALUE,s.ErrorMessage.EmptyString):e.charCodeAt(0)))}unicode(e,t){return this.runFunction(e.args,t,this.metadata("UNICODE"),(e=>{var t;return null!==(t=e.codePointAt(0))&&void 0!==t?t:new n.CellError(n.ErrorType.VALUE,s.ErrorMessage.EmptyString)}))}}t.CodePlugin=a,a.implementedFunctions={CODE:{method:"code",parameters:[{argumentType:o.FunctionArgumentType.STRING}]},UNICODE:{method:"unicode",parameters:[{argumentType:o.FunctionArgumentType.STRING}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.CountBlankPlugin=void 0,r(73),r(134);var n=r(160),s=r(189);class o extends s.FunctionPlugin{countblank(e,t){return this.runFunction(e.args,t,this.metadata("COUNTBLANK"),((...e)=>{let t=0;return e.forEach((e=>{e===n.EmptyValue&&t++})),t}))}}t.CountBlankPlugin=o,o.implementedFunctions={COUNTBLANK:{method:"countblank",parameters:[{argumentType:s.FunctionArgumentType.SCALAR}],repeatLastArgs:1,expandRanges:!0}}},function(e,t,r){"use strict";t.__esModule=!0,t.CountUniquePlugin=void 0,r(109),r(120),r(122),r(124),r(126),r(128),r(130);var n=r(106),s=r(189);class o extends s.FunctionPlugin{countunique(e,t){return this.runFunction(e.args,t,this.metadata("COUNTUNIQUE"),((...e)=>{const t=new Set,r=new Set;for(const s of e)s instanceof n.CellError?r.add(s.type):""!==s&&t.add(s);return t.size+r.size}))}}t.CountUniquePlugin=o,o.implementedFunctions={COUNTUNIQUE:{method:"countunique",parameters:[{argumentType:s.FunctionArgumentType.SCALAR}],repeatLastArgs:1,expandRanges:!0}}},function(e,t,r){"use strict";t.__esModule=!0,t.DateTimePlugin=void 0,r(3),r(109),r(120),r(122),r(124),r(126),r(128),r(130),r(73),r(132);var n=r(106),s=r(198),o=r(151),a=r(200),i=r(160),u=r(189);class l extends u.FunctionPlugin{constructor(){super(...arguments),this.isoweeknumCore=e=>{const t=Math.floor(this.dateTimeHelper.relativeNumberToAbsoluteNumber(e)),r=this.dateTimeHelper.numberToSimpleDate(e),n=this.dateTimeHelper.dateToNumber({year:r.year,month:1,day:1}),s=this.dateTimeHelper.relativeNumberToAbsoluteNumber(n),o=s+((4-s)%7+7)%7,a=Math.floor((t-1)/7)-Math.floor((o-1)/7)+1;return 0===a?this.isoweeknumCore(e-7)+1:a},this.days360Core=(e,t,r)=>{const n=this.dateTimeHelper.numberToSimpleDate(e),o=this.dateTimeHelper.numberToSimpleDate(t);let a,i;return r?(a=(0,s.toBasisEU)(n),i=(0,s.toBasisEU)(o)):[a,i]=this.dateTimeHelper.toBasisUS(n,o),360*(i.year-a.year)+30*(i.month-a.month)+i.day-a.day}}date(e,t){return this.runFunction(e.args,t,this.metadata("DATE"),((e,t,r)=>{const s=Math.trunc(r);let a=Math.trunc(t),i=Math.trunc(e);i<this.dateTimeHelper.getEpochYearZero()&&(i+=this.dateTimeHelper.getEpochYearZero());const u=Math.floor((a-1)/12);i+=u,a-=12*u;const l={year:i,month:a,day:1};if(this.dateTimeHelper.isValidDate(l)){let e=this.dateTimeHelper.dateToNumber(l)+(s-1);return e=this.dateTimeHelper.getWithinBounds(e),void 0===e?new n.CellError(n.ErrorType.NUM,o.ErrorMessage.DateBounds):e}return new n.CellError(n.ErrorType.VALUE,o.ErrorMessage.InvalidDate)}))}time(e,t){return this.runFunction(e.args,t,this.metadata("TIME"),((e,t,r)=>{const a=(0,s.timeToNumber)({hours:Math.trunc(e),minutes:Math.trunc(t),seconds:Math.trunc(r)});return a<0?new n.CellError(n.ErrorType.NUM,o.ErrorMessage.NegativeTime):a%1}))}eomonth(e,t){return this.runFunction(e.args,t,this.metadata("EOMONTH"),((e,t)=>{const r=this.dateTimeHelper.numberToSimpleDate(e);let a=this.dateTimeHelper.dateToNumber(this.dateTimeHelper.endOfMonth((0,s.offsetMonth)(r,t)));return a=this.dateTimeHelper.getWithinBounds(a),void 0===a?new n.CellError(n.ErrorType.NUM,o.ErrorMessage.DateBounds):a}))}day(e,t){return this.runFunction(e.args,t,this.metadata("DAY"),(e=>this.dateTimeHelper.numberToSimpleDate(e).day))}days(e,t){return this.runFunction(e.args,t,this.metadata("DAYS"),((e,t)=>Math.trunc(e)-Math.trunc(t)))}month(e,t){return this.runFunction(e.args,t,this.metadata("MONTH"),(e=>this.dateTimeHelper.numberToSimpleDate(e).month))}year(e,t){return this.runFunction(e.args,t,this.metadata("YEAR"),(e=>this.dateTimeHelper.numberToSimpleDate(e).year))}hour(e,t){return this.runFunction(e.args,t,this.metadata("HOUR"),(e=>(0,s.numberToSimpleTime)((0,s.roundToNearestSecond)(e)%1).hours))}minute(e,t){return this.runFunction(e.args,t,this.metadata("MINUTE"),(e=>(0,s.numberToSimpleTime)((0,s.roundToNearestSecond)(e)%1).minutes))}second(e,t){return this.runFunction(e.args,t,this.metadata("SECOND"),(e=>(0,s.numberToSimpleTime)((0,s.roundToNearestSecond)(e)%1).seconds))}text(e,t){return this.runFunction(e.args,t,this.metadata("TEXT"),((e,t)=>(0,a.format)(e,t,this.config,this.dateTimeHelper)))}weekday(e,t){return this.runFunction(e.args,t,this.metadata("WEEKDAY"),((e,t)=>{const r=Math.floor(this.dateTimeHelper.relativeNumberToAbsoluteNumber(e));if(3===t)return(r-1)%7;const s=d.get(t);return void 0===s?new n.CellError(n.ErrorType.NUM,o.ErrorMessage.BadMode):(r-s)%7+1}))}weeknum(e,t){return this.runFunction(e.args,t,this.metadata("WEEKNUM"),((e,t)=>{const r=Math.floor(this.dateTimeHelper.relativeNumberToAbsoluteNumber(e)),s=this.dateTimeHelper.numberToSimpleDate(e),a=this.dateTimeHelper.dateToNumber({year:s.year,month:1,day:1}),i=this.dateTimeHelper.relativeNumberToAbsoluteNumber(a);if(21===t)return this.isoweeknumCore(e);const u=d.get(t);return void 0===u?new n.CellError(n.ErrorType.NUM,o.ErrorMessage.BadMode):Math.floor((r-u)/7)-Math.floor((i-u)/7)+1}))}isoweeknum(e,t){return this.runFunction(e.args,t,this.metadata("ISOWEEKNUM"),this.isoweeknumCore)}datevalue(e,t){return this.runFunction(e.args,t,this.metadata("DATEVALUE"),(e=>{const{dateTime:t}=this.dateTimeHelper.parseDateTimeFromConfigFormats(e);return void 0===t?new n.CellError(n.ErrorType.VALUE,o.ErrorMessage.IncorrectDateTime):(0,s.instanceOfSimpleDate)(t)?((0,s.instanceOfSimpleTime)(t)?Math.trunc((0,s.timeToNumber)(t)):0)+this.dateTimeHelper.dateToNumber(t):0}))}timevalue(e,t){return this.runFunction(e.args,t,this.metadata("TIMEVALUE"),(e=>{const t=this.dateTimeHelper.dateStringToDateNumber(e);return void 0===t?new n.CellError(n.ErrorType.VALUE,o.ErrorMessage.IncorrectDateTime):(0,i.getRawValue)(t)%1}))}now(e,t){return this.runFunction(e.args,t,this.metadata("NOW"),(()=>{const e=new Date(Date.now());return(0,s.timeToNumber)({hours:e.getHours(),minutes:e.getMinutes(),seconds:e.getSeconds()})+this.dateTimeHelper.dateToNumber({year:e.getFullYear(),month:e.getMonth()+1,day:e.getDate()})}))}today(e,t){return this.runFunction(e.args,t,this.metadata("TODAY"),(()=>{const e=new Date(Date.now());return this.dateTimeHelper.dateToNumber({year:e.getFullYear(),month:e.getMonth()+1,day:e.getDate()})}))}edate(e,t){return this.runFunction(e.args,t,this.metadata("EDATE"),((e,t)=>{const r=this.dateTimeHelper.numberToSimpleDate(e),a=(0,s.truncateDayInMonth)((0,s.offsetMonth)(r,t));let i=this.dateTimeHelper.dateToNumber(a);return i=this.dateTimeHelper.getWithinBounds(i),void 0===i?new n.CellError(n.ErrorType.NUM,o.ErrorMessage.DateBounds):i}))}datedif(e,t){return this.runFunction(e.args,t,this.metadata("DATEDIF"),((e,t,r)=>{if(e>t)return new n.CellError(n.ErrorType.NUM,o.ErrorMessage.StartEndDate);if("D"===r)return Math.floor(t)-Math.floor(e);const s=this.dateTimeHelper.numberToSimpleDate(e),a=this.dateTimeHelper.numberToSimpleDate(t);switch(r){case"M":return 12*(a.year-s.year)+(a.month-s.month)-(a.day<s.day?1:0);case"YM":return(a.month-s.month+12-(a.day<s.day?1:0))%12;case"Y":return a.month>s.month||a.month===s.month&&a.day>=s.day?a.year-s.year:a.year-s.year-1;case"MD":if(a.day>=s.day)return a.day-s.day;{const e=1===a.month?12:a.month-1,t=1===a.month?a.year-1:a.year;return this.dateTimeHelper.daysInMonth(t,e)+a.day-s.day}case"YD":return a.month>s.month||a.month===s.month&&a.day>=s.day?Math.floor(t)-this.dateTimeHelper.dateToNumber({year:a.year,month:s.month,day:s.day}):Math.floor(t)-Math.floor(e)-365*(a.year-s.year-1)-this.dateTimeHelper.leapYearsCount(a.year-1)+this.dateTimeHelper.leapYearsCount(s.year);default:return new n.CellError(n.ErrorType.NUM,o.ErrorMessage.BadMode)}}))}days360(e,t){return this.runFunction(e.args,t,this.metadata("DAYS360"),this.days360Core)}yearfrac(e,t){return this.runFunction(e.args,t,this.metadata("YEARFRAC"),((e,t,r)=>{switch((e=Math.trunc(e))>(t=Math.trunc(t))&&([e,t]=[t,e]),r){case 0:return this.days360Core(e,t,!1)/360;case 1:return(t-e)/this.dateTimeHelper.yearLengthForBasis(this.dateTimeHelper.numberToSimpleDate(e),this.dateTimeHelper.numberToSimpleDate(t));case 2:return(t-e)/360;case 3:return(t-e)/365;case 4:return this.days360Core(e,t,!0)/360}throw new Error("Should not be reachable.")}))}interval(e,t){return this.runFunction(e.args,t,this.metadata("INTERVAL"),(e=>{const t=(e=Math.trunc(e))%60,r=(e=Math.trunc(e/60))%60,n=(e=Math.trunc(e/60))%24,s=(e=Math.trunc(e/24))%30,o=(e=Math.trunc(e/30))%12,a=Math.trunc(e/12);return"P"+(a>0?`${a}Y`:"")+(o>0?`${o}M`:"")+(s>0?`${s}D`:"")+"T"+(n>0?`${n}H`:"")+(r>0?`${r}M`:"")+(t>0?`${t}S`:"")}))}networkdays(e,t){return this.runFunction(e.args,t,this.metadata("NETWORKDAYS"),((e,t,r)=>this.networkdayscore(e,t,1,r)))}networkdaysintl(e,t){return this.runFunction(e.args,t,this.metadata("NETWORKDAYS.INTL"),((e,t,r,n)=>this.networkdayscore(e,t,r,n)))}workday(e,t){return this.runFunction(e.args,t,this.metadata("WORKDAY"),((e,t,r)=>this.workdaycore(e,t,1,r)))}workdayintl(e,t){return this.runFunction(e.args,t,this.metadata("WORKDAY.INTL"),((e,t,r,n)=>this.workdaycore(e,t,r,n)))}networkdayscore(e,t,r,s){let o=1;(e=Math.trunc(e))>(t=Math.trunc(t))&&([e,t]=[t,e],o=-1);const a=h(r);if(a instanceof n.CellError)return a;const i=this.simpleRangeToFilteredHolidays(a,s);return i instanceof n.CellError?i:o*this.countWorkdays(e,t,a,i)}workdaycore(e,t,r,s){e=Math.trunc(e),t=Math.trunc(t);const o=h(r);if(o instanceof n.CellError)return o;const a=this.simpleRangeToFilteredHolidays(o,s);if(a instanceof n.CellError)return a;if(t>0){let r=1;for(;this.countWorkdays(e+1,e+r,o,a)<t;)r*=2;let n=1;for(;n+1<r;){const s=Math.trunc((n+r)/2);this.countWorkdays(e+1,e+s,o,a)<t?n=s:r=s}return e+r}if(t<0){t*=-1;let r=1;for(;this.countWorkdays(e-r,e-1,o,a)<t;)r*=2;let n=1;for(;n+1<r;){const s=Math.trunc((n+r)/2);this.countWorkdays(e-s,e-1,o,a)<t?n=s:r=s}return e-r}return e}countWorkdays(e,t,r,n){const s=Math.floor(this.dateTimeHelper.relativeNumberToAbsoluteNumber(t)),o=Math.floor(this.dateTimeHelper.relativeNumberToAbsoluteNumber(e));let a=0;for(let e=0;e<7;e++)"0"===r.charAt(e)&&(a+=Math.floor((s+6-e)/7),a-=Math.floor((o-1+6-e)/7));return a-=c(t+1,n)-c(e,n),a}simpleRangeToFilteredHolidays(e,t){var r;const s=null!==(r=null==t?void 0:t.valuesFromTopLeftCorner())&&void 0!==r?r:[];for(const e of s)if(e instanceof n.CellError)return e;const a=[];for(const e of s)if(e!==i.EmptyValue){if(!(0,i.isExtendedNumber)(e))return new n.CellError(n.ErrorType.VALUE,o.ErrorMessage.WrongType);a.push(Math.trunc((0,i.getRawValue)(e)))}return[...new Set(a)].sort(((e,t)=>e-t)).filter((t=>{const r=(this.dateTimeHelper.relativeNumberToAbsoluteNumber(t)-1)%7;return"0"===e.charAt(r)}))}}function c(e,t){if(0===t.length)return 0;if(e<=t[0])return 0;if(t[t.length-1]<e)return t.length;let r=0,n=t.length-1;for(;r+1<n;){const s=Math.floor((n+r)/2);t[s]>=e?n=s:r=s}return n}function h(e){var t;return"number"!=typeof e&&"string"!=typeof e?new n.CellError(n.ErrorType.VALUE,o.ErrorMessage.WrongType):"string"==typeof e?7===e.length&&/^(0|1)*$/.test(e)&&"1111111"!==e?e:new n.CellError(n.ErrorType.NUM,o.ErrorMessage.WeekendString):null!==(t=p.get(e))&&void 0!==t?t:new n.CellError(n.ErrorType.NUM,o.ErrorMessage.BadMode)}t.DateTimePlugin=l,l.implementedFunctions={DATE:{method:"date",parameters:[{argumentType:u.FunctionArgumentType.NUMBER},{argumentType:u.FunctionArgumentType.NUMBER},{argumentType:u.FunctionArgumentType.NUMBER}],returnNumberType:i.NumberType.NUMBER_DATE},TIME:{method:"time",parameters:[{argumentType:u.FunctionArgumentType.NUMBER},{argumentType:u.FunctionArgumentType.NUMBER},{argumentType:u.FunctionArgumentType.NUMBER}],returnNumberType:i.NumberType.NUMBER_TIME},MONTH:{method:"month",parameters:[{argumentType:u.FunctionArgumentType.NUMBER,minValue:0}]},YEAR:{method:"year",parameters:[{argumentType:u.FunctionArgumentType.NUMBER,minValue:0}]},HOUR:{method:"hour",parameters:[{argumentType:u.FunctionArgumentType.NUMBER,minValue:0}]},MINUTE:{method:"minute",parameters:[{argumentType:u.FunctionArgumentType.NUMBER,minValue:0}]},SECOND:{method:"second",parameters:[{argumentType:u.FunctionArgumentType.NUMBER,minValue:0}]},TEXT:{method:"text",parameters:[{argumentType:u.FunctionArgumentType.NUMBER},{argumentType:u.FunctionArgumentType.STRING}]},EOMONTH:{method:"eomonth",parameters:[{argumentType:u.FunctionArgumentType.NUMBER,minValue:0},{argumentType:u.FunctionArgumentType.NUMBER}],returnNumberType:i.NumberType.NUMBER_DATE},DAY:{method:"day",parameters:[{argumentType:u.FunctionArgumentType.NUMBER,minValue:0}]},DAYS:{method:"days",parameters:[{argumentType:u.FunctionArgumentType.NUMBER,minValue:0},{argumentType:u.FunctionArgumentType.NUMBER,minValue:0}]},WEEKDAY:{method:"weekday",parameters:[{argumentType:u.FunctionArgumentType.NUMBER,minValue:0},{argumentType:u.FunctionArgumentType.NUMBER,defaultValue:1}]},WEEKNUM:{method:"weeknum",parameters:[{argumentType:u.FunctionArgumentType.NUMBER,minValue:0},{argumentType:u.FunctionArgumentType.NUMBER,defaultValue:1}]},ISOWEEKNUM:{method:"isoweeknum",parameters:[{argumentType:u.FunctionArgumentType.NUMBER,minValue:0}]},DATEVALUE:{method:"datevalue",parameters:[{argumentType:u.FunctionArgumentType.STRING}],returnNumberType:i.NumberType.NUMBER_DATE},TIMEVALUE:{method:"timevalue",parameters:[{argumentType:u.FunctionArgumentType.STRING}],returnNumberType:i.NumberType.NUMBER_TIME},NOW:{method:"now",parameters:[],isVolatile:!0,returnNumberType:i.NumberType.NUMBER_DATETIME},TODAY:{method:"today",parameters:[],isVolatile:!0,returnNumberType:i.NumberType.NUMBER_DATE},EDATE:{method:"edate",parameters:[{argumentType:u.FunctionArgumentType.NUMBER,minValue:0},{argumentType:u.FunctionArgumentType.NUMBER}],returnNumberType:i.NumberType.NUMBER_DATE},DAYS360:{method:"days360",parameters:[{argumentType:u.FunctionArgumentType.NUMBER,minValue:0},{argumentType:u.FunctionArgumentType.NUMBER,minValue:0},{argumentType:u.FunctionArgumentType.BOOLEAN,defaultValue:!1}]},DATEDIF:{method:"datedif",parameters:[{argumentType:u.FunctionArgumentType.NUMBER,minValue:0},{argumentType:u.FunctionArgumentType.NUMBER,minValue:0},{argumentType:u.FunctionArgumentType.STRING}]},YEARFRAC:{method:"yearfrac",parameters:[{argumentType:u.FunctionArgumentType.NUMBER,minValue:0},{argumentType:u.FunctionArgumentType.NUMBER,minValue:0},{argumentType:u.FunctionArgumentType.INTEGER,defaultValue:0,minValue:0,maxValue:4}]},INTERVAL:{method:"interval",parameters:[{argumentType:u.FunctionArgumentType.NUMBER,minValue:0}]},NETWORKDAYS:{method:"networkdays",parameters:[{argumentType:u.FunctionArgumentType.NUMBER,minValue:0},{argumentType:u.FunctionArgumentType.NUMBER,minValue:0},{argumentType:u.FunctionArgumentType.RANGE,optionalArg:!0}]},"NETWORKDAYS.INTL":{method:"networkdaysintl",parameters:[{argumentType:u.FunctionArgumentType.NUMBER,minValue:0},{argumentType:u.FunctionArgumentType.NUMBER,minValue:0},{argumentType:u.FunctionArgumentType.NOERROR,defaultValue:1},{argumentType:u.FunctionArgumentType.RANGE,optionalArg:!0}]},WORKDAY:{method:"workday",parameters:[{argumentType:u.FunctionArgumentType.NUMBER,minValue:0},{argumentType:u.FunctionArgumentType.NUMBER},{argumentType:u.FunctionArgumentType.RANGE,optionalArg:!0}]},"WORKDAY.INTL":{method:"workdayintl",parameters:[{argumentType:u.FunctionArgumentType.NUMBER,minValue:0},{argumentType:u.FunctionArgumentType.NUMBER},{argumentType:u.FunctionArgumentType.NOERROR,defaultValue:1},{argumentType:u.FunctionArgumentType.RANGE,optionalArg:!0}]}};const d=new Map([[1,0],[2,1],[11,1],[12,2],[13,3],[14,4],[15,5],[16,6],[17,0]]),p=new Map([[1,"0000011"],[2,"1000001"],[3,"1100000"],[4,"0110000"],[5,"0011000"],[6,"0001100"],[7,"0000110"],[11,"0000001"],[12,"1000000"],[13,"0100000"],[14,"0010000"],[15,"0001000"],[16,"0000100"],[17,"0000010"]])},function(e,t,r){"use strict";t.__esModule=!0,t.DegreesPlugin=void 0;var n=r(189);class s extends n.FunctionPlugin{degrees(e,t){return this.runFunction(e.args,t,this.metadata("DEGREES"),(e=>e*(180/Math.PI)))}}t.DegreesPlugin=s,s.implementedFunctions={DEGREES:{method:"degrees",parameters:[{argumentType:n.FunctionArgumentType.NUMBER}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.DeltaPlugin=void 0;var n=r(189);class s extends n.FunctionPlugin{delta(e,t){return this.runFunction(e.args,t,this.metadata("DELTA"),((e,t)=>e===t?1:0))}}t.DeltaPlugin=s,s.implementedFunctions={DELTA:{method:"delta",parameters:[{argumentType:n.FunctionArgumentType.NUMBER},{argumentType:n.FunctionArgumentType.NUMBER,defaultValue:0}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.ExpPlugin=void 0;var n=r(189);class s extends n.FunctionPlugin{exp(e,t){return this.runFunction(e.args,t,this.metadata("EXP"),Math.exp)}}t.ExpPlugin=s,s.implementedFunctions={EXP:{method:"exp",parameters:[{argumentType:n.FunctionArgumentType.NUMBER}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.FinancialPlugin=void 0,r(3);var n=r(106),s=r(151),o=r(160),a=r(189);class i extends a.FunctionPlugin{pmt(e,t){return this.runFunction(e.args,t,this.metadata("PMT"),u)}ipmt(e,t){return this.runFunction(e.args,t,this.metadata("IPMT"),l)}ppmt(e,t){return this.runFunction(e.args,t,this.metadata("PPMT"),h)}fv(e,t){return this.runFunction(e.args,t,this.metadata("FV"),c)}cumipmt(e,t){return this.runFunction(e.args,t,this.metadata("CUMIPMT"),((e,t,r,o,a,i)=>{if(o>a)return new n.CellError(n.ErrorType.NUM,s.ErrorMessage.EndStartPeriod);let u=0;for(let n=o;n<=a;n++)u+=l(e,n,t,r,0,i);return u}))}cumprinc(e,t){return this.runFunction(e.args,t,this.metadata("CUMPRINC"),((e,t,r,o,a,i)=>{if(o>a)return new n.CellError(n.ErrorType.NUM,s.ErrorMessage.EndStartPeriod);let u=0;for(let n=o;n<=a;n++)u+=h(e,n,t,r,0,i);return u}))}db(e,t){return this.runFunction(e.args,t,this.metadata("DB"),((e,t,r,o,a)=>{if(12===a&&o>r||o>r+1)return new n.CellError(n.ErrorType.NUM,s.ErrorMessage.PeriodLong);if(t>=e)return 0;const i=Math.round(1e3*(1-Math.pow(t/e,1/r)))/1e3,u=e*i*a/12;if(1===o)return u;let l=u;for(let t=0;t<o-2;t++)l+=(e-l)*i;return o===r+1?(e-l)*i*(12-a)/12:(e-l)*i}))}ddb(e,t){return this.runFunction(e.args,t,this.metadata("DDB"),((e,t,r,s,o)=>{if(s>r)return new n.CellError(n.ErrorType.NUM);let a,i=o/r;i>=1?(i=1,a=1===s?e:0):a=e*Math.pow(1-i,s-1);const u=e*Math.pow(1-i,s);return Math.max(a-Math.max(t,u),0)}))}dollarde(e,t){return this.runFunction(e.args,t,this.metadata("DOLLARDE"),((e,t)=>{if(t<1)return new n.CellError(n.ErrorType.DIV_BY_ZERO);for(t=Math.trunc(t);t>10;)t/=10;return Math.trunc(e)+10*(e-Math.trunc(e))/t}))}dollarfr(e,t){return this.runFunction(e.args,t,this.metadata("DOLLARFR"),((e,t)=>{if(t<1)return new n.CellError(n.ErrorType.DIV_BY_ZERO);for(t=Math.trunc(t);t>10;)t/=10;return Math.trunc(e)+(e-Math.trunc(e))*t/10}))}effect(e,t){return this.runFunction(e.args,t,this.metadata("EFFECT"),((e,t)=>(t=Math.trunc(t),Math.pow(1+e/t,t)-1)))}ispmt(e,t){return this.runFunction(e.args,t,this.metadata("ISPMT"),((e,t,r,s)=>0===r?new n.CellError(n.ErrorType.DIV_BY_ZERO):s*e*(t/r-1)))}nominal(e,t){return this.runFunction(e.args,t,this.metadata("NOMINAL"),((e,t)=>(t=Math.trunc(t),(Math.pow(e+1,1/t)-1)*t)))}nper(e,t){return this.runFunction(e.args,t,this.metadata("NPER"),((e,t,r,s,o)=>0===e?0===t?new n.CellError(n.ErrorType.DIV_BY_ZERO):(-r-s)/t:(o&&(t*=1+e),Math.log((t-s*e)/(r*e+t))/Math.log(1+e))))}rate(e,t){return this.runFunction(e.args,t,this.metadata("RATE"),((e,t,r,s,o,a)=>{if(a<=-1)return new n.CellError(n.ErrorType.VALUE);const i=1e-7;let u=a;o=o?1:0;for(let a=0;a<50;a++){if(u<=-1)return new n.CellError(n.ErrorType.NUM);let a,l;if(Math.abs(u)<i)a=r*(1+e*u)+t*(1+u*o)*e+s;else{const n=Math.pow(1+u,e);a=r*n+t*(1/u+o)*(n-1)+s}if(Math.abs(a)<i)return u;if(Math.abs(u)<i)l=r*e+t*o*e;else{const n=Math.pow(1+u,e),s=e*Math.pow(1+u,e-1);l=r*s+t*(1/u+o)*s+t*(-1/(u*u))*(n-1)}u-=a/l}return new n.CellError(n.ErrorType.NUM)}))}pv(e,t){return this.runFunction(e.args,t,this.metadata("PV"),((e,t,r,s,o)=>(o=o?1:0,-1===e?0===t?new n.CellError(n.ErrorType.NUM):new n.CellError(n.ErrorType.DIV_BY_ZERO):0===e?-r*t-s:((1-Math.pow(1+e,t))*r*(1+e*o)/e-s)/Math.pow(1+e,t))))}rri(e,t){return this.runFunction(e.args,t,this.metadata("RRI"),((e,t,r)=>0===t||r<0&&t>0||r>0&&t<0?new n.CellError(n.ErrorType.NUM):Math.pow(r/t,1/e)-1))}sln(e,t){return this.runFunction(e.args,t,this.metadata("SLN"),((e,t,r)=>0===r?new n.CellError(n.ErrorType.DIV_BY_ZERO):(e-t)/r))}syd(e,t){return this.runFunction(e.args,t,this.metadata("SYD"),((e,t,r,s)=>s>r?new n.CellError(n.ErrorType.NUM):(e-t)*(r-s+1)*2/(r*(r+1))))}tbilleq(e,t){return this.runFunction(e.args,t,this.metadata("TBILLEQ"),((e,t,r)=>{if((e=Math.round(e))>=(t=Math.round(t)))return new n.CellError(n.ErrorType.NUM);const s=this.dateTimeHelper.numberToSimpleDate(e),o=this.dateTimeHelper.numberToSimpleDate(t);if(o.year>s.year+1||o.year===s.year+1&&(o.month>s.month||o.month===s.month&&o.day>s.day))return new n.CellError(n.ErrorType.NUM);const a=360-r*(t-e);return 0===a?0:a<0?new n.CellError(n.ErrorType.NUM):365*r/a}))}tbillprice(e,t){return this.runFunction(e.args,t,this.metadata("TBILLPRICE"),((e,t,r)=>{if((e=Math.round(e))>=(t=Math.round(t)))return new n.CellError(n.ErrorType.NUM);const s=this.dateTimeHelper.numberToSimpleDate(e),o=this.dateTimeHelper.numberToSimpleDate(t);if(o.year>s.year+1||o.year===s.year+1&&(o.month>s.month||o.month===s.month&&o.day>s.day))return new n.CellError(n.ErrorType.NUM);const a=360-r*(t-e);return 0===a?0:a<0?new n.CellError(n.ErrorType.NUM):100*(1-r*(t-e)/360)}))}tbillyield(e,t){return this.runFunction(e.args,t,this.metadata("TBILLYIELD"),((e,t,r)=>{if((e=Math.round(e))>=(t=Math.round(t)))return new n.CellError(n.ErrorType.NUM);const s=this.dateTimeHelper.numberToSimpleDate(e),o=this.dateTimeHelper.numberToSimpleDate(t);return o.year>s.year+1||o.year===s.year+1&&(o.month>s.month||o.month===s.month&&o.day>s.day)?new n.CellError(n.ErrorType.NUM):360*(100-r)/(r*(t-e))}))}fvschedule(e,t){return this.runFunction(e.args,t,this.metadata("FVSCHEDULE"),((e,t)=>{const r=t.valuesFromTopLeftCorner();for(const e of r)if(e instanceof n.CellError)return e;for(const t of r)if((0,o.isExtendedNumber)(t))e*=1+(0,o.getRawValue)(t);else if(t!==o.EmptyValue)return new n.CellError(n.ErrorType.VALUE,s.ErrorMessage.NumberExpected);return e}))}npv(e,t){return this.runFunction(e.args,t,this.metadata("NPV"),((e,...t)=>{const r=this.arithmeticHelper.coerceNumbersExactRanges(t);return r instanceof n.CellError?r:d(e,r)}))}mirr(e,t){return this.runFunction(e.args,t,this.metadata("MIRR"),((e,t,r)=>{const s=this.arithmeticHelper.manyToExactNumbers(e.valuesFromTopLeftCorner());if(s instanceof n.CellError)return s;let o=!1,a=!1;const i=[],u=[];for(const e of s)e>0?(o=!0,i.push(e),u.push(0)):e<0?(a=!0,u.push(e),i.push(0)):(u.push(0),i.push(0));if(!o||!a)return new n.CellError(n.ErrorType.DIV_BY_ZERO);const l=s.length,c=d(r,i);if(c instanceof n.CellError)return c;const h=d(t,u);return h instanceof n.CellError?h:Math.pow(-c*Math.pow(1+r,l)/h/(1+t),1/(l-1))-1}))}pduration(e,t){return this.runFunction(e.args,t,this.metadata("PDURATION"),((e,t,r)=>(Math.log(r)-Math.log(t))/Math.log(1+e)))}xnpv(e,t){return this.runFunction(e.args,t,this.metadata("XNPV"),((e,t,r)=>{const o=t.valuesFromTopLeftCorner();for(const e of o)if("number"!=typeof e)return new n.CellError(n.ErrorType.VALUE,s.ErrorMessage.NumberExpected);const a=o,i=r.valuesFromTopLeftCorner();for(const e of i)if("number"!=typeof e)return new n.CellError(n.ErrorType.VALUE,s.ErrorMessage.NumberExpected);const u=i;if(u.length!==a.length)return new n.CellError(n.ErrorType.NUM,s.ErrorMessage.EqualLength);const l=u.length;let c=0;if(u[0]<0)return new n.CellError(n.ErrorType.NUM,s.ErrorMessage.ValueSmall);for(let t=0;t<l;t++){if(u[t]=Math.floor(u[t]),u[t]<u[0])return new n.CellError(n.ErrorType.NUM,s.ErrorMessage.ValueSmall);c+=a[t]/Math.pow(1+e,(u[t]-u[0])/365)}return c}))}}function u(e,t,r,n,s){if(0===e)return(-r-n)/t;{const o=Math.pow(1+e,t);return(n*e+r*e*o)*(s?1/(1+e):1)/(1-o)}}function l(e,t,r,n,s,o){const a=u(e,r,n,s,o);return 1===t?e*(o?0:-n):e*(o?c(e,t-2,a,n,o)-a:c(e,t-1,a,n,o))}function c(e,t,r,n,s){if(0===e)return-n-r*t;{const o=Math.pow(1+e,t);return r*(s?1+e:1)*(1-o)/e-n*o}}function h(e,t,r,n,s,o){return u(e,r,n,s,o)-l(e,t,r,n,s,o)}function d(e,t){let r=0;for(let s=t.length-1;s>=0;s--){if(r+=t[s],-1===e){if(0===r)continue;return new n.CellError(n.ErrorType.DIV_BY_ZERO)}r/=1+e}return r}t.FinancialPlugin=i,i.implementedFunctions={PMT:{method:"pmt",parameters:[{argumentType:a.FunctionArgumentType.NUMBER},{argumentType:a.FunctionArgumentType.NUMBER},{argumentType:a.FunctionArgumentType.NUMBER},{argumentType:a.FunctionArgumentType.NUMBER,defaultValue:0},{argumentType:a.FunctionArgumentType.NUMBER,defaultValue:0}],returnNumberType:o.NumberType.NUMBER_CURRENCY},IPMT:{method:"ipmt",parameters:[{argumentType:a.FunctionArgumentType.NUMBER},{argumentType:a.FunctionArgumentType.NUMBER},{argumentType:a.FunctionArgumentType.NUMBER},{argumentType:a.FunctionArgumentType.NUMBER},{argumentType:a.FunctionArgumentType.NUMBER,defaultValue:0},{argumentType:a.FunctionArgumentType.NUMBER,defaultValue:0}],returnNumberType:o.NumberType.NUMBER_CURRENCY},PPMT:{method:"ppmt",parameters:[{argumentType:a.FunctionArgumentType.NUMBER},{argumentType:a.FunctionArgumentType.NUMBER},{argumentType:a.FunctionArgumentType.NUMBER},{argumentType:a.FunctionArgumentType.NUMBER},{argumentType:a.FunctionArgumentType.NUMBER,defaultValue:0},{argumentType:a.FunctionArgumentType.NUMBER,defaultValue:0}],returnNumberType:o.NumberType.NUMBER_CURRENCY},FV:{method:"fv",parameters:[{argumentType:a.FunctionArgumentType.NUMBER},{argumentType:a.FunctionArgumentType.NUMBER},{argumentType:a.FunctionArgumentType.NUMBER},{argumentType:a.FunctionArgumentType.NUMBER,defaultValue:0},{argumentType:a.FunctionArgumentType.NUMBER,defaultValue:0}],returnNumberType:o.NumberType.NUMBER_CURRENCY},CUMIPMT:{method:"cumipmt",parameters:[{argumentType:a.FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:a.FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:a.FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:a.FunctionArgumentType.INTEGER,minValue:1},{argumentType:a.FunctionArgumentType.INTEGER,minValue:1},{argumentType:a.FunctionArgumentType.INTEGER,minValue:0,maxValue:1}],returnNumberType:o.NumberType.NUMBER_CURRENCY},CUMPRINC:{method:"cumprinc",parameters:[{argumentType:a.FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:a.FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:a.FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:a.FunctionArgumentType.INTEGER,minValue:1},{argumentType:a.FunctionArgumentType.INTEGER,minValue:1},{argumentType:a.FunctionArgumentType.INTEGER,minValue:0,maxValue:1}],returnNumberType:o.NumberType.NUMBER_CURRENCY},DB:{method:"db",parameters:[{argumentType:a.FunctionArgumentType.NUMBER,minValue:0},{argumentType:a.FunctionArgumentType.NUMBER,minValue:0},{argumentType:a.FunctionArgumentType.INTEGER,minValue:0},{argumentType:a.FunctionArgumentType.INTEGER,minValue:0},{argumentType:a.FunctionArgumentType.INTEGER,minValue:1,maxValue:12,defaultValue:12}],returnNumberType:o.NumberType.NUMBER_CURRENCY},DDB:{method:"ddb",parameters:[{argumentType:a.FunctionArgumentType.NUMBER,minValue:0},{argumentType:a.FunctionArgumentType.NUMBER,minValue:0},{argumentType:a.FunctionArgumentType.INTEGER,minValue:0},{argumentType:a.FunctionArgumentType.NUMBER,minValue:0},{argumentType:a.FunctionArgumentType.NUMBER,greaterThan:0,defaultValue:2}],returnNumberType:o.NumberType.NUMBER_CURRENCY},DOLLARDE:{method:"dollarde",parameters:[{argumentType:a.FunctionArgumentType.NUMBER},{argumentType:a.FunctionArgumentType.NUMBER,minValue:0}]},DOLLARFR:{method:"dollarfr",parameters:[{argumentType:a.FunctionArgumentType.NUMBER},{argumentType:a.FunctionArgumentType.NUMBER,minValue:0}]},EFFECT:{method:"effect",parameters:[{argumentType:a.FunctionArgumentType.NUMBER,minValue:0},{argumentType:a.FunctionArgumentType.NUMBER,minValue:1}],returnNumberType:o.NumberType.NUMBER_PERCENT},ISPMT:{method:"ispmt",parameters:[{argumentType:a.FunctionArgumentType.NUMBER},{argumentType:a.FunctionArgumentType.NUMBER},{argumentType:a.FunctionArgumentType.NUMBER},{argumentType:a.FunctionArgumentType.NUMBER}]},NOMINAL:{method:"nominal",parameters:[{argumentType:a.FunctionArgumentType.NUMBER,minValue:0},{argumentType:a.FunctionArgumentType.NUMBER,minValue:1}],returnNumberType:o.NumberType.NUMBER_PERCENT},NPER:{method:"nper",parameters:[{argumentType:a.FunctionArgumentType.NUMBER},{argumentType:a.FunctionArgumentType.NUMBER},{argumentType:a.FunctionArgumentType.NUMBER},{argumentType:a.FunctionArgumentType.NUMBER,defaultValue:0},{argumentType:a.FunctionArgumentType.NUMBER,defaultValue:0}]},PV:{method:"pv",parameters:[{argumentType:a.FunctionArgumentType.NUMBER},{argumentType:a.FunctionArgumentType.NUMBER},{argumentType:a.FunctionArgumentType.NUMBER},{argumentType:a.FunctionArgumentType.NUMBER,defaultValue:0},{argumentType:a.FunctionArgumentType.NUMBER,defaultValue:0}],returnNumberType:o.NumberType.NUMBER_CURRENCY},RATE:{method:"rate",parameters:[{argumentType:a.FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:a.FunctionArgumentType.NUMBER},{argumentType:a.FunctionArgumentType.NUMBER},{argumentType:a.FunctionArgumentType.NUMBER,defaultValue:0},{argumentType:a.FunctionArgumentType.NUMBER,defaultValue:0},{argumentType:a.FunctionArgumentType.NUMBER,defaultValue:.1}],returnNumberType:o.NumberType.NUMBER_PERCENT},RRI:{method:"rri",parameters:[{argumentType:a.FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:a.FunctionArgumentType.NUMBER},{argumentType:a.FunctionArgumentType.NUMBER}],returnNumberType:o.NumberType.NUMBER_PERCENT},SLN:{method:"sln",parameters:[{argumentType:a.FunctionArgumentType.NUMBER},{argumentType:a.FunctionArgumentType.NUMBER},{argumentType:a.FunctionArgumentType.NUMBER}],returnNumberType:o.NumberType.NUMBER_CURRENCY},SYD:{method:"syd",parameters:[{argumentType:a.FunctionArgumentType.NUMBER},{argumentType:a.FunctionArgumentType.NUMBER},{argumentType:a.FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:a.FunctionArgumentType.NUMBER,greaterThan:0}],returnNumberType:o.NumberType.NUMBER_CURRENCY},TBILLEQ:{method:"tbilleq",parameters:[{argumentType:a.FunctionArgumentType.NUMBER,minValue:0},{argumentType:a.FunctionArgumentType.NUMBER,minValue:0},{argumentType:a.FunctionArgumentType.NUMBER,greaterThan:0}],returnNumberType:o.NumberType.NUMBER_PERCENT},TBILLPRICE:{method:"tbillprice",parameters:[{argumentType:a.FunctionArgumentType.NUMBER,minValue:0},{argumentType:a.FunctionArgumentType.NUMBER,minValue:0},{argumentType:a.FunctionArgumentType.NUMBER,greaterThan:0}],returnNumberType:o.NumberType.NUMBER_CURRENCY},TBILLYIELD:{method:"tbillyield",parameters:[{argumentType:a.FunctionArgumentType.NUMBER,minValue:0},{argumentType:a.FunctionArgumentType.NUMBER,minValue:0},{argumentType:a.FunctionArgumentType.NUMBER,greaterThan:0}],returnNumberType:o.NumberType.NUMBER_PERCENT},FVSCHEDULE:{method:"fvschedule",parameters:[{argumentType:a.FunctionArgumentType.NUMBER},{argumentType:a.FunctionArgumentType.RANGE}],returnNumberType:o.NumberType.NUMBER_CURRENCY},NPV:{method:"npv",parameters:[{argumentType:a.FunctionArgumentType.NUMBER},{argumentType:a.FunctionArgumentType.ANY}],repeatLastArgs:1,returnNumberType:o.NumberType.NUMBER_CURRENCY},MIRR:{method:"mirr",parameters:[{argumentType:a.FunctionArgumentType.RANGE},{argumentType:a.FunctionArgumentType.NUMBER},{argumentType:a.FunctionArgumentType.NUMBER}],returnNumberType:o.NumberType.NUMBER_PERCENT},PDURATION:{method:"pduration",parameters:[{argumentType:a.FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:a.FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:a.FunctionArgumentType.NUMBER,greaterThan:0}]},XNPV:{method:"xnpv",parameters:[{argumentType:a.FunctionArgumentType.NUMBER,greaterThan:-1},{argumentType:a.FunctionArgumentType.RANGE},{argumentType:a.FunctionArgumentType.RANGE}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.FormulaTextPlugin=void 0;var n=r(106),s=r(151),o=r(188),a=r(189);class i extends o.FunctionPlugin{formulatext(e,t){return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("FORMULATEXT"),(()=>new n.CellError(n.ErrorType.NA,s.ErrorMessage.WrongArgNumber)),(e=>{var t;return null!==(t=this.serialization.getCellFormula(e))&&void 0!==t?t:new n.CellError(n.ErrorType.NA,s.ErrorMessage.Formula)}))}}t.FormulaTextPlugin=i,i.implementedFunctions={FORMULATEXT:{method:"formulatext",parameters:[{argumentType:a.FunctionArgumentType.NOERROR}],doesNotNeedArgumentsToBeComputed:!0,isDependentOnSheetStructureChange:!0,vectorizationForbidden:!0}}},function(e,t,r){"use strict";t.__esModule=!0,t.HyperlinkPlugin=void 0;var n=r(189);class s extends n.FunctionPlugin{hyperlink(e,t){return this.runFunction(e.args,t,this.metadata("HYPERLINK"),((t,r)=>(e.hyperlink=t,null!=r?r:t)))}}t.HyperlinkPlugin=s,s.implementedFunctions={HYPERLINK:{method:"hyperlink",parameters:[{argumentType:n.FunctionArgumentType.STRING},{argumentType:n.FunctionArgumentType.STRING,optionalArg:!0}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.InformationPlugin=void 0,r(73),r(148);var n=r(106),s=r(170),o=r(151),a=r(137),i=r(160),u=r(159),l=r(189);class c extends l.FunctionPlugin{isbinary(e,t){return this.runFunction(e.args,t,this.metadata("ISBINARY"),(e=>/^[01]{1,10}$/.test(e)))}iserr(e,t){return this.runFunction(e.args,t,this.metadata("ISERR"),(e=>e instanceof n.CellError&&e.type!==n.ErrorType.NA))}iserror(e,t){return this.runFunction(e.args,t,this.metadata("ISERROR"),(e=>e instanceof n.CellError))}isformula(e,t){return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("ISFORMULA"),(()=>new n.CellError(n.ErrorType.NA,o.ErrorMessage.WrongArgNumber)),(e=>this.dependencyGraph.addressMapping.getCell(e)instanceof s.FormulaVertex))}isblank(e,t){return this.runFunction(e.args,t,this.metadata("ISBLANK"),(e=>e===i.EmptyValue))}isna(e,t){return this.runFunction(e.args,t,this.metadata("ISNA"),(e=>e instanceof n.CellError&&e.type==n.ErrorType.NA))}isnumber(e,t){return this.runFunction(e.args,t,this.metadata("ISNUMBER"),i.isExtendedNumber)}islogical(e,t){return this.runFunction(e.args,t,this.metadata("ISLOGICAL"),(e=>"boolean"==typeof e))}isref(e,t){return this.runFunction(e.args,t,this.metadata("ISREF"),(e=>e instanceof n.CellError&&(e.type==n.ErrorType.REF||e.type==n.ErrorType.CYCLE)))}istext(e,t){return this.runFunction(e.args,t,this.metadata("ISTEXT"),(e=>"string"==typeof e))}isnontext(e,t){return this.runFunction(e.args,t,this.metadata("ISNONTEXT"),(e=>!("string"==typeof e)))}column(e,t){return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("COLUMN"),(()=>t.formulaAddress.col+1),(e=>e.col+1))}columns(e,t){if(1!==e.args.length)return new n.CellError(n.ErrorType.NA,o.ErrorMessage.WrongArgNumber);if(e.args.some((e=>e.type===a.AstNodeType.EMPTY)))return new n.CellError(n.ErrorType.NUM,o.ErrorMessage.EmptyArg);let r=e.args[0];for(;r.type===a.AstNodeType.PARENTHESIS;)r=r.expression;if(r.type===a.AstNodeType.CELL_RANGE||r.type===a.AstNodeType.COLUMN_RANGE)return r.end.col-r.start.col+1;if(r.type===a.AstNodeType.CELL_REFERENCE)return 1;if(r.type===a.AstNodeType.ROW_RANGE)return this.config.maxColumns;{const e=this.evaluateAst(r,t);return e instanceof u.SimpleRangeValue?e.width():e instanceof n.CellError?e:1}}row(e,t){return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("ROW"),(()=>t.formulaAddress.row+1),(e=>e.row+1))}rows(e,t){if(1!==e.args.length)return new n.CellError(n.ErrorType.NA,o.ErrorMessage.WrongArgNumber);if(e.args.some((e=>e.type===a.AstNodeType.EMPTY)))return new n.CellError(n.ErrorType.NUM,o.ErrorMessage.EmptyArg);let r=e.args[0];for(;r.type===a.AstNodeType.PARENTHESIS;)r=r.expression;if(r.type===a.AstNodeType.CELL_RANGE||r.type===a.AstNodeType.ROW_RANGE)return r.end.row-r.start.row+1;if(r.type===a.AstNodeType.CELL_REFERENCE)return 1;if(r.type===a.AstNodeType.COLUMN_RANGE)return this.config.maxRows;{const e=this.evaluateAst(r,t);return e instanceof u.SimpleRangeValue?e.height():e instanceof n.CellError?e:1}}index(e,t){return this.runFunction(e.args,t,this.metadata("INDEX"),((e,t,r)=>{var s,a,i,u,l,c;return r<1||t<1?new n.CellError(n.ErrorType.VALUE,o.ErrorMessage.LessThanOne):r>e.width()||t>e.height()?new n.CellError(n.ErrorType.NUM,o.ErrorMessage.ValueLarge):null!==(c=null!==(i=null===(a=null===(s=null==e?void 0:e.data)||void 0===s?void 0:s[t-1])||void 0===a?void 0:a[r-1])&&void 0!==i?i:null===(l=null===(u=null==e?void 0:e.data)||void 0===u?void 0:u[0])||void 0===l?void 0:l[0])&&void 0!==c?c:new n.CellError(n.ErrorType.VALUE,o.ErrorMessage.CellRangeExpected)}))}na(e,t){return new n.CellError(n.ErrorType.NA)}sheet(e,t){return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("SHEET"),(()=>t.formulaAddress.sheet+1),(e=>e.sheet+1),(e=>{const t=this.dependencyGraph.sheetMapping.get(e);return void 0!==t?t+1:new n.CellError(n.ErrorType.NA,o.ErrorMessage.SheetRef)}))}sheets(e,t){return this.runFunctionWithReferenceArgument(e.args,t,this.metadata("SHEETS"),(()=>this.dependencyGraph.sheetMapping.numberOfSheets()),(()=>1),(()=>new n.CellError(n.ErrorType.VALUE,o.ErrorMessage.CellRefExpected)))}}t.InformationPlugin=c,c.implementedFunctions={COLUMN:{method:"column",parameters:[{argumentType:l.FunctionArgumentType.NOERROR,optionalArg:!0}],isDependentOnSheetStructureChange:!0,doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},COLUMNS:{method:"columns",parameters:[{argumentType:l.FunctionArgumentType.RANGE}],isDependentOnSheetStructureChange:!0,doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},ISBINARY:{method:"isbinary",parameters:[{argumentType:l.FunctionArgumentType.STRING}]},ISERR:{method:"iserr",parameters:[{argumentType:l.FunctionArgumentType.SCALAR}]},ISFORMULA:{method:"isformula",parameters:[{argumentType:l.FunctionArgumentType.NOERROR}],doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},ISNA:{method:"isna",parameters:[{argumentType:l.FunctionArgumentType.SCALAR}]},ISREF:{method:"isref",parameters:[{argumentType:l.FunctionArgumentType.SCALAR}],vectorizationForbidden:!0},ISERROR:{method:"iserror",parameters:[{argumentType:l.FunctionArgumentType.SCALAR}]},ISBLANK:{method:"isblank",parameters:[{argumentType:l.FunctionArgumentType.SCALAR}]},ISNUMBER:{method:"isnumber",parameters:[{argumentType:l.FunctionArgumentType.SCALAR}]},ISLOGICAL:{method:"islogical",parameters:[{argumentType:l.FunctionArgumentType.SCALAR}]},ISTEXT:{method:"istext",parameters:[{argumentType:l.FunctionArgumentType.SCALAR}]},ISNONTEXT:{method:"isnontext",parameters:[{argumentType:l.FunctionArgumentType.SCALAR}]},INDEX:{method:"index",parameters:[{argumentType:l.FunctionArgumentType.RANGE},{argumentType:l.FunctionArgumentType.NUMBER},{argumentType:l.FunctionArgumentType.NUMBER,defaultValue:1}]},NA:{method:"na",parameters:[]},ROW:{method:"row",parameters:[{argumentType:l.FunctionArgumentType.NOERROR,optionalArg:!0}],isDependentOnSheetStructureChange:!0,doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},ROWS:{method:"rows",parameters:[{argumentType:l.FunctionArgumentType.RANGE}],isDependentOnSheetStructureChange:!0,doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},SHEET:{method:"sheet",parameters:[{argumentType:l.FunctionArgumentType.STRING}],doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0},SHEETS:{method:"sheets",parameters:[{argumentType:l.FunctionArgumentType.STRING}],doesNotNeedArgumentsToBeComputed:!0,vectorizationForbidden:!0}}},function(e,t,r){"use strict";t.__esModule=!0,t.IsEvenPlugin=void 0;var n=r(189);class s extends n.FunctionPlugin{iseven(e,t){return this.runFunction(e.args,t,this.metadata("ISEVEN"),(e=>e%2==0))}}t.IsEvenPlugin=s,s.implementedFunctions={ISEVEN:{method:"iseven",parameters:[{argumentType:n.FunctionArgumentType.NUMBER}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.IsOddPlugin=void 0;var n=r(189);class s extends n.FunctionPlugin{isodd(e,t){return this.runFunction(e.args,t,this.metadata("ISODD"),(e=>e%2==1))}}t.IsOddPlugin=s,s.implementedFunctions={ISODD:{method:"isodd",parameters:[{argumentType:n.FunctionArgumentType.NUMBER}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.LogarithmPlugin=void 0;var n=r(189);class s extends n.FunctionPlugin{log10(e,t){return this.runFunction(e.args,t,this.metadata("LOG10"),Math.log10)}log(e,t){return this.runFunction(e.args,t,this.metadata("LOG"),((e,t)=>Math.log(e)/Math.log(t)))}ln(e,t){return this.runFunction(e.args,t,this.metadata("LN"),Math.log)}}t.LogarithmPlugin=s,s.implementedFunctions={LOG10:{method:"log10",parameters:[{argumentType:n.FunctionArgumentType.NUMBER}]},LOG:{method:"log",parameters:[{argumentType:n.FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:n.FunctionArgumentType.NUMBER,defaultValue:10,greaterThan:0}]},LN:{method:"ln",parameters:[{argumentType:n.FunctionArgumentType.NUMBER}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.PI=t.MathConstantsPlugin=void 0;var n=r(189);const s=t.PI=parseFloat(Math.PI.toFixed(14));class o extends n.FunctionPlugin{pi(e,t){return this.runFunction(e.args,t,this.metadata("PI"),(()=>s))}sqrtpi(e,t){return this.runFunction(e.args,t,this.metadata("SQRTPI"),(e=>Math.sqrt(s*e)))}}t.MathConstantsPlugin=o,o.implementedFunctions={PI:{method:"pi",parameters:[]},SQRTPI:{method:"sqrtpi",parameters:[{argumentType:n.FunctionArgumentType.NUMBER,minValue:0}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.MatrixPlugin=void 0,r(3),r(85);var n=r(2),s=r(106),o=r(151),a=r(137),i=r(187),u=r(159),l=r(189);function c(e,t){return new n.ArraySize(t.width,e.height)}function h(e,t,r){return new n.ArraySize(1+(e.width-t)/r,1+(e.height-t)/r)}class d extends l.FunctionPlugin{mmult(e,t){return this.runFunction(e.args,t,this.metadata("MMULT"),((e,t)=>{if(!e.hasOnlyNumbers()||!t.hasOnlyNumbers())return new s.CellError(s.ErrorType.VALUE,o.ErrorMessage.NumberRange);if(t.height()!==e.width())return new s.CellError(s.ErrorType.VALUE,o.ErrorMessage.ArrayDimensions);const r=c(e.size,t.size),n=this.createKernel((function(e,t,r){let n=0;for(let s=0;s<r;++s)n+=e[this.thread.y][s]*t[s][this.thread.x];return n}),r)(e.rawNumbers(),t.rawNumbers(),e.width());return u.SimpleRangeValue.onlyNumbers(n)}))}mmultArraySize(e,t){if(2!==e.args.length)return n.ArraySize.error();const r=this.metadata("MMULT"),s=e.args.map((e=>{var n;return this.arraySizeForAst(e,new i.InterpreterState(t.formulaAddress,t.arraysFlag||null!==(n=null==r?void 0:r.arrayFunction)&&void 0!==n&&n))})),[o,a]=s;return c(o,a)}maxpool(e,t){return this.runFunction(e.args,t,this.metadata("MAXPOOL"),((e,t,r=t)=>{if(!e.hasOnlyNumbers())return new s.CellError(s.ErrorType.VALUE,o.ErrorMessage.NumberRange);const n=h(e.size,t,r),a=this.createKernel((function(e,t,r){const n=this.thread.x*r,s=this.thread.y*r;let o=e[s][n];for(let r=0;r<t;r++)for(let a=0;a<t;a++)o=Math.max(o,e[s+r][n+a]);return o}),n)(e.rawNumbers(),t,r);return u.SimpleRangeValue.onlyNumbers(a)}))}medianpool(e,t){return this.runFunction(e.args,t,this.metadata("MEDIANPOOL"),((e,t,r=t)=>{if(!e.hasOnlyNumbers())return new s.CellError(s.ErrorType.VALUE,o.ErrorMessage.NumberRange);const n=h(e.size,t,r),a=this.createKernel((function(e,t,r){const n=this.thread.x*r,s=this.thread.y*r;let o=e[s][n];for(let r=0;r<t;r++)for(let a=0;a<t;a++)o=Math.max(o,e[s+r][n+a]);let a=e[s][n];for(let r=0;r<t;r++)for(let o=0;o<t;o++)a=Math.min(a,e[s+r][n+o]);const i=t*t;let u=a,l=o,c=42;for(let r=0;r<32;r++){const r=(u+l)/2;let o=0;for(let a=0;a<t;a++)for(let i=0;i<t;i++)e[s+a][n+i]>r&&o++;if(t%2==0){if(o===i/2){c=r;break}o>i/2?u=r:l=r}else{if(o===(i-1)/2){c=r;break}o>(i-1)/2?u=r:l=r}}return c}),n)(e.rawNumbers(),t,r);return u.SimpleRangeValue.onlyNumbers(a)}))}maxpoolArraySize(e,t){if(e.args.length<2||e.args.length>3)return n.ArraySize.error();const r=this.metadata("MAXPOOL"),s=e.args.map((e=>{var n;return this.arraySizeForAst(e,new i.InterpreterState(t.formulaAddress,t.arraysFlag||null!==(n=null==r?void 0:r.arrayFunction)&&void 0!==n&&n))}))[0],o=e.args[1];let u;u=o.type===a.AstNodeType.NUMBER?o.value:1;let l=u;if(3===e.args.length){const t=e.args[2];l=t.type===a.AstNodeType.NUMBER?t.value:1}return u>s.width||u>s.height||l>u||(s.width-u)%l!=0||(s.height-u)%l!=0?n.ArraySize.error():h(s,u,l)}medianpoolArraySize(e,t){return this.maxpoolArraySize(e,t)}transpose(e,t){return this.runFunction(e.args,t,this.metadata("TRANSPOSE"),(e=>{const t=e.rawData(),r=e.size,n=[];for(let e=0;e<r.width;++e){n[e]=[];for(let s=0;s<r.height;++s)n[e][s]=t[s][e]}return u.SimpleRangeValue.onlyValues(n)}))}transposeArraySize(e,t){if(1!==e.args.length)return n.ArraySize.error();const r=this.metadata("TRANSPOSE"),s=e.args.map((e=>{var n;return this.arraySizeForAst(e,new i.InterpreterState(t.formulaAddress,t.arraysFlag||null!==(n=null==r?void 0:r.arrayFunction)&&void 0!==n&&n))})),[o]=s;return new n.ArraySize(o.height,o.width)}createKernel(e,t){return function(...r){const n=[];for(let s=0;s<t.height;++s){n.push([]);for(let o=0;o<t.width;++o)n[s][o]=e.apply({thread:{x:o,y:s}},r)}return n}}}t.MatrixPlugin=d,d.implementedFunctions={MMULT:{method:"mmult",arraySizeMethod:"mmultArraySize",parameters:[{argumentType:l.FunctionArgumentType.RANGE},{argumentType:l.FunctionArgumentType.RANGE}],vectorizationForbidden:!0},TRANSPOSE:{method:"transpose",arraySizeMethod:"transposeArraySize",parameters:[{argumentType:l.FunctionArgumentType.RANGE}],vectorizationForbidden:!0},MAXPOOL:{method:"maxpool",arraySizeMethod:"maxpoolArraySize",parameters:[{argumentType:l.FunctionArgumentType.RANGE},{argumentType:l.FunctionArgumentType.NUMBER},{argumentType:l.FunctionArgumentType.NUMBER,optionalArg:!0}],vectorizationForbidden:!0},MEDIANPOOL:{method:"medianpool",arraySizeMethod:"medianpoolArraySize",parameters:[{argumentType:l.FunctionArgumentType.RANGE},{argumentType:l.FunctionArgumentType.NUMBER},{argumentType:l.FunctionArgumentType.NUMBER,optionalArg:!0}],vectorizationForbidden:!0}}},function(e,t,r){"use strict";t.__esModule=!0,t.MedianPlugin=void 0;var n=r(106),s=r(151),o=r(189);class a extends o.FunctionPlugin{median(e,t){return this.runFunction(e.args,t,this.metadata("MEDIAN"),((...e)=>{const t=this.arithmeticHelper.coerceNumbersExactRanges(e);return t instanceof n.CellError?t:0===t.length?new n.CellError(n.ErrorType.NUM,s.ErrorMessage.OneValue):(t.sort(((e,t)=>e-t)),t.length%2==0?(t[t.length/2-1]+t[t.length/2])/2:t[Math.floor(t.length/2)])}))}large(e,t){return this.runFunction(e.args,t,this.metadata("LARGE"),((e,t)=>{const r=this.arithmeticHelper.manyToExactNumbers(e.valuesFromTopLeftCorner());return r instanceof n.CellError?r:(r.sort(((e,t)=>e-t)),(t=Math.trunc(t))>r.length?new n.CellError(n.ErrorType.NUM,s.ErrorMessage.ValueLarge):r[r.length-t])}))}small(e,t){return this.runFunction(e.args,t,this.metadata("SMALL"),((e,t)=>{const r=this.arithmeticHelper.manyToExactNumbers(e.valuesFromTopLeftCorner());return r instanceof n.CellError?r:(r.sort(((e,t)=>e-t)),(t=Math.trunc(t))>r.length?new n.CellError(n.ErrorType.NUM,s.ErrorMessage.ValueLarge):r[t-1])}))}}t.MedianPlugin=a,a.implementedFunctions={MEDIAN:{method:"median",parameters:[{argumentType:o.FunctionArgumentType.ANY}],repeatLastArgs:1},LARGE:{method:"large",parameters:[{argumentType:o.FunctionArgumentType.RANGE},{argumentType:o.FunctionArgumentType.NUMBER,minValue:1}]},SMALL:{method:"small",parameters:[{argumentType:o.FunctionArgumentType.RANGE},{argumentType:o.FunctionArgumentType.NUMBER,minValue:1}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.ModuloPlugin=void 0;var n=r(106),s=r(189);class o extends s.FunctionPlugin{mod(e,t){return this.runFunction(e.args,t,this.metadata("MOD"),((e,t)=>0===t?new n.CellError(n.ErrorType.DIV_BY_ZERO):e%t))}}t.ModuloPlugin=o,o.implementedFunctions={MOD:{method:"mod",parameters:[{argumentType:s.FunctionArgumentType.NUMBER},{argumentType:s.FunctionArgumentType.NUMBER}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.NumericAggregationPlugin=void 0,r(3),r(73),r(132),r(85),r(94);var n=r(105),s=r(106),o=r(151),a=r(167),i=r(137),u=r(192),l=r(160),c=r(159),h=r(189);function d(e){return(0,l.isExtendedNumber)(e)&&!Number.isFinite((0,l.getRawValue)(e))?0:e}class p{constructor(e,t,r){this.sumsq=e,this.sum=t,this.count=r}static single(e){return new p(e*e,e,1)}compose(e){return new p(this.sumsq+e.sumsq,this.sum+e.sum,this.count+e.count)}averageValue(){return this.count>0?this.sum/this.count:void 0}varSValue(){return this.count>1?(this.sumsq-this.sum*this.sum/this.count)/(this.count-1):void 0}varPValue(){return this.count>0?(this.sumsq-this.sum*this.sum/this.count)/this.count:void 0}}p.empty=new p(0,0,0);class m extends h.FunctionPlugin{constructor(){super(...arguments),this.addWithEpsilonRaw=(e,t)=>this.arithmeticHelper.addWithEpsilonRaw(e,t)}sum(e,t){return this.doSum(e.args,t)}sumsq(e,t){return this.reduce(e.args,t,0,"SUMSQ",this.addWithEpsilonRaw,(e=>Math.pow((0,l.getRawValue)(e),2)),g)}max(e,t){return this.doMax(e.args,t)}maxa(e,t){return d(this.reduce(e.args,t,Number.NEGATIVE_INFINITY,"MAXA",((e,t)=>Math.max(e,t)),l.getRawValue,E))}min(e,t){return this.doMin(e.args,t)}mina(e,t){return d(this.reduce(e.args,t,Number.POSITIVE_INFINITY,"MINA",((e,t)=>Math.min(e,t)),l.getRawValue,E))}count(e,t){return this.doCount(e.args,t)}counta(e,t){return this.doCounta(e.args,t)}average(e,t){return this.doAverage(e.args,t)}averagea(e,t){var r;const n=this.reduce(e.args,t,p.empty,"_AGGREGATE_A",((e,t)=>e.compose(t)),(e=>p.single((0,l.getRawValue)(e))),E);return n instanceof s.CellError?n:null!==(r=n.averageValue())&&void 0!==r?r:new s.CellError(s.ErrorType.DIV_BY_ZERO)}vars(e,t){return this.doVarS(e.args,t)}varp(e,t){return this.doVarP(e.args,t)}vara(e,t){var r;const n=this.reduceAggregateA(e.args,t);return n instanceof s.CellError?n:null!==(r=n.varSValue())&&void 0!==r?r:new s.CellError(s.ErrorType.DIV_BY_ZERO)}varpa(e,t){var r;const n=this.reduceAggregateA(e.args,t);return n instanceof s.CellError?n:null!==(r=n.varPValue())&&void 0!==r?r:new s.CellError(s.ErrorType.DIV_BY_ZERO)}stdevs(e,t){return this.doStdevS(e.args,t)}stdevp(e,t){return this.doStdevP(e.args,t)}stdeva(e,t){const r=this.reduceAggregateA(e.args,t);if(r instanceof s.CellError)return r;{const e=r.varSValue();return void 0===e?new s.CellError(s.ErrorType.DIV_BY_ZERO):Math.sqrt(e)}}stdevpa(e,t){const r=this.reduceAggregateA(e.args,t);if(r instanceof s.CellError)return r;{const e=r.varPValue();return void 0===e?new s.CellError(s.ErrorType.DIV_BY_ZERO):Math.sqrt(e)}}product(e,t){return this.doProduct(e.args,t)}subtotal(e,t){if(e.args.length<2)return new s.CellError(s.ErrorType.NA,o.ErrorMessage.WrongArgNumber);const r=this.coerceToType(this.evaluateAst(e.args[0],t),{argumentType:h.FunctionArgumentType.NUMBER},t),n=e.args.slice(1);switch(r){case 1:case 101:return this.doAverage(n,t);case 2:case 102:return this.doCount(n,t);case 3:case 103:return this.doCounta(n,t);case 4:case 104:return this.doMax(n,t);case 5:case 105:return this.doMin(n,t);case 6:case 106:return this.doProduct(n,t);case 7:case 107:return this.doStdevS(n,t);case 8:case 108:return this.doStdevP(n,t);case 9:case 109:return this.doSum(n,t);case 10:case 110:return this.doVarS(n,t);case 11:case 111:return this.doVarP(n,t);default:return new s.CellError(s.ErrorType.VALUE,o.ErrorMessage.BadMode)}}reduceAggregate(e,t){return this.reduce(e,t,p.empty,"_AGGREGATE",((e,t)=>e.compose(t)),(e=>p.single((0,l.getRawValue)(e))),g)}reduceAggregateA(e,t){return this.reduce(e,t,p.empty,"_AGGREGATE_A",((e,t)=>e.compose(t)),(e=>p.single((0,l.getRawValue)(e))),E)}doAverage(e,t){var r;const n=this.reduceAggregate(e,t);return n instanceof s.CellError?n:null!==(r=n.averageValue())&&void 0!==r?r:new s.CellError(s.ErrorType.DIV_BY_ZERO)}doVarS(e,t){var r;const n=this.reduceAggregate(e,t);return n instanceof s.CellError?n:null!==(r=n.varSValue())&&void 0!==r?r:new s.CellError(s.ErrorType.DIV_BY_ZERO)}doVarP(e,t){var r;const n=this.reduceAggregate(e,t);return n instanceof s.CellError?n:null!==(r=n.varPValue())&&void 0!==r?r:new s.CellError(s.ErrorType.DIV_BY_ZERO)}doStdevS(e,t){const r=this.reduceAggregate(e,t);if(r instanceof s.CellError)return r;{const e=r.varSValue();return void 0===e?new s.CellError(s.ErrorType.DIV_BY_ZERO):Math.sqrt(e)}}doStdevP(e,t){const r=this.reduceAggregate(e,t);if(r instanceof s.CellError)return r;{const e=r.varPValue();return void 0===e?new s.CellError(s.ErrorType.DIV_BY_ZERO):Math.sqrt(e)}}doCount(e,t){return this.reduce(e,t,0,"COUNT",((e,t)=>e+t),l.getRawValue,(e=>(0,l.isExtendedNumber)(e)?1:0))}doCounta(e,t){return this.reduce(e,t,0,"COUNTA",((e,t)=>e+t),l.getRawValue,(e=>e===l.EmptyValue?0:1))}doMax(e,t){return d(this.reduce(e,t,Number.NEGATIVE_INFINITY,"MAX",((e,t)=>Math.max(e,t)),l.getRawValue,g))}doMin(e,t){return d(this.reduce(e,t,Number.POSITIVE_INFINITY,"MIN",((e,t)=>Math.min(e,t)),l.getRawValue,g))}doSum(e,t){return this.reduce(e,t,0,"SUM",this.addWithEpsilonRaw,l.getRawValue,g)}doProduct(e,t){return this.reduce(e,t,1,"PRODUCT",((e,t)=>e*t),l.getRawValue,g)}reduce(e,t,r,n,a,u,l){return e.length<1?new s.CellError(s.ErrorType.NA,o.ErrorMessage.WrongArgNumber):e.reduce(((e,o)=>{if(e instanceof s.CellError)return e;if(o.type===i.AstNodeType.CELL_RANGE||o.type===i.AstNodeType.COLUMN_RANGE||o.type===i.AstNodeType.ROW_RANGE){const i=this.evaluateRange(o,t,r,n,a,u,l);return i instanceof s.CellError?i:a(i,e)}let h;if(h=this.evaluateAst(o,t),h instanceof c.SimpleRangeValue){const t=Array.from(h.valuesFromTopLeftCorner()).map(l).filter((e=>void 0!==e));return t.map((e=>e instanceof s.CellError?e:u(e))).reduce(((e,t)=>e instanceof s.CellError?e:t instanceof s.CellError?t:a(e,t)),e)}if(o.type===i.AstNodeType.CELL_REFERENCE){if(h=l(h),void 0===h)return e}else if(h=this.coerceScalarToNumberOrError(h),h=l(h),void 0===h)return e;return h instanceof s.CellError?h:a(e,u(h))}),r)}evaluateRange(e,t,r,i,u,l,c){let h;try{h=n.AbsoluteCellRange.fromAst(e,t.formulaAddress)}catch(e){if(e instanceof a.SheetsNotEqual)return new s.CellError(s.ErrorType.REF,o.ErrorMessage.RangeManySheets);throw e}const d=this.dependencyGraph.getRange(h.start,h.end);if(void 0===d)throw new Error("Range does not exists in graph");let p=d.getFunctionValue(i);if(void 0===p){p=this.getRangeValues(i,h,d,l,c).reduce(((e,t)=>e instanceof s.CellError?e:t instanceof s.CellError?t:u(e,t)),r),d.setFunctionValue(i,p)}return p}getRangeValues(e,t,r,n,o){const a=[],{smallerRangeVertex:i,restRange:u}=this.dependencyGraph.rangeMapping.findSmallerRange(t);let l;if(void 0!==i&&this.dependencyGraph.existsEdge(i,r)){const t=i.getFunctionValue(e);if(void 0!==t)a.push(t);else for(const e of i.range.addresses(this.dependencyGraph)){const t=o(this.dependencyGraph.getScalarValue(e));t instanceof s.CellError?a.push(t):void 0!==t&&a.push(n(t))}l=u}else l=t;for(const e of l.addresses(this.dependencyGraph)){const t=o(this.dependencyGraph.getScalarValue(e));t instanceof s.CellError?a.push(t):void 0!==t&&a.push(n(t))}return a}}function g(e){return(0,l.isExtendedNumber)(e)||e instanceof s.CellError?e:void 0}function E(e){return"boolean"==typeof e?(0,u.coerceBooleanToNumber)(e):(0,l.isExtendedNumber)(e)||e instanceof s.CellError?e:"string"==typeof e?0:void 0}t.NumericAggregationPlugin=m,m.implementedFunctions={SUM:{method:"sum",parameters:[{argumentType:h.FunctionArgumentType.ANY}],repeatLastArgs:1},SUMSQ:{method:"sumsq",parameters:[{argumentType:h.FunctionArgumentType.ANY}],repeatLastArgs:1},MAX:{method:"max",parameters:[{argumentType:h.FunctionArgumentType.ANY}],repeatLastArgs:1},MIN:{method:"min",parameters:[{argumentType:h.FunctionArgumentType.ANY}],repeatLastArgs:1},MAXA:{method:"maxa",parameters:[{argumentType:h.FunctionArgumentType.ANY}],repeatLastArgs:1},MINA:{method:"mina",parameters:[{argumentType:h.FunctionArgumentType.ANY}],repeatLastArgs:1},COUNT:{method:"count",parameters:[{argumentType:h.FunctionArgumentType.ANY}],repeatLastArgs:1},COUNTA:{method:"counta",parameters:[{argumentType:h.FunctionArgumentType.ANY}],repeatLastArgs:1},AVERAGE:{method:"average",parameters:[{argumentType:h.FunctionArgumentType.ANY}],repeatLastArgs:1},AVERAGEA:{method:"averagea",parameters:[{argumentType:h.FunctionArgumentType.ANY}],repeatLastArgs:1},PRODUCT:{method:"product",parameters:[{argumentType:h.FunctionArgumentType.ANY}],repeatLastArgs:1},"VAR.S":{method:"vars",parameters:[{argumentType:h.FunctionArgumentType.ANY}],repeatLastArgs:1},"VAR.P":{method:"varp",parameters:[{argumentType:h.FunctionArgumentType.ANY}],repeatLastArgs:1},VARA:{method:"vara",parameters:[{argumentType:h.FunctionArgumentType.ANY}],repeatLastArgs:1},VARPA:{method:"varpa",parameters:[{argumentType:h.FunctionArgumentType.ANY}],repeatLastArgs:1},"STDEV.S":{method:"stdevs",parameters:[{argumentType:h.FunctionArgumentType.ANY}],repeatLastArgs:1},"STDEV.P":{method:"stdevp",parameters:[{argumentType:h.FunctionArgumentType.ANY}],repeatLastArgs:1},STDEVA:{method:"stdeva",parameters:[{argumentType:h.FunctionArgumentType.ANY}],repeatLastArgs:1},STDEVPA:{method:"stdevpa",parameters:[{argumentType:h.FunctionArgumentType.ANY}],repeatLastArgs:1},SUBTOTAL:{method:"subtotal",parameters:[{argumentType:h.FunctionArgumentType.NUMBER},{argumentType:h.FunctionArgumentType.ANY}],repeatLastArgs:1}},m.aliases={VAR:"VAR.S",VARP:"VAR.P",STDEV:"STDEV.S",STDEVP:"STDEV.P",VARS:"VAR.S",STDEVS:"STDEV.S"}},function(e,t,r){"use strict";t.__esModule=!0,t.PowerPlugin=void 0;var n=r(189);class s extends n.FunctionPlugin{power(e,t){return this.runFunction(e.args,t,this.metadata("POWER"),Math.pow)}}t.PowerPlugin=s,s.implementedFunctions={POWER:{method:"power",parameters:[{argumentType:n.FunctionArgumentType.NUMBER},{argumentType:n.FunctionArgumentType.NUMBER}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.RadiansPlugin=void 0;var n=r(189);class s extends n.FunctionPlugin{radians(e,t){return this.runFunction(e.args,t,this.metadata("RADIANS"),(e=>e*(Math.PI/180)))}}t.RadiansPlugin=s,s.implementedFunctions={RADIANS:{method:"radians",parameters:[{argumentType:n.FunctionArgumentType.NUMBER}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.RadixConversionPlugin=void 0;var n=r(106),s=r(151),o=r(200),a=r(189);const i=10;class u extends a.FunctionPlugin{dec2bin(e,t){return this.runFunction(e.args,t,this.metadata("DEC2BIN"),((e,t)=>c(e,2,t)))}dec2oct(e,t){return this.runFunction(e.args,t,this.metadata("DEC2OCT"),((e,t)=>c(e,8,t)))}dec2hex(e,t){return this.runFunction(e.args,t,this.metadata("DEC2HEX"),((e,t)=>c(e,16,t)))}bin2dec(e,t){return this.runFunction(e.args,t,this.metadata("BIN2DEC"),(e=>{const t=l(e,2,i);return void 0===t?new n.CellError(n.ErrorType.NUM,s.ErrorMessage.NotBinary):m(t,2)}))}bin2oct(e,t){return this.runFunction(e.args,t,this.metadata("BIN2OCT"),((e,t)=>{const r=l(e,2,i);return void 0===r?new n.CellError(n.ErrorType.NUM,s.ErrorMessage.NotBinary):c(m(r,2),8,t)}))}bin2hex(e,t){return this.runFunction(e.args,t,this.metadata("BIN2HEX"),((e,t)=>{const r=l(e,2,i);return void 0===r?new n.CellError(n.ErrorType.NUM,s.ErrorMessage.NotBinary):c(m(r,2),16,t)}))}oct2dec(e,t){return this.runFunction(e.args,t,this.metadata("OCT2DEC"),(e=>{const t=l(e,8,i);return void 0===t?new n.CellError(n.ErrorType.NUM,s.ErrorMessage.NotOctal):m(t,8)}))}oct2bin(e,t){return this.runFunction(e.args,t,this.metadata("OCT2BIN"),((e,t)=>{const r=l(e,8,i);return void 0===r?new n.CellError(n.ErrorType.NUM,s.ErrorMessage.NotOctal):c(m(r,8),2,t)}))}oct2hex(e,t){return this.runFunction(e.args,t,this.metadata("OCT2HEX"),((e,t)=>{const r=l(e,8,i);return void 0===r?new n.CellError(n.ErrorType.NUM,s.ErrorMessage.NotOctal):c(m(r,8),16,t)}))}hex2dec(e,t){return this.runFunction(e.args,t,this.metadata("HEX2DEC"),(e=>{const t=l(e,16,i);return void 0===t?new n.CellError(n.ErrorType.NUM,s.ErrorMessage.NotHex):m(t,16)}))}hex2bin(e,t){return this.runFunction(e.args,t,this.metadata("HEX2BIN"),((e,t)=>{const r=l(e,16,i);return void 0===r?new n.CellError(n.ErrorType.NUM,s.ErrorMessage.NotHex):c(m(r,16),2,t)}))}hex2oct(e,t){return this.runFunction(e.args,t,this.metadata("HEX2OCT"),((e,t)=>{const r=l(e,16,i);return void 0===r?new n.CellError(n.ErrorType.NUM,s.ErrorMessage.NotHex):c(m(r,16),8,t)}))}base(e,t){return this.runFunction(e.args,t,this.metadata("BASE"),d)}decimal(e,t){return this.runFunction(e.args,t,this.metadata("DECIMAL"),((e,t)=>{const r=l(e,t,255);return void 0===r?new n.CellError(n.ErrorType.NUM,s.ErrorMessage.NotHex):parseInt(r,t)}))}}function l(e,t,r){const n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ".substr(0,t),s=new RegExp(`^[${n}]+$`);if(!(e.length>r)&&s.test(e))return e}function c(e,t,r){if(e>function(e){return-h(e)-1}(t))return new n.CellError(n.ErrorType.NUM,s.ErrorMessage.ValueBaseLarge);if(e<h(t))return new n.CellError(n.ErrorType.NUM,s.ErrorMessage.ValueBaseSmall);const a=p(e,t);return void 0===r||e<0?a:a.length>r?new n.CellError(n.ErrorType.NUM,s.ErrorMessage.ValueBaseLong):(0,o.padLeft)(a,r)}function h(e){return-Math.pow(e,i)/2}function d(e,t,r){const n=p(e,t);return void 0!==r&&r>n.length?(0,o.padLeft)(n,r):n}function p(e,t){return(e+(e<0?Math.pow(t,i):0)).toString(t).toUpperCase()}function m(e,t){const r=parseInt(e,t),n=Math.pow(t,i);return r>=n/2?r-n:r}t.RadixConversionPlugin=u,u.implementedFunctions={DEC2BIN:{method:"dec2bin",parameters:[{argumentType:a.FunctionArgumentType.NUMBER},{argumentType:a.FunctionArgumentType.NUMBER,optionalArg:!0,minValue:1,maxValue:10}]},DEC2OCT:{method:"dec2oct",parameters:[{argumentType:a.FunctionArgumentType.NUMBER},{argumentType:a.FunctionArgumentType.NUMBER,optionalArg:!0,minValue:1,maxValue:10}]},DEC2HEX:{method:"dec2hex",parameters:[{argumentType:a.FunctionArgumentType.NUMBER},{argumentType:a.FunctionArgumentType.NUMBER,optionalArg:!0,minValue:1,maxValue:10}]},BIN2DEC:{method:"bin2dec",parameters:[{argumentType:a.FunctionArgumentType.STRING}]},BIN2OCT:{method:"bin2oct",parameters:[{argumentType:a.FunctionArgumentType.STRING},{argumentType:a.FunctionArgumentType.NUMBER,optionalArg:!0,minValue:0,maxValue:i}]},BIN2HEX:{method:"bin2hex",parameters:[{argumentType:a.FunctionArgumentType.STRING},{argumentType:a.FunctionArgumentType.NUMBER,optionalArg:!0,minValue:0,maxValue:i}]},OCT2DEC:{method:"oct2dec",parameters:[{argumentType:a.FunctionArgumentType.STRING}]},OCT2BIN:{method:"oct2bin",parameters:[{argumentType:a.FunctionArgumentType.STRING},{argumentType:a.FunctionArgumentType.NUMBER,optionalArg:!0,minValue:0,maxValue:i}]},OCT2HEX:{method:"oct2hex",parameters:[{argumentType:a.FunctionArgumentType.STRING},{argumentType:a.FunctionArgumentType.NUMBER,optionalArg:!0,minValue:0,maxValue:i}]},HEX2DEC:{method:"hex2dec",parameters:[{argumentType:a.FunctionArgumentType.STRING}]},HEX2BIN:{method:"hex2bin",parameters:[{argumentType:a.FunctionArgumentType.STRING},{argumentType:a.FunctionArgumentType.NUMBER,optionalArg:!0,minValue:0,maxValue:i}]},HEX2OCT:{method:"hex2oct",parameters:[{argumentType:a.FunctionArgumentType.STRING},{argumentType:a.FunctionArgumentType.NUMBER,optionalArg:!0,minValue:0,maxValue:i}]},DECIMAL:{method:"decimal",parameters:[{argumentType:a.FunctionArgumentType.STRING},{argumentType:a.FunctionArgumentType.NUMBER,minValue:2,maxValue:36}]},BASE:{method:"base",parameters:[{argumentType:a.FunctionArgumentType.NUMBER,minValue:0},{argumentType:a.FunctionArgumentType.NUMBER,minValue:2,maxValue:36},{argumentType:a.FunctionArgumentType.NUMBER,optionalArg:!0,minValue:0,maxValue:255}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.RandomPlugin=void 0;var n=r(106),s=r(151),o=r(189);class a extends o.FunctionPlugin{rand(e,t){return this.runFunction(e.args,t,this.metadata("RAND"),Math.random)}randbetween(e,t){return this.runFunction(e.args,t,this.metadata("RANDBETWEEN"),((e,t)=>t<e?new n.CellError(n.ErrorType.NUM,s.ErrorMessage.WrongOrder):((e=Math.ceil(e))===(t=Math.floor(t)+1)&&(t+=1),e+Math.floor(Math.random()*(t-e)))))}}t.RandomPlugin=a,a.implementedFunctions={RAND:{method:"rand",parameters:[],isVolatile:!0},RANDBETWEEN:{method:"randbetween",parameters:[{argumentType:o.FunctionArgumentType.NUMBER},{argumentType:o.FunctionArgumentType.NUMBER}],isVolatile:!0}}},function(e,t,r){"use strict";t.__esModule=!0,t.RoundingPlugin=void 0,t.findNextEvenNumber=i,t.findNextOddNumber=a;var n=r(106),s=r(151),o=r(189);function a(e){const t=Math.ceil(e);return t%2==1?t:t+1}function i(e){const t=Math.ceil(e);return t%2==0?t:t+1}class u extends o.FunctionPlugin{roundup(e,t){return this.runFunction(e.args,t,this.metadata("ROUNDDOWN"),((e,t)=>{const r=Math.pow(10,t);return e<0?-Math.ceil(-e*r)/r:Math.ceil(e*r)/r}))}rounddown(e,t){return this.runFunction(e.args,t,this.metadata("ROUNDDOWN"),((e,t)=>{const r=Math.pow(10,t);return e<0?-Math.floor(-e*r)/r:Math.floor(e*r)/r}))}round(e,t){return this.runFunction(e.args,t,this.metadata("ROUND"),((e,t)=>{const r=Math.pow(10,t);return e<0?-Math.round(-e*r)/r:Math.round(e*r)/r}))}intFunc(e,t){return this.runFunction(e.args,t,this.metadata("INT"),(e=>e<0?-Math.floor(-e):Math.floor(e)))}even(e,t){return this.runFunction(e.args,t,this.metadata("EVEN"),(e=>e<0?-i(-e):i(e)))}odd(e,t){return this.runFunction(e.args,t,this.metadata("ODD"),(e=>e<0?-a(-e):a(e)))}ceilingmath(e,t){return this.runFunction(e.args,t,this.metadata("CEILING.MATH"),((e,t,r)=>0===t||0===e?0:(t=Math.abs(t),1===r&&e<0&&(t=-t),Math.ceil(e/t)*t)))}ceiling(e,t){return this.runFunction(e.args,t,this.metadata("CEILING"),((e,t)=>0===e?0:0===t?new n.CellError(n.ErrorType.DIV_BY_ZERO):e>0&&t<0?new n.CellError(n.ErrorType.NUM,s.ErrorMessage.DistinctSigns):Math.ceil(e/t)*t))}ceilingprecise(e,t){return this.runFunction(e.args,t,this.metadata("CEILING.PRECISE"),((e,t)=>0===t||0===e?0:(t=Math.abs(t),Math.ceil(e/t)*t)))}floormath(e,t){return this.runFunction(e.args,t,this.metadata("FLOOR.MATH"),((e,t,r)=>0===t||0===e?0:(t=Math.abs(t),1===r&&e<0&&(t*=-1),Math.floor(e/t)*t)))}floor(e,t){return this.runFunction(e.args,t,this.metadata("FLOOR"),((e,t)=>0===e?0:0===t?new n.CellError(n.ErrorType.DIV_BY_ZERO):e>0&&t<0?new n.CellError(n.ErrorType.NUM,s.ErrorMessage.DistinctSigns):Math.floor(e/t)*t))}floorprecise(e,t){return this.runFunction(e.args,t,this.metadata("FLOOR.PRECISE"),((e,t)=>0===t||0===e?0:(t=Math.abs(t),Math.floor(e/t)*t)))}}t.RoundingPlugin=u,u.implementedFunctions={ROUNDUP:{method:"roundup",parameters:[{argumentType:o.FunctionArgumentType.NUMBER},{argumentType:o.FunctionArgumentType.NUMBER,defaultValue:0}]},ROUNDDOWN:{method:"rounddown",parameters:[{argumentType:o.FunctionArgumentType.NUMBER},{argumentType:o.FunctionArgumentType.NUMBER,defaultValue:0}]},ROUND:{method:"round",parameters:[{argumentType:o.FunctionArgumentType.NUMBER},{argumentType:o.FunctionArgumentType.NUMBER,defaultValue:0}]},INT:{method:"intFunc",parameters:[{argumentType:o.FunctionArgumentType.NUMBER}]},EVEN:{method:"even",parameters:[{argumentType:o.FunctionArgumentType.NUMBER}]},ODD:{method:"odd",parameters:[{argumentType:o.FunctionArgumentType.NUMBER}]},"CEILING.MATH":{method:"ceilingmath",parameters:[{argumentType:o.FunctionArgumentType.NUMBER},{argumentType:o.FunctionArgumentType.NUMBER,defaultValue:1},{argumentType:o.FunctionArgumentType.NUMBER,defaultValue:0}]},CEILING:{method:"ceiling",parameters:[{argumentType:o.FunctionArgumentType.NUMBER},{argumentType:o.FunctionArgumentType.NUMBER}]},"CEILING.PRECISE":{method:"ceilingprecise",parameters:[{argumentType:o.FunctionArgumentType.NUMBER},{argumentType:o.FunctionArgumentType.NUMBER,defaultValue:1}]},"FLOOR.MATH":{method:"floormath",parameters:[{argumentType:o.FunctionArgumentType.NUMBER},{argumentType:o.FunctionArgumentType.NUMBER,defaultValue:1},{argumentType:o.FunctionArgumentType.NUMBER,defaultValue:0}]},FLOOR:{method:"floor",parameters:[{argumentType:o.FunctionArgumentType.NUMBER},{argumentType:o.FunctionArgumentType.NUMBER}]},"FLOOR.PRECISE":{method:"floorprecise",parameters:[{argumentType:o.FunctionArgumentType.NUMBER},{argumentType:o.FunctionArgumentType.NUMBER,defaultValue:1}]}},u.aliases={"ISO.CEILING":"CEILING.PRECISE",TRUNC:"ROUNDDOWN"}},function(e,t,r){"use strict";t.__esModule=!0,t.SqrtPlugin=void 0;var n=r(189);class s extends n.FunctionPlugin{sqrt(e,t){return this.runFunction(e.args,t,this.metadata("SQRT"),Math.sqrt)}}t.SqrtPlugin=s,s.implementedFunctions={SQRT:{method:"sqrt",parameters:[{argumentType:n.FunctionArgumentType.NUMBER}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.ConditionalAggregationPlugin=void 0,r(3),r(85);var n=r(106),s=r(151),o=r(275),a=r(160),i=r(189);class u{constructor(e,t){this.sum=e,this.count=t}static single(e){return new u(e,1)}compose(e){return new u(this.sum+e.sum,this.count+e.count)}averageValue(){return this.count>0?this.sum/this.count:void 0}}function l(e){return(0,a.isExtendedNumber)(e)&&!Number.isFinite((0,a.getRawValue)(e))?0:e}function c(e){return e instanceof n.CellError?e:(0,a.isExtendedNumber)(e)?(0,a.getRawValue)(e):void 0}u.empty=new u(0,0);class h extends i.FunctionPlugin{sumif(e,t){const r="SUMIF";return this.runFunction(e.args,t,this.metadata(r),((e,t,n)=>this.computeConditionalAggregationFunction(null!=n?n:e,[e,t],r,0,((e,t)=>this.arithmeticHelper.nonstrictadd(e,t)),c)))}sumifs(e,t){const r="SUMIFS";return this.runFunction(e.args,t,this.metadata(r),((e,...t)=>this.computeConditionalAggregationFunction(e,t,r,0,((e,t)=>this.arithmeticHelper.nonstrictadd(e,t)),c)))}averageif(e,t){const r="AVERAGEIF";return this.runFunction(e.args,t,this.metadata(r),((e,t,s)=>{const o=this.computeConditionalAggregationFunction(null!=s?s:e,[e,t],r,u.empty,((e,t)=>e.compose(t)),(e=>(0,a.isExtendedNumber)(e)?u.single((0,a.getRawValue)(e)):u.empty));return o instanceof n.CellError?o:o.averageValue()||new n.CellError(n.ErrorType.DIV_BY_ZERO)}))}countif(e,t){const r="COUNTIF";return this.runFunction(e.args,t,this.metadata(r),((e,t)=>this.computeConditionalAggregationFunction(e,[e,t],r,0,((e,t)=>e+t),(()=>1))))}countifs(e,t){const r="COUNTIFS";return this.runFunction(e.args,t,this.metadata(r),((...e)=>this.computeConditionalAggregationFunction(e[0],e,r,0,((e,t)=>e+t),(()=>1))))}minifs(e,t){const r="MINIFS",n=(e,t)=>void 0===t||void 0===e?void 0===t?e:t:Math.min(e,t);return this.runFunction(e.args,t,this.metadata(r),((e,...t)=>l(this.computeConditionalAggregationFunction(e,t,r,Number.POSITIVE_INFINITY,n,c))))}maxifs(e,t){const r="MAXIFS",n=(e,t)=>void 0===t||void 0===e?void 0===t?e:t:Math.max(e,t);return this.runFunction(e.args,t,this.metadata(r),((e,...t)=>l(this.computeConditionalAggregationFunction(e,t,r,Number.NEGATIVE_INFINITY,n,c))))}computeConditionalAggregationFunction(e,t,r,a,i,u){const l=[];for(let e=0;e<t.length;e+=2){const r=t[e],a=this.interpreter.criterionBuilder.fromCellValue(t[e+1],this.arithmeticHelper);if(void 0===a)return new n.CellError(n.ErrorType.VALUE,s.ErrorMessage.BadCriterion);l.push(new o.Condition(r,a))}return new o.CriterionFunctionCompute(this.interpreter,function(e){return t=>{const r=t.map((e=>`${e.conditionRange.range.sheet},${e.conditionRange.range.start.col},${e.conditionRange.range.start.row}`));return[e,...r].join(",")}}(r),a,i,u).compute(e,l)}}t.ConditionalAggregationPlugin=h,h.implementedFunctions={SUMIF:{method:"sumif",parameters:[{argumentType:i.FunctionArgumentType.RANGE},{argumentType:i.FunctionArgumentType.NOERROR},{argumentType:i.FunctionArgumentType.RANGE,optionalArg:!0}]},COUNTIF:{method:"countif",parameters:[{argumentType:i.FunctionArgumentType.RANGE},{argumentType:i.FunctionArgumentType.NOERROR}]},AVERAGEIF:{method:"averageif",parameters:[{argumentType:i.FunctionArgumentType.RANGE},{argumentType:i.FunctionArgumentType.NOERROR},{argumentType:i.FunctionArgumentType.RANGE,optionalArg:!0}]},SUMIFS:{method:"sumifs",parameters:[{argumentType:i.FunctionArgumentType.RANGE},{argumentType:i.FunctionArgumentType.RANGE},{argumentType:i.FunctionArgumentType.NOERROR}],repeatLastArgs:2},COUNTIFS:{method:"countifs",parameters:[{argumentType:i.FunctionArgumentType.RANGE},{argumentType:i.FunctionArgumentType.NOERROR}],repeatLastArgs:2},MINIFS:{method:"minifs",parameters:[{argumentType:i.FunctionArgumentType.RANGE},{argumentType:i.FunctionArgumentType.RANGE},{argumentType:i.FunctionArgumentType.NOERROR}],repeatLastArgs:2},MAXIFS:{method:"maxifs",parameters:[{argumentType:i.FunctionArgumentType.RANGE},{argumentType:i.FunctionArgumentType.RANGE},{argumentType:i.FunctionArgumentType.NOERROR}],repeatLastArgs:2}}},function(e,t,r){"use strict";t.__esModule=!0,t.CriterionFunctionCompute=t.Condition=void 0,r(3),r(73),r(190),r(134),r(85);var n=r(106),s=r(151),o=r(276),a=r(160);t.CriterionFunctionCompute=class{constructor(e,t,r,n,s){this.interpreter=e,this.cacheKey=t,this.reduceInitialValue=r,this.composeFunction=n,this.mapFunction=s,this.dependencyGraph=this.interpreter.dependencyGraph}compute(e,t){for(const r of t)if(!r.conditionRange.sameDimensionsAs(e))return new n.CellError(n.ErrorType.VALUE,s.ErrorMessage.EqualLength);const r=this.tryToGetRangeVertexForRangeValue(e),o=t.map((e=>this.tryToGetRangeVertexForRangeValue(e.conditionRange)));if(r&&o.every((e=>void 0!==e))){const n=t.map((e=>e.criterionPackage.raw)).join(","),s=this.findAlreadyComputedValueInCache(r,this.cacheKey(t),n);if(void 0!==s)return this.interpreter.stats.incrementCriterionFunctionFullCacheUsed(),s;const a=this.buildNewCriterionCache(this.cacheKey(t),t.map((e=>e.conditionRange.range)),e.range);return a.has(n)||a.set(n,[this.evaluateRangeValue(e,t),t.map((e=>e.criterionPackage.lambda))]),r.setCriterionFunctionValues(this.cacheKey(t),a),o.forEach((e=>{void 0!==e&&e.addDependentCacheRange(r)})),a.get(n)[0]}return this.evaluateRangeValue(e,t)}tryToGetRangeVertexForRangeValue(e){const t=e.range;return void 0===t?void 0:this.dependencyGraph.getRange(t.start,t.end)}reduceFunction(e){let t=this.reduceInitialValue;for(const r of e)t=this.composeFunction(t,r);return t}findAlreadyComputedValueInCache(e,t,r){return e.getCriterionFunctionValue(t,r)}evaluateRangeValue(e,t){const r=t.map((e=>e.criterionPackage.lambda)),n=Array.from(e.valuesFromTopLeftCorner()).map(this.mapFunction)[Symbol.iterator](),s=u(r,t.map((e=>e.conditionRange.iterateValuesFromTopLeftCorner())),n);return this.reduceFunction(s)}buildNewCriterionCache(e,t,r){const s=this.dependencyGraph.getRange(r.start,r.end),{smallerRangeVertex:o,restConditionRanges:a,restValuesRange:l}=((e,t,r)=>{if(r.end.row>r.start.row){const s=(0,n.simpleCellAddress)(r.end.sheet,r.end.col,r.end.row-1),o=e.getRange(r.start,s);if(void 0!==o)return{smallerRangeVertex:o,restValuesRange:r.withStart((0,n.simpleCellAddress)(r.start.sheet,r.start.col,r.end.row)),restConditionRanges:t.map((e=>e.withStart((0,n.simpleCellAddress)(e.start.sheet,e.start.col,e.end.row))))}}return{restValuesRange:r,restConditionRanges:t}})(this.dependencyGraph,t,r);let c;c=void 0!==o&&this.dependencyGraph.existsEdge(o,s)?o.getCriterionFunctionValues(e):new Map;const h=new Map;return c.forEach((([e,t],r)=>{const n=u(t,a.map((e=>i(this.dependencyGraph,e))),Array.from(i(this.dependencyGraph,l)).map(this.mapFunction)[Symbol.iterator]()),s=this.composeFunction(e,this.reduceFunction(n));this.interpreter.stats.incrementCriterionFunctionPartialCacheUsed(),h.set(r,[s,t])})),h}};function*i(e,t){for(const r of t.addresses(e))yield(0,a.getRawValue)(e.getScalarValue(r))}function*u(e,t,r){for(const n of r){const r=t.map((e=>(0,o.split)(e)));if(!r.every((e=>Object.prototype.hasOwnProperty.call(e,"value"))))return;l(r.map((e=>(0,a.getRawValue)(e.value))),e).every((([e,t])=>t(e)))&&(yield n),t=r.map((e=>e.rest))}}function l(e,t){const r=[];for(let n=0;n<Math.min(e.length,t.length);n++)r.push([e[n],t[n]]);return r}t.Condition=class{constructor(e,t){this.conditionRange=e,this.criterionPackage=t}}},function(e,t,r){"use strict";function*n(){}t.__esModule=!0,t.empty=n,t.first=function(e){const t=e[Symbol.iterator](),{done:r,value:n}=t.next();if(!r)return n;return},t.split=function(e){const t=e[Symbol.iterator](),{done:r,value:s}=t.next();return r?{rest:n()}:{value:s,rest:t}}},function(e,t,r){"use strict";t.__esModule=!0,t.SumprodPlugin=void 0,r(85);var n=r(106),s=r(151),o=r(160),a=r(189);class i extends a.FunctionPlugin{sumproduct(e,t){return this.runFunction(e.args,t,this.metadata("SUMPRODUCT"),((...e)=>{const t=e[0].width(),r=e[0].height();for(const o of e)if(o.width()!==t||o.height()!==r)return new n.CellError(n.ErrorType.VALUE,s.ErrorMessage.EqualLength);let a=0;const i=e.map((e=>e.iterateValuesFromTopLeftCorner()));for(let e=0;e<t*r;e++){let e=1;for(const t of i){const r=t.next().value;if(r instanceof n.CellError)return r;const s=this.coerceScalarToNumberOrError(r);(0,o.isExtendedNumber)(s)?e*=(0,o.getRawValue)(s):e=0}a+=e}return a}))}}t.SumprodPlugin=i,i.implementedFunctions={SUMPRODUCT:{method:"sumproduct",parameters:[{argumentType:a.FunctionArgumentType.RANGE}],repeatLastArgs:1}}},function(e,t,r){"use strict";t.__esModule=!0,t.TextPlugin=void 0;var n=r(106),s=r(151),o=r(189);class a extends o.FunctionPlugin{concatenate(e,t){return this.runFunction(e.args,t,this.metadata("CONCATENATE"),((...e)=>"".concat(...e)))}split(e,t){return this.runFunction(e.args,t,this.metadata("SPLIT"),((e,t)=>{const r=e.split(" ");return t>=r.length||t<0?new n.CellError(n.ErrorType.VALUE,s.ErrorMessage.IndexBounds):r[t]}))}len(e,t){return this.runFunction(e.args,t,this.metadata("LEN"),(e=>e.length))}lower(e,t){return this.runFunction(e.args,t,this.metadata("LOWER"),(e=>e.toLowerCase()))}trim(e,t){return this.runFunction(e.args,t,this.metadata("TRIM"),(e=>e.replace(/^ +| +$/g,"").replace(/ +/g," ")))}proper(e,t){return this.runFunction(e.args,t,this.metadata("PROPER"),(e=>e.replace(/\p{L}+/gu,(e=>e.charAt(0).toUpperCase()+e.substring(1).toLowerCase()))))}clean(e,t){return this.runFunction(e.args,t,this.metadata("CLEAN"),(e=>e.replace(/[\u0000-\u001F]/g,"")))}exact(e,t){return this.runFunction(e.args,t,this.metadata("EXACT"),((e,t)=>e===t))}rept(e,t){return this.runFunction(e.args,t,this.metadata("REPT"),((e,t)=>t<0?new n.CellError(n.ErrorType.VALUE,s.ErrorMessage.NegativeCount):e.repeat(t)))}right(e,t){return this.runFunction(e.args,t,this.metadata("RIGHT"),((e,t)=>t<0?new n.CellError(n.ErrorType.VALUE,s.ErrorMessage.NegativeLength):0===t?"":e.slice(-t)))}left(e,t){return this.runFunction(e.args,t,this.metadata("LEFT"),((e,t)=>t<0?new n.CellError(n.ErrorType.VALUE,s.ErrorMessage.NegativeLength):e.slice(0,t)))}mid(e,t){return this.runFunction(e.args,t,this.metadata("MID"),((e,t,r)=>t<1?new n.CellError(n.ErrorType.VALUE,s.ErrorMessage.LessThanOne):r<0?new n.CellError(n.ErrorType.VALUE,s.ErrorMessage.NegativeLength):e.substring(t-1,t+r-1)))}replace(e,t){return this.runFunction(e.args,t,this.metadata("REPLACE"),((e,t,r,o)=>t<1?new n.CellError(n.ErrorType.VALUE,s.ErrorMessage.LessThanOne):r<0?new n.CellError(n.ErrorType.VALUE,s.ErrorMessage.NegativeLength):e.substring(0,t-1)+o+e.substring(t+r-1)))}search(e,t){return this.runFunction(e.args,t,this.metadata("SEARCH"),((e,t,r)=>{if(r<1||r>t.length)return new n.CellError(n.ErrorType.VALUE,s.ErrorMessage.LengthBounds);const o=e.toLowerCase(),a=t.substring(r-1).toLowerCase(),i=this.arithmeticHelper.requiresRegex(o)?this.arithmeticHelper.searchString(o,a):a.indexOf(o);return i>-1?i+r:new n.CellError(n.ErrorType.VALUE,s.ErrorMessage.PatternNotFound)}))}substitute(e,t){return this.runFunction(e.args,t,this.metadata("SUBSTITUTE"),((e,t,r,o)=>{const a=this.escapeRegExpSpecialCharacters(t),i=new RegExp(a,"g");if(void 0===o)return e.replace(i,r);if(o<1)return new n.CellError(n.ErrorType.VALUE,s.ErrorMessage.LessThanOne);let u,l=0;for(;null!==(u=i.exec(e));)if(o===++l)return e.substring(0,u.index)+r+e.substring(i.lastIndex);return e}))}find(e,t){return this.runFunction(e.args,t,this.metadata("FIND"),((e,t,r)=>{if(r<1||r>t.length)return new n.CellError(n.ErrorType.VALUE,s.ErrorMessage.IndexBounds);const o=t.substring(r-1).indexOf(e)+r;return o>0?o:new n.CellError(n.ErrorType.VALUE,s.ErrorMessage.PatternNotFound)}))}t(e,t){return this.runFunction(e.args,t,this.metadata("T"),(e=>e instanceof n.CellError||"string"==typeof e?e:""))}upper(e,t){return this.runFunction(e.args,t,this.metadata("UPPER"),(e=>e.toUpperCase()))}escapeRegExpSpecialCharacters(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}}t.TextPlugin=a,a.implementedFunctions={CONCATENATE:{method:"concatenate",parameters:[{argumentType:o.FunctionArgumentType.STRING}],repeatLastArgs:1,expandRanges:!0},EXACT:{method:"exact",parameters:[{argumentType:o.FunctionArgumentType.STRING},{argumentType:o.FunctionArgumentType.STRING}]},SPLIT:{method:"split",parameters:[{argumentType:o.FunctionArgumentType.STRING},{argumentType:o.FunctionArgumentType.NUMBER}]},LEN:{method:"len",parameters:[{argumentType:o.FunctionArgumentType.STRING}]},LOWER:{method:"lower",parameters:[{argumentType:o.FunctionArgumentType.STRING}]},MID:{method:"mid",parameters:[{argumentType:o.FunctionArgumentType.STRING},{argumentType:o.FunctionArgumentType.NUMBER},{argumentType:o.FunctionArgumentType.NUMBER}]},TRIM:{method:"trim",parameters:[{argumentType:o.FunctionArgumentType.STRING}]},T:{method:"t",parameters:[{argumentType:o.FunctionArgumentType.SCALAR}]},PROPER:{method:"proper",parameters:[{argumentType:o.FunctionArgumentType.STRING}]},CLEAN:{method:"clean",parameters:[{argumentType:o.FunctionArgumentType.STRING}]},REPT:{method:"rept",parameters:[{argumentType:o.FunctionArgumentType.STRING},{argumentType:o.FunctionArgumentType.NUMBER}]},RIGHT:{method:"right",parameters:[{argumentType:o.FunctionArgumentType.STRING},{argumentType:o.FunctionArgumentType.NUMBER,defaultValue:1}]},LEFT:{method:"left",parameters:[{argumentType:o.FunctionArgumentType.STRING},{argumentType:o.FunctionArgumentType.NUMBER,defaultValue:1}]},REPLACE:{method:"replace",parameters:[{argumentType:o.FunctionArgumentType.STRING},{argumentType:o.FunctionArgumentType.NUMBER},{argumentType:o.FunctionArgumentType.NUMBER},{argumentType:o.FunctionArgumentType.STRING}]},SEARCH:{method:"search",parameters:[{argumentType:o.FunctionArgumentType.STRING},{argumentType:o.FunctionArgumentType.STRING},{argumentType:o.FunctionArgumentType.NUMBER,defaultValue:1}]},SUBSTITUTE:{method:"substitute",parameters:[{argumentType:o.FunctionArgumentType.STRING},{argumentType:o.FunctionArgumentType.STRING},{argumentType:o.FunctionArgumentType.STRING},{argumentType:o.FunctionArgumentType.NUMBER,optionalArg:!0}]},FIND:{method:"find",parameters:[{argumentType:o.FunctionArgumentType.STRING},{argumentType:o.FunctionArgumentType.STRING},{argumentType:o.FunctionArgumentType.NUMBER,defaultValue:1}]},UPPER:{method:"upper",parameters:[{argumentType:o.FunctionArgumentType.STRING}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.TrigonometryPlugin=void 0;var n=r(106),s=r(151),o=r(189),a=r(263);class i extends o.FunctionPlugin{acos(e,t){return this.runFunction(e.args,t,this.metadata("ACOS"),Math.acos)}asin(e,t){return this.runFunction(e.args,t,this.metadata("ASIN"),Math.asin)}cos(e,t){return this.runFunction(e.args,t,this.metadata("COS"),Math.cos)}sin(e,t){return this.runFunction(e.args,t,this.metadata("SIN"),Math.sin)}tan(e,t){return this.runFunction(e.args,t,this.metadata("TAN"),Math.tan)}atan(e,t){return this.runFunction(e.args,t,this.metadata("ATAN"),Math.atan)}atan2(e,t){return this.runFunction(e.args,t,this.metadata("ATAN2"),((e,t)=>0===e&&0===t?new n.CellError(n.ErrorType.DIV_BY_ZERO):Math.atan2(t,e)))}cot(e,t){return this.runFunction(e.args,t,this.metadata("COT"),(e=>0===e?new n.CellError(n.ErrorType.DIV_BY_ZERO):1/Math.tan(e)))}acot(e,t){return this.runFunction(e.args,t,this.metadata("ACOT"),(e=>0===e?a.PI/2:Math.atan(1/e)))}sec(e,t){return this.runFunction(e.args,t,this.metadata("SEC"),(e=>1/Math.cos(e)))}csc(e,t){return this.runFunction(e.args,t,this.metadata("CSC"),(e=>0===e?new n.CellError(n.ErrorType.DIV_BY_ZERO):1/Math.sin(e)))}sinh(e,t){return this.runFunction(e.args,t,this.metadata("SINH"),Math.sinh)}asinh(e,t){return this.runFunction(e.args,t,this.metadata("ASINH"),Math.asinh)}cosh(e,t){return this.runFunction(e.args,t,this.metadata("COSH"),Math.cosh)}acosh(e,t){return this.runFunction(e.args,t,this.metadata("ACOSH"),Math.acosh)}tanh(e,t){return this.runFunction(e.args,t,this.metadata("TANH"),Math.tanh)}atanh(e,t){return this.runFunction(e.args,t,this.metadata("ATANH"),Math.atanh)}coth(e,t){return this.runFunction(e.args,t,this.metadata("COTH"),(e=>0===e?new n.CellError(n.ErrorType.DIV_BY_ZERO):1/Math.tanh(e)))}acoth(e,t){return this.runFunction(e.args,t,this.metadata("ACOTH"),(e=>0===e?new n.CellError(n.ErrorType.NUM,s.ErrorMessage.NonZero):Math.atanh(1/e)))}sech(e,t){return this.runFunction(e.args,t,this.metadata("SECH"),(e=>1/Math.cosh(e)))}csch(e,t){return this.runFunction(e.args,t,this.metadata("CSCH"),(e=>0===e?new n.CellError(n.ErrorType.DIV_BY_ZERO):1/Math.sinh(e)))}}t.TrigonometryPlugin=i,i.implementedFunctions={ACOS:{method:"acos",parameters:[{argumentType:o.FunctionArgumentType.NUMBER}]},ASIN:{method:"asin",parameters:[{argumentType:o.FunctionArgumentType.NUMBER}]},COS:{method:"cos",parameters:[{argumentType:o.FunctionArgumentType.NUMBER}]},SIN:{method:"sin",parameters:[{argumentType:o.FunctionArgumentType.NUMBER}]},TAN:{method:"tan",parameters:[{argumentType:o.FunctionArgumentType.NUMBER}]},ATAN:{method:"atan",parameters:[{argumentType:o.FunctionArgumentType.NUMBER}]},ATAN2:{method:"atan2",parameters:[{argumentType:o.FunctionArgumentType.NUMBER},{argumentType:o.FunctionArgumentType.NUMBER}]},COT:{method:"cot",parameters:[{argumentType:o.FunctionArgumentType.NUMBER}]},SEC:{method:"sec",parameters:[{argumentType:o.FunctionArgumentType.NUMBER}]},CSC:{method:"csc",parameters:[{argumentType:o.FunctionArgumentType.NUMBER}]},SINH:{method:"sinh",parameters:[{argumentType:o.FunctionArgumentType.NUMBER}]},COSH:{method:"cosh",parameters:[{argumentType:o.FunctionArgumentType.NUMBER}]},TANH:{method:"tanh",parameters:[{argumentType:o.FunctionArgumentType.NUMBER}]},COTH:{method:"coth",parameters:[{argumentType:o.FunctionArgumentType.NUMBER}]},SECH:{method:"sech",parameters:[{argumentType:o.FunctionArgumentType.NUMBER}]},CSCH:{method:"csch",parameters:[{argumentType:o.FunctionArgumentType.NUMBER}]},ACOT:{method:"acot",parameters:[{argumentType:o.FunctionArgumentType.NUMBER}]},ASINH:{method:"asinh",parameters:[{argumentType:o.FunctionArgumentType.NUMBER}]},ACOSH:{method:"acosh",parameters:[{argumentType:o.FunctionArgumentType.NUMBER}]},ATANH:{method:"atanh",parameters:[{argumentType:o.FunctionArgumentType.NUMBER}]},ACOTH:{method:"acoth",parameters:[{argumentType:o.FunctionArgumentType.NUMBER}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.LookupPlugin=void 0,r(73),r(183),r(85);var n=r(105),s=r(106),o=r(151),a=r(281),i=r(162),u=r(192),l=r(159),c=r(189),h=r(2);class d extends c.FunctionPlugin{constructor(){super(...arguments),this.rowSearch=new a.RowSearchStrategy(this.dependencyGraph)}vlookup(e,t){return this.runFunction(e.args,t,this.metadata("VLOOKUP"),((e,t,r,n)=>{const a=t.range;if(void 0===a)return new s.CellError(s.ErrorType.VALUE,o.ErrorMessage.WrongType);if(r<1)return new s.CellError(s.ErrorType.VALUE,o.ErrorMessage.LessThanOne);if(r>a.width())return new s.CellError(s.ErrorType.REF,o.ErrorMessage.IndexLarge);const i={ordering:n?"asc":"none",ifNoMatch:n?"returnLowerBound":"returnNotFound"};return this.doVlookup((0,u.zeroIfEmpty)(e),t,r-1,i)}))}hlookup(e,t){return this.runFunction(e.args,t,this.metadata("HLOOKUP"),((e,t,r,n)=>{const a=t.range;if(void 0===a)return new s.CellError(s.ErrorType.VALUE,o.ErrorMessage.WrongType);if(r<1)return new s.CellError(s.ErrorType.VALUE,o.ErrorMessage.LessThanOne);if(r>a.height())return new s.CellError(s.ErrorType.REF,o.ErrorMessage.IndexLarge);const i={ordering:n?"asc":"none",ifNoMatch:n?"returnLowerBound":"returnNotFound"};return this.doHlookup((0,u.zeroIfEmpty)(e),t,r-1,i)}))}xlookup(e,t){return this.runFunction(e.args,t,this.metadata("XLOOKUP"),((e,t,r,n,a,i)=>{if(![0,-1,1,2].includes(a))return new s.CellError(s.ErrorType.VALUE,o.ErrorMessage.BadMode);if(![1,-1,2,-2].includes(i))return new s.CellError(s.ErrorType.VALUE,o.ErrorMessage.BadMode);const c=t instanceof l.SimpleRangeValue?t:l.SimpleRangeValue.fromScalar(t),h=r instanceof l.SimpleRangeValue?r:l.SimpleRangeValue.fromScalar(r),d=2===a,p={ordering:2===i?"asc":-2===i?"desc":"none",returnOccurrence:-1===i?"last":"first",ifNoMatch:-1===a?"returnLowerBound":1===a?"returnUpperBound":"returnNotFound"};return this.doXlookup((0,u.zeroIfEmpty)(e),c,h,n,d,p)}))}xlookupArraySize(e){var t,r;const n=null===(t=null==e?void 0:e.args)||void 0===t?void 0:t[1],s=null===(r=null==e?void 0:e.args)||void 0===r?void 0:r[2];if(null==(null==n?void 0:n.start)||null==(null==n?void 0:n.end)||null==(null==s?void 0:s.start)||null==(null==s?void 0:s.end))return h.ArraySize.error();const o=n.end.row-n.start.row+1,a=n.end.col-n.start.col+1,i=s.end.row-s.start.row+1,u=s.end.col-s.start.col+1,l=1===a&&i===o;return l||1===o&&u===a?l?new h.ArraySize(u,1):new h.ArraySize(1,i):h.ArraySize.error()}match(e,t){return this.runFunction(e.args,t,this.metadata("MATCH"),((e,t,r)=>this.doMatch((0,u.zeroIfEmpty)(e),t,r)))}searchInRange(e,t,r,n,s){return r&&"string"==typeof e&&this.arithmeticHelper.requiresRegex(e)?s.advancedFind(this.arithmeticHelper.eqMatcherFunction(e),t,{returnOccurrence:n.returnOccurrence}):s.find(e,t,n)}doVlookup(e,t,r,a){this.dependencyGraph.stats.start(i.StatType.VLOOKUP);const u=t.range;let c;c=void 0===u?l.SimpleRangeValue.onlyValues(t.data.map((e=>[e[0]]))):l.SimpleRangeValue.onlyRange(n.AbsoluteCellRange.spanFrom(u.start,1,u.height()),this.dependencyGraph);const h=this.searchInRange(e,c,"none"===a.ordering,a,this.columnSearch);if(this.dependencyGraph.stats.end(i.StatType.VLOOKUP),-1===h)return new s.CellError(s.ErrorType.NA,o.ErrorMessage.ValueNotFound);let d;if(void 0===u)d=t.data[h][r];else{const e=(0,s.simpleCellAddress)(u.sheet,u.start.col+r,u.start.row+h);d=this.dependencyGraph.getCellValue(e)}return d instanceof l.SimpleRangeValue?new s.CellError(s.ErrorType.VALUE,o.ErrorMessage.WrongType):d}doHlookup(e,t,r,a){const i=t.range;let u;u=void 0===i?l.SimpleRangeValue.onlyValues([t.data[0]]):l.SimpleRangeValue.onlyRange(n.AbsoluteCellRange.spanFrom(i.start,i.width(),1),this.dependencyGraph);const c=this.searchInRange(e,u,"none"===a.ordering,a,this.rowSearch);if(-1===c)return new s.CellError(s.ErrorType.NA,o.ErrorMessage.ValueNotFound);let h;if(void 0===i)h=t.data[r][c];else{const e=(0,s.simpleCellAddress)(i.sheet,i.start.col+c,i.start.row+r);h=this.dependencyGraph.getCellValue(e)}return h instanceof l.SimpleRangeValue?new s.CellError(s.ErrorType.VALUE,o.ErrorMessage.WrongType):h}doXlookup(e,t,r,n,a,i){const u=1===t.width()&&r.height()===t.height(),c=1===t.height()&&r.width()===t.width();if(!u&&!c)return new s.CellError(s.ErrorType.VALUE,o.ErrorMessage.WrongDimension);const h=u?this.columnSearch:this.rowSearch,d=this.searchInRange(e,t,a,i,h);if(-1===d)return n==s.ErrorType.NA?new s.CellError(s.ErrorType.NA,o.ErrorMessage.ValueNotFound):n;const p=u?[r.data[d]]:r.data.map((e=>[e[d]]));return l.SimpleRangeValue.onlyValues(p)}doMatch(e,t,r){if(![-1,0,1].includes(r))return new s.CellError(s.ErrorType.VALUE,o.ErrorMessage.BadMode);if(t.width()>1&&t.height()>1)return new s.CellError(s.ErrorType.NA);const n=0===r?{ordering:"none",ifNoMatch:"returnNotFound"}:{ordering:-1===r?"desc":"asc",ifNoMatch:-1===r?"returnUpperBound":"returnLowerBound"},a=(1===t.width()?this.columnSearch:this.rowSearch).find(e,t,n);return-1===a?new s.CellError(s.ErrorType.NA,o.ErrorMessage.ValueNotFound):a+1}}t.LookupPlugin=d,d.implementedFunctions={VLOOKUP:{method:"vlookup",parameters:[{argumentType:c.FunctionArgumentType.NOERROR},{argumentType:c.FunctionArgumentType.RANGE},{argumentType:c.FunctionArgumentType.NUMBER},{argumentType:c.FunctionArgumentType.BOOLEAN,defaultValue:!0}]},HLOOKUP:{method:"hlookup",parameters:[{argumentType:c.FunctionArgumentType.NOERROR},{argumentType:c.FunctionArgumentType.RANGE},{argumentType:c.FunctionArgumentType.NUMBER},{argumentType:c.FunctionArgumentType.BOOLEAN,defaultValue:!0}]},XLOOKUP:{method:"xlookup",arraySizeMethod:"xlookupArraySize",parameters:[{argumentType:c.FunctionArgumentType.NOERROR},{argumentType:c.FunctionArgumentType.RANGE},{argumentType:c.FunctionArgumentType.RANGE},{argumentType:c.FunctionArgumentType.SCALAR,optionalArg:!0,defaultValue:s.ErrorType.NA},{argumentType:c.FunctionArgumentType.NUMBER,optionalArg:!0,defaultValue:0},{argumentType:c.FunctionArgumentType.NUMBER,optionalArg:!0,defaultValue:1}]},MATCH:{method:"match",parameters:[{argumentType:c.FunctionArgumentType.NOERROR},{argumentType:c.FunctionArgumentType.RANGE},{argumentType:c.FunctionArgumentType.NUMBER,defaultValue:1}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.RowSearchStrategy=void 0;var n=r(232);class s extends n.AdvancedFind{constructor(e){super(e),this.dependencyGraph=e}find(e,t,r){return this.basicFind(e,t,"col",r)}}t.RowSearchStrategy=s},function(e,t,r){"use strict";t.__esModule=!0,t.RomanPlugin=void 0;var n=r(106),s=r(151),o=r(160),a=r(189);class i extends a.FunctionPlugin{roman(e,t){return this.runFunction(e.args,t,this.metadata("ROMAN"),((e,t)=>(e=Math.trunc(e),!1===t?t=4:!0===t&&(t=0),(t=(0,o.getRawValue)(this.coerceScalarToNumberOrError(t)))instanceof n.CellError?t:(t=Math.trunc(t))<0?new n.CellError(n.ErrorType.VALUE,s.ErrorMessage.ValueSmall):t>4?new n.CellError(n.ErrorType.VALUE,s.ErrorMessage.ValueLarge):function(e,t){const r={val:e%1e3,acc:"M".repeat(Math.floor(e/1e3))};4===t&&(l(r,"IM",999,1e3),l(r,"ID",499,500));t>=3&&(l(r,"VM",995,1e3),l(r,"VD",495,500));t>=2&&(l(r,"XM",990,1e3),l(r,"XD",490,500));t>=1&&(l(r,"LM",950,1e3),l(r,"LD",450,500));l(r,"CM",900,1e3),l(r,"CD",400,500),l(r,"D",500,900),r.acc+="C".repeat(Math.floor(r.val/100)),r.val%=100,t>=2&&(l(r,"IC",99,100),l(r,"IL",49,50));t>=1&&(l(r,"VC",95,100),l(r,"VL",45,50));return l(r,"XC",90,100),l(r,"XL",40,50),l(r,"L",50,90),r.acc+="X".repeat(Math.floor(r.val/10)),r.val%=10,l(r,"IX",9,10),l(r,"IV",4,5),l(r,"V",5,9),r.acc+="I".repeat(r.val),r.acc}(e,t))))}arabic(e,t){return this.runFunction(e.args,t,this.metadata("ARABIC"),(e=>{let t=!1;if((e=e.trim().toUpperCase()).startsWith("-")&&(t=!0,""===(e=e.slice(1))))return new n.CellError(n.ErrorType.VALUE,s.ErrorMessage.InvalidRoman);const r={input:e,acc:0};return u(r,{token:"MMM",val:3e3},{token:"MM",val:2e3},{token:"M",val:1e3}),u(r,{token:"IM",val:999},{token:"VM",val:995},{token:"XM",val:990},{token:"LM",val:950},{token:"CM",val:900}),u(r,{token:"D",val:500},{token:"ID",val:499},{token:"VD",val:495},{token:"XD",val:490},{token:"LD",val:450},{token:"CD",val:400}),u(r,{token:"CCC",val:300},{token:"CC",val:200},{token:"C",val:100}),u(r,{token:"IC",val:99},{token:"VC",val:95},{token:"XC",val:90}),u(r,{token:"L",val:50},{token:"IL",val:49},{token:"VL",val:45},{token:"XL",val:40}),u(r,{token:"XXX",val:30},{token:"XX",val:20},{token:"X",val:10}),u(r,{token:"IX",val:9}),u(r,{token:"V",val:5},{token:"IV",val:4}),u(r,{token:"III",val:3},{token:"II",val:2},{token:"I",val:1}),""!==r.input?new n.CellError(n.ErrorType.VALUE,s.ErrorMessage.InvalidRoman):t?-r.acc:r.acc}))}}function u(e,...t){for(const r of t)if(e.input.startsWith(r.token)){e.input=e.input.slice(r.token.length),e.acc+=r.val;break}}function l(e,t,r,n){e.val>=r&&e.val<n&&(e.val-=r,e.acc+=t)}t.RomanPlugin=i,i.implementedFunctions={ROMAN:{method:"roman",parameters:[{argumentType:a.FunctionArgumentType.NUMBER,minValue:1,lessThan:4e3},{argumentType:a.FunctionArgumentType.NOERROR,optionalArg:!0,defaultValue:0}]},ARABIC:{method:"arabic",parameters:[{argumentType:a.FunctionArgumentType.STRING}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.SimpleArithmerticPlugin=void 0;var n=r(189);class s extends n.FunctionPlugin{add(e,t){return this.runFunction(e.args,t,this.metadata("HF.ADD"),this.arithmeticHelper.addWithEpsilon)}concat(e,t){return this.runFunction(e.args,t,this.metadata("HF.CONCAT"),this.arithmeticHelper.concat)}divide(e,t){return this.runFunction(e.args,t,this.metadata("HF.DIVIDE"),this.arithmeticHelper.divide)}eq(e,t){return this.runFunction(e.args,t,this.metadata("HF.EQ"),this.arithmeticHelper.eq)}gt(e,t){return this.runFunction(e.args,t,this.metadata("HF.GT"),this.arithmeticHelper.gt)}gte(e,t){return this.runFunction(e.args,t,this.metadata("HF.GTE"),this.arithmeticHelper.geq)}lt(e,t){return this.runFunction(e.args,t,this.metadata("HF.LT"),this.arithmeticHelper.lt)}lte(e,t){return this.runFunction(e.args,t,this.metadata("HF.LTE"),this.arithmeticHelper.leq)}minus(e,t){return this.runFunction(e.args,t,this.metadata("HF.MINUS"),this.arithmeticHelper.subtract)}multiply(e,t){return this.runFunction(e.args,t,this.metadata("HF.MULTIPLY"),this.arithmeticHelper.multiply)}ne(e,t){return this.runFunction(e.args,t,this.metadata("HF.NE"),this.arithmeticHelper.neq)}pow(e,t){return this.runFunction(e.args,t,this.metadata("HF.POW"),this.arithmeticHelper.pow)}uminus(e,t){return this.runFunction(e.args,t,this.metadata("HF.UMINUS"),this.arithmeticHelper.unaryMinus)}upercent(e,t){return this.runFunction(e.args,t,this.metadata("HF.UNARY_PERCENT"),this.arithmeticHelper.unaryPercent)}uplus(e,t){return this.runFunction(e.args,t,this.metadata("HF.UPLUS"),this.arithmeticHelper.unaryPlus)}}t.SimpleArithmerticPlugin=s,s.implementedFunctions={"HF.ADD":{method:"add",parameters:[{argumentType:n.FunctionArgumentType.NUMBER,passSubtype:!0},{argumentType:n.FunctionArgumentType.NUMBER,passSubtype:!0}]},"HF.CONCAT":{method:"concat",parameters:[{argumentType:n.FunctionArgumentType.STRING,passSubtype:!0},{argumentType:n.FunctionArgumentType.STRING,passSubtype:!0}]},"HF.DIVIDE":{method:"divide",parameters:[{argumentType:n.FunctionArgumentType.NUMBER,passSubtype:!0},{argumentType:n.FunctionArgumentType.NUMBER,passSubtype:!0}]},"HF.EQ":{method:"eq",parameters:[{argumentType:n.FunctionArgumentType.NOERROR,passSubtype:!0},{argumentType:n.FunctionArgumentType.NOERROR,passSubtype:!0}]},"HF.GT":{method:"gt",parameters:[{argumentType:n.FunctionArgumentType.NOERROR,passSubtype:!0},{argumentType:n.FunctionArgumentType.NOERROR,passSubtype:!0}]},"HF.GTE":{method:"gte",parameters:[{argumentType:n.FunctionArgumentType.NOERROR,passSubtype:!0},{argumentType:n.FunctionArgumentType.NOERROR,passSubtype:!0}]},"HF.LT":{method:"lt",parameters:[{argumentType:n.FunctionArgumentType.NOERROR,passSubtype:!0},{argumentType:n.FunctionArgumentType.NOERROR,passSubtype:!0}]},"HF.LTE":{method:"lte",parameters:[{argumentType:n.FunctionArgumentType.NOERROR,passSubtype:!0},{argumentType:n.FunctionArgumentType.NOERROR,passSubtype:!0}]},"HF.MINUS":{method:"minus",parameters:[{argumentType:n.FunctionArgumentType.NUMBER,passSubtype:!0},{argumentType:n.FunctionArgumentType.NUMBER,passSubtype:!0}]},"HF.MULTIPLY":{method:"multiply",parameters:[{argumentType:n.FunctionArgumentType.NUMBER,passSubtype:!0},{argumentType:n.FunctionArgumentType.NUMBER,passSubtype:!0}]},"HF.NE":{method:"ne",parameters:[{argumentType:n.FunctionArgumentType.NOERROR,passSubtype:!0},{argumentType:n.FunctionArgumentType.NOERROR,passSubtype:!0}]},"HF.POW":{method:"pow",parameters:[{argumentType:n.FunctionArgumentType.NUMBER,passSubtype:!0},{argumentType:n.FunctionArgumentType.NUMBER,passSubtype:!0}]},"HF.UMINUS":{method:"uminus",parameters:[{argumentType:n.FunctionArgumentType.NUMBER,passSubtype:!0}]},"HF.UNARY_PERCENT":{method:"upercent",parameters:[{argumentType:n.FunctionArgumentType.NUMBER,passSubtype:!0}]},"HF.UPLUS":{method:"uplus",parameters:[{argumentType:n.FunctionArgumentType.NUMBER,passSubtype:!0}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.StatisticalPlugin=void 0;var n=r(106),s=r(151),o=r(285),a=r(286),i=r(189);class u extends i.FunctionPlugin{erf(e,t){return this.runFunction(e.args,t,this.metadata("ERF"),((e,t)=>void 0===t?(0,a.erf)(e):(0,a.erf)(t)-(0,a.erf)(e)))}erfc(e,t){return this.runFunction(e.args,t,this.metadata("ERFC"),a.erfc)}expondist(e,t){return this.runFunction(e.args,t,this.metadata("EXPON.DIST"),((e,t,r)=>r?a.exponential.cdf(e,t):a.exponential.pdf(e,t)))}fisher(e,t){return this.runFunction(e.args,t,this.metadata("FISHER"),(e=>Math.log((1+e)/(1-e))/2))}fisherinv(e,t){return this.runFunction(e.args,t,this.metadata("FISHERINV"),(e=>1-2/(Math.exp(2*e)+1)))}gamma(e,t){return this.runFunction(e.args,t,this.metadata("GAMMA"),a.gammafn)}gammadist(e,t){return this.runFunction(e.args,t,this.metadata("GAMMA.DIST"),((e,t,r,n)=>n?a.gamma.cdf(e,t,r):a.gamma.pdf(e,t,r)))}gammaln(e,t){return this.runFunction(e.args,t,this.metadata("GAMMALN"),a.gammaln)}gammainv(e,t){return this.runFunction(e.args,t,this.metadata("GAMMA.INV"),a.gamma.inv)}gauss(e,t){return this.runFunction(e.args,t,this.metadata("GAUSS"),(e=>a.normal.cdf(e,0,1)-.5))}betadist(e,t){return this.runFunction(e.args,t,this.metadata("BETA.DIST"),((e,t,r,o,i,u)=>e<=i?new n.CellError(n.ErrorType.NUM,s.ErrorMessage.ValueSmall):e>=u?new n.CellError(n.ErrorType.NUM,s.ErrorMessage.ValueLarge):(e=(e-i)/(u-i),o?a.beta.cdf(e,t,r):a.beta.pdf(e,t,r))))}betainv(e,t){return this.runFunction(e.args,t,this.metadata("BETA.INV"),((e,t,r,o,i)=>o>=i?new n.CellError(n.ErrorType.NUM,s.ErrorMessage.WrongOrder):a.beta.inv(e,t,r)*(i-o)+o))}binomialdist(e,t){return this.runFunction(e.args,t,this.metadata("BINOM.DIST"),((e,t,r,o)=>e>t?new n.CellError(n.ErrorType.NUM,s.ErrorMessage.WrongOrder):(e=Math.trunc(e),t=Math.trunc(t),o?a.binomial.cdf(e,t,r):a.binomial.pdf(e,t,r))))}binomialinv(e,t){return this.runFunction(e.args,t,this.metadata("BINOM.INV"),((e,t,r)=>{let n=-1,s=e=Math.trunc(e);for(;s>n+1;){const o=Math.trunc((n+s)/2);a.binomial.cdf(o,e,t)>=r?s=o:n=o}return s}))}besselifn(e,t){return this.runFunction(e.args,t,this.metadata("BESSELI"),((e,t)=>(0,o.besseli)(e,Math.trunc(t))))}besseljfn(e,t){return this.runFunction(e.args,t,this.metadata("BESSELJ"),((e,t)=>(0,o.besselj)(e,Math.trunc(t))))}besselkfn(e,t){return this.runFunction(e.args,t,this.metadata("BESSELK"),((e,t)=>(0,o.besselk)(e,Math.trunc(t))))}besselyfn(e,t){return this.runFunction(e.args,t,this.metadata("BESSELY"),((e,t)=>(0,o.bessely)(e,Math.trunc(t))))}chisqdist(e,t){return this.runFunction(e.args,t,this.metadata("CHISQ.DIST"),((e,t,r)=>(t=Math.trunc(t),r?a.chisquare.cdf(e,t):a.chisquare.pdf(e,t))))}chisqdistrt(e,t){return this.runFunction(e.args,t,this.metadata("CHISQ.DIST.RT"),((e,t)=>1-a.chisquare.cdf(e,Math.trunc(t))))}chisqinv(e,t){return this.runFunction(e.args,t,this.metadata("CHISQ.INV"),((e,t)=>a.chisquare.inv(e,Math.trunc(t))))}chisqinvrt(e,t){return this.runFunction(e.args,t,this.metadata("CHISQ.INV.RT"),((e,t)=>a.chisquare.inv(1-e,Math.trunc(t))))}fdist(e,t){return this.runFunction(e.args,t,this.metadata("F.DIST"),((e,t,r,n)=>(t=Math.trunc(t),r=Math.trunc(r),n?a.centralF.cdf(e,t,r):a.centralF.pdf(e,t,r))))}fdistrt(e,t){return this.runFunction(e.args,t,this.metadata("F.DIST.RT"),((e,t,r)=>1-a.centralF.cdf(e,Math.trunc(t),Math.trunc(r))))}finv(e,t){return this.runFunction(e.args,t,this.metadata("F.INV"),((e,t,r)=>a.centralF.inv(e,Math.trunc(t),Math.trunc(r))))}finvrt(e,t){return this.runFunction(e.args,t,this.metadata("F.INV.RT"),((e,t,r)=>a.centralF.inv(1-e,Math.trunc(t),Math.trunc(r))))}weibulldist(e,t){return this.runFunction(e.args,t,this.metadata("WEIBULL.DIST"),((e,t,r,n)=>n?a.weibull.cdf(e,r,t):a.weibull.pdf(e,r,t)))}poissondist(e,t){return this.runFunction(e.args,t,this.metadata("POISSON.DIST"),((e,t,r)=>(e=Math.trunc(e),r?a.poisson.cdf(e,t):a.poisson.pdf(e,t))))}hypgeomdist(e,t){return this.runFunction(e.args,t,this.metadata("HYPGEOM.DIST"),((e,t,r,o,i)=>e>t||e>r||t>o||r>o||e+o<r+t?new n.CellError(n.ErrorType.NUM,s.ErrorMessage.ValueLarge):(e=Math.trunc(e),t=Math.trunc(t),r=Math.trunc(r),o=Math.trunc(o),i?a.hypgeom.cdf(e,o,r,t):a.hypgeom.pdf(e,o,r,t))))}tdist(e,t){return this.runFunction(e.args,t,this.metadata("T.DIST"),((e,t,r)=>(t=Math.trunc(t),r?a.studentt.cdf(e,t):a.studentt.pdf(e,t))))}tdist2t(e,t){return this.runFunction(e.args,t,this.metadata("T.DIST.2T"),((e,t)=>2*(1-a.studentt.cdf(e,Math.trunc(t)))))}tdistrt(e,t){return this.runFunction(e.args,t,this.metadata("T.DIST.RT"),((e,t)=>1-a.studentt.cdf(e,Math.trunc(t))))}tdistold(e,t){return this.runFunction(e.args,t,this.metadata("TDIST"),((e,t,r)=>r*(1-a.studentt.cdf(e,Math.trunc(t)))))}tinv(e,t){return this.runFunction(e.args,t,this.metadata("T.INV"),((e,t)=>a.studentt.inv(e,Math.trunc(t))))}tinv2t(e,t){return this.runFunction(e.args,t,this.metadata("T.INV.2T"),((e,t)=>a.studentt.inv(1-e/2,Math.trunc(t))))}lognormdist(e,t){return this.runFunction(e.args,t,this.metadata("LOGNORM.DIST"),((e,t,r,n)=>n?a.lognormal.cdf(e,t,r):a.lognormal.pdf(e,t,r)))}lognorminv(e,t){return this.runFunction(e.args,t,this.metadata("LOGNORM.INV"),((e,t,r)=>a.lognormal.inv(e,t,r)))}normdist(e,t){return this.runFunction(e.args,t,this.metadata("NORM.DIST"),((e,t,r,n)=>n?a.normal.cdf(e,t,r):a.normal.pdf(e,t,r)))}norminv(e,t){return this.runFunction(e.args,t,this.metadata("NORM.INV"),((e,t,r)=>a.normal.inv(e,t,r)))}normsdist(e,t){return this.runFunction(e.args,t,this.metadata("NORM.S.DIST"),((e,t)=>t?a.normal.cdf(e,0,1):a.normal.pdf(e,0,1)))}normsinv(e,t){return this.runFunction(e.args,t,this.metadata("NORM.S.INV"),(e=>a.normal.inv(e,0,1)))}phi(e,t){return this.runFunction(e.args,t,this.metadata("PHI"),(e=>a.normal.pdf(e,0,1)))}negbinomdist(e,t){return this.runFunction(e.args,t,this.metadata("NEGBINOM.DIST"),((e,t,r,n)=>(e=Math.trunc(e),t=Math.trunc(t),n?a.negbin.cdf(e,t,r):a.negbin.pdf(e,t,r))))}confidencenorm(e,t){return this.runFunction(e.args,t,this.metadata("CONFIDENCE.NORM"),((e,t,r)=>(0,a.normalci)(1,e,t,Math.trunc(r))[1]-1))}confidencet(e,t){return this.runFunction(e.args,t,this.metadata("CONFIDENCE.T"),((e,t,r)=>1===(r=Math.trunc(r))?new n.CellError(n.ErrorType.DIV_BY_ZERO):(0,a.tci)(1,e,t,r)[1]-1))}standardize(e,t){return this.runFunction(e.args,t,this.metadata("STANDARDIZE"),((e,t,r)=>(e-t)/r))}}t.StatisticalPlugin=u,u.implementedFunctions={ERF:{method:"erf",parameters:[{argumentType:i.FunctionArgumentType.NUMBER},{argumentType:i.FunctionArgumentType.NUMBER,optionalArg:!0}]},ERFC:{method:"erfc",parameters:[{argumentType:i.FunctionArgumentType.NUMBER}]},"EXPON.DIST":{method:"expondist",parameters:[{argumentType:i.FunctionArgumentType.NUMBER,minValue:0},{argumentType:i.FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:i.FunctionArgumentType.BOOLEAN}]},FISHER:{method:"fisher",parameters:[{argumentType:i.FunctionArgumentType.NUMBER,greaterThan:-1,lessThan:1}]},FISHERINV:{method:"fisherinv",parameters:[{argumentType:i.FunctionArgumentType.NUMBER}]},GAMMA:{method:"gamma",parameters:[{argumentType:i.FunctionArgumentType.NUMBER}]},"GAMMA.DIST":{method:"gammadist",parameters:[{argumentType:i.FunctionArgumentType.NUMBER,minValue:0},{argumentType:i.FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:i.FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:i.FunctionArgumentType.BOOLEAN}]},GAMMALN:{method:"gammaln",parameters:[{argumentType:i.FunctionArgumentType.NUMBER,greaterThan:0}]},"GAMMA.INV":{method:"gammainv",parameters:[{argumentType:i.FunctionArgumentType.NUMBER,minValue:0,lessThan:1},{argumentType:i.FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:i.FunctionArgumentType.NUMBER,greaterThan:0}]},GAUSS:{method:"gauss",parameters:[{argumentType:i.FunctionArgumentType.NUMBER}]},"BETA.DIST":{method:"betadist",parameters:[{argumentType:i.FunctionArgumentType.NUMBER},{argumentType:i.FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:i.FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:i.FunctionArgumentType.BOOLEAN},{argumentType:i.FunctionArgumentType.NUMBER,defaultValue:0},{argumentType:i.FunctionArgumentType.NUMBER,defaultValue:1}]},"BETA.INV":{method:"betainv",parameters:[{argumentType:i.FunctionArgumentType.NUMBER,greaterThan:0,maxValue:1},{argumentType:i.FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:i.FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:i.FunctionArgumentType.NUMBER,defaultValue:0},{argumentType:i.FunctionArgumentType.NUMBER,defaultValue:1}]},"BINOM.DIST":{method:"binomialdist",parameters:[{argumentType:i.FunctionArgumentType.NUMBER,minValue:0},{argumentType:i.FunctionArgumentType.NUMBER,minValue:0},{argumentType:i.FunctionArgumentType.NUMBER,minValue:0,maxValue:1},{argumentType:i.FunctionArgumentType.BOOLEAN}]},"BINOM.INV":{method:"binomialinv",parameters:[{argumentType:i.FunctionArgumentType.NUMBER,minValue:0},{argumentType:i.FunctionArgumentType.NUMBER,minValue:0,maxValue:1},{argumentType:i.FunctionArgumentType.NUMBER,greaterThan:0,lessThan:1}]},BESSELI:{method:"besselifn",parameters:[{argumentType:i.FunctionArgumentType.NUMBER},{argumentType:i.FunctionArgumentType.NUMBER,minValue:0}]},BESSELJ:{method:"besseljfn",parameters:[{argumentType:i.FunctionArgumentType.NUMBER},{argumentType:i.FunctionArgumentType.NUMBER,minValue:0}]},BESSELK:{method:"besselkfn",parameters:[{argumentType:i.FunctionArgumentType.NUMBER},{argumentType:i.FunctionArgumentType.NUMBER,minValue:0}]},BESSELY:{method:"besselyfn",parameters:[{argumentType:i.FunctionArgumentType.NUMBER},{argumentType:i.FunctionArgumentType.NUMBER,minValue:0}]},"CHISQ.DIST":{method:"chisqdist",parameters:[{argumentType:i.FunctionArgumentType.NUMBER},{argumentType:i.FunctionArgumentType.NUMBER,minValue:1,maxValue:1e10},{argumentType:i.FunctionArgumentType.BOOLEAN}]},"CHISQ.DIST.RT":{method:"chisqdistrt",parameters:[{argumentType:i.FunctionArgumentType.NUMBER},{argumentType:i.FunctionArgumentType.NUMBER,minValue:1,maxValue:1e10}]},"CHISQ.INV":{method:"chisqinv",parameters:[{argumentType:i.FunctionArgumentType.NUMBER,minValue:0,maxValue:1},{argumentType:i.FunctionArgumentType.NUMBER,minValue:1,maxValue:1e10}]},"CHISQ.INV.RT":{method:"chisqinvrt",parameters:[{argumentType:i.FunctionArgumentType.NUMBER,minValue:0,maxValue:1},{argumentType:i.FunctionArgumentType.NUMBER,minValue:1}]},"F.DIST":{method:"fdist",parameters:[{argumentType:i.FunctionArgumentType.NUMBER,minValue:0},{argumentType:i.FunctionArgumentType.NUMBER,minValue:1},{argumentType:i.FunctionArgumentType.NUMBER,minValue:1},{argumentType:i.FunctionArgumentType.BOOLEAN}]},"F.DIST.RT":{method:"fdistrt",parameters:[{argumentType:i.FunctionArgumentType.NUMBER,minValue:0},{argumentType:i.FunctionArgumentType.NUMBER,minValue:1},{argumentType:i.FunctionArgumentType.NUMBER,minValue:1}]},"F.INV":{method:"finv",parameters:[{argumentType:i.FunctionArgumentType.NUMBER,minValue:0,maxValue:1},{argumentType:i.FunctionArgumentType.NUMBER,minValue:1},{argumentType:i.FunctionArgumentType.NUMBER,minValue:1}]},"F.INV.RT":{method:"finvrt",parameters:[{argumentType:i.FunctionArgumentType.NUMBER,minValue:0,maxValue:1},{argumentType:i.FunctionArgumentType.NUMBER,minValue:1},{argumentType:i.FunctionArgumentType.NUMBER,minValue:1}]},"WEIBULL.DIST":{method:"weibulldist",parameters:[{argumentType:i.FunctionArgumentType.NUMBER,minValue:0},{argumentType:i.FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:i.FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:i.FunctionArgumentType.BOOLEAN}]},"POISSON.DIST":{method:"poissondist",parameters:[{argumentType:i.FunctionArgumentType.NUMBER,minValue:0},{argumentType:i.FunctionArgumentType.NUMBER,minValue:0},{argumentType:i.FunctionArgumentType.BOOLEAN}]},"HYPGEOM.DIST":{method:"hypgeomdist",parameters:[{argumentType:i.FunctionArgumentType.NUMBER,minValue:0},{argumentType:i.FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:i.FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:i.FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:i.FunctionArgumentType.BOOLEAN}]},"T.DIST":{method:"tdist",parameters:[{argumentType:i.FunctionArgumentType.NUMBER},{argumentType:i.FunctionArgumentType.NUMBER,minValue:1},{argumentType:i.FunctionArgumentType.BOOLEAN}]},"T.DIST.2T":{method:"tdist2t",parameters:[{argumentType:i.FunctionArgumentType.NUMBER,minValue:0},{argumentType:i.FunctionArgumentType.NUMBER,minValue:1}]},"T.DIST.RT":{method:"tdistrt",parameters:[{argumentType:i.FunctionArgumentType.NUMBER},{argumentType:i.FunctionArgumentType.NUMBER,minValue:1}]},TDIST:{method:"tdistold",parameters:[{argumentType:i.FunctionArgumentType.NUMBER,minValue:0},{argumentType:i.FunctionArgumentType.NUMBER,minValue:1},{argumentType:i.FunctionArgumentType.INTEGER,minValue:1,maxValue:2}]},"T.INV":{method:"tinv",parameters:[{argumentType:i.FunctionArgumentType.NUMBER,greaterThan:0,lessThan:1},{argumentType:i.FunctionArgumentType.NUMBER,minValue:1}]},"T.INV.2T":{method:"tinv2t",parameters:[{argumentType:i.FunctionArgumentType.NUMBER,greaterThan:0,maxValue:1},{argumentType:i.FunctionArgumentType.NUMBER,minValue:1}]},"LOGNORM.DIST":{method:"lognormdist",parameters:[{argumentType:i.FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:i.FunctionArgumentType.NUMBER},{argumentType:i.FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:i.FunctionArgumentType.BOOLEAN}]},"LOGNORM.INV":{method:"lognorminv",parameters:[{argumentType:i.FunctionArgumentType.NUMBER,greaterThan:0,lessThan:1},{argumentType:i.FunctionArgumentType.NUMBER},{argumentType:i.FunctionArgumentType.NUMBER,greaterThan:0}]},"NORM.DIST":{method:"normdist",parameters:[{argumentType:i.FunctionArgumentType.NUMBER},{argumentType:i.FunctionArgumentType.NUMBER},{argumentType:i.FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:i.FunctionArgumentType.BOOLEAN}]},"NORM.INV":{method:"norminv",parameters:[{argumentType:i.FunctionArgumentType.NUMBER,greaterThan:0,lessThan:1},{argumentType:i.FunctionArgumentType.NUMBER},{argumentType:i.FunctionArgumentType.NUMBER,greaterThan:0}]},"NORM.S.DIST":{method:"normsdist",parameters:[{argumentType:i.FunctionArgumentType.NUMBER},{argumentType:i.FunctionArgumentType.BOOLEAN}]},"NORM.S.INV":{method:"normsinv",parameters:[{argumentType:i.FunctionArgumentType.NUMBER,greaterThan:0,lessThan:1}]},PHI:{method:"phi",parameters:[{argumentType:i.FunctionArgumentType.NUMBER}]},"NEGBINOM.DIST":{method:"negbinomdist",parameters:[{argumentType:i.FunctionArgumentType.NUMBER,minValue:0},{argumentType:i.FunctionArgumentType.NUMBER,minValue:1},{argumentType:i.FunctionArgumentType.NUMBER,minValue:0,maxValue:1},{argumentType:i.FunctionArgumentType.BOOLEAN}]},"CONFIDENCE.NORM":{method:"confidencenorm",parameters:[{argumentType:i.FunctionArgumentType.NUMBER,greaterThan:0,lessThan:1},{argumentType:i.FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:i.FunctionArgumentType.NUMBER,minValue:1}]},"CONFIDENCE.T":{method:"confidencet",parameters:[{argumentType:i.FunctionArgumentType.NUMBER,greaterThan:0,lessThan:1},{argumentType:i.FunctionArgumentType.NUMBER,greaterThan:0},{argumentType:i.FunctionArgumentType.NUMBER,minValue:1}]},STANDARDIZE:{method:"standardize",parameters:[{argumentType:i.FunctionArgumentType.NUMBER},{argumentType:i.FunctionArgumentType.NUMBER},{argumentType:i.FunctionArgumentType.NUMBER,greaterThan:0}]}},u.aliases={NEGBINOMDIST:"NEGBINOM.DIST",EXPONDIST:"EXPON.DIST",BETADIST:"BETA.DIST",NORMDIST:"NORM.DIST",NORMINV:"NORM.INV",NORMSDIST:"NORM.S.DIST",NORMSINV:"NORM.S.INV",LOGNORMDIST:"LOGNORM.DIST",LOGINV:"LOGNORM.INV",TINV:"T.INV.2T",HYPGEOMDIST:"HYPGEOM.DIST",POISSON:"POISSON.DIST",WEIBULL:"WEIBULL.DIST",FINV:"F.INV.RT",FDIST:"F.DIST.RT",CHIDIST:"CHISQ.DIST.RT",CHIINV:"CHISQ.INV.RT",GAMMADIST:"GAMMA.DIST","GAMMALN.PRECISE":"GAMMALN",GAMMAINV:"GAMMA.INV",BETAINV:"BETA.INV",BINOMDIST:"BINOM.DIST",CONFIDENCE:"CONFIDENCE.NORM",CRITBINOM:"BINOM.INV",WEIBULLDIST:"WEIBULL.DIST",TINV2T:"T.INV.2T",TDISTRT:"T.DIST.RT",TDIST2T:"T.DIST.2T",FINVRT:"F.INV.RT",FDISTRT:"F.DIST.RT",CHIDISTRT:"CHISQ.DIST.RT",CHIINVRT:"CHISQ.INV.RT",LOGNORMINV:"LOGNORM.INV",POISSONDIST:"POISSON.DIST"}},function(e,t,r){"use strict";t.__esModule=!0,t.bessely=t.besselk=t.besselj=t.besseli=void 0;
/**
 * @license
 bessel.js (C) 2013-present SheetJS -- http://sheetjs.com

 Apache License
 Version 2.0, January 2004
 http://www.apache.org/licenses/

 TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION

 1. Definitions.

 "License" shall mean the terms and conditions for use, reproduction,
 and distribution as defined by Sections 1 through 9 of this document.

 "Licensor" shall mean the copyright owner or entity authorized by
 the copyright owner that is granting the License.

 "Legal Entity" shall mean the union of the acting entity and all
 other entities that control, are controlled by, or are under common
 control with that entity. For the purposes of this definition,
 "control" means (i) the power, direct or indirect, to cause the
 direction or management of such entity, whether by contract or
 otherwise, or (ii) ownership of fifty percent (50%) or more of the
 outstanding shares, or (iii) beneficial ownership of such entity.

 "You" (or "Your") shall mean an individual or Legal Entity
 exercising permissions granted by this License.

 "Source" form shall mean the preferred form for making modifications,
 including but not limited to software source code, documentation
 source, and configuration files.

 "Object" form shall mean any form resulting from mechanical
 transformation or translation of a Source form, including but
 not limited to compiled object code, generated documentation,
 and conversions to other media types.

 "Work" shall mean the work of authorship, whether in Source or
 Object form, made available under the License, as indicated by a
 copyright notice that is included in or attached to the work
 (an example is provided in the Appendix below).

 "Derivative Works" shall mean any work, whether in Source or Object
 form, that is based on (or derived from) the Work and for which the
 editorial revisions, annotations, elaborations, or other modifications
 represent, as a whole, an original work of authorship. For the purposes
 of this License, Derivative Works shall not include works that remain
 separable from, or merely link (or bind by name) to the interfaces of,
 the Work and Derivative Works thereof.

 "Contribution" shall mean any work of authorship, including
 the original version of the Work and any modifications or additions
 to that Work or Derivative Works thereof, that is intentionally
 submitted to Licensor for inclusion in the Work by the copyright owner
 or by an individual or Legal Entity authorized to submit on behalf of
 the copyright owner. For the purposes of this definition, "submitted"
 means any form of electronic, verbal, or written communication sent
 to the Licensor or its representatives, including but not limited to
 communication on electronic mailing lists, source code control systems,
 and issue tracking systems that are managed by, or on behalf of, the
 Licensor for the purpose of discussing and improving the Work, but
 excluding communication that is conspicuously marked or otherwise
 designated in writing by the copyright owner as "Not a Contribution."

 "Contributor" shall mean Licensor and any individual or Legal Entity
 on behalf of whom a Contribution has been received by Licensor and
 subsequently incorporated within the Work.

 2. Grant of Copyright License. Subject to the terms and conditions of
 this License, each Contributor hereby grants to You a perpetual,
 worldwide, non-exclusive, no-charge, royalty-free, irrevocable
 copyright license to reproduce, prepare Derivative Works of,
 publicly display, publicly perform, sublicense, and distribute the
 Work and such Derivative Works in Source or Object form.

 3. Grant of Patent License. Subject to the terms and conditions of
 this License, each Contributor hereby grants to You a perpetual,
 worldwide, non-exclusive, no-charge, royalty-free, irrevocable
 (except as stated in this section) patent license to make, have made,
 use, offer to sell, sell, import, and otherwise transfer the Work,
 where such license applies only to those patent claims licensable
 by such Contributor that are necessarily infringed by their
 Contribution(s) alone or by combination of their Contribution(s)
 with the Work to which such Contribution(s) was submitted. If You
 institute patent litigation against any entity (including a
 cross-claim or counterclaim in a lawsuit) alleging that the Work
 or a Contribution incorporated within the Work constitutes direct
 or contributory patent infringement, then any patent licenses
 granted to You under this License for that Work shall terminate
 as of the date such litigation is filed.

 4. Redistribution. You may reproduce and distribute copies of the
 Work or Derivative Works thereof in any medium, with or without
 modifications, and in Source or Object form, provided that You
 meet the following conditions:

 (a) You must give any other recipients of the Work or
 Derivative Works a copy of this License; and

 (b) You must cause any modified files to carry prominent notices
 stating that You changed the files; and

 (c) You must retain, in the Source form of any Derivative Works
 that You distribute, all copyright, patent, trademark, and
 attribution notices from the Source form of the Work,
 excluding those notices that do not pertain to any part of
 the Derivative Works; and

 (d) If the Work includes a "NOTICE" text file as part of its
 distribution, then any Derivative Works that You distribute must
 include a readable copy of the attribution notices contained
 within such NOTICE file, excluding those notices that do not
 pertain to any part of the Derivative Works, in at least one
 of the following places: within a NOTICE text file distributed
 as part of the Derivative Works; within the Source form or
 documentation, if provided along with the Derivative Works; or,
 within a display generated by the Derivative Works, if and
 wherever such third-party notices normally appear. The contents
 of the NOTICE file are for informational purposes only and
 do not modify the License. You may add Your own attribution
 notices within Derivative Works that You distribute, alongside
 or as an addendum to the NOTICE text from the Work, provided
 that such additional attribution notices cannot be construed
 as modifying the License.

 You may add Your own copyright statement to Your modifications and
 may provide additional or different license terms and conditions
 for use, reproduction, or distribution of Your modifications, or
 for any such Derivative Works as a whole, provided Your use,
 reproduction, and distribution of the Work otherwise complies with
 the conditions stated in this License.

 5. Submission of Contributions. Unless You explicitly state otherwise,
 any Contribution intentionally submitted for inclusion in the Work
 by You to the Licensor shall be under the terms and conditions of
 this License, without any additional terms or conditions.
 Notwithstanding the above, nothing herein shall supersede or modify
 the terms of any separate license agreement you may have executed
 with Licensor regarding such Contributions.

 6. Trademarks. This License does not grant permission to use the trade
 names, trademarks, service marks, or product names of the Licensor,
 except as required for reasonable and customary use in describing the
 origin of the Work and reproducing the content of the NOTICE file.

 7. Disclaimer of Warranty. Unless required by applicable law or
 agreed to in writing, Licensor provides the Work (and each
 Contributor provides its Contributions) on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
 implied, including, without limitation, any warranties or conditions
 of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A
 PARTICULAR PURPOSE. You are solely responsible for determining the
 appropriateness of using or redistributing the Work and assume any
 risks associated with Your exercise of permissions under this License.

 8. Limitation of Liability. In no event and under no legal theory,
 whether in tort (including negligence), contract, or otherwise,
 unless required by applicable law (such as deliberate and grossly
 negligent acts) or agreed to in writing, shall any Contributor be
 liable to You for damages, including any direct, indirect, special,
 incidental, or consequential damages of any character arising as a
 result of this License or out of the use or inability to use the
 Work (including but not limited to damages for loss of goodwill,
 work stoppage, computer failure or malfunction, or any and all
 other commercial damages or losses), even if such Contributor
 has been advised of the possibility of such damages.

 9. Accepting Warranty or Additional Liability. While redistributing
 the Work or Derivative Works thereof, You may choose to offer,
 and charge a fee for, acceptance of support, warranty, indemnity,
 or other liability obligations and/or rights consistent with this
 License. However, in accepting such obligations, You may act only
 on Your own behalf and on Your sole responsibility, not on behalf
 of any other Contributor, and only if You agree to indemnify,
 defend, and hold each Contributor harmless for any liability
 incurred by, or claims asserted against, such Contributor by reason
 of your accepting any such warranty or additional liability.

 END OF TERMS AND CONDITIONS

 APPENDIX: How to apply the Apache License to your work.

 To apply the Apache License to your work, attach the following
 boilerplate notice, with the fields enclosed by brackets "{}"
 replaced with your own identifying information. (Don't include
 the brackets!)  The text should be enclosed in the appropriate
 comment syntax for the file format. We also recommend that a
 file or class name and description of purpose be included on the
 same "printed page" as the copyright notice for easier
 identification within third-party archives.

 Copyright (C) 2013-present   SheetJS LLC

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

 http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 */
var n=Math;function s(e,t){for(var r=0,n=0;r<e.length;++r)n=t*n+e[r];return n}function o(e,t,r,n,s){if(0===t)return r;if(1===t)return n;for(var o=2/e,a=n,i=1;i<t;++i)a=n*i*o+s*r,r=n,n=a;return a}function a(e,t,r,n,s){return function(r,a){if(n){if(0===r)return 1==n?-1/0:1/0;if(r<0)return NaN}return 0===a?e(r):1===a?t(r):a<0?NaN:o(r,a|=0,e(r),t(r),s)}}var i,u,l,c,h,d,p,m,g,E,T,y,f,A=t.besselj=function(){var e=.636619772,t=[57568490574,-13362590354,651619640.7,-11214424.18,77392.33017,-184.9052456].reverse(),r=[57568490411,1029532985,9494680.718,59272.64853,267.8532712,1].reverse(),a=[1,-.001098628627,2734510407e-14,-2073370639e-15,2.093887211e-7].reverse(),i=[-.01562499995,.0001430488765,-6911147651e-15,7.621095161e-7,-9.34935152e-8].reverse();function u(o){var u=0,l=0,c=0,h=o*o;if(o<8)u=(l=s(t,h))/(c=s(r,h));else{var d=o-.785398164;l=s(a,h=64/h),c=s(i,h),u=n.sqrt(e/o)*(n.cos(d)*l-n.sin(d)*c*8/o)}return u}var l=[72362614232,-7895059235,242396853.1,-2972611.439,15704.4826,-30.16036606].reverse(),c=[144725228442,2300535178,18583304.74,99447.43394,376.9991397,1].reverse(),h=[1,.00183105,-3516396496e-14,2457520174e-15,-2.40337019e-7].reverse(),d=[.04687499995,-.0002002690873,8449199096e-15,-8.8228987e-7,1.05787412e-7].reverse();function p(t){var r=0,o=0,a=0,i=t*t,u=n.abs(t)-2.356194491;return Math.abs(t)<8?r=(o=t*s(l,i))/(a=s(c,i)):(o=s(h,i=64/i),a=s(d,i),r=n.sqrt(e/n.abs(t))*(n.cos(u)*o-n.sin(u)*a*8/n.abs(t)),t<0&&(r=-r)),r}return function e(t,r){if(r=Math.round(r),!isFinite(t))return isNaN(t)?t:0;if(r<0)return(r%2?-1:1)*e(t,-r);if(t<0)return(r%2?-1:1)*e(-t,r);if(0===r)return u(t);if(1===r)return p(t);if(0===t)return 0;var s=0;if(t>r)s=o(t,r,u(t),p(t),-1);else{for(var a=!1,i=0,l=0,c=1,h=0,d=2/t,m=2*n.floor((r+n.floor(n.sqrt(40*r)))/2);m>0;m--)h=m*d*c-i,i=c,c=h,n.abs(c)>1e10&&(c*=1e-10,i*=1e-10,s*=1e-10,l*=1e-10),a&&(l+=c),a=!a,m==r&&(s=i);s/=l=2*l-c}return s}}(),R=(t.bessely=(i=.636619772,u=[-2957821389,7062834065,-512359803.6,10879881.29,-86327.92757,228.4622733].reverse(),l=[40076544269,745249964.8,7189466.438,47447.2647,226.1030244,1].reverse(),c=[1,-.001098628627,2734510407e-14,-2073370639e-15,2.093887211e-7].reverse(),h=[-.01562499995,.0001430488765,-6911147651e-15,7.621095161e-7,-9.34945152e-8].reverse(),d=[-4900604943e3,127527439e4,-51534381390,734926455.1,-4237922.726,8511.937935].reverse(),p=[249958057e5,424441966400,3733650367,22459040.02,102042.605,354.9632885,1].reverse(),m=[1,.00183105,-3516396496e-14,2457520174e-15,-2.40337019e-7].reverse(),g=[.04687499995,-.0002002690873,8449199096e-15,-8.8228987e-7,1.05787412e-7].reverse(),a((function(e){var t=0,r=0,o=0,a=e*e,d=e-.785398164;return e<8?t=(r=s(u,a))/(o=s(l,a))+i*A(e,0)*n.log(e):(r=s(c,a=64/a),o=s(h,a),t=n.sqrt(i/e)*(n.sin(d)*r+n.cos(d)*o*8/e)),t}),(function(e){var t=0,r=0,o=0,a=e*e,u=e-2.356194491;return e<8?t=(r=e*s(d,a))/(o=s(p,a))+i*(A(e,1)*n.log(e)-1/e):(r=s(m,a=64/a),o=s(g,a),t=n.sqrt(i/e)*(n.sin(u)*r+n.cos(u)*o*8/e)),t}),0,1,-1)),t.besseli=(E=[1,3.5156229,3.0899424,1.2067492,.2659732,.0360768,.0045813].reverse(),T=[.39894228,.01328592,.00225319,-.00157565,.00916281,-.02057706,.02635537,-.01647633,.00392377].reverse(),y=[.5,.87890594,.51498869,.15084934,.02658733,.00301532,32411e-8].reverse(),f=[.39894228,-.03988024,-.00362018,.00163801,-.01031555,.02282967,-.02895312,.01787654,-.00420059].reverse(),function e(t,r){if(0===(r=Math.round(r)))return function(e){return e<=3.75?s(E,e*e/14.0625):n.exp(n.abs(e))/n.sqrt(n.abs(e))*s(T,3.75/n.abs(e))}(t);if(1===r)return function(e){return e<3.75?e*s(y,e*e/14.0625):(e<0?-1:1)*n.exp(n.abs(e))/n.sqrt(n.abs(e))*s(f,3.75/n.abs(e))}(t);if(r<0)return NaN;if(0===n.abs(t))return 0;if(t==1/0)return 1/0;var o,a=0,i=2/n.abs(t),u=0,l=1,c=0;for(o=2*n.round((r+n.round(n.sqrt(40*r)))/2);o>0;o--)c=o*i*l+u,u=l,l=c,n.abs(l)>1e10&&(l*=1e-10,u*=1e-10,a*=1e-10),o==r&&(a=u);return a*=e(t,0)/l,t<0&&r%2?-a:a}));t.besselk=function(){var e=[-.57721566,.4227842,.23069756,.0348859,.00262698,1075e-7,74e-7].reverse(),t=[1.25331414,-.07832358,.02189568,-.01062446,.00587872,-.0025154,53208e-8].reverse();var r=[1,.15443144,-.67278579,-.18156897,-.01919402,-.00110404,-4686e-8].reverse(),o=[1.25331414,.23498619,-.0365562,.01504268,-.00780353,.00325614,-68245e-8].reverse();return a((function(r){return r<=2?-n.log(r/2)*R(r,0)+s(e,r*r/4):n.exp(-r)/n.sqrt(r)*s(t,2/r)}),(function(e){return e<=2?n.log(e/2)*R(e,1)+1/e*s(r,e*e/4):n.exp(-e)/n.sqrt(e)*s(o,2/e)}),0,2,1)}()},function(e,t,r){"use strict";
/**
 * @license
 Copyright (c) 2013 jStat

 Permission is hereby granted, free of charge, to any person obtaining a copy
 of this software and associated documentation files (the "Software"), to deal
 in the Software without restriction, including without limitation the rights
 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the Software is
 furnished to do so, subject to the following conditions:

 The above copyright notice and this permission notice shall be included in
 all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 THE SOFTWARE.
 */
function n(e){const t=[-1.3026537197817094,.6419697923564902,.019476473204185836,-.00956151478680863,-.000946595344482036,.000366839497852761,42523324806907e-18,-20278578112534e-18,-1624290004647e-18,130365583558e-17,1.5626441722e-8,-8.5238095915e-8,6.529054439e-9,5.059343495e-9,-9.91364156e-10,-2.27365122e-10,96467911e-18,2394038e-18,-6886027e-18,894487e-18,313092e-18,-112708e-18,381e-18,7106e-18,-1523e-18,-94e-18,121e-18,-28e-18];let r,n,s,o,a=t.length-1,i=!1,u=0,l=0;if(0===e)return 0;for(e<0&&(e=-e,i=!0),r=2/(2+e),n=4*r-2;a>0;a--)s=u,u=n*u-l+t[a],l=s;return o=r*Math.exp(-e*e+.5*(t[0]+n*u)-l),i?o-1:1-o}function s(e){return 1-n(e)}function o(e){let t,r,n,o,a=0;if(e>=2)return-100;if(e<=0)return 100;for(o=e<1?e:2-e,n=Math.sqrt(-2*Math.log(o/2)),t=-.70711*((2.30753+.27061*n)/(1+n*(.99229+.04481*n))-n);a<2;a++)r=s(t)-o,t+=r/(1.1283791670955126*Math.exp(-t*t)-t*r);return e<1?t:-t}t.__esModule=!0,t.chisquare=t.centralF=t.binomial=t.beta=void 0,t.corrcoeff=function(e,t){return I(e,t)/O(e,1)/O(t,1)},t.covariance=I,t.erf=n,t.erfc=s,t.exponential=void 0,t.factorial=A,t.factorialln=f,t.gamma=void 0,t.gammafn=a,t.gammaln=i,t.geomean=function(e){return Math.pow(function(e){var t=1,r=e.length;for(;--r>=0;)t*=e[r];return t}(e),1/e.length)},t.lognormal=t.hypgeom=void 0,t.mean=M,t.normal=t.negbin=void 0,t.normalci=function(){var e,t=[].slice.call(arguments),r=new Array(2);e=4===t.length?Math.abs(c.inv(t[1]/2,0,1)*t[2]/Math.sqrt(t[3])):Math.abs(c.inv(t[1]/2,0,1)*O(t[2])/Math.sqrt(t[2].length));return r[0]=t[0]-e,r[1]=t[0]+e,r},t.poisson=void 0,t.stdev=O,t.studentt=void 0,t.sumsqerr=w,t.tci=function(){var e,t=[].slice.call(arguments),r=new Array(2);e=4===t.length?Math.abs(S.inv(t[1]/2,t[3]-1)*t[2]/Math.sqrt(t[3])):Math.abs(S.inv(t[1]/2,t[2].length-1)*O(t[2],!0)/Math.sqrt(t[2].length));return r[0]=t[0]-e,r[1]=t[0]+e,r},t.variance=F,t.weibull=void 0;t.exponential={pdf:(e,t)=>e<0?0:t*Math.exp(-t*e),cdf:(e,t)=>e<0?0:1-Math.exp(-t*e)};function a(e){const t=[-1.716185138865495,24.76565080557592,-379.80425647094563,629.3311553128184,866.9662027904133,-31451.272968848367,-36144.413418691176,66456.14382024054],r=[-30.8402300119739,315.35062697960416,-1015.1563674902192,-3107.771671572311,22538.11842098015,4755.846277527881,-134659.9598649693,-115132.2596755535];let n,s,o,a,i=!1,u=0,l=0,c=0,h=e;if(e>171.6243769536076)return 1/0;if(h<=0){if(a=h%1,!a)return 1/0;i=(1&h?-1:1)*Math.PI/Math.sin(Math.PI*a),h=1-h}for(o=h,s=h<1?h++:(h-=u=(0|h)-1)-1,n=0;n<8;++n)c=(c+t[n])*s,l=l*s+r[n];if(a=c/l+1,o<h)a/=o;else if(o>h)for(n=0;n<u;++n)a*=h,h++;return i&&(a=i/a),a}t.gamma={pdf:function(e,t,r){return e<0?0:0===e&&1===t?1/r:Math.exp((t-1)*Math.log(e)-e/r-i(t)-t*Math.log(r))},cdf:function(e,t,r){return e<0?0:u(t,e/r)},inv:function(e,t,r){return l(e,t)*r}};function i(e){let t=0;const r=[76.18009172947146,-86.50532032941678,24.01409824083091,-1.231739572450155,.001208650973866179,-5395239384953e-18];let n,s,o,a=1.000000000190015;for(o=(s=n=e)+5.5,o-=(n+.5)*Math.log(o);t<6;t++)a+=r[t]/++s;return Math.log(2.5066282746310007*a/n)-o}function u(e,t){const r=i(e);let n=e,s=1/e,o=s,a=t+1-e,u=1/1e-30,l=1/a,c=l,h=1;const d=-~(8.5*Math.log(e>=1?e:1/e)+.4*e+17);let p;if(t<0||e<=0)return NaN;if(t<e+1){for(;h<=d;h++)s+=o*=t/++n;return s*Math.exp(-t+e*Math.log(t)-r)}for(;h<=d;h++)p=-h*(h-e),a+=2,l=p*l+a,u=a+p/u,l=1/l,c*=l*u;return 1-c*Math.exp(-t+e*Math.log(t)-r)}function l(e,t){let r=0;const n=t-1,s=i(t);let o,a,l,c,h,d,p;if(e>=1)return Math.max(100,t+100*Math.sqrt(t));if(e<=0)return 0;for(t>1?(d=Math.log(n),p=Math.exp(n*(d-1)-s),h=e<.5?e:1-e,l=Math.sqrt(-2*Math.log(h)),o=(2.30753+.27061*l)/(1+l*(.99229+.04481*l))-l,e<.5&&(o=-o),o=Math.max(.001,t*Math.pow(1-1/(9*t)-o/(3*Math.sqrt(t)),3))):(l=1-t*(.253+.12*t),o=e<l?Math.pow(e/l,1/t):1-Math.log(1-(e-l)/(1-l)));r<12;r++){if(o<=0)return 0;if(a=u(t,o)-e,l=t>1?p*Math.exp(-(o-n)+n*(Math.log(o)-d)):Math.exp(-o+n*Math.log(o)-s),c=a/l,o-=l=c/(1-.5*Math.min(1,c*((t-1)/o-1))),o<=0&&(o=.5*(o+l)),Math.abs(l)<1e-8*o)break}return o}const c=t.normal={pdf:function(e,t,r){return Math.exp(-.5*Math.log(2*Math.PI)-Math.log(r)-Math.pow(e-t,2)/(2*r*r))},cdf:function(e,t,r){return.5*(1+n((e-t)/Math.sqrt(2*r*r)))},inv:function(e,t,r){return-1.4142135623730951*r*o(2*e)+t}};t.beta={pdf:function(e,t,r){return e>1||e<0?0:1==t&&1==r?1:t<512&&r<512?Math.pow(e,t-1)*Math.pow(1-e,r-1)/h(t,r):Math.exp((t-1)*Math.log(e)+(r-1)*Math.log(1-e)-d(t,r))},cdf:function(e,t,r){return e>1||e<0?+(e>1):m(e,t,r)},inv:function(e,t,r){return p(e,t,r)}};function h(e,t){if(!(e<=0||t<=0))return e+t>170?Math.exp(d(e,t)):a(e)*a(t)/a(e+t)}function d(e,t){return i(e)+i(t)-i(e+t)}function p(e,t,r){var n,s,o,a,u,l,c,h,d,p,g=t-1,E=r-1,T=0;if(e<=0)return 0;if(e>=1)return 1;for(t>=1&&r>=1?(o=e<.5?e:1-e,l=(2.30753+.27061*(a=Math.sqrt(-2*Math.log(o))))/(1+a*(.99229+.04481*a))-a,e<.5&&(l=-l),c=(l*l-3)/6,h=2/(1/(2*t-1)+1/(2*r-1)),d=l*Math.sqrt(c+h)/h-(1/(2*r-1)-1/(2*t-1))*(c+5/6-2/(3*h)),l=t/(t+r*Math.exp(2*d))):(n=Math.log(t/(t+r)),s=Math.log(r/(t+r)),l=e<(a=Math.exp(t*n)/t)/(d=a+(u=Math.exp(r*s)/r))?Math.pow(t*d*e,1/t):1-Math.pow(r*d*(1-e),1/r)),p=-i(t)-i(r)+i(t+r);T<10;T++){if(0===l||1===l)return l;if((l-=a=(u=(m(l,t,r)-e)/(a=Math.exp(g*Math.log(l)+E*Math.log(1-l)+p)))/(1-.5*Math.min(1,u*(g/l-E/(1-l)))))<=0&&(l=.5*(l+a)),l>=1&&(l=.5*(l+a+1)),Math.abs(a)<1e-8*l&&T>0)break}return l}function m(e,t,r){var n=0===e||1===e?0:Math.exp(i(t+r)-i(t)-i(r)+t*Math.log(e)+r*Math.log(1-e));return!(e<0||e>1)&&(e<(t+1)/(t+r+2)?n*g(e,t,r)/t:1-n*g(1-e,r,t)/r)}function g(e,t,r){var n,s,o,a,i=1e-30,u=1,l=t+r,c=t+1,h=t-1,d=1,p=1-l*e/c;for(Math.abs(p)<i&&(p=i),a=p=1/p;u<=100&&(p=1+(s=u*(r-u)*e/((h+(n=2*u))*(t+n)))*p,Math.abs(p)<i&&(p=i),d=1+s/d,Math.abs(d)<i&&(d=i),a*=(p=1/p)*d,p=1+(s=-(t+u)*(l+u)*e/((t+n)*(c+n)))*p,Math.abs(p)<i&&(p=i),d=1+s/d,Math.abs(d)<i&&(d=i),a*=o=(p=1/p)*d,!(Math.abs(o-1)<3e-7));u++);return a}const E=t.binomial={pdf:function(e,t,r){return 0===r||1===r?t*r===e?1:0:y(t,e)*Math.pow(r,e)*Math.pow(1-r,t-e)},cdf:function(e,t,r){var n,s=1e-10;if(e<0)return 0;if(e>=t)return 1;if(r<0||r>1||t<=0)return NaN;var o=r,a=(e=Math.floor(e))+1,u=t-e,l=a+u,c=Math.exp(i(l)-i(u)-i(a)+a*Math.log(o)+u*Math.log(1-o));return n=o<(a+1)/(l+2)?c*T(o,a,u,s):1-c*T(1-o,u,a,s),Math.round(1/s*(1-n))/(1/s)}};function T(e,t,r,n){for(var s,o=0,a=1,i=1,u=1,l=0,c=0;Math.abs((i-c)/i)>n;)c=i,a=u+(s=-(t+l)*(t+r+l)*e/(t+2*l)/(t+2*l+1))*a,i=(o=i+s*o)+(s=(l+=1)*(r-l)*e/(t+2*l-1)/(t+2*l))*i,o/=u=a+s*u,a/=u,i/=u,u=1;return i/t}function y(e,t){return e>170||t>170?Math.exp(function(e,t){return f(e)-f(t)-f(e-t)}(e,t)):A(e)/A(t)/A(e-t)}function f(e){return e<0?NaN:i(e+1)}function A(e){return e<0?NaN:a(e+1)}t.chisquare={pdf:function(e,t){return e<0?0:0===e&&2===t?.5:Math.exp((t/2-1)*Math.log(e)-e/2-t/2*Math.log(2)-i(t/2))},cdf:function(e,t){return e<0?0:u(t/2,e/2)},inv:function(e,t){return 2*l(e,.5*t)}},t.centralF={pdf:function(e,t,r){var n;return e<0?0:t<=2?0===e&&t<2?1/0:0===e&&2===t?1:1/h(t/2,r/2)*Math.pow(t/r,t/2)*Math.pow(e,t/2-1)*Math.pow(1+t/r*e,-(t+r)/2):(n=t*e/(r+e*t),t*(r/(r+e*t))/2*E.pdf((t-2)/2,(t+r-2)/2,n))},cdf:function(e,t,r){return e<0?0:m(t*e/(t*e+r),t/2,r/2)},inv:function(e,t,r){return r/(t*(1/p(e,t/2,r/2)-1))}},t.weibull={pdf:function(e,t,r){return e<0||t<0||r<0?0:r/t*Math.pow(e/t,r-1)*Math.exp(-Math.pow(e/t,r))},cdf:function(e,t,r){return e<0?0:1-Math.exp(-Math.pow(e/t,r))}};const R=t.poisson={pdf:function(e,t){return t<0||e%1!=0||e<0?0:Math.pow(t,e)*Math.exp(-t)/A(e)},cdf:function(e,t){var r=0;if(e<0)return 0;for(var n=0;r<=e;r++)n+=R.pdf(r,t);return n}},N=t.hypgeom={pdf:function(e,t,r,n){if(e<0||e<r-(t-n))return 0;if(e>n||e>r)return 0;if(2*r>t)return 2*n>t?N.pdf(t-r-n+e,t,t-r,t-n):N.pdf(n-e,t,t-r,n);if(2*n>t)return N.pdf(r-e,t,r,t-n);if(r<n)return N.pdf(e,t,n,r);for(var s=1,o=0,a=0;a<e;a++){for(;s>1&&o<n;)s*=1-r/(t-o),o++;s*=(n-a)*(r-a)/((a+1)*(t-r-n+a+1))}for(;o<n;o++)s*=1-r/(t-o);return Math.min(1,Math.max(0,s))},cdf:function e(t,r,n,s){if(t<0||t<n-(r-s))return 0;if(t>=s||t>=n)return 1;if(2*n>r)return 2*s>r?e(r-n-s+t,r,r-n,r-s):1-N.cdf(s-t-1,r,r-n,s);if(2*s>r)return 1-N.cdf(n-t-1,r,n,r-s);if(n<s)return N.cdf(t,r,s,n);for(var o=1,a=1,i=0,u=0;u<t;u++){for(;o>1&&i<s;){var l=1-n/(r-i);a*=l,o*=l,i++}o+=a*=(s-u)*(n-u)/((u+1)*(r-n-s+u+1))}for(;i<s;i++)o*=1-n/(r-i);return Math.min(1,Math.max(0,o))}},S=t.studentt={pdf:function(e,t){return t=t>1e100?1e100:t,1/(Math.sqrt(t)*h(.5,t/2))*Math.pow(1+e*e/t,-(t+1)/2)},cdf:function(e,t){var r=t/2;return m((e+Math.sqrt(e*e+t))/(2*Math.sqrt(e*e+t)),r,r)},inv:function(e,t){var r=p(2*Math.min(e,1-e),.5*t,.5);return r=Math.sqrt(t*(1-r)/r),e>.5?r:-r}},C=(t.lognormal={pdf:function(e,t,r){return e<=0?0:Math.exp(-Math.log(e)-.5*Math.log(2*Math.PI)-Math.log(r)-Math.pow(Math.log(e)-t,2)/(2*r*r))},cdf:function(e,t,r){return e<0?0:.5+.5*n((Math.log(e)-t)/Math.sqrt(2*r*r))},inv:function(e,t,r){return Math.exp(-1.4142135623730951*r*o(2*e)+t)}},t.negbin={pdf:function(e,t,r){return e===e>>>0&&(e<0?0:y(e+t-1,t-1)*Math.pow(1-r,e)*Math.pow(r,t))},cdf:function(e,t,r){var n=0,s=0;if(e<0)return 0;for(;s<=e;s++)n+=C.pdf(s,t,r);return n}});function v(e){for(var t=0,r=e.length;--r>=0;)t+=e[r];return t}function M(e){return v(e)/e.length}function w(e){for(var t,r=M(e),n=0,s=e.length;--s>=0;)n+=(t=e[s]-r)*t;return n}function F(e,t){return w(e)/(e.length-(t?1:0))}function O(e,t){return Math.sqrt(F(e,t))}function I(e,t){var r,n=M(e),s=M(t),o=e.length,a=new Array(o);for(r=0;r<o;r++)a[r]=(e[r]-n)*(t[r]-s);return v(a)/(o-1)}},function(e,t,r){"use strict";t.__esModule=!0,t.MathPlugin=void 0;var n=r(106),s=r(151),o=r(189);class a extends o.FunctionPlugin{fact(e,t){return this.runFunction(e.args,t,this.metadata("FACT"),(e=>{e=Math.trunc(e);let t=1;for(let r=1;r<=e;r++)t*=r;return t}))}factdouble(e,t){return this.runFunction(e.args,t,this.metadata("FACTDOUBLE"),(e=>{let t=1;for(let r=e=Math.trunc(e);r>=1;r-=2)t*=r;return t}))}combin(e,t){return this.runFunction(e.args,t,this.metadata("COMBIN"),((e,t)=>t>e?new n.CellError(n.ErrorType.NUM,s.ErrorMessage.WrongOrder):i(e=Math.trunc(e),t=Math.trunc(t))))}combina(e,t){return this.runFunction(e.args,t,this.metadata("COMBINA"),((e,t)=>(e=Math.trunc(e))+(t=Math.trunc(t))-1>=1030?new n.CellError(n.ErrorType.NUM,s.ErrorMessage.ValueLarge):0===e&&0===t?1:i(e+t-1,t)))}gcd(e,t){return this.runFunction(e.args,t,this.metadata("GCD"),((...e)=>{const t=this.arithmeticHelper.coerceNumbersCoerceRangesDropNulls(e);if(t instanceof n.CellError)return t;let r=0;for(const e of t){if(e<0)return new n.CellError(n.ErrorType.NUM,s.ErrorMessage.ValueSmall);r=u(r,Math.trunc(e))}return r>Number.MAX_SAFE_INTEGER?new n.CellError(n.ErrorType.NUM,s.ErrorMessage.ValueLarge):r}))}lcm(e,t){return this.runFunction(e.args,t,this.metadata("LCM"),((...e)=>{const t=this.arithmeticHelper.coerceNumbersCoerceRangesDropNulls(e);if(t instanceof n.CellError)return t;let r=1;for(const e of t){if(e<0)return new n.CellError(n.ErrorType.NUM,s.ErrorMessage.ValueSmall);r=l(r,Math.trunc(e))}return r>Number.MAX_SAFE_INTEGER?new n.CellError(n.ErrorType.NUM,s.ErrorMessage.ValueLarge):r}))}mround(e,t){return this.runFunction(e.args,t,this.metadata("MROUND"),((e,t)=>0===t?0:e>0&&t<0||e<0&&t>0?new n.CellError(n.ErrorType.NUM,s.ErrorMessage.DistinctSigns):Math.round(e/t)*t))}multinomial(e,t){return this.runFunction(e.args,t,this.metadata("MULTINOMIAL"),((...e)=>{let t=0,r=1;for(let o of e){if(o<0)return new n.CellError(n.ErrorType.NUM,s.ErrorMessage.ValueSmall);o=Math.trunc(o);for(let e=1;e<=o;e++)r*=(t+e)/e;t+=o}return Math.round(r)}))}quotient(e,t){return this.runFunction(e.args,t,this.metadata("QUOTIENT"),((e,t)=>0===t?new n.CellError(n.ErrorType.DIV_BY_ZERO):Math.trunc(e/t)))}seriessum(e,t){return this.runFunction(e.args,t,this.metadata("SERIESSUM"),((e,t,r,s)=>{const o=this.arithmeticHelper.manyToOnlyNumbersDropNulls(s.valuesFromTopLeftCorner());if(o instanceof n.CellError)return o;let a=0;o.reverse();for(const t of o)a*=Math.pow(e,r),a+=t;return a*Math.pow(e,t)}))}sign(e,t){return this.runFunction(e.args,t,this.metadata("SIGN"),(e=>e>0?1:e<0?-1:0))}sumx2my2(e,t){return this.runFunction(e.args,t,this.metadata("SUMX2MY2"),((e,t)=>{const r=e.valuesFromTopLeftCorner(),o=t.valuesFromTopLeftCorner();if(r.length!==o.length)return new n.CellError(n.ErrorType.NA,s.ErrorMessage.EqualLength);const a=r.length;let i=0;for(let e=0;e<a;e++){const t=r[e],s=o[e];if(t instanceof n.CellError)return t;if(s instanceof n.CellError)return s;"number"==typeof t&&"number"==typeof s&&(i+=Math.pow(t,2)-Math.pow(s,2))}return i}))}sumx2py2(e,t){return this.runFunction(e.args,t,this.metadata("SUMX2PY2"),((e,t)=>{const r=e.valuesFromTopLeftCorner(),o=t.valuesFromTopLeftCorner();if(r.length!==o.length)return new n.CellError(n.ErrorType.NA,s.ErrorMessage.EqualLength);const a=r.length;let i=0;for(let e=0;e<a;e++){const t=r[e],s=o[e];if(t instanceof n.CellError)return t;if(s instanceof n.CellError)return s;"number"==typeof t&&"number"==typeof s&&(i+=Math.pow(t,2)+Math.pow(s,2))}return i}))}sumxmy2(e,t){return this.runFunction(e.args,t,this.metadata("SUMXMY2"),((e,t)=>{const r=e.valuesFromTopLeftCorner(),o=t.valuesFromTopLeftCorner();if(r.length!==o.length)return new n.CellError(n.ErrorType.NA,s.ErrorMessage.EqualLength);const a=r.length;let i=0;for(let e=0;e<a;e++){const t=r[e],s=o[e];if(t instanceof n.CellError)return t;if(s instanceof n.CellError)return s;"number"==typeof t&&"number"==typeof s&&(i+=Math.pow(t-s,2))}return i}))}}function i(e,t){2*t>e&&(t=e-t);let r=1;for(let n=1;n<=t;n++)r*=(e-t+n)/n;return Math.round(r)}function u(e,t){for(e<t&&([e,t]=[t,e]);t>0;)[e,t]=[t,e%t];return e}function l(e,t){return 0===e||0===t?0:e*(t/u(e,t))}t.MathPlugin=a,a.implementedFunctions={FACT:{method:"fact",parameters:[{argumentType:o.FunctionArgumentType.NUMBER,minValue:0,maxValue:170}]},FACTDOUBLE:{method:"factdouble",parameters:[{argumentType:o.FunctionArgumentType.NUMBER,minValue:0,maxValue:288}]},COMBIN:{method:"combin",parameters:[{argumentType:o.FunctionArgumentType.NUMBER,minValue:0,lessThan:1030},{argumentType:o.FunctionArgumentType.NUMBER,minValue:0}]},COMBINA:{method:"combina",parameters:[{argumentType:o.FunctionArgumentType.NUMBER,minValue:0},{argumentType:o.FunctionArgumentType.NUMBER,minValue:0}]},GCD:{method:"gcd",parameters:[{argumentType:o.FunctionArgumentType.ANY}],repeatLastArgs:1},LCM:{method:"lcm",parameters:[{argumentType:o.FunctionArgumentType.ANY}],repeatLastArgs:1},MROUND:{method:"mround",parameters:[{argumentType:o.FunctionArgumentType.NUMBER},{argumentType:o.FunctionArgumentType.NUMBER}]},MULTINOMIAL:{method:"multinomial",parameters:[{argumentType:o.FunctionArgumentType.NUMBER}],repeatLastArgs:1,expandRanges:!0},QUOTIENT:{method:"quotient",parameters:[{argumentType:o.FunctionArgumentType.NUMBER},{argumentType:o.FunctionArgumentType.NUMBER}]},SERIESSUM:{method:"seriessum",parameters:[{argumentType:o.FunctionArgumentType.NUMBER},{argumentType:o.FunctionArgumentType.NUMBER},{argumentType:o.FunctionArgumentType.NUMBER},{argumentType:o.FunctionArgumentType.RANGE}]},SIGN:{method:"sign",parameters:[{argumentType:o.FunctionArgumentType.NUMBER}]},SUMX2MY2:{method:"sumx2my2",parameters:[{argumentType:o.FunctionArgumentType.RANGE},{argumentType:o.FunctionArgumentType.RANGE}]},SUMX2PY2:{method:"sumx2py2",parameters:[{argumentType:o.FunctionArgumentType.RANGE},{argumentType:o.FunctionArgumentType.RANGE}]},SUMXMY2:{method:"sumxmy2",parameters:[{argumentType:o.FunctionArgumentType.RANGE},{argumentType:o.FunctionArgumentType.RANGE}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.ComplexPlugin=void 0;var n=r(106),s=r(151),o=r(192),a=r(189);class i extends a.FunctionPlugin{complex(e,t){return this.runFunction(e.args,t,this.metadata("COMPLEX"),((e,t,r)=>"i"!==r&&"j"!==r?new n.CellError(n.ErrorType.VALUE,s.ErrorMessage.ShouldBeIorJ):(0,o.coerceComplexToString)([e,t],r)))}imabs(e,t){return this.runFunction(e.args,t,this.metadata("IMABS"),E)}imaginary(e,t){return this.runFunction(e.args,t,this.metadata("IMAGINARY"),(([e,t])=>t))}imreal(e,t){return this.runFunction(e.args,t,this.metadata("IMREAL"),(([e,t])=>e))}imargument(e,t){return this.runFunction(e.args,t,this.metadata("IMARGUMENT"),(([e,t])=>0===e&&0===t?new n.CellError(n.ErrorType.DIV_BY_ZERO):Math.atan2(t,e)))}imconjugate(e,t){return this.runFunction(e.args,t,this.metadata("IMCONJUGATE"),(([e,t])=>(0,o.coerceComplexToString)([e,-t])))}imcos(e,t){return this.runFunction(e.args,t,this.metadata("IMCOS"),(e=>(0,o.coerceComplexToString)(h(e))))}imcosh(e,t){return this.runFunction(e.args,t,this.metadata("IMCOSH"),(e=>(0,o.coerceComplexToString)(d(e))))}imcot(e,t){return this.runFunction(e.args,t,this.metadata("IMCOT"),(e=>(0,o.coerceComplexToString)(c(h(e),p(e)))))}imcsc(e,t){return this.runFunction(e.args,t,this.metadata("IMCSC"),(e=>(0,o.coerceComplexToString)(c([1,0],p(e)))))}imcsch(e,t){return this.runFunction(e.args,t,this.metadata("IMCSCH"),(e=>(0,o.coerceComplexToString)(c([1,0],m(e)))))}imsec(e,t){return this.runFunction(e.args,t,this.metadata("IMSEC"),(e=>(0,o.coerceComplexToString)(c([1,0],h(e)))))}imsech(e,t){return this.runFunction(e.args,t,this.metadata("IMSECH"),(e=>(0,o.coerceComplexToString)(c([1,0],d(e)))))}imsin(e,t){return this.runFunction(e.args,t,this.metadata("IMSIN"),(e=>(0,o.coerceComplexToString)(p(e))))}imsinh(e,t){return this.runFunction(e.args,t,this.metadata("IMSINH"),(e=>(0,o.coerceComplexToString)(m(e))))}imtan(e,t){return this.runFunction(e.args,t,this.metadata("IMTAN"),(e=>(0,o.coerceComplexToString)(c(p(e),h(e)))))}imdiv(e,t){return this.runFunction(e.args,t,this.metadata("IMDIV"),((e,t)=>(0,o.coerceComplexToString)(c(e,t))))}improduct(e,t){return this.runFunction(e.args,t,this.metadata("IMPRODUCT"),((...e)=>{const t=this.arithmeticHelper.coerceComplexExactRanges(e);if(t instanceof n.CellError)return t;let r=[1,0];for(const e of t)r=l(r,e);return(0,o.coerceComplexToString)(r)}))}imsum(e,t){return this.runFunction(e.args,t,this.metadata("IMSUM"),((...e)=>{const t=this.arithmeticHelper.coerceComplexExactRanges(e);if(t instanceof n.CellError)return t;let r=[0,0];for(const e of t)r=u(r,e);return(0,o.coerceComplexToString)(r)}))}imsub(e,t){return this.runFunction(e.args,t,this.metadata("IMSUB"),((e,t)=>(0,o.coerceComplexToString)(function([e,t],[r,n]){return[e-r,t-n]}(e,t))))}imexp(e,t){return this.runFunction(e.args,t,this.metadata("IMEXP"),(e=>(0,o.coerceComplexToString)(g(e))))}imln(e,t){return this.runFunction(e.args,t,this.metadata("IMLN"),(e=>(0,o.coerceComplexToString)(T(e))))}imlog10(e,t){return this.runFunction(e.args,t,this.metadata("IMLOG10"),(e=>{const[t,r]=T(e),n=Math.log(10);return(0,o.coerceComplexToString)([t/n,r/n])}))}imlog2(e,t){return this.runFunction(e.args,t,this.metadata("IMLOG2"),(e=>{const[t,r]=T(e),n=Math.log(2);return(0,o.coerceComplexToString)([t/n,r/n])}))}impower(e,t){return this.runFunction(e.args,t,this.metadata("IMPOWER"),((e,t)=>(0,o.coerceComplexToString)(y(e,t))))}imsqrt(e,t){return this.runFunction(e.args,t,this.metadata("IMSQRT"),(e=>(0,o.coerceComplexToString)(y(e,.5))))}}function u([e,t],[r,n]){return[e+r,t+n]}function l([e,t],[r,n]){return[e*r-t*n,e*n+r*t]}function c([e,t],[r,n]){const s=Math.pow(r,2)+Math.pow(n,2),[o,a]=l([e,t],[r,-n]);return[o/s,a/s]}function h([e,t]){return[Math.cos(e)*Math.cosh(t),-Math.sin(e)*Math.sinh(t)]}function d([e,t]){return[Math.cosh(e)*Math.cos(t),Math.sinh(e)*Math.sin(t)]}function p([e,t]){return[Math.sin(e)*Math.cosh(t),Math.cos(e)*Math.sinh(t)]}function m([e,t]){return[Math.sinh(e)*Math.cos(t),Math.cosh(e)*Math.sin(t)]}function g([e,t]){return[Math.exp(e)*Math.cos(t),Math.exp(e)*Math.sin(t)]}function E([e,t]){return Math.sqrt(e*e+t*t)}function T([e,t]){return[Math.log(E([e,t])),Math.atan2(t,e)]}function y(e,t){const[r,n]=T(e);return g([t*r,t*n])}t.ComplexPlugin=i,i.implementedFunctions={COMPLEX:{method:"complex",parameters:[{argumentType:a.FunctionArgumentType.NUMBER},{argumentType:a.FunctionArgumentType.NUMBER},{argumentType:a.FunctionArgumentType.STRING,defaultValue:"i"}]},IMABS:{method:"imabs",parameters:[{argumentType:a.FunctionArgumentType.COMPLEX}]},IMAGINARY:{method:"imaginary",parameters:[{argumentType:a.FunctionArgumentType.COMPLEX}]},IMREAL:{method:"imreal",parameters:[{argumentType:a.FunctionArgumentType.COMPLEX}]},IMARGUMENT:{method:"imargument",parameters:[{argumentType:a.FunctionArgumentType.COMPLEX}]},IMCONJUGATE:{method:"imconjugate",parameters:[{argumentType:a.FunctionArgumentType.COMPLEX}]},IMCOS:{method:"imcos",parameters:[{argumentType:a.FunctionArgumentType.COMPLEX}]},IMCOSH:{method:"imcosh",parameters:[{argumentType:a.FunctionArgumentType.COMPLEX}]},IMCOT:{method:"imcot",parameters:[{argumentType:a.FunctionArgumentType.COMPLEX}]},IMCSC:{method:"imcsc",parameters:[{argumentType:a.FunctionArgumentType.COMPLEX}]},IMCSCH:{method:"imcsch",parameters:[{argumentType:a.FunctionArgumentType.COMPLEX}]},IMSEC:{method:"imsec",parameters:[{argumentType:a.FunctionArgumentType.COMPLEX}]},IMSECH:{method:"imsech",parameters:[{argumentType:a.FunctionArgumentType.COMPLEX}]},IMSIN:{method:"imsin",parameters:[{argumentType:a.FunctionArgumentType.COMPLEX}]},IMSINH:{method:"imsinh",parameters:[{argumentType:a.FunctionArgumentType.COMPLEX}]},IMTAN:{method:"imtan",parameters:[{argumentType:a.FunctionArgumentType.COMPLEX}]},IMDIV:{method:"imdiv",parameters:[{argumentType:a.FunctionArgumentType.COMPLEX},{argumentType:a.FunctionArgumentType.COMPLEX}]},IMPRODUCT:{method:"improduct",parameters:[{argumentType:a.FunctionArgumentType.ANY}],repeatLastArgs:1},IMSUM:{method:"imsum",parameters:[{argumentType:a.FunctionArgumentType.ANY}],repeatLastArgs:1},IMSUB:{method:"imsub",parameters:[{argumentType:a.FunctionArgumentType.COMPLEX},{argumentType:a.FunctionArgumentType.COMPLEX}]},IMEXP:{method:"imexp",parameters:[{argumentType:a.FunctionArgumentType.COMPLEX}]},IMLN:{method:"imln",parameters:[{argumentType:a.FunctionArgumentType.COMPLEX}]},IMLOG10:{method:"imlog10",parameters:[{argumentType:a.FunctionArgumentType.COMPLEX}]},IMLOG2:{method:"imlog2",parameters:[{argumentType:a.FunctionArgumentType.COMPLEX}]},IMPOWER:{method:"impower",parameters:[{argumentType:a.FunctionArgumentType.COMPLEX},{argumentType:a.FunctionArgumentType.NUMBER}]},IMSQRT:{method:"imsqrt",parameters:[{argumentType:a.FunctionArgumentType.COMPLEX}]}}},function(e,t,r){"use strict";t.__esModule=!0,t.StatisticalAggregationPlugin=void 0,r(3),r(73),r(94);var n=r(106),s=r(151),o=r(160),a=r(286),i=r(189);class u extends i.FunctionPlugin{avedev(e,t){return this.runFunction(e.args,t,this.metadata("AVEDEV"),((...e)=>{const t=this.arithmeticHelper.coerceNumbersExactRanges(e);if(t instanceof n.CellError)return t;if(0===t.length)return new n.CellError(n.ErrorType.DIV_BY_ZERO);const r=(0,a.mean)(t);return t.reduce(((e,t)=>e+Math.abs(t-r)),0)/t.length}))}devsq(e,t){return this.runFunction(e.args,t,this.metadata("DEVSQ"),((...e)=>{const t=this.arithmeticHelper.coerceNumbersExactRanges(e);return t instanceof n.CellError?t:0===t.length?0:(0,a.sumsqerr)(t)}))}geomean(e,t){return this.runFunction(e.args,t,this.metadata("GEOMEAN"),((...e)=>{const t=this.arithmeticHelper.coerceNumbersExactRanges(e);if(t instanceof n.CellError)return t;if(0===t.length)return new n.CellError(n.ErrorType.NUM,s.ErrorMessage.OneValue);for(const e of t)if(e<=0)return new n.CellError(n.ErrorType.NUM,s.ErrorMessage.ValueSmall);return(0,a.geomean)(t)}))}harmean(e,t){return this.runFunction(e.args,t,this.metadata("HARMEAN"),((...e)=>{const t=this.arithmeticHelper.coerceNumbersExactRanges(e);if(t instanceof n.CellError)return t;if(0===t.length)return new n.CellError(n.ErrorType.NUM,s.ErrorMessage.OneValue);for(const e of t)if(e<=0)return new n.CellError(n.ErrorType.NUM,s.ErrorMessage.ValueSmall);return t.length/t.reduce(((e,t)=>e+1/t),0)}))}correl(e,t){return this.runFunction(e.args,t,this.metadata("CORREL"),((e,t)=>{if(e.numberOfElements()!==t.numberOfElements())return new n.CellError(n.ErrorType.NA,s.ErrorMessage.EqualLength);const r=l(e,t);if(r instanceof n.CellError)return r;return r[0].length<=1?new n.CellError(n.ErrorType.DIV_BY_ZERO,s.ErrorMessage.TwoValues):(0,a.corrcoeff)(r[0],r[1])}))}rsq(e,t){return this.runFunction(e.args,t,this.metadata("RSQ"),((e,t)=>{if(e.numberOfElements()!==t.numberOfElements())return new n.CellError(n.ErrorType.NA,s.ErrorMessage.EqualLength);const r=l(e,t);if(r instanceof n.CellError)return r;return r[0].length<=1?new n.CellError(n.ErrorType.DIV_BY_ZERO,s.ErrorMessage.TwoValues):Math.pow((0,a.corrcoeff)(r[0],r[1]),2)}))}covariancep(e,t){return this.runFunction(e.args,t,this.metadata("COVARIANCE.P"),((e,t)=>{if(e.numberOfElements()!==t.numberOfElements())return new n.CellError(n.ErrorType.NA,s.ErrorMessage.EqualLength);const r=l(e,t);if(r instanceof n.CellError)return r;const o=r[0].length;return o<1?new n.CellError(n.ErrorType.DIV_BY_ZERO,s.ErrorMessage.OneValue):1===o?0:(0,a.covariance)(r[0],r[1])*(o-1)/o}))}covariances(e,t){return this.runFunction(e.args,t,this.metadata("COVARIANCE.S"),((e,t)=>{if(e.numberOfElements()!==t.numberOfElements())return new n.CellError(n.ErrorType.NA,s.ErrorMessage.EqualLength);const r=l(e,t);if(r instanceof n.CellError)return r;return r[0].length<=1?new n.CellError(n.ErrorType.DIV_BY_ZERO,s.ErrorMessage.TwoValues):(0,a.covariance)(r[0],r[1])}))}ztest(e,t){return this.runFunction(e.args,t,this.metadata("Z.TEST"),((e,t,r)=>{const o=this.arithmeticHelper.manyToExactNumbers(e.valuesFromTopLeftCorner());if(o instanceof n.CellError)return o;const i=o.length;if(void 0===r){if(i<2)return new n.CellError(n.ErrorType.DIV_BY_ZERO,s.ErrorMessage.TwoValues);r=(0,a.stdev)(o,!0)}return i<1?new n.CellError(n.ErrorType.NA,s.ErrorMessage.OneValue):0===r?new n.CellError(n.ErrorType.DIV_BY_ZERO):1-a.normal.cdf(((0,a.mean)(o)-t)/(r/Math.sqrt(i)),0,1)}))}ftest(e,t){return this.runFunction(e.args,t,this.metadata("F.TEST"),((e,t)=>{const r=this.arithmeticHelper.manyToExactNumbers(e.valuesFromTopLeftCorner()),s=this.arithmeticHelper.manyToExactNumbers(t.valuesFromTopLeftCorner());if(r instanceof n.CellError)return r;if(s instanceof n.CellError)return s;if(r.length<=1||s.length<=1)return new n.CellError(n.ErrorType.DIV_BY_ZERO);const o=(0,a.variance)(r,!0),i=(0,a.variance)(s,!0);if(0===o||0===i)return new n.CellError(n.ErrorType.DIV_BY_ZERO);const u=o/i,l=a.centralF.cdf(u,r.length-1,s.length-1);return 2*Math.min(l,1-l)}))}steyx(e,t){return this.runFunction(e.args,t,this.metadata("STEYX"),((e,t)=>{if(e.numberOfElements()!==t.numberOfElements())return new n.CellError(n.ErrorType.NA,s.ErrorMessage.EqualLength);const r=l(e,t);if(r instanceof n.CellError)return r;const o=r[0].length;return o<=2?new n.CellError(n.ErrorType.DIV_BY_ZERO,s.ErrorMessage.ThreeValues):Math.sqrt(((0,a.sumsqerr)(r[0])-Math.pow((0,a.covariance)(r[0],r[1])*(o-1),2)/(0,a.sumsqerr)(r[1]))/(o-2))}))}slope(e,t){return this.runFunction(e.args,t,this.metadata("SLOPE"),((e,t)=>{if(e.numberOfElements()!==t.numberOfElements())return new n.CellError(n.ErrorType.NA,s.ErrorMessage.EqualLength);const r=l(e,t);if(r instanceof n.CellError)return r;const o=r[0].length;return o<=1?new n.CellError(n.ErrorType.DIV_BY_ZERO,s.ErrorMessage.TwoValues):(0,a.covariance)(r[0],r[1])*(o-1)/(0,a.sumsqerr)(r[1])}))}chisqtest(e,t){return this.runFunction(e.args,t,this.metadata("CHISQ.TEST"),((e,t)=>{const r=e.height(),o=e.width();if(t.height()!==r||t.width()!==o)return new n.CellError(n.ErrorType.NA,s.ErrorMessage.EqualLength);const i=l(e,t);if(i instanceof n.CellError)return i;if(i[0].length<=1)return new n.CellError(n.ErrorType.DIV_BY_ZERO,s.ErrorMessage.TwoValues);let u=0;for(let e=0;e<i[0].length;e++){if(0===i[1][e])return new n.CellError(n.ErrorType.DIV_BY_ZERO);u+=Math.pow(i[0][e]-i[1][e],2)/i[1][e]}return u<0?new n.CellError(n.ErrorType.NUM,s.ErrorMessage.NaN):1-a.chisquare.cdf(u,r>1&&o>1?(r-1)*(o-1):r*o-1)}))}ttest(e,t){return this.runFunction(e.args,t,this.metadata("T.TEST"),((e,t,r,o)=>{const i=this.arithmeticHelper.manyToExactNumbers(e.valuesFromTopLeftCorner()),u=this.arithmeticHelper.manyToExactNumbers(t.valuesFromTopLeftCorner());if(i instanceof n.CellError)return i;if(u instanceof n.CellError)return u;const l=i.length,c=u.length;if(1===o){if(c!==l)return new n.CellError(n.ErrorType.NA,s.ErrorMessage.EqualLength);if(l<=1)return new n.CellError(n.ErrorType.DIV_BY_ZERO,s.ErrorMessage.TwoValues);const e=Array(l);for(let t=0;t<l;t++)e[t]=i[t]-u[t];const t=(0,a.stdev)(e,!0);if(0===t)return new n.CellError(n.ErrorType.DIV_BY_ZERO);const o=Math.abs(Math.sqrt(l)*(0,a.mean)(e)/t);return r*(1-a.studentt.cdf(o,l-1))}if(2===o){if(l<=1||c<=1)return new n.CellError(n.ErrorType.DIV_BY_ZERO,s.ErrorMessage.TwoValues);const e=((0,a.sumsqerr)(i)+(0,a.sumsqerr)(u))/(l+c-2);if(0===e)return new n.CellError(n.ErrorType.DIV_BY_ZERO);const t=Math.abs(((0,a.mean)(i)-(0,a.mean)(u))/Math.sqrt(e*(1/l+1/c)));return r*(1-a.studentt.cdf(t,l+c-2))}{if(l<=1||c<=1)return new n.CellError(n.ErrorType.DIV_BY_ZERO,s.ErrorMessage.TwoValues);const e=(0,a.variance)(i,!0),t=(0,a.variance)(u,!0);if(0===e&&0===t)return new n.CellError(n.ErrorType.DIV_BY_ZERO);const o=Math.abs(((0,a.mean)(i)-(0,a.mean)(u))/Math.sqrt(e/l+t/c)),h=Math.pow(e/l+t/c,2)/(Math.pow(e/l,2)/(l-1)+Math.pow(t/c,2)/(c-1));return r*(1-a.studentt.cdf(o,h))}}))}skew(e,t){return this.runFunction(e.args,t,this.metadata("SKEW"),((...e)=>{const t=this.arithmeticHelper.coerceNumbersExactRanges(e);if(t instanceof n.CellError)return t;const r=t.length;if(r<3)return new n.CellError(n.ErrorType.DIV_BY_ZERO,s.ErrorMessage.ThreeValues);const o=(0,a.mean)(t),i=(0,a.stdev)(t,!0);return 0===i?new n.CellError(n.ErrorType.DIV_BY_ZERO):t.reduce(((e,t)=>e+Math.pow((t-o)/i,3)),0)*r/(r-1)/(r-2)}))}skewp(e,t){return this.runFunction(e.args,t,this.metadata("SKEW.P"),((...e)=>{const t=this.arithmeticHelper.coerceNumbersExactRanges(e);if(t instanceof n.CellError)return t;const r=t.length;if(r<3)return new n.CellError(n.ErrorType.DIV_BY_ZERO,s.ErrorMessage.ThreeValues);const o=(0,a.mean)(t),i=(0,a.stdev)(t,!1);return 0===i?new n.CellError(n.ErrorType.DIV_BY_ZERO):t.reduce(((e,t)=>e+Math.pow((t-o)/i,3)),0)/r}))}}function l(e,t){const r=e.iterateValuesFromTopLeftCorner(),s=t.iterateValuesFromTopLeftCorner();let a,i;const u=[],l=[];for(;a=r.next(),i=s.next(),!a.done&&!i.done;){const e=a.value,t=i.value;if(e instanceof n.CellError)return e;if(t instanceof n.CellError)return t;(0,o.isExtendedNumber)(e)&&(0,o.isExtendedNumber)(t)&&(u.push((0,o.getRawValue)(e)),l.push((0,o.getRawValue)(t)))}return[u,l]}t.StatisticalAggregationPlugin=u,u.implementedFunctions={AVEDEV:{method:"avedev",parameters:[{argumentType:i.FunctionArgumentType.ANY}],repeatLastArgs:1},DEVSQ:{method:"devsq",parameters:[{argumentType:i.FunctionArgumentType.ANY}],repeatLastArgs:1},GEOMEAN:{method:"geomean",parameters:[{argumentType:i.FunctionArgumentType.ANY}],repeatLastArgs:1},HARMEAN:{method:"harmean",parameters:[{argumentType:i.FunctionArgumentType.ANY}],repeatLastArgs:1},CORREL:{method:"correl",parameters:[{argumentType:i.FunctionArgumentType.RANGE},{argumentType:i.FunctionArgumentType.RANGE}]},RSQ:{method:"rsq",parameters:[{argumentType:i.FunctionArgumentType.RANGE},{argumentType:i.FunctionArgumentType.RANGE}]},"COVARIANCE.P":{method:"covariancep",parameters:[{argumentType:i.FunctionArgumentType.RANGE},{argumentType:i.FunctionArgumentType.RANGE}]},"COVARIANCE.S":{method:"covariances",parameters:[{argumentType:i.FunctionArgumentType.RANGE},{argumentType:i.FunctionArgumentType.RANGE}]},"Z.TEST":{method:"ztest",parameters:[{argumentType:i.FunctionArgumentType.RANGE},{argumentType:i.FunctionArgumentType.NUMBER},{argumentType:i.FunctionArgumentType.NUMBER,optionalArg:!0}]},"F.TEST":{method:"ftest",parameters:[{argumentType:i.FunctionArgumentType.RANGE},{argumentType:i.FunctionArgumentType.RANGE}]},STEYX:{method:"steyx",parameters:[{argumentType:i.FunctionArgumentType.RANGE},{argumentType:i.FunctionArgumentType.RANGE}]},SLOPE:{method:"slope",parameters:[{argumentType:i.FunctionArgumentType.RANGE},{argumentType:i.FunctionArgumentType.RANGE}]},"CHISQ.TEST":{method:"chisqtest",parameters:[{argumentType:i.FunctionArgumentType.RANGE},{argumentType:i.FunctionArgumentType.RANGE}]},"T.TEST":{method:"ttest",parameters:[{argumentType:i.FunctionArgumentType.RANGE},{argumentType:i.FunctionArgumentType.RANGE},{argumentType:i.FunctionArgumentType.INTEGER,minValue:1,maxValue:2},{argumentType:i.FunctionArgumentType.INTEGER,minValue:1,maxValue:3}]},SKEW:{method:"skew",parameters:[{argumentType:i.FunctionArgumentType.ANY}],repeatLastArgs:1},"SKEW.P":{method:"skewp",parameters:[{argumentType:i.FunctionArgumentType.ANY}],repeatLastArgs:1}},u.aliases={COVAR:"COVARIANCE.P",FTEST:"F.TEST",PEARSON:"CORREL",ZTEST:"Z.TEST",CHITEST:"CHISQ.TEST",TTEST:"T.TEST",COVARIANCEP:"COVARIANCE.P",COVARIANCES:"COVARIANCE.S",SKEWP:"SKEW.P"}}]).default}));